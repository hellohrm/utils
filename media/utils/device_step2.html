<div class="device-page__content messages-page" vi="JTdCJTIyanNfMDA5XzMxJTIyJTNBJTVCJTIyUyVFMSVCQiU5MSUyMGwlQzYlQjAlRTElQkIlQTNuZyUyMHRoaSVFMSVCQSVCRnQlMjBiJUUxJUJCJThCJTIyJTJDJTIyVCVFMSVCQiU5NW5nJTIwcyVFMSVCQiU5MSUyMG5oJUMzJUEybiUyMHZpJUMzJUFBbiUyMiUyQyUyMlQlRTElQkIlOTVuZyUyMHMlRTElQkIlOTElMjBMb2clMjB0aCVFMSVCQSVCQiUyMiUyQyUyMlQlRTElQkIlQUIlMjBuZyVDMyVBMHklMjIlMkMlMjIlQzQlOTAlRTElQkElQkZuJTIwbmclQzMlQTB5JTIyJTJDJTIyVCVFMSVCQSVBM2klMjBsJUUxJUJBJUExaSUyMiUyQyUyMlhlbSUyMiUyQyUyMlh1JUUxJUJBJUE1dCUyMHQlRTElQkIlODdwJTIyJTVEJTJDJTIyanNfMDA5XzMyJTIyJTNBJTIyQ2glQzYlQjBhJTIwYyVDMyVCMyUyMHRoaSVFMSVCQSVCRnQlMjBiJUUxJUJCJThCLiUyMFZ1aSUyMGtpJUUxJUJCJTgzbSUyMHRyYSUyMHYlQzMlQTAlMjB0aCVFMSVCQiVBRCUyMGwlRTElQkElQTFpLiUyMiU3RA==">

    <div class="container-fluid h-100">
        <div class="row px-0 h-100">
            <!-- start message list section  -->
            <!--https://www.bootdey.com/snippets/view/Gradients-dashboard-cards-->
            <div class="col-12 px-0  pt-3 messages-page__list-scroll">

                <style type="text/css">


                    .cart_shake {
                        animation: shakeCart 0.4s ease-in-out forwards;
                         -webkit-animation: shakeCart 0.4s ease-in-out forwards;
                    }
                    @keyframes shakeCart {
                        /*https://codepen.io/machal/pen/nEbyqx*/
                        25% {
                            transform: translateX(15px);
                            -webkit-transform: translateX(15px);
                           -moz-transform:translateX(15px);
                           -o-transform:translateX(15px);
                        }

                        50% {
                            transform: translateX(-4px);
                            -webkit-transform:translateX(-4px);
                           -moz-transform:translateX(-4px);
                           -o-transform:translateX(-4px);
                        }

                        75% {
                            transform: translateX(10px);
                            -webkit-transform:  translateX(10px);
                           -moz-transform: translateX(10px);
                           -o-transform: translateX(10px);
                        }

                        100% {
                            transform: translateX(0);
                            -webkit-transform: translateX(0);
                           -moz-transform:translateX(0);
                           -o-transform:translateX(0);
                        }
                    }

                    .material-icons {
                        font-family: 'Material Icons';
                        font-weight: normal;
                        font-style: normal;
                        font-size: 15px; /* Preferred icon size */
                        display: inline-block;
                        line-height: 1;
                        text-transform: none;
                        letter-spacing: normal;
                        word-wrap: normal;
                        white-space: nowrap;
                        direction: ltr;
                        /* Support for all WebKit browsers. */
                        -webkit-font-smoothing: antialiased;
                        /* Support for Safari and Chrome. */
                        text-rendering: optimizeLegibility;
                        /* Support for Firefox. */
                        -moz-osx-font-smoothing: grayscale;
                        /* Support for IE. */
                        font-feature-settings: 'liga';
                    }


                    internetConection {
                        position: fixed;
                        z-index: 100;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        color: #666;
                        font-weight: 100;
                        background: rgba(255,255,255,0.75);
                        padding: 15px;
                        text-align: left;
                        font-size: 35px;
                        backdrop-filter: blur(15px);
                    }

                        internetConection off {
                            color: red;
                            display: none;
                        }

                        internetConection on {
                            color: green;
                            display: none;
                        }

                        internetConection span {
                            font-size: 75px !important;
                        }

                    .js_js_att internetconection {
                        position: absolute !important;
                    }

                    .mngusrs .hsnv {
                        position: absolute;
                        top: 5px;
                        left: 170px;
                        font-size:larger;
                        display:block!important;
                    }
                        .mngusrs .hsnv.vantay {
                            width: 50px;
                            height: 50px;
                        }

                    .mngusrs .server {
                        display:none!important;
                    }

                    .global {
                        max-width: 900px;
                        display: block;
                        margin: auto;
                        position: relative;
                        text-align: center;
                        padding: 10px;
                        width: 100%;
                    }

                        .global o_pos, .global *::after, .global *::before {
                            box-sizing: initial !important;
                        }

                    .headerx-lg {
                        position: absolute !important;
                        top: -20px !important;
                    }

                    headerx {
                        position: fixed;
                        top: 58px;
                        left: 10px;
                        right: 10px;
                        padding: 10px 0;
                        z-index: 50;
                        border-radius: 0 0 10px 10px;
                        /*background: rgba(255,255,255,0.5);*/
                        /*backdrop-filter: blur(15px);*/
                        transition: all 0.3s ease;
                    }

                    .stickyx {
                        box-shadow: 0px 5px 20px rgba(0,0,0,0.25);
                        padding: 10px 0 5px 0;
                    }

                        .stickyx counter .box {
                            padding: 5px;
                            width: 25%;
                            text-align: right;
                        }

                            .stickyx counter .box b {
                                display: none;
                            }

                            .stickyx counter .box span {
                                display: none;
                            }

                            .stickyx counter .box value {
                                font-size: 25px;
                                position: relative;
                                padding: 0px;
                            }

                                .stickyx counter .box value::before {
                                    content: "Schedule";
                                    position: absolute;
                                    top: -10px;
                                    left: 0;
                                    background: #ccc;
                                    font-size: 8px;
                                    padding: 2px 8px;
                                    width: 50%;
                                    border-radius: 5px;
                                    text-transform: uppercase;
                                }

                        .stickyx counter .ok value::before {
                            content: "Confirmed";
                        }

                        .stickyx counter .canceled value::before {
                            content: "Canceled";
                        }

                        .stickyx performance {
                            display: inline-block;
                            width: 60%;
                            font-size: 12px;
                            height: 20px;
                            line-height: 20px;
                            margin-bottom: 0;
                            position: relative;
                        }

                            .stickyx performance Bar, .stickyx performance status {
                                height: 20px;
                                line-height: 20px;
                            }

                        .stickyx actionLine {
                            display: inline-block;
                            width: auto;
                            padding: 0;
                            line-height: 20px;
                            margin-bottom: 0;
                            position: relative;
                            top: -7px;
                        }

                            .stickyx actionLine button {
                                font-size: 10px;
                            }

                    counter {
                        margin-bottom: 10px;
                        /*display: block;*/
                        width: 100%;
                        display: flex;
                        justify-content: space-evenly;
                    }

                    .box {
                        padding: 10px 0;
                        /*display: inline-block;*/
                        text-align: center;
                        background: rgba(191, 191, 191, 0.15);
                        width: 30%;
                        font-weight: 300;
                        border-radius: 10px;
                        font-size: 15px;
                        transition: all 0.3s ease;
                        display: flex;
                        flex-direction: column;
                    }

                        .box b {
                            display: block;
                            transition: all 0.3s ease;
                        }

                        .box value {
                            font-size: 50px;
                            display: block;
                            padding: 5px;
                            font-weight: 400;
                            transition: all 0.3s ease;
                            flex: 1;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        }

                        .box > span {
                            height: 30px;
                            line-height: 1.1;
                        }

                    .ok value {
                        color: green;
                    }

                    .canceled value {
                        color: red;
                    }

                    performance {
                        border: 1px solid #ccc;
                        padding: 0px;
                        display: block;
                        border-radius: 30px;
                        text-align: left;
                        overflow: hidden;
                        position: relative;
                        height: 30px;
                        margin-bottom: 10px;
                        transition: all 0.3s ease;
                    }

                        performance Bar {
                            height: 30px;
                            padding: 0 10px 0 0;
                            position: absolute;
                            border-radius: 15px;
                            text-align: right;
                            line-height: 30px;
                        }

                        performance .ok {
                            background: rgba(0,255,50,0.85);
                            z-index: 1;
                            color: green;
                        }

                        performance .canceled {
                            background: rgba(255,0,0,0.50);
                            z-index: 2;
                            color: rgba(255,50,0,0.90);
                        }

                        performance status {
                            display: block;
                            position: relative;
                            text-align: right;
                            line-height: 30px;
                            padding: 0 15px;
                            z-index: 3;
                            text-shadow: 1px 0 0 #fff, -1px 0 0 #fff, 0 1px 0 #fff, 0 -1px 0 #fff, 1px 1px #fff, -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff;
                        }

                    actionLine {
                        display: block;
                        text-align: right;
                        margin-bottom: 10px;
                    }

                        actionLine button, filter button {
                            border: none;
                            border-radius: 5px;
                            background: #ccc;
                            padding: 5px 10px;
                        }

                    filter {
                        display: none;
                        background: #ececec;
                        padding: 5px 0;
                        width: 90%;
                        margin: 0 auto 10px auto;
                        border-radius: 10px;
                    }

                        filter #lineFilter {
                            width: 80%;
                            border: 0;
                            border-bottom: 1px solid #666;
                            background: none;
                            line-height: 15px;
                            font-size: 12px;
                        }



                    .clientPanel {
                        display: block;
                        margin: 300px 0px 30px 0px;
                        padding: 10px;
                        border: 1px solid #ccc;
                        border-radius: 10px;
                    }

                    .darkcolor .clientPanel {
                        border-color: #4d4d4d !important;
                    }

                    .clientPanel h2 {
                        background: #fff;
                        display: flex;
                        min-height: 70px;
                        justify-content: center;
                        align-items: center;
                        margin: -45px auto 0 auto;
                        width: 180px;
                        box-shadow: rgba(207, 203,203,0.48) 6px 2px 16px 0px, rgba(218,218,218, 0.8) -6px -2px 16px 0px;
                        border-radius: 10px;
                    }

                    .darkcolor .clientPanel h2 {
                        background: black !important;
                    }

                    .clientPanel obj_att {
                        text-align: left;
                        display: block;
                        /*overflow: hidden;*/
                        padding: 10px 10px;
                        border-radius: 5px;
                    }

                        .clientPanel obj_att:nth-child(even) {
                            background: rgba(191, 191, 191, 0.3);
                        }

                            .clientPanel obj_att:nth-child(even) .progress {
                                background: #fff;
                            }


                            .container_x .clientPanel obj_att:nth-child(n+3) {
                                /*n+3: vi first child la h2*/
                                /*nhieu hon 1 mcc, download progress thay doi height, skew*/
                               display:none!important;
                            }

                            .container_x .client_dienthoai .clientPanel obj_att,.JS_JS_payrollonline.client_dienthoai .clientPanel{
                                /*phone thi ko can height dai.*/
                               display:none!important;
                            }

                    .JS_JS_payrollonline.client_dienthoai headerx {
                        margin-bottom:0!important;
                    }

                            .container_x .client_dienthoai .clientPanel,.JS_JS_payrollonline.client_dienthoai .clientPanel{
                                /*phone thi ko can height dai.*/
                               visibility:hidden!important;
                            }


                    .container_x .client_dienthoai .clientPanel {
                        display:block!important;
                    }
                            




                    .clientPanel .card-footer {
                        border-top: none !important;
                        background: none !important;
                    }

                    .rtevt_the {
                        transform: rotate(-15deg);
                    }


                    .arw_in {
                        border-top: 1px dashed gray;
                        padding-top: 10px;
                    }

                        .arw_in:before {
                            content: "\f04b";
                            position: absolute;
                            font: normal normal normal 11px/1 FontAwesome;
                            top: -5px;
                            left: 1px;
                            transform: rotate(60deg);
                            color: gray;
                        }

                        .arw_in:after {
                            content: "\f04b";
                            position: absolute;
                            font: normal normal normal 11px/1 FontAwesome;
                            top: -5px;
                            right: 1px;
                            transform: rotate(120deg);
                            color: gray;
                        }

                    .line_gio:before {
                        content: "";
                        position: absolute;
                        top: 0px;
                        left: 0px;
                        width: 1px;
                        height: 60px;
                        border-left: 1px dashed gray;
                    }


                    .orgi_tg {
                        position: absolute;
                        left: -10px;
                        font-size: 9px;
                        top: -12px;
                    }

                    .orgi_tg1 {
                        font-size: 8px;
                        display: block;
                        background: #ccc;
                        border-radius: 2px;
                        position: absolute;
                        padding: 2px;
                        top: -14px;
                    }

                    .orgi_ou {
                        left: initial;
                        right: -10px;
                    }

                    .inputs__dates {
                        font-size: 15px !important;
                    }

                        .inputs__dates input {
                            border-radius: 0 !important;
                            border: none;
                            outline: none;
                            background: transparent;
                            box-sizing: border-box;
                            border-top: 1px solid #ccc;
                            line-height: normal !important;
                            text-align: center;
                            color: #a19f9f;
                            transition: all 0.3s;
                            padding-top: 5px;
                            margin-right: 5px !important;
                        }

                    .darkcolor .inputs__dates input::-webkit-calendar-picker-indicator {
                        filter: invert(1);
                    }
                </style>

                <internetconection>
                    <off>
                        Please, verify your
                        <br /> internet connection
                        <span class="material-icons">
                            signal_wifi_bad
                        </span>
                    </off>
                    <on>
                        Your internet
                        <br /> connection is ready
                        <span class="fa fa-wifi"></span>
                    </on>

                    <style type="text/css">
                        /*https://www.youtube.com/watch?v=EuE13Y5qjzY&t=637s*/
                        .cardx {
                            position: absolute;
                            width: 100px;
                            height: 200px;
                            margin-top: -75px;
                            left: 100px;
                            z-index: 1;
                        }

                            .cardx .rating {
                                position: relative;
                                width: 100%;
                                height: 100%;
                            }

                                .cardx .rating .block {
                                    position: absolute;

                                    /*width: 2px;
                                    height: 15px;
                                    background: #333;*/

                                    left: 50%;
                                    transform-origin: 50% 100px;
                                    opacity: 0;
                                    animation: animate 0.1s linear forwards;
                                    z-index: 2;
                                    /*box-shadow:0 0 15px #383c38, 0 0 30px #a8aba8;*/
                                    width: 2px;
                                    height: 15px;
                                    background:transparent;
                                    border-bottom: 8px solid #333;
                                }

                                    .cardx .rating .block.val {
                                        background: #0f0;
                                        /*box-shadow:0 0 15px #0f0,0 0 30px #0f0;*/
                                        /*animation-delay:0.05s;*/
                                        border-bottom: none; 
                                    }

                                        .cardx .rating .block.val.err {
                                            background: #f00 !important;
                                            /*box-shadow:0 0 15px #0f0,0 0 30px #0f0;*/
                                            /*animation-delay:0.05s;*/
                                        }



                        @keyframes animate {
                            to {
                                opacity: 1;
                            }
                        }

                        .cardx .rating h2 {
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%,-50%);
                            color: hotpink;
                        }

                            .cardx .rating h2.slash {
                                -webkit-animation: fade-in-out 2.5s infinite;
                                -moz-animation: fade-in-out 2.5s infinite;
                                -o-animation: fade-in-out 2.5s infinite;
                                animation: fade-in-out 2.5s infinite;
                            }
                    </style>


                    <div class="text-success">
                        <div class="box_conn">
                            <div class="text_conn text-uppercase" style="">
                                LOADING ...
                            </div>

                            <div class="comp"> </div>

                            <div class="loader_conn"></div>
                            <div class="con"></div><div class="byte"></div>

                            <div class="server"> </div>


                            <div class="cardx d-none">
                                <div class="rating">
                                    <h2 class="slash"><span class="phantram" data-target="0">0</span><sup>%</sup></h2>
                                    <div class="block"></div>
                                </div>
                            </div>

                            <div class="hsnv" style="display:none">
                                <i class="fa fa-users" style="position: absolute;"></i>
                            </div>

                        </div>

                        <div class="dog_canvas"> </div>
                    </div>


                </internetconection>

                <div class="global invisible">
                    <!--https://bootsnipp.com/snippets/aMVZE-->
                    <headerx class="headerx-lg">
                        <!--https://codepen.io/tunglam/pen/xxZqrbr-->
                        <!--https://dev.to/jankapunkt/make-text-fit-it-s-parent-size-using-javascript-m40-->
                        <counter>
                            <div class="box schedule">
                                <span class="mx-1" data-lang="js_009_31|0">Quantity Devices</span>
                                <value>
                                    <span>-</span>
                                </value>
                            </div>
                            <div class="box ok">
                                <span class="mx-1" data-lang="js_009_31|1">Total Employees</span>
                                <value>
                                    <span>-</span>
                                </value>
                            </div>
                            <div class="box canceled">
                                <span class="mx-1" data-lang="js_009_31|2">Number of logs</span>
                                <value>
                                    <span>-</span>
                                </value>
                            </div>
                        </counter>

                        <div class="row no-gutters mx-auto" style="max-width: 380px;">
                            <div class="inputs__dates col-6">
                                <div data-lang="js_009_31|3">From date</div>
                                <input type="date" />
                            </div>
                            <div class="inputs__dates  col-6">
                                <div data-lang="js_009_31|4">To date</div>
                                <input type="date" />
                            </div>
                        </div>

                        <actionline class="mt-3 text-center">
                            <div class="btn btn-warning ">
                                <i class="ti-reload"></i>
                                <span data-lang="js_009_31|5">Reload</span>
                            </div>
                            <div class="btn btn-primary  viewlogs" data-lang="js_009_31|6">View</div>
                            <div class="btn btn-success" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fa fa-download mr-2">
                                </i><span data-lang="js_009_31|7">Export</span>
                                <div class="dropdown-menu dropdown-light dropdown-menu-left dropdown-alignleft" style="max-width: 120px;min-width: 120px;">
                                    <a class="dropdown-item" href="#">.xlsx</a>
                                    <a class="dropdown-item" href="#">.csv</a>
                                    <a class="dropdown-item" href="#">.txt</a>
                                </div>
                            </div>
                        </actionline>

                        <filter>
                            <input type="text" name="lineFilter" id="lineFilter" placeholder="Type 3 letters or more" />
                            <button class="close">x</button>
                        </filter>

                    </headerx>


                    <clientpanel class="clientPanel">

                        <h2 class="px-2 mb-4">
                            <i class="ti-pie-chart"></i>
                            <span style="font-size:1.5rem">Thong ke chi tiet</span>
                        </h2>

                        <obj_att class="my-3 position-relative">
                            <div>
                                <div role="button" data-toggle="collapse" href=".collapse0">
                                    <div class="card-body pb-0 pt-1">
                                        <div class="row">
                                            <div class="col-12 ">
                                                <h4 class="card-title "><b>4000TID-C</b></h4>

                                            </div>
                                            <div class="col">
                                                <h6 class="card-subtitle mb-2">
                                                    <span class="text-success"><i class="fa fa-circle"></i>&nbsp;<span>online</span></span>
                                                    <p class="card-text text-muted small d-inline-block">
                                                        <span class="vl mr-2 ml-0"></span>
                                                        <span>
                                                            <i class="ti-time"></i>
                                                            <span class="timeago">-</span>
                                                        </span>
                                                    </p>
                                                </h6>
                                            </div>
                                        </div>
                                        <span class="d-flex">
                                            <span class="progress my-2 mr-3" style="height: 3px;flex:1">
                                                <span class="btn ti-angle-down" style="position: absolute;right: 0px;top:15px"></span>
                                                <span class="progress-bar bg-primary" role="progressbar" style="width: 80%"></span>
                                            </span>
                                            <span>80%</span>
                                        </span>
                                    </div>

                                    <div class="card-footer px-0 pb-0">
                                        <div class="row">

                                            <div class="col-md-auto">

                                                <a class="btn">
                                                    <span class="fa fa-id-card-o"></span>
                                                    <span class="mcc_inf">-</span>
                                                </a>

                                                <i class="mdi mdi-settings-outline"></i>


                                                <a class="btn">
                                                    <span class="ti-user" style="font-size:16px"></span>
                                                    <span class="mcc_inf">-</span>
                                                </a>
                                                <a class="btn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <span class="ti-more-alt" style="font-size:18px;vertical-align:middle"></span>
                                                    <small>MORE</small>
                                                </a>
                                                <div class="dropdown-menu dropdown-menu-right dropdown-menu-arrow">
                                                    <a class="dropdown-item" href="#">Action</a>
                                                    <a class="dropdown-item" href="#">Another action</a>
                                                    <a class="dropdown-item" href="#">Something else here</a>
                                                </div>

                                            </div>

                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="pt-3 panel-collapse collapse collapse0">
                                <div class="row no-gutters text-center pt-2">
                                    <span class="col-3 text-success">
                                        <span class="orgi_tg">06:00</span>
                                        In
                                    </span>
                                    <span class="col-3 line_gio text-danger">
                                        <span class="orgi_tg">08:05</span>
                                        Late
                                        <span class="orgi_tg1" style="right:2px">10:00</span>
                                    </span>

                                    <span class="col-3 line_gio text-danger">
                                        <span class="orgi_tg1" style="left:2px">14:00</span>
                                        Early
                                    </span>

                                    <span class="col-3 line_gio  text-success">
                                        <span class="orgi_tg">16:00</span>
                                        Out
                                        <span class="orgi_tg orgi_ou">18:00</span>
                                    </span>

                                </div>



                                <div class="row no-gutters text-center">
                                    <div class="col-3 arw_in text-success">
                                        <!--<span class="fa fa-id-card-o rtevt_the"></span>-->
                                        <span class="ml-1">-</span>
                                    </div>
                                    <div class="col-3 arw_in text-danger">
                                        <!--<span class="fa fa-id-card-o rtevt_the"></span>-->
                                        <span class="ml-1">-</span>
                                    </div>
                                    <div class="col-3 arw_in text-danger">
                                        <!--<span class="fa fa-id-card-o rtevt_the"></span>-->
                                        <span class="ml-1">-</span>
                                    </div>
                                    <div class="col-3 arw_in  text-success">
                                        <!--<span class="fa fa-id-card-o rtevt_the"></span>-->
                                        <span class="ml-1">-</span>
                                    </div>
                                </div>
                            </div>
                        </obj_att>

                        <style type="text/css">
                            #star {
                                margin-left: -5px !important;
                                vertical-align: bottom !important;
                                opacity: 0.5;
                            }


                            .more {
                                opacity: 0.5 !important;
                            }

                            /*.btn:hover {
                                color: black !important;
                            }*/

                            .vl {
                                margin: 8px !important;
                                width: 2px;
                                border-right: 1px solid #aaaaaa;
                                height: 25px;
                            }


                            #plus {
                                opacity: 0.8;
                            }


                            .card {
                                border-radius: 10px !important;
                            }

                            /*a:hover {
                                background-color: #ccc !important;
                            }*/



                            /*.btn-outlined:active {
                                color: #FFF;
                                border-color: #fff !important;
                            }*/


                            /*img {
                                cursor: pointer;
                                overflow: visible;
                            }*/

                            /*.btn:focus,
                            .btn:active {
                                outline: none !important;
                                box-shadow: none !important;
                            }*/
                        </style>

                    </clientpanel>



                    <style type="text/css">
                        .timesheet {
                            width: 100%;
                            height: 292px;
                            margin: 0 auto;
                        }

                        .timesheet {
                            border-top: 1px solid rgba(250,250,250,0.5);
                            background-color: #333;
                            position: relative;
                        }

                            .timesheet.color-scheme-default .bubble-default {
                                background-color: RGBA(252, 70, 74, 1);
                            }

                            .timesheet.color-scheme-default .bubble-lorem {
                                background-color: RGBA(154, 202, 39, 1);
                            }

                            .timesheet.color-scheme-default .bubble-ipsum {
                                background-color: RGBA(60, 182, 227, 1);
                            }

                            .timesheet.color-scheme-default .bubble-dolor {
                                background-color: RGBA(244, 207, 48, 1);
                            }

                            .timesheet.color-scheme-default .bubble-sit {
                                background-color: RGBA(169, 105, 202, 1);
                            }

                            .timesheet.color-scheme-alternative .bubble-default {
                                background-color: #f3552e;
                            }

                            .timesheet.color-scheme-alternative .bubble-lorem {
                                background-color: #88c33a;
                            }

                            .timesheet.color-scheme-alternative .bubble-ipsum {
                                background-color: #436ae0;
                            }

                            .timesheet.color-scheme-alternative .bubble-dolor {
                                background-color: #f4d234;
                            }

                            .timesheet.color-scheme-alternative .bubble-sit {
                                background-color: #707d86;
                            }

                            .timesheet .scale {
                                height: 100%;
                                position: absolute;
                                top: 0;
                                left: 0;
                                white-space: nowrap;
                            }

                                .timesheet .scale section {
                                    display: inline-block; /*float: left;*/
                                    width: 59px;
                                    max-width: 59px;
                                    min-width: 59px;
                                    text-align: center;
                                    color: rgba(250,250,250,0.8);
                                    font-family: "Signika Negative";
                                    font-size: 13px;
                                    line-height: 24px;
                                    font-weight: lighter;
                                    border-left: 1px dashed rgba(250,250,250,0.2);
                                    height: 100%;
                                }

                        .chen_shift_map .hed section {
                            text-align: left !important;
                        }

                        .timesheet .data {
                            margin: 28px 0 0 0;
                            padding: 0;
                            text-align: left;
                            list-style-type: none;
                            color: rgba(250,250,250,0.8);
                            font-family: "Signika Negative";
                            font-size: 13px;
                            /*overflow: hidden;*/
                        }

                            .timesheet .data li {
                                margin: 0 0 3px 0;
                                line-height: 22px;
                                height: 21px;
                                display: block;
                                clear: both;
                                position: relative;
                                white-space: nowrap;
                            }

                                .timesheet .data li:hover .bubble {
                                    opacity: 1;
                                }

                                .timesheet .data li .date {
                                    color: #b5b5b5;
                                    font-size: 14px;
                                }

                                .timesheet .data li .label {
                                    font-weight: lighter;
                                    font-size: 14px;
                                    padding-left: 5px;
                                    line-height: 21px;
                                    color: #979796;
                                    white-space: nowrap;
                                }

                                .timesheet .data li .bubble {
                                    width: 24px;
                                    height: 7px;
                                    display: block;
                                    float: left;
                                    position: relative;
                                    top: 7px;
                                    border-radius: 4px;
                                    margin: 0 10px 0 0;
                                    opacity: 0.7;
                                }

                        #timesheet-alternative {
                            background-color: RGBA(247, 247, 247, 1);
                            border-radius: 5px;
                        }

                            #timesheet-alternative section {
                                color: RGBA(63, 68, 72, 1);
                                border-left: 1px dashed RGBA(63, 68, 72, 0.2);
                            }

                                #timesheet-alternative section:first-child {
                                    border-left: 1px dashed transparent;
                                }

                            #timesheet-alternative .date {
                                display: none;
                            }

                            #timesheet-alternative .bubble {
                                margin-right: 7px;
                            }

                            #timesheet-alternative .label {
                                padding-left: 0px;
                                color: RGBA(48, 48, 48, 1);
                            }
                    </style>



                </div>

            </div>
        </div>
        <!-- end message list section  -->
        <!-- start content section  -->
        <div class="d-none chat col-12 px-0">
            <div class="chat__container">
                <div class="chat__wrapper py-2 pt-mb-2 pb-md-3">
                    <div class="chat__messaging messaging-member--online mt-2 pb-2 pb-md-2 pl-2 pl-md-4 pr-2">
                        <div class="chat__previous d-flex">
                            <i class="ti-arrow-left mr-2"></i>
                        </div>
                        <div class="chat__notification d-flex d-md-none chat__notification--new">
                            <span>1</span>
                        </div>
                        <div class="chat__infos pl-2 pl-md-0">
                            <div class="chat-member__wrapper" data-online="true">
                                <div class="chat-member__avatar">
                                    <!--<img src="https://randomuser.me/api/portraits/thumb/women/56.jpg" alt="Jenny Smith" loading="lazy">-->
                                    <div class="user-status user-status--large"></div>
                                </div>
                                <div class="chat-member__details">
                                    <span class="chat-member__name">Jenny Smith</span>
                                    <span class="chat-member__status">Online</span>
                                </div>
                            </div>
                        </div>
                        <div class="chat__actions mr-2 mb-1">
                            <ul class="m-0 sc-bottom-bar" style="gap:20px;">
                                <li class="d-none">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon" viewBox="0 0 48 48">
                                        <path d="M38.4,48c-2.1,0-5.1-.8-9.5-3.2a62.9,62.9,0,0,1-14.6-11A61.7,61.7,0,0,1,3.2,19C-.9,11.8-.3,8.5.7,6.4A9.7,9.7,0,0,1,4.8,2,21.1,21.1,0,0,1,7.8.4h.3c1.8-.7,3-.3,4.9,1.5h.1a40.1,40.1,0,0,1,5.4,8.2c1.3,2.6,1.6,4.3-.2,6.9l-.5.6c-.8,1-.8,1.2-.8,1.6s1.9,3.4,5.2,6.7S28,30.8,28.8,31s.6,0,1.6-.8l.7-.4c2.5-1.9,4.2-1.6,6.8-.3A40.6,40.6,0,0,1,46.1,35h.1c1.8,1.9,2.2,3.1,1.5,4.9v.2h0a21.1,21.1,0,0,1-1.6,3,10,10,0,0,1-4.3,4.1A7.7,7.7,0,0,1,38.4,48ZM9.5,4.1H9.2L6.9,5.4H6.8A6.3,6.3,0,0,0,4.3,8.1c-.3.7-1.2,2.6,2.4,9A58.9,58.9,0,0,0,17.1,30.9,58.2,58.2,0,0,0,30.9,41.3c6.4,3.6,8.4,2.7,9.1,2.4a6.7,6.7,0,0,0,2.5-2.5.1.1,0,0,0,.1-.1c.5-.8.9-1.6,1.3-2.4v-.2l-.5-.6a35.4,35.4,0,0,0-7.3-4.8c-1.7-.8-1.8-.8-2.7-.1l-.6.4A5.3,5.3,0,0,1,28,34.9c-2.9-.6-7.4-4.9-8.7-6.2s-5.6-5.8-6.2-8.7.6-3.6,1.5-4.8l.4-.6c.7-.9.8-1-.1-2.7a35.4,35.4,0,0,0-4.8-7.3Z" fill="#f68b3c" />
                                    </svg>
                                </li>
                                <li class="d-none">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon" viewBox="0 0 46.8 47.4">
                                        <path d="M35.8,47.4H11a11,11,0,0,1-11-11V11.6A11,11,0,0,1,11,.6h8.8a2,2,0,1,1,0,4H11a7,7,0,0,0-7,7V36.4a7,7,0,0,0,7,7H35.8a7,7,0,0,0,7-7v-9a2,2,0,1,1,4,0v9A11,11,0,0,1,35.8,47.4Z" fill="#f68b3c" />
                                        <path d="M36.6,20.4A10.2,10.2,0,1,1,46.8,10.2,10.2,10.2,0,0,1,36.6,20.4ZM36.6,4a6.2,6.2,0,1,0,6.2,6.2A6.2,6.2,0,0,0,36.6,4Z" fill="#f68b3c" />
                                    </svg>
                                </li>
                                <li class="chat__details d-flex d-xl-none">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon" viewBox="0 0 42.2 11.1">
                                        <g>
                                            <circle cx="5.6" cy="5.6" r="5.6" fill="#d87232" />
                                            <circle cx="21.1" cy="5.6" r="5.6" fill="#d87232" />
                                            <circle cx="36.6" cy="5.6" r="5.6" fill="#d87232" />
                                        </g>
                                    </svg>
                                </li>
                            </ul>

                        </div>
                    </div>
                    <div class="chat__content px-3">

                        <textarea class="form-control h-100 logathe mt-2">
                            5	2008-09-20 05:04:23	1	0	1	0
                            5	2008-09-20 09:04:58	1	0	1	0
                            5	2008-09-20 10:06:47	1	0	1	0
                            5	2008-09-20 14:07:28	1	0	1	0
                        </textarea>

                    </div>
                    <div class="chat__send-container px-2 px-md-3 pt-1 pt-md-3">
                        <div class="custom-form__send-wrapper">
                            <input type="text" class="form-control custom-form" id="message" placeholder="Ecrivez un message …" autocomplete="off">
                            <div class="custom-form__send-img">
                                <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon svg-icon--send-img" viewBox="0 0 45.7 45.7">
                                    <path d="M6.6,45.7A6.7,6.7,0,0,1,0,39.1V6.6A6.7,6.7,0,0,1,6.6,0H39.1a6.7,6.7,0,0,1,6.6,6.6V39.1h0a6.7,6.7,0,0,1-6.6,6.6ZM39,4H6.6A2.6,2.6,0,0,0,4,6.6V39.1a2.6,2.6,0,0,0,2.6,2.6H39.1a2.6,2.6,0,0,0,2.6-2.6V6.6A2.7,2.7,0,0,0,39,4Zm4.7,35.1Zm-4.6-.4H6.6a2.1,2.1,0,0,1-1.8-1.1,2,2,0,0,1,.3-2.1l8.1-10.4a1.8,1.8,0,0,1,1.5-.8,2.4,2.4,0,0,1,1.6.7l4.2,5.1,6.6-8.5a1.8,1.8,0,0,1,1.6-.8,1.8,1.8,0,0,1,1.5.8L40.7,35.5a2,2,0,0,1,.1,2.1A1.8,1.8,0,0,1,39.1,38.7Zm-17.2-4H35.1l-6.5-8.6-6.5,8.4C22,34.6,22,34.7,21.9,34.7Zm-11.2,0H19l-4.2-5.1Z" fill="#f68b3c" />
                                </svg>
                            </div>
                            <div class="custom-form__send-emoji">
                                <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon svg-icon--send-emoji" viewBox="0 0 46.2 46.2">
                                    <path d="M23.1,0A23.1,23.1,0,1,0,46.2,23.1,23.1,23.1,0,0,0,23.1,0Zm0,41.6A18.5,18.5,0,1,1,41.6,23.1,18.5,18.5,0,0,1,23.1,41.6Zm8.1-20.8a3.5,3.5,0,0,0,3.5-3.5,3.5,3.5,0,0,0-7,0,3.5,3.5,0,0,0,3.5,3.5ZM15,20.8a3.5,3.5,0,0,0,3.5-3.5A3.5,3.5,0,0,0,15,13.9a3.4,3.4,0,0,0-3.4,3.4A3.5,3.5,0,0,0,15,20.8Zm8.1,15a12.6,12.6,0,0,0,10.5-5.5,1.7,1.7,0,0,0-1.3-2.6H14a1.7,1.7,0,0,0-1.4,2.6A12.9,12.9,0,0,0,23.1,35.8Z" fill="#f68b3c" />
                                </svg>
                            </div>
                            <button type="submit" class="custom-form__send-submit">
                                <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon svg-icon--send" viewBox="0 0 45.6 45.6">
                                    <g>
                                        <path d="M20.7,26.7a1.4,1.4,0,0,1-1.2-.6,1.6,1.6,0,0,1,0-2.4L42.6.5a1.8,1.8,0,0,1,2.5,0,1.8,1.8,0,0,1,0,2.5L21.9,26.1A1.6,1.6,0,0,1,20.7,26.7Z" fill="#d87232" />
                                        <path d="M29.1,45.6a1.8,1.8,0,0,1-1.6-1L19.4,26.2,1,18.1a1.9,1.9,0,0,1-1-1.7,1.8,1.8,0,0,1,1.2-1.6L43.3.1a1.7,1.7,0,0,1,1.8.4,1.7,1.7,0,0,1,.4,1.8L30.8,44.4a1.8,1.8,0,0,1-1.6,1.2ZM6.5,16.7l14.9,6.6a2,2,0,0,1,.9.9l6.6,14.9L41,4.6Z" fill="#d87232" />
                                    </g>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- end content section  -->
        <!-- start infos section  -->
        <div class="d-none col-12 col-md-5 col-lg-4 col-xl-3 px-4 px-sm-5 px-lg-4 user-profile">
            <div class="user-profile__close d-flex">
                <i class="ti-arrow-left mr-2"></i>
            </div>
            <div class="user-profile__wrapper">
                <div class="user-profile__avatar">
                    <!--<img src="https://randomuser.me/api/portraits/women/56.jpg" alt="Jenny Smith" loading="lazy">-->
                </div>
                <div class="user-profile__details mt-1">
                    <span class="user-profile__name">Jenny Smith</span>
                    <span class="user-profile__phone">(025) 015-234-567</span>
                    <span class="user-profile__location">New York, United States</span>
                </div>
                <div class="user-profile__description">
                    <p>Fly me to the moon 🌙 If you feel like your life is a routine, step back and take a deep breath.</p>
                </div>
                <div class="user-profile__learning mt-4">
                    <span class="user-profile__label">Social Medias</span>
                    <ul class="user-profile__tags user-profile__tags--primary mt-2">
                        <li><a href="https://www.instagram.com/tiantsoa_sh/" target="_blank">Instagram</a></li>
                        <li><a href="https://www.linkedin.com/in/tiantsoa-rabemananjara-254655152/" target="_blank">Linkedin</a></li>
                        <li><a href="https://codepen.io/tiantsoa" target="_blank">Codepen</a></li>
                    </ul>
                </div>
                <div class="user-profile__hobbies">
                    <span class="user-profile__label">Activities</span>
                    <ul class="user-profile__tags user-profile__tags--secondary mt-2">
                        <li>Biking</li>
                        <li>Cooking</li>
                        <li>Traveling</li>
                        <li>Grahic design</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- end infos section  -->
    </div>


</div>

<script type="text/javascript">

    /* ===================================
                Screen resize handler
            ====================================== */
    if (!Main.hasOwnProperty('device_step2')) Main.device_step2 = (function () { // scoping

        "use strict";



        //obfucation step 1: minify -> obfucation uncheck move strings into Array option.
        const workerCODE = function (dat, tenNA, hed, M, attlog__rte, dbO) {

            //debugger;

            const CB = this;

            const modDB = {
                W: function (db) {

                    //debugger;

                    if (db.kq == 0) {//create new
                        //
                        const D$b = db.e.target.result;//var Db = e.target.result;

                        //uncomment if we want to start clean
                        for (var z = 0; z < hed.length; z++) {
                            if (D$b.objectStoreNames.contains(hed[z])) D$b.deleteObjectStore(hed[z]);
                            D$b.createObjectStore(hed[z], { autoIncrement: true });
                        };

                        //const tc = D$b.createObjectStore(hed, { autoIncrement: true });
                        //tc.createIndex("LogIndex", "logid");
                        //
                    } else if (db.kq == 1) { //ok
                        //

                        //se modify cho nay a?
                        if (workerCODE.hasOwnProperty(tenNA)) {
                            //debugger;
                            var c = modDB['SU'];
                        };


                        var saveRST = 0,
                            //, hisTime = new Date()
                            //, hisID = hisTime.getTime(),

                            ts = db.rst.transaction([/*lin,*/ hed[attlog__rte]], "readwrite"),
                            //hisStore = ts.objectStore(lin),
                                        tcStore = ts.objectStore(hed[attlog__rte]),
                                        countHIS = 0,
                                        log_1 = {},
                                        req;
                        //debugger;
                        req = tcStore.put(dat, 1);

                        //
                        //
                        req.onsuccess = function (e) {
                            //
                            //debugger;
                            //saveRST = 1;
                            //dat['aid'] = e.target.result;//auto ID vua tao ra
                            //
                        };
                        //
                        //
                        ts.oncomplete = function () {
                            //
                            //debugger;
                            db.rst.close();
                            //
                            if (CB) CB();
                            //
                        };
                    } else {//err
                        if (CB) CB();
                    }
                }
                ,
                R: function (db) {
                    //
                    //debugger;

                    if (db.kq == 0) {//create new
                        //
                        db.cb('cancel');
                        //khong tao moi
                        //
                        //di lay cai dau tien ....
                        //new opts.zkblob(-505, m[2], m[1] + 1, "0|300|$!N;$!N;$!N;$!N;$!N;$!N;$!N;$!N;$!N;|1|2");
                        //
                        if (CB) CB([0]);//do request..
                        //
                    } else if (db.kq == 1) { //ok
                        // dbTBname: ['loghis', 'tc3'],
                        try {
                            var req
                            , rst = []
                            , ts = db.rst.transaction([hed[attlog__rte]], "readonly")
                            , tc3Store = ts.objectStore(hed[attlog__rte]);
                            //
                            ts.oncomplete = function () {
                                db.rst.close();
                                //
                                if (CB) CB([1, rst]);//tra ve ket qua????
                                //
                                //debugger;
                                //
                                workerCODE[tenNA] = rst;
                                //
                                //for (var z in workerCODE) {
                                //    if (workerCODE.hasOwnProperty(z)) {
                                //        console.log(new Date().getTime(), z, workerCODE[z]);
                                //    };
                                //};
                                //
                                //
                            };
                            //
                            tc3Store.openCursor().onsuccess = function (e) {
                                var cursor = e.target.result;
                                if (cursor) {
                                    //if (logIDs.indexOf(cursor.value.logid) > -1) {
                                    rst.push(cursor.value);
                                    //};
                                    cursor.continue();
                                } else {
                                    //End
                                }
                            };
                        } catch (err) {
                            //console.log('ios', 'indexedDB');
                            if (CB) CB([1, rst]);//tra ve ket qua????
                            workerCODE[tenNA] = rst;
                        }
                    };
                    //
                }

                ,

                SU: function () {

                    //debugger;

                    //reset variable rst
                    var attLOG = this,

                        rst = "", RET = [0, [], null, null, 0];
                    //
                    if (attLOG[0] != "-1") {//download error

                        //debugger;
                        //store it to indexDB ......

                        for (var z = attLOG.length - 1; z > -1; z -= 3) {
                            //debugger;
                            rst += attLOG[z - 1];

                            const mp = attLOG[z];

                            RET[4] += mp[1];//so luong log the
                            //
                            //
                            if (parseInt(mp[0]) > RET[0]) RET[0] = parseInt(mp[0]);//max ID in table ATT_LOG
                            //
                            //
                            //
                            for (var h = 0; h < mp[4].length; h += 2) {
                                const atI = RET[1].indexOf(mp[4][h]);
                                if (atI > -1) {
                                    //don so luong log the cua nhan vien nay len
                                    RET[1][atI + 1] += mp[4][h + 1];
                                } else {
                                    RET[1].push(mp[4][h]);
                                    RET[1].push(mp[4][h + 1]);
                                }
                            };

                            //
                            //tu ngay
                            if (!RET[2]) {
                                RET[2] = mp[2];
                            } else {
                                if (mp[2] && new Date(mp[2]) < new Date(RET[2])) {
                                    RET[2] = mp[2];//lay lai ngay lon hon
                                }
                            }
                            //den ngay
                            if (!RET[3]) {
                                RET[3] = mp[3];
                            } else {
                                if (new Date(mp[3]) > new Date(RET[3])) {
                                    RET[3] = mp[3];//lay lai ngay lon hon
                                }
                            }
                        };
                    };

                    return [[RET[0], RET[4], RET[2], RET[3], RET[1], RET[4]], rst];
                }

                ,

                logRTE: function (l0g) {
                    //
                    //debugger;
                    //
                    try {
                        //
                        if (/*ARGs*/dat[3] === true) return;//download 1 ngay

                        var rte_lg_map = dat[4];
                        //if (!rte_lg_map) {//rte-log head ko co
                        //    rte_lg_map = self.localStorage.getItem(tenDB + dat[2]/*.VER*/ + '__rte');
                        //};

                        const whe_rte = new Date(new Date().toISOString().split('T')[0]),
                            rstRTE = [];

                        const ax = l0g[0].split(/\r?\n/);
                        if (ax[ax.length - 1].trim() == "") ax.splice(-1);
                        //
                        for (var z = ax.length - 1; z > -1; z--) {
                            //
                            if (new Date(ax[z].split('\|')[1]/*.replace(/-/g, '\/')*/) > whe_rte) {
                                rstRTE.unshift(ax[z]);//thu tu lon xon, ko khong che duoc.
                            };
                            //
                            //dt  = L[1]/*'01-01-1970 00:03:44'*/.split(/\-|\s/),
                            //dat = new Date(dt.slice(0, 3)/*.reverse()*/.join('/') + ' ' + dt[3]);
                        };
                        //

                        //debugger;

                        //cau truc :l0g[1]: [0]: ID log in ATT_LOG, [1]:so luong log the
                        //
                        //
                        //fake end line of rstRTE by add ID + SL log
                        if (rstRTE.length > 0) {
                            //
                            const zz = rstRTE.length - 1, endLN = rstRTE[zz];
                            //
                            //cau truc last log : [0]: so luong log the [1]:ID log in ATT_LOG
                            rstRTE[zz] = (zz + 1) + '|' + l0g[1][0] + '|' + endLN;
                            //
                            //*** same in worker -> RST()
                            const l0g_NEW = workerCODE(rstRTE, null, null, 'l0g_SUM')([], [], [0, 50, 0]);
                            //usr = l0g_NEW[0],
                            //dMap = l0g_NEW[1],
                            //req = l0g_NEW[2];
                            //
                            //phuc hoi lai end line
                            rstRTE[zz] = endLN;
                            //
                            //
                            //attLOG = attLOG.concat([m[1][3][2], rst, dMap]);
                            //
                            //
                            //*** same in worker -> RST_END()
                            return workerCODE(null, null, null, 'SU').bind(['nouse', rstRTE.join('\n'), l0g_NEW[1]/*dMap*/])();
                            //
                            //
                            //
                        } else {
                            return [

                                [l0g[1][0]/*max ID*/, 0, l0g[1][3], l0g[1][3], [], 0]
                                ,

                                ""
                            ]
                        };
                        //
                    } catch (err) {
                        //
                    };
                }

                ,

                l0g_SUM: function (usr, dMap, req) {
                    //
                    //debugger;
                    //
                    var lne = dat,
                        oriRST,
                        z = lne.length - 1;
                    //
                    //console.log(' l0g_SUM: function (usr, dMap, req): ' + z);
                    //
                    //thuong end line la ky tu xuong dong.
                    for (z; z > -1; z--) {
                        if (lne[z].trim() != '') {
                            //
                            //console.log(lne[z]);
                            //
                            const maxID = lne[z].split('|');

                            //bo idex dau tien vi day la total record
                            req[2] = maxID.splice(0, 1)[0];//next block keep total here
                            //
                            //update start next block
                            req[0] = maxID[0];
                            //
                            //
                            usr = usr.concat(['|' + maxID[1].trim(), 1]);//User_PIN cua line cuoi cung
                            //
                            dMap[0] = maxID[0];//ID log
                            dMap[1] = z + 1;//so luong log

                            dMap[3] = maxID[2];//max attlog time
                            //
                            const _usr = lne[0].split('|');
                            //debugger;
                            dMap[2] = _usr[z == 0 ?

                                4//(usr[1] = 2, 3)//so 3 la index cua _usr[]

                                :

                                (
                                usr = usr.concat(['|' + _usr[0].trim(), 1]) //User_PIN cua line 0
                                ,

                                1//index lay max log cua _usr[]

                                )

                            ];//max attlog
                            //
                            //
                            //remove maxID in origin result
                            //rst = rst.replace(req[2] + "|" + req[0] + "|", "");
                            oriRST = [lne[z], lne[z].replace(req[2] + "|" + req[0] + "|", "")];//line se replace ...
                            //
                            break;
                        }
                    };

                    //debugger;

                    //lay min, max log, count user

                    for (var k = 1; k < z ; k++) {//bo line dau tien, va line cuoi cung

                        const maxID = lne[k].split('|'),
                            idx = usr.indexOf('|' + maxID[0].trim());
                        //
                        if (idx < 0) {//chua co.

                            usr = usr.concat(['|' + maxID[0].trim(), 1]);//User_PIN cua line cuoi cung

                        } else {//cong len 1 log
                            usr[idx + 1] += 1;
                        }
                    };
                    //
                    //
                    //
                    //luu giu lai index=4
                    dMap.push(usr);
                    //index=5
                    dMap.push(req[2]);//total log the cua may cham cong
                    //
                    //
                    return [usr, dMap, req, oriRST];
                    //
                }
                //
            };
            //
            //debugger;
            if (tenNA) {
                lo$DB(modDB[M], tenNA, dbO);
            } else {
                return modDB[M];
            };
            //
        };

        //obfucation step:2 :  minify variable block -> add to obfucator tool
        const MyObj = function (opts) { // constructor
            //
            //debugger;
            //
            //console.log(srcpf$ + '/media/css/bubble_msg_demo.css')
            _gsC(srcpf$ + '/media/css/bubble_msg_demo.css', 'css', function () {
                //rawHTML[z].innerHTML += "<link rel='stylesheet' href='" + srcpf$ + "/media/css/bubble_msg_demo.css'/>";
            }, 'bubble_msg_demo.css');
            //
            //
            //
            const PAA = opts.el,

                mdlDIG=PAA.closest('.modal-dialog'),

                js_js_att = mdlDIG.hasClass('js_js_att'),

                mngusrs = mdlDIG.hasClass('mngusrs'),

                downFP = mdlDIG.hasClass('down_fp'),

                attlog_oneday = PAA.hasClass('attlog_oneday'),

                $chat = PAA.find(".chat"),

                $profile = PAA.find(".user-profile"),

                smallDevice = window.matchMedia("(max-width: 767px)"),

                largeScreen = window.matchMedia("(max-width: 5199px)"),

                evt = smallDevice.addEventListener ? 'addEventListener' : 'addListener';



            if (PAA.hasClass('JS_JS_payrollonline')) {
                //debugger;
                PAA.find(".global").removeClass('invisible').
                prev().addClass('d-none');
                //
                //khi form realtime trigger se show ra element chat
                $chat.empty();
                $profile.empty();

            };



            smallDevice[evt]("change", handleDeviceChange);
            largeScreen[evt]("change", handleLargeScreenChange);

            handleDeviceChange(smallDevice);
            handleLargeScreenChange(largeScreen);

            function handleDeviceChange(e) {
                //debugger;
                if (e.matches) chatMobile();
                else chatDesktop();
            }

            function handleLargeScreenChange(e) {
                //debugger;
                if (e.matches) profileToogleOnLarge();
                else profileExtraLarge();
            }

            function chatMobile() {
                $chat.addClass("chat--mobile").trigger('chatui_changed', ["chatMobile"]);
            }

            function chatDesktop() {
                $chat.addClass("chat--mobile").trigger('chatui_changed', ["chatDesktop"]);
            }

            function profileToogleOnLarge() {
                $profile.addClass("user-profile--large").trigger('chatui_changed', ["profileToogleOnLarge"]);
            }

            function profileExtraLarge() {
                $profile.addClass("user-profile--large").trigger('chatui_changed', ["profileExtraLarge"]);
            }



            //debugger;
            const online_signal = function () { // scoping

                var isDRAW = true;

                const re = {};

                function _draw(canvas) {//https://codepen.io/collin-garvey/pen/BdWMMb
                    //debugger;
                    //var canvas = document.getElementById('binary-canvas');
                    if (!canvas) return;
                    //
                    const ctx = canvas.getContext('2d');

                    //ctx.canvas.width = canvas.innerWidth;
                    //ctx.canvas.height = canvas.innerHeight;

                    ctx.font = '20px Arial';
                    ctx.fillStyle = '#444444';

                    var fontSize = 20, raf;
                    var columns = Math.floor(canvas.width / fontSize);
                    var rows = Math.floor(canvas.height / fontSize);

                    var binChars = ['0', '1'];
                    var bits = [];
                    var bitHeight = fontSize;
                    var bitWidth = fontSize;

                    // Populate array of 'bits'
                    for (var r = 0; r < rows; r++) {
                        for (var c = 0; c < columns; c++) {
                            bits.push({
                                x: c * bitWidth,
                                y: r * bitHeight,
                                value: binChars[Math.floor(Math.random() * binChars.length)],
                                hasDrawn: false
                            });
                        }
                    }

                    // Vars for manually calculating frame rate
                    var fps = 10;
                    var interval = 1000 / fps;
                    var now;
                    var then = Date.now();
                    var delta;

                    // Draw all bits once before starting animation
                    bits.forEach(function (bit) {
                        ctx.clearRect(bit.x, bit.y, bitWidth, bitHeight);
                        ctx.fillText(bit.value, bit.x, bit.y + bitHeight);
                        bit.hasDrawn = true;
                    });

                    const dogDR = re.dogDR = function () {
                        //
                        if (isDRAW === false) return;
                        //console.log('online_signal', new Date().getTime());
                        //
                        raf = window.requestAnimationFrame(dogDR);
                        now = Date.now();
                        delta = now - then;

                        if (delta > interval) {
                            bits.forEach(function (bit) {
                                if (bit.hasDrawn === true && (Math.random() * 100) > 95) { // If passes the randomness check
                                    var newVal = (bit.value === binChars[1]) ? binChars[0] : binChars[1];

                                    ctx.clearRect(bit.x, bit.y, bitWidth, bitHeight);
                                    ctx.fillText(newVal, bit.x, bit.y + bitHeight);
                                    bit.value = newVal;
                                }
                            });
                            then = now - (delta % interval);
                        }
                    }
                    if (isDRAW===true) dogDR();
                };

                re.draw = _draw;
                re.stop=function(){
                    isDRAW=false;
                };
                re.start = function () {
                    isDRAW = true;
                    //debugger;
                    re.dogDR();
                };

                return re;

            }()
            ,
            dog_canvas = PAA.find('.dog_canvas')
            ,

            fixWID = function (E, O) {

                var miSZ = 10 || O && O.miSZ
                    , maSZ = 51 || O && O.maSZ
                    , ste = 1 || O && O.ste
                    , unt = 'px';

                (O && O.E || [E]).forEach(function (el) {

                    var pW = el.parentNode.clientWidth - 10,
                        ovF = true,
                        i = maSZ;

                    while (ovF && i > miSZ) {
                        //
                        el.style.fontSize = i + unt;
                        //
                        ovF = el.clientWidth > pW;
                        //
                        if (ovF) i -= ste;
                        //
                    };
                    //
                });
            }
            ,
            txtW = function (dumeVAL) {

                var hwnFixW;
                function logdisplay(e) {
                    clearTimeout(hwnFixW);
                    hwnFixW = setTimeout(function () {
                        fixWID(null, { E: [].slice.apply(dumeVAL) });
                    }, 200);
                }
                //
                // Call once to set.
                logdisplay();
                //
                // Bind events
                $(window).on('orientationchange resize', logdisplay);
                //
                // unBind events when popup close
                opts.elUI.unFixW = function () {
                    $(window).off('orientationchange resize', logdisplay);
                    delete opts.elUI.unFixW;
                };
                //
            }
            ,

            timeAgo = function (input) {
                //https://stackoverflow.com/questions/3177836/how-to-format-time-since-xxx-e-g-4-minutes-ago-similar-to-stack-exchange-site

                var fnLAN = function (v, ix) {
                    if (aLAN.js_011_3_4) {
                        return aLAN.js_011_3_4 + " " + v + " " + aLAN.js_011_34[ix];
                    }
                }
                    ,
                    date = (input instanceof Date) ? input : new Date(input),
                    ranges = {
                        year: 3600 * 24 * 365,
                        month: 3600 * 24 * 30,
                        week: 3600 * 24 * 7,
                        day: 3600 * 24,
                        hour: 3600,
                        minute: 60,
                        second: 1
                    }
                    ,
                    secondsElapsed = Math.abs(date.getTime() - Date.now()) / 1000,
                    ix = 1;

                for (var key in ranges) {
                    if (ranges[key] < secondsElapsed) {
                        var delta = Math.round(secondsElapsed / ranges[key]);
                        return fnLAN(delta, ix) || delta + " " + key + (parseInt(delta) > 1 ? 's' : '') + " Ago";
                    }
                    ix++;
                };

                return aLAN.js_011_34 && aLAN.js_011_34[0] || 'Just now';
            }
            ,

            filas = []
            ,

            CARDX = function (dumeRING) {
                //
                //debugger;
                //
                const ringX = PAA.find('.cardx'),
                    rating = ringX.find('.rating'),
                    couter = rating.find('.phantram').html("0");
                //
                rating.find('.block:gt(0)').remove();

                //signal before request ajax ftp....
                if (!opts.ignoreCLEAN) ringX.removeClass('d-none').prevAll().html('');
                //
                if (downFP) {
                    if (ringX.next().empty().addClass('vantay'));
                };
                //
                filas.iDOG = 0;
                filas.per = 0;
                //
                var GREEN = 0,//tai thanh cong
                    RED = 100, //tai that bai

                    _TOTAL = [],

                    TONG = function () {
                        var su = 0;
                        for (var z = 0; z < _TOTAL.length; z += 2) {
                            su += _TOTAL[z + 1];
                        };
                        return su;
                    }
                    ,
                    PHANTRAM = 0,
                    tmpVAL
                    ,
                    isENDJOB = 0
                    ,
                    bl = 0
                    ,
                    block = rating.find('.block');

                    const lst_MCC = []
                    ,

                    CALC_S1 = {

                        "localconn": function (m) {//android result
                            //debugger;
                            //du me khi upload template, add them  m[1][4]
                            return CALC_S1['0'](m, m[1][4] ? 1 : 2);
                            //
                        }
                        ,
                        "0": function (m, fSL) {//node js result
                            //debugger;
                            var sl = 0, pt = 0,
                                 tongIDX = -1;

                            if (m[0] == "OK") {//thanh cong

                                //debugger;

                                sl = parseInt(fSL == 1 ? m[1][4][2] :

                                    m[1][0].split(';')[0]//local connection se attach so luong phia truoc ,

                                    );
                                //TONG += sl;
                                tongIDX = _TOTAL.indexOf(m[2].id);
                                //
                                //console.log(new Date().getTime(), 'tongIDX: ', tongIDX, 'if (m[0] == "OK") {//thanh cong', sl);
                                //value co the =1
                                if (tongIDX % 2 == 1) tongIDX = -1;//chia het cho 2
                                //
                                if (tongIDX == -1) {
                                    _TOTAL.push(m[2].id);
                                    _TOTAL.push(sl);
                                } else {//up0date
                                    _TOTAL[tongIDX+1]=sl;
                                };
                                //
                            } else {
                                //that bai thi sl=0 default
                                sl = -1;//bi loi
                                //
                            };
                            //
                            for (var z = 0; z < dumeRING.length; z++) {
                                if (dumeRING[z][0] == m[2].id) {
                                    //
                                    pt = dumeRING[z][2];
                                    dumeRING[z][1] = sl;//cap nhat lai so luong cua origin
                                    //
                                    if (sl > -1) PHANTRAM += pt;//chi cong phan tram cua nhung devcie OK
                                    //
                                    if (sl == 0) filas.per += pt;//0 new log
                                    //
                                    break;
                                }
                            };
                            //
                            //console.log('sl NaN', sl);
                            return [m[2].id, sl, pt, 0];
                            //
                        }
                        ,
                        "calc": function () {
                            //tinh toan lai ti le % cua thiet bi
                            for (var c = 0; c < lst_MCC.length; c++) {

                                if (lst_MCC[c][1] == -1) {//so luong
                                    RED -= lst_MCC[c][2];
                                }

                            }

                        }
                    }
                    ,
                    bg = function () {
                        const i = block.length;
                        if (i < 100) {
                            rating.append('<div class="block" style="transform:rotate(' + 3.6 * i + 'deg);"></div>');
                            //update lai
                            block = rating.find('.block');
                        } else {
                            //debugger;
                            clearInterval(bgHWN);
                            if (filas.per > 99) {
                                clearInterval(tmpVAL);
                                clearInterval(RE.hwn);
                                //debugger;
                                tmpVAL = setInterval(FAKE_PERCENT, 1);
                            };
                        };

                    }
                    ,

                    RE = {

                        BZ2_From_MCC: function (m) {
                            //
                            //debugger;
                            //chu y chi bind lan dau tien thoi.
                            if (m[4].indexOf('0|') == 0) {
                                //
                                const new0 = CALC_S1[m[1][3][0]](m, 1);
                                if (new0) lst_MCC.push(new0);
                                //
                                if (lst_MCC.length == dumeRING.length) {//chuyen sang step 2
                                    //
                                    //debugger;
                                    //
                                    clearInterval(bgHWN);//xoa bg process mau den slow
                                    bgHWN=setInterval(bg, 1); //new bg fast to complete!
                                    //
                                    //debugger;
                                    CALC_S1.calc();
                                    //
                                    if (lst_MCC.tmp) {
                                        for (var z = 0; z < lst_MCC.tmp.length; z++) {
                                            //debugger;
                                            RE.WOKER_2_BZ2.bind(lst_MCC.tmp[z])();
                                        }
                                        delete lst_MCC.tmp;
                                    }
                                    //
                                };
                                //
                            } else {
                                //da co log roi.
                                //debugger;
                            };
                            //
                            clearInterval(tmpVAL);
                            //
                            if (filas.per < 100) {
                                tmpVAL = setInterval(FAKE_PERCENT, 1000);
                            };
                            //
                        }
                        ,
                        WOKER_2_BZ2: function () {
                            //
                            //debugger;
                            //
                            if (lst_MCC.length < dumeRING.length) {
                                //local se chay le hon
                                if (lst_MCC.tmp) {
                                    lst_MCC.tmp.push(this);
                                } else {
                                    lst_MCC.tmp = [this];
                                }
                                return;
                            };
                            //
                            //
                            clearInterval(tmpVAL);
                            clearInterval(RE.hwn);
                            //
                            //debugger;
                            //console.log(this);
                            //
                            var id = this[0],
                                    msg = this[1],
                                    blo = msg[1],
                                    tog = 0;

                            
                            for (var c = 0; c < lst_MCC.length; c++) {

                                //debugger;

                                if (lst_MCC[c][1] > -1) {//so luong

                                    if (lst_MCC[c][0] == id) {

                                        console.log("blo += lst_MCC[c][3]", lst_MCC[c][3]);

                                        blo += lst_MCC[c][3];

                                        lst_MCC[c][3] = blo;//so luong OK

                                        console.log(new Date().getTime(), lst_MCC[c]);
                                        //
                                        //
                                        if (this[2] == 'end' && HEAVY_JOB_HWND.hasOwnProperty(id)) {
                                            //debugger;
                                            //cause by download FP template custom select emp lam lech so luong tong !!!
                                            const __bk_res = HEAVY_JOB_HWND[id].__bk_res;
                                            if (__bk_res.sem && (__bk_res.sem[0] !== null && __bk_res.sem[0]!==undefined)) {
                                                const tongIDX = _TOTAL.indexOf(id);
                                                if (tongIDX > -1) {
                                                    //modify tong
                                                    _TOTAL[tongIDX + 1] = parseInt(msg[2]);
                                                };
                                            };
                                        };
                                        //
                                        //
                                    };

                                    tog += lst_MCC[c][3];
                                }
                            };

                            if (filas.per == 100) {
                                //debugger;
                                tmpVAL = setInterval(FAKE_PERCENT, 1);
                                return;
                            };
                            //


                            const t$tal =TONG() ;
              
                            var totalP = (tog == t$tal ? 100 : parseInt(100 * tog / t$tal)) + (100 - RED);
                            if (totalP > 100) totalP = 100;
                            //
                            //console.log("t$tal", t$tal, " , tog ", tog);
                            //
                            //console.log(new Date().getTime(), totalP,"totalP / filas.per" , filas.per);
                            //
                            if (totalP > filas.per) {
                                //
                                //RE.hwn = setInterval(RE.fn, totalP < 100 ? 100 : 10);
                                //
                                const tio = totalP > 99 ? 0 : 100 * 20 / (totalP - filas.per);
                                //
                                RE.hwn = setInterval(RE.fn, tio);
                                //
                                //console.log(new Date().getTime(), id, (totalP - filas.per), "Timeout: ", tio);
                                //
                                filas.per = totalP;

                            } else {
                                //khi download template nhieu package , 100% approach, but download still continue.
                                if (filas.per < 5 || filas.per < totalP + (parseInt(blo) / (filas.per < 95 ? 1 : 2) / t$tal)) {
                                    tmpVAL = setInterval(FAKE_PERCENT, 1000);
                                };
                            };
                            //
                        }
                        ,
                        DABUG: function () {
                            clearInterval(tmpVAL);
                            clearInterval(RE.hwn);
                        }
                        ,
                        ERR: function () {
                            //
                            //debugger;
                            online_signal.stop();
                            //
                            RED = filas.per;
                            //
                            isENDJOB = 1;
                        }
                        ,
                        fn: function () {
                            ////
                            //console.log(new Date().getTime(), 'fn: function () { RED: ', RED, "filas.iDOG: ", filas.iDOG);
                            ////

                            //debugger;

                            var cls = 'remove';
                            //
                            if (filas.iDOG < filas.per && filas.iDOG < block.length) {
                                //
                                block.eq(filas.iDOG).addClass('val' + (filas.iDOG > RED ? ' err' : ''));
                                //
                                filas.iDOG += 1;
                                //
                                couter.text(filas.iDOG);
                                //
                            } else {
                                //
                                clearInterval(RE.hwn);
                                clearInterval(tmpVAL);
                                //
                                cls = 'add';
                                if (filas.per == 100 && isENDJOB == 1) {
                                    //
                                    //debugger;
                                    //
                                    try {
                                        //
                                        if (mngusrs === true) {

                                            //debugger;

                                            if (PAA.parent().hasClass('fuk_desktop')) {
                                                PAA.slideUp('fast', function () {
                                                    //$(this).remove();
                                                    PAA.find("internetConection").remove();//tui nay nang lam !!!
                                                    PAA.trigger('DOWN_ATTLOG_END');
                                                });
                                            } else {

                                                //debugger;

                                                PAA.trigger('DOWN_ATTLOG_END', [

                                                    frmUI.INFO.map(function (da) {
                                                        //
                                                        //debugger;
                                                        //
                                                        //0:id ,1:ten ,2:sn, 3:isatt, 4: wdmo, 5:ERR , 6:template table 9 Or 10 , 7: kind local or internet
                                                        const devI = [da[1].id, da[1].ten, da[1].serno, da[1].isatt, da[1].wdmo, da[3], da[4] && da[4][4],da[1].kind];
                                                        //them thong tin vao line cuoi cung ...
                                                        if (da[0][da[0].length - 1] == "") {
                                                            da[0][da[0].length - 1] = devI;
                                                        } else {
                                                            da[0].push(devI);
                                                        };
                                                        //
                                                        return da[0];
                                                    })
                                                ]);
                                            };
                                            //PAA.trigger('DOWN_ATTLOG_END');
                                        } else if (js_js_att === true || PAA.hasClass('JS_JS_payrollonline')) {
                                            PAA.slideUp('fast', function () {//.find("internetConection")
                                                //raise event to JS_JS_att.js
                                                PAA.find("internetConection").remove();//tui nay nang lam !!!
                                                PAA.trigger('DOWN_ATTLOG_END');
                                            });
                                        } else {
                                            PAA.find("internetConection").slideUp('slow', function () {

                                                $(this).remove();
                                                PAA.trigger('DOWN_ATTLOG_END');

                                            }).next().removeClass("invisible");//.global
                                        };
                                    } catch (rr) {
                                        //debugger;
                                        devDlg(0, rr.toString() + "<br/>" + _La$N('js_003_err', aLAN) || "Errors have occurred, please try again !", 'device_sep2.html / end').show();
                                    };

                                    //
                                    //setTimeout(function () {
                                    //    //
                                    DEVI__Q.isBSY = '1'//reset susy status
                                    //    //
                                    //    //console.log(new Date().getTime(), "RELEASE ...", DEVI__Q.isBSY);
                                    //    //
                                    //}, 10000);
                                    //
                                } else {
                                    //ko fake no se dung yen
                                    tmpVAL = setInterval(FAKE_PERCENT, 1000);
                                }
                                //
                            };
                            //
                            couter.parent()[cls + 'Class']('slash');
                            ////
                        }
                        ,
                        hwn: 0
                    }

                    ,

                    FAKE_PERCENT = function () {
                        //debugger;
                        //console.log(new Date().getTime(),'FAKE_PERCENT: ' ,filas.per);
                        //
                        filas.per += 1;
                        //
                        var totalP = filas.per + (100 - RED);
                        if (totalP > 100) totalP = 100;
                        //
                        if (totalP == 100) {
                            //debugger;
                            clearInterval(RE.hwn);
                            clearInterval(tmpVAL);
                            filas.per = totalP;
                            RE.hwn = setInterval(RE.fn, totalP < 100 ? 100 : 10);
                            return;
                        };
                        //
                        if (filas.per > 100) filas.per = 100;
                        //
                        RE.fn();
                    };

                    var bgHWN = setInterval(bg, 30);//free

                return RE;
            }

            ,

            CARDX_CALC = function (msg) {
                //
                //
                //clearInterval(CARDX_CALC.X.hwn);
                ////
                ////heavyBLOCK
                ////
                //var blo = msg[1],
                //    tog = parseInt( msg[5]),

                //    id = this,
                //    tmpTOTAL = 0,
                //    cntGET = 0;

            }
            ,

            l0gMAP = function (re, v) {
                //debugger;
                //const v = it[0];
                //
                if (v && v[2]) {

                    //v[2] null nghia la error
                    //
                    re[0] += v[5];// v[0];//so luong log the
                    //re[1] += v[1];//so luong nhan vien
                    //
                    for (var h = 0; h < v[4].length; h += 2) {
                        const atI = re[1].indexOf(v[4][h]);
                        if (atI > -1) {
                            //don so luong log the cua nhan vien nay len
                            re[1][atI + 1] += v[4][h + 1];
                        } else {
                            re[1].push(v[4][h]);
                            re[1].push(v[4][h + 1]);
                        }
                    };
                    //
                    //
                    //tu ngay
                    if (!re[2]) {
                        re[2] = v[2];
                    } else {
                        if (new Date(v[2]) < new Date(re[2])) {
                            re[2] = v[2];//lay lai ngay lon hon
                        }
                    };
                    //
                    //den ngay
                    if (!re[3]) {
                        re[3] = v[3];
                    } else {
                        if (new Date(v[3]) > new Date(re[3])) {
                            re[3] = v[3];//lay lai ngay lon hon
                        }
                    };
                    //
                };
            }
            ,
            frmUI = function () {

                if (mngusrs === true ) return;

                /* ===================================
                Events
                ====================================== */

                PAA.find(".messaging-member").click(function () {
                    $chat.fadeIn();
                    $chat.addClass("chat--show");
                });

                PAA.find(".chat__previous").click(function () {
                    $chat.removeClass("chat--show");
                    //
                    //du me khi show log detail, no hide button rat kho chiu
                    //const doA = PAA.find('actionline').addClass('d-none');
                    //setTimeout(function () {
                    //    doA.removeClass('d-none');
                    //}, 500);
                });

                PAA.find(".chat__details").click(function () {
                    $profile.fadeIn();
                    $profile.addClass("user-profile--show");
                });

                PAA.find(".user-profile__close").click(function () {
                    $profile.removeClass("user-profile--show");
                });

                PAA.find(".messages-page__dark-mode-toogler").click(function () {
                    $("body").toggleClass("dark-mode");
                });




                const GLO = PAA.find('actionline')

                    //.on("click", '.btn', function (e) {
                    //const mnu = $(e.currentTarget);
                    //if (mnu.hasClass('viewlogs')) {
                    //    $chat.fadeIn();
                    //    $chat.addClass("chat--show");
                    //};
                    //})

                    .closest('.global')

                , tuden_ng = GLO.find('.inputs__dates input')

                , titH2 = GLO.find('.clientPanel >h2')

                , mcc0 = titH2.next('obj_att')

                , tmpl0 = mcc0[0].outerHTML,

                disVAL = GLO.find('counter .box value span'),

                mcc_inf = function (mcc, it) {
                    //
                    const v = it[0]
                        , dis = mcc.find(".mcc_inf")
                        ,tota = v && v[5] || 0
                        ,slnv = v && (v[4].length / 2) || 0;
                    //
                    dis[0].innerHTML = fmtNB(tota);//tong so log the String.fromCharCode(29);//
                    dis[1].innerHTML = fmtNB(slnv);//so luong nhan vien
                    //
                    //debugger;
                    //
                    mcc.find('.card-title b').text(it[1]['ten']);
                    mcc.find('.timeago').text(timeAgo(new Date()));
                    //
                    //
                    //
                    //
                    //console.log(new Date().getTime(), 'mcc_inf', v[2]);
                    //if (isSAVE == 2) mcc.trigger('buoc2_c$b', [it[1]]);
                    var isSAVE = [], storeNA = it[2][0];

                    if (v[2]) {//ko bi error
                        //
                        //debugger;

                        //tabTinhCong open neu hitcache se ko save lai.
                        if (it[3] == 'HIT_CACHE') return;
                        //
                        //
                        isSAVE = [tota, slnv, v[2], v[3], new Date().getTime()];
                        it[1].dlog = isSAVE;
                        //
                        mcc.trigger('buoc2_c$b', { 'a': isSAVE, 'b': storeNA + DEVI__Q.VER[0] + (attlog_oneday === true ? '__rte' : '') });
                        //
                        //
                        isSAVE.push(it[2]);//[5] db info
                        isSAVE.push(it[3]);//[6] download status
                        //
                        //
                        const logNA=(attlog_oneday === true ? 'RTE' : 'ATT') + '_Log';
                        //
                        //if (attlog_oneday === true) {
                            //
                            //append log rte vao save de stor lai....
                        isSAVE.push(DEVI__Q[logNA][storeNA][0]);
                        //
                        //
                        //map dung de restore tabTinhCong ........... HIT_CACHE
                        isSAVE[8] = it[0];
                        //
                        //
                            //cache download result lai ....
                        DEVI__Q[logNA][storeNA] = isSAVE;
                            //
                        //};
                        //
                        //
                        //thoi gian download hoan tat su dung trong JS_JS_att.js
                            DEVI__Q[logNA]['at'] = new Date().getTime();
                        //
                        //
                        //} else {
                        //    delete it[1].dlog;
                        //    if (attlog_oneday === true) {
                        //        delete DEVI__Q.RTE_Log[storeNA];
                        //    };
                    } else if (attlog_oneday === true && it[3] == 'OK') {
                        //
                        //chu y: //triet tieu tai (XXX***)
                        //
                        //danh dau la da download ok - > online device
                        const tg = new Date(new Date().setHours(0, 0, 0, 0)).toISOString().split('.')[0];
                        extractRTE_LOG(it[2], [[0, 0, tg, tg, [], 0], ""], it[3]);
                        //
                    };
                    //
                };
                //
                //
                var re = [0, [], null, null], t = 0;


                for (var y = 0; y < frmUI.INFO.length; y++) {
                    //
                    //debugger;
                    //
                    const it = frmUI.INFO[y];
                    //
                    l0gMAP(re, it[0]);
                    //

                    if (t == 0) {
                        mcc_inf(mcc0, it);
                    } else {
                        mcc_inf($(tmpl0.replace(/collapse0/g, 'collapse' + t)).appendTo(titH2.parent()), it);
                    };
  
                    t++;
                }
                //const VAL = frmUI.INFO.reduce(function (re, it, t) {

                //    //
                //    return re;
                //    //
                // }, [0,[],null,null]);
                //
                //
                //debugger;
                const VAL = re;
                disVAL[0].innerHTML = frmUI.INFO.length;//so luong may cham cong
                disVAL[2].innerHTML = fmtNB(VAL[0]);//'1.000.000';//so luong log the
                //
                disVAL[1].innerHTML = fmtNB(VAL[1].length / 2);//so luong nhan vien
                //
                //
                //
                txtW(disVAL);
                //
                //copy ra nhieu may cham cong
                //for (var o = 1; o < 3; o++) {
                //    titH2.parent().append(tmpl0.replace(/collapse0/g, 'collapse' + o));
                //}

                //debugger;
                tuden_ng[0].valueAsDate = new Date(VAL[2]);
                tuden_ng[1].valueAsDate = new Date(VAL[3]);



                ////debugger;
                ////logathe.val(logathe.val() + dat.msg);
                //const logathe = PAA.find('.logathe').val(frmUI.VAL);


                //
                if (navigator.onLine) {
                    //PAA.find("internetConection off").css('display', 'none');
                    //PAA.find("internetConection on").css('display', 'flex');
                    //PAA.find("internetConection").slideUp('slow');
                } else {
                    //PAA.find("internetConection off").css('display', 'flex');
                    //PAA.find("internetConection on").css('display', 'none');
                    //PAA.find("internetConection").slideDown('slow');
                }

            }
            ,

            HEAVY_JOB_HWND = {}
            ,

            extractRTE_LOG = function (dbI, JOI,STA) {
                //
                //download att_log se extract rte_log -> prevent paidload !
                //
                //debugger;
                //
                if (!JOI) return;
                //
                const storeNA = dbI[0],

                    re = [0, [], null, null],

                    v = JOI[0],

                    tota = fmtNB(v && v[5] || 0),

                    slnv = fmtNB(v && (v[4].length / 2) || 0),

                    isSAVE = [tota, slnv, v[2], v[3], -1 /*chua luu local-storage, -> khi offline se luu*/];
                //
                isSAVE[5] = dbI;//index = 5
                isSAVE[6] = STA;//index = 6
                //
                //$chat.trigger('buoc2_c$b', { 'a': isSAVE, 'b': storeNA + DEVI__Q.VER[0] + '__rte' });
                //
                //index [5]: log
                isSAVE.push(JOI[1]);
                //
                //extract rte_log from att_log se ko luu tru local-storage, -> ma chi cap nhat cache  DEVI__Q.RTE_Log
                DEVI__Q.RTE_Log[storeNA] = isSAVE;
                //
                console.log(new Date().getTime(), isSAVE);
                //
            }
            ,

            endJOB = function (wo) {
                //
                console.log(new Date().getTime(),'endJOB = function (wo) {');
                //return;
                //debugger;
                //
                if (HEAVY_JOB_HWND[wo].seson) {
                    //iframe
                    const dg = HEAVY_JOB_HWND[wo];
                    delete apisvr.a$.sessions[dg.seson];
                    dg.evtWK.parentNode.removeChild(dg.evtWK);
                };
                //
                delete HEAVY_JOB_HWND[wo];
                //
                var count = 0;
                for (var property in HEAVY_JOB_HWND) count++;
                //
                if (count == 0) {
                    //debugger;
                    frmUI();
                    //vet cuoi...
                    CARDX_CALC.X.ERR();
                };
                //
            };
            //
            frmUI.VAL = '';
            frmUI.INFO = [];
            //
            //
            dog_canvas.html('<canvas></canvas>');
            setTimeout(function () {
                online_signal.draw(dog_canvas.find('canvas')[0]);
            }, 300);
            //
            //PAA.find("internetConection").slideUp('slow');
            //



            //debugger;

            
            var uitroi = PAA.children().first().attr(apisvr.a$.selected_language);
            if (uitroi && uitroi != '') {
                //js_009_31 js_009_32
                uitroi=JSON.parse(decodeURIComponent(atob(uitroi)));
                PAA.find('[data-lang]').each(function (idx, el) {
                    var key = el.getAttribute('data-lang');
                    $(el).html(_La$N(key, uitroi));
                });
            };
            //
            function _fpver(a,devIDX) {
                //debugger;
                if (a && a.hasOwnProperty('sem')) {
                    //cho nay con phai tinh toan rat nhieu ...
                    if (devIDX && a.sem[1][devIDX]) {
                        //debugger;
                        return pad$(a.sem[1][devIDX][1], 2);
                    } else {
                        return pad$(a.sem[1][0][1], 2);
                    }
                };
                return "";
            };
            //
            //
            function dCAPA(wdmo) {
                //
                const devcap = JSON.parse(wdmo)[2].split('-'),
                    p = [
                        devcap[6],//6 'fp_capacity': 56,
                        devcap[7],//7 'user_capacity': 60,
                        devcap[13]///13 'face_capacity': 88
                        ,
                        devcap[8], //log_capacity

                        devcap[1], // fp_used
                        devcap[0], // usr_used
                        devcap[12], // face_used

                        devcap[2], // log_used

                       
                        "1350", //8: each fp tempalate
                        "100", //9: each line usr byte

                        "0", //10: each line face ???
                        "40", //11: each line log byte
                        "15", //12: line head fp

                        "0",//13 bak
                        "0",//14.bak
                        "0", //15 bak
                        "2048", //16 : min byte size pipeCMD 

                        "J99Z578vyJD7LT/XvUWYSg==", //17 SHARED.ENCRYPT('F62C92')

                        "-1" //18 web, android, ios 
                        

                    ];
                //
                //
                if (w0w['_cordovaNative']) {
                    //
                    const thongtin_app = w0w._cordovaNative.thongtin_app,
                         nativ = thongtin_app.__v$r.split('|');
                    //
                    _fpver.___appIos = nativ[2].toLowerCase();
                    //
                };
                //
                //
                if (_fpver.___appIos === 'ios') {
                    debugger;
                    //tinh toan size pagge 
                    p[18]="8888";//index 16 cuoi cung
                };
                //
                return JSON.stringify(p);
                //
            };

            //
            const stack_put_tmpl = {}
                ,

                _tmpl_cloud_inf = function () {
                    //
                    //debugger;
                    //
                    //console.log('_tmpl_cloud_inf', new Date().getTime(), c.kind);
                    const c = this[1];
                    //
                    //
                    const

                        //devcap = JSON.parse(c.wdmo)[2].split('-'),
                        //p = [
                        //    devcap[6],//6 'fp_capacity': 56,
                        //    devcap[7],//7 'user_capacity': 60,
                        //    devcap[13]///13 'face_capacity': 88
                        //    ,
                        //    devcap[8], //log_capacity

                        //    devcap[1], // fp_used
                        //    devcap[0], // usr_used
                        //    devcap[12], // face_used

                        //    devcap[2] // log_used

                        //],
                        atB = this[0],
                        clnI = JSON.parse(stack_put_tmpl['tmpl_cloud_inf'][c.kind == 0 ? 0 : 1]),
                        dume = clnI[1].split('_');
                    //

                    //
                    dume[0] = 't' + atB;
                    //
                    clnI[1] = dume.join('_');
                    //
                    //
                    //device capacity limit upload.
                    clnI.push(dCAPA(c.wdmo)); //JSON.stringify(p));
                    //
                    return clnI.join(String.fromCharCode(4));
                    //
                }

                ,

                _put_tmpl_2_cloud = function (m, hedBlock, tmplDAT, newTOK) {
                    //
                    //debugger;
                    if (tmplDAT[1] == 'return_heavy_tmpl_local') {
                        //
                        //debugger;
                        //
                        if (tmplDAT[0] == 'err') {
                            //error chua xu ly !!!
                            debugger;
                            endJOB(tmplDAT[5]);
                            return;
                        };
                        //
                        //const __dev = gloEVTs.giaidoan2.fnXX.___devs,
                        //        copyM = JSON.parse(JSON.stringify(m));
                        ////
                        ////
                        //for (var w = 0; w < __dev.length; w++) {
                        //    if (__dev[w].id == tmplDAT[5]) {
                        //        copyM[2] = JSON.parse(JSON.stringify(__dev[w]));
                        //        break;
                        //    };
                        //};
                        if (HEAVY_JOB_HWND.hasOwnProperty(tmplDAT[5])) {
                            //
                            //debugger;
                            const wo = HEAVY_JOB_HWND[tmplDAT[5]];
                            //
                            if (wo.M) m[2] = wo.M;//khong phai Main thi se attach theo device record data
                            //
                        };
                        //
                        //
                        _commit_tmplBlock_2_DEV.bind(m)("RST", hedBlock);
                        //
                        return;
                    };
                    //
                    //
                    //
                    const realINI = stack_put_tmpl.hasOwnProperty('hedBlock') ? 'INI' : 'RST';//RST CUA DEVICE 0 TO GET CLOUD
                    //
                    //
                    //
                    stack_put_tmpl['hedBlock'] = hedBlock;
                    //
                    //
                    //
                    //
                    //sau khi first device get cloud information from node js thi trigger lai cac device pedding
                    for (var id in HEAVY_JOB_HWND) {
                        //
                        if (HEAVY_JOB_HWND.hasOwnProperty(id)) {
                            //
                            //
                            //debugger;
                            const wo = HEAVY_JOB_HWND[id];
                            //
                            //
                            if (tmplDAT[0] == 'err') {
                                //error chua xu ly !!!
                                debugger;
                                endJOB(id);
                                continue;
                            };
                            //
                            //
                            //wo.__bk_res.tok = newTOK;
                            if (wo.M) m[2] = wo.M;//khong phai main thi se attach theo device record data
                            //
                            if (wo.delayZKBLOB) {
                                //
                                //debugger;

                                const myBLOCK = stack_put_tmpl[id]
                                myBLOCK[0] += 1; //increse block 1
                                myBLOCK[1] = 'BUZY';//wil reset when return result
                                //
                                wo.delayZKBLOB.resolve([id, hedBlock[1]/*total*/,

                                    _tmpl_cloud_inf.bind([myBLOCK[0], m[2]])()

                                ]);
                                delete wo.delayZKBLOB; //xoa luon de lan sau la post message.
                                //
                            } else {
                                //debugger;
                                _commit_tmplBlock_2_DEV.bind(m)(realINI);
                                //
                            };
                            //
                        };
                        //
                    };
                    //
                }

                ,

                localconn_UP_TMPL = function () {

                    //debugger;

                    const localZK = this;

                    for (var id in HEAVY_JOB_HWND) {
                        //
                        if (HEAVY_JOB_HWND.hasOwnProperty(id)) {
                            //
                            const wo = HEAVY_JOB_HWND[id];
                            //
                            if (wo.toilaMAIN) {//main se co them thong tin nay de post
                                //debugger;
                                const mmm = localZK[0][2],
                                    __uuidphone = JSON.parse(mmm.__uuidphone);
                                localZK[0] = [mmm.wdms/*IP "192.168.1.210"*/, __uuidphone[0], mmm.serno, mmm.id];
                                //
                                wo.postMessage({ cmd: 'up_heavy_tmpl_local', dat: localZK });
                                //
                                break;
                            };
                        };
                    };
                }

                ,

                _commit_tmplBlock_2_DEV = function (act,local_HED_BLO) {
                    //
                    //debugger;
                    //
                    const m1 = this,

                        req = m1[4].split('|'),

                        id = m1[2].id,

                        hedBlock =local_HED_BLO || stack_put_tmpl['hedBlock'],

                        myBLOCK = stack_put_tmpl[id],//.push(newTOK);//template file ready on cloud.

                        dMap = ["1", 1, null, null, 10, hedBlock[1]],

                        dat = { cmd: 'OK', msg: [m1[4], dMap] },

                       wo = HEAVY_JOB_HWND[id];
                    //
                    //
                    //
                    //
                    //debugger;
                    //
                    if (act == 'RST') {
                        //
                        //debugger;
                        //
                        //upload result
                        myBLOCK[1] = '';//reset
                        //
                        //console.log(new Date().getTime(), '_commit_tmplBlock_2_DEV: ', m1[1][4]);
                        //debugger;
                        //
                        if (false && !m1[1][4]) {
                            //debugger;
                            //error . phat hien local execute cmd error
                            endJOB(id);
                            return;
                            //
                        } else {
                            if (req[0] != "-1") {
                                //debugger;
                                //first call get cloud host info.
                                CARDX_CALC.X.WOKER_2_BZ2.bind([id, dat.msg[1], dat.cmd])();
                                //
                            };
                        };
                        //
                    };
                    //
                    //
                    //myBLOCK[0] start at -1 ,so it compare with    hedBlock[1] - 1
                    if (myBLOCK[0] < hedBlock[0] || myBLOCK[0] == hedBlock[1]-1) {//hedBlock[1]:total template block upload 2 device 
                        //
                        //
                        //*************** BLOCK CUOI CUNG LA DUNG DE run ./biometric service 9900-C .******************************
                        //
                        if (myBLOCK[1] != 'BUZY') {
                            //
                            myBLOCK[1] = 'BUZY';//wil reset when return result
                            //
                            //
                            //debugger;
                            //
                            if (myBLOCK[0] > -1 && myBLOCK[0] < hedBlock[1] - 1) {//*** CAI CUOI CUNG LA CLEAN.
                                if (m1[1][3][0] == 'localconn') {//loai connection local
                                    //
                                    //console.log('hedBlock', hedBlock);
                                    //debugger;
                                    if (!local_HED_BLO) {
                                        //local conn delay UP finger print template tra ve.
                                        localconn_UP_TMPL.bind([m1, myBLOCK, [ myBLOCK[0]+1, hedBlock[1]]])();
                                        return;//cho upload xong template se chay tiep
                                    };
                                };
                            };
                            //
                            //
                            //
                            //
                            myBLOCK[0] += 1; //increse block 1
                            //
                            //
                            //
                            //debugger;
                            //
                            //
                            req[0] = myBLOCK[0]; //prevent dup zero:0
                            //
                            //
                            //req[1]=0 ; MEANING END UPLOAD  - SE THU DON folder /tmp cua may cham cong.
                            req[1] = hedBlock[1] - myBLOCK[0]; // so luong pkg send to fingertemplateXX
                            //
                            //
                            req[2] = hedBlock[1];//total record
                            req[4] = myBLOCK[0];
                            //
                            dat.msg[0] = req.slice(0, 6) //lay 6 phan tu dau tien
                                .join('|') +
                                //them vao cloud kind free or paid
                                '|' + _tmpl_cloud_inf.bind([myBLOCK[0], m1[2]])();//update lai request next block
                            //
                            //debugger;
                            //
                            //next template block
                            new opts.zkblob(

                                 m1[1][3][1]//current commandid
                                 ,
                                 m1[2]//dat
                                 ,
                                 m1[3]//index dat
                                 ,

                                 dat.msg[0]

                                 ,

                                 wo.hevyENGINE

                                 ,

                                 wo.__bk_res.tok

                                 );
                        };
                        //
                        //

                        //
                    } else if (myBLOCK[0] == hedBlock[1]) {
                        //
                        //debugger;
                        const re = m1[1][3][0] != 'localconn' ? (m1[1][4] || dat['m[1][4]']) : JSON.parse(m1[1][0].split(';')[1]);
                        //
                        frmUI.INFO.push([[re, ""/*empty for add result*/], m1[2], dat.msg[2], m1[0], re]);
                        //
                        setTimeout(function () {
                            //hoan tat
                            endJOB(id);
                            //
                        },100);
                        //
                    };
                };

            //
            //mdlDIG.fadeIn('slow');
            //
            return {

                bz2: function (m) {
                    //
                    //
                    //debugger;
                    //
                    CARDX_CALC.X.BZ2_From_MCC(m);
                    //
                    //debugger;
                    const woME = HEAVY_JOB_HWND[m[2].id];//** note ko duoc xai trong worker event.
                    //
                    if (!woME || m[1][3][1] == 'ZKBUSY') {//limit FTP host
                        //debugger;
                        return;
                    };
                    //
                    //
                    //***************** use for upload device user + template ****************************************
                    if (woME.__bk_res.hasOwnProperty('__fn')) {
                        //
                        //debugger;
                        //
                        if (woME.one_put_tmpl_2_cloud) {
                            //debugger;
                            if (m[0] == "OK") {
                                //
                                //debugger;
                                //debugger;
                                //cloud chua template se keep only one shared all device.
                                stack_put_tmpl['tmpl_cloud_inf'] = [

                                    m[1][3][0] != 'localconn' ? JSON.stringify(m[1][4]) : "",

                                    '["ko_can_req_dev_localconn","loc_' + (new Date().getTime().toString().slice(-7)) + '",2,"1"]'//1: tao , quy uuoc index cuoi cung 0: ko tao copy debug template local /tmp/fp.tmX
                                ];
                                //
                                //chi co device 1st upload template to cloud.
                                woME.one_put_tmpl_2_cloud(woME, m, _put_tmpl_2_cloud);
                                //
                            } else {

                                console.log(new Date().getTime(),'error: ' + m[0]);
                                endJOB(m[2].id);

                            };
                            //
                            //chi 1 lan dau nhu ten goi!
                            delete woME.one_put_tmpl_2_cloud;
                            //
                        } else {
                            //
                            //debugger;
                            _commit_tmplBlock_2_DEV.bind(m)('RST');
                            //
                        };
                        //
                        //REDIRECT TO NEW HANDLER  device_user.html - > UP_TMPL ....
                        return;
                    };
                    //************************************************************************************************
                    //
                    //
                    //debugger;
                    //chu y chi bind lan dau tien thoi.
                    if (m[4].indexOf('0|') == 0) {
                        //
                        //
                        (function (factory) {
                            "use strict";
                            //
                            //debugger;
                            HEAVY_JOB_HWND[m[2].id].onmessage = factory.bind(m);//XXX
                            //
                        })(function () {

                            //debugger;

                            const m1 = this, dat = arguments[0].data;

                            //debugger;

                            if (dat.cmd == 'ajz') {
                                //
                                //debugger;
                                //khoi tao uoc tinh log se mang ve
                                //CARDX_CALC.X.ini(m1[2].id, dat.msg);
                                //
                                return;
                            } else if (dat.cmd !== 'err') {
                                //
                                //CARDX_CALC.bind(m1[2].id)(dat.msg[1]);
                                //
                                //debugger;
                                //
                                CARDX_CALC.X.WOKER_2_BZ2.bind([m1[2].id, dat.msg[1], dat.cmd])();
                                //
                                //
                                //
                                //******************************* use for download select custom user + template ********************************************
                                //debugger;
                                if (dat.msg[2] && dat.msg[2][0] == 'package_tmpl') {
                                    //
                                    //debugger;
                                    //
                                    //download FP template 5 finger =10kb, => worker will error handle end package !!!
                                    if (!HEAVY_JOB_HWND[m1[2].id].package_tmpl) {

                                        HEAVY_JOB_HWND[m1[2].id].package_tmpl = [dat.msg[2][1]];

                                    } else {

                                        HEAVY_JOB_HWND[m1[2].id].package_tmpl.push(dat.msg[2][1]);

                                        //if (HEAVY_JOB_HWND[m1[2].id].package_tmpl.length > 3) {
                                        //    dat.cmd = "end";
                                        //};

                                    };
                                    //
                                };
                                //**************************************************************************************************************************
                                //
                                //
                                if (dat.cmd == 'nxt') {

                                    //debugger;

                                    new opts.zkblob(

                                        m1[1][3][1]//current commandid
                                        ,
                                        m1[2]//dat
                                        ,
                                        m1[3]//index dat
                                        ,

                                        dat.msg[0]

                                        ,

                                        HEAVY_JOB_HWND[m1[2].id].hevyENGINE

                                        ,

                                        HEAVY_JOB_HWND[m1[2].id].__bk_res.tok

                                        );

                                    return;

                                };
                                //
                                //debugger;
                                //
                                if (parseInt(m[3]) > 0) {//dowload attlog

                                    if (dat.cmd == 'end') {
                                        if (workerCODE.indexedDB == 2) {

                                            var isSAVE = 2;
                                            const tenDB = dat.msg[2][0] + DEVI__Q.VER[0],
                                                oDAT = workerCODE[tenDB];
                                            //
                                            if (oDAT) {//old db
                                                //
                                                var makeO = [];
                                                if (["-1", "-2"].indexOf(dat.msg[1][0]) > -1) {//dMap Error
                                                    isSAVE = 1;//down flag
                                                    if (oDAT.length == 1) {//khoi build chi cho met
                                                        isSAVE = 3;//ignore
                                                        dat.msg[0] = oDAT[0];
                                                    }
                                                } else {
                                                    makeO = dat.msg[0];
                                                    makeO.unshift("new");//chi cho vui
                                                };
                                                //
                                                if (isSAVE != 3) {//ignore
                                                    for (var z = 0; z < oDAT.length; z++) {
                                                        makeO.unshift(oDAT[z][1]);
                                                        makeO.unshift(oDAT[z][0]);
                                                        makeO.unshift(z);//chi cho vui
                                                    }
                                                    makeO = workerCODE(null, null, null, 'SU').bind(makeO)();
                                                    dat.msg[0] = [makeO[1], makeO[0]];//dao nguoc lai
                                                }
                                            };

                                            //save append vao db co san...
                                            if (isSAVE == 2) {
                                                workerCODE.apply(function () {
                                                    //debugger;
                                                }, [dat.msg[0], tenDB, dat.msg[2][1], "W", attlog_oneday === true ? 1 : 0,

                                                      { noV: 1 }//triet tieu version db trong main.js  -> lo$DB

                                                ]);
                                            };
                                            //
                                            //debugger;
                                            //
                                            if (attlog_oneday === false) {//download mode att-log //triet tieu tai (XXX***)
                                                //debugger;
                                                extractRTE_LOG(dat.msg[2], workerCODE(/*ARGs*/dat.msg[2], null, null, 'logRTE')(/*[rst,RET]*/  dat.msg[0]), m[0]);
                                            };
                                        } else {
                                            //
                                            if (attlog_oneday === false) {//download mode att-log  //triet tieu tai (XXX***)
                                                //debugger;
                                                extractRTE_LOG(dat.msg[2], dat.msg[3], m[0]);
                                            };
                                            //
                                        };
                                    };
                                    //
                                    //
                                    //
                                    if (dat.msg[0][1][2]) {//download ok chu y triet tieu (XXX***)
                                        // DEVI__Q.RTE_Log khai bao o main.js
                                        DEVI__Q[(attlog_oneday === true ? 'RTE' : 'ATT') + '_Log'][dat.msg[2][0]] = [dat.msg[0][0]];
                                    };
                                    ///
                                } else {
                                    //debugger;
                                    //tai user + template
                                    m[0] = dat.cmd; //OK, or ERR
                                    //
                                };
                                //
                                //debugger;
                                //console.log('m[1][4]',  m[1][4] , dat['m[1][4]']);
                                //frmUI.VAL += dat.msg;
                                frmUI.INFO.push([


                                          !HEAVY_JOB_HWND[m1[2].id].package_tmpl
                                          ?
                                          dat.msg[0][1]
                                          :
                                          (HEAVY_JOB_HWND[m1[2].id].package_tmpl.push(dat.msg[0][1]), HEAVY_JOB_HWND[m1[2].id].package_tmpl)


                                    , m[2], dat.msg[2], m[0], m[1][4] || dat['m[1][4]'] ]);
                                //
                            };
                            //
                            endJOB(m1[2].id);
                            //
                        });
                    };
                    //
                    //debugger;
                    //
                    woME.postMessage({ cmd: m[0]/* == "OK" ? 'close' : 0*/, dat: m });
                    //
                }

                ,

                initWOK: function (devs) {

                    const th$a = this;

                    if (PAA.hasClass('JS_JS_payrollonline')) {
                        //
                        var maxDEV = devs.length, cntDEV = 0,
                            frmUI_INFO = function () {
                                //
                                const m = devs[cntDEV], tenDB = c0s$l_na(m.serno,1),// c0s$l_na trong main.js ('dev_' + m.serno).hexEncode(),
                                    inf = arguments[0],
                                    ARG = [tenDB, ['alog'.hexEncode(), 'alog__rte'.hexEncode()], DEVI__Q.VER[0]];
                                //
                                if (inf[0] == 1) {//OK
                                    const dat = inf[1][0];
                                    DEVI__Q.ATT_Log[tenDB] = dat;//dung flag 
                                    frmUI.INFO.push([dat[1], m, [tenDB], 'LOD']);
                                    //
                                    //debugger;
                                    extractRTE_LOG(ARG, workerCODE(/*ARGs*/ARG, null, null, 'logRTE')(/*[rst,RET]*/  dat), 'LOD');
                                    //
                                } else if (inf[0] == 1001) {//HIT_CACHE
                                    frmUI.INFO.push([inf[1][8], m, ARG, 'HIT_CACHE']);
                                };
                                //
                                cntDEV += 1;
                                LOD_INF();
                                //
                            },
                            LOD_INF = function () {
                                if (cntDEV < maxDEV) {
                                    //
                                    //debugger;

                                    const m = devs[cntDEV], tenDB = c0s$l_na(m.serno, 1);// c0s$l_na trong main.js ('dev_' + m.serno).hexEncode();
                                    //
                                    //*************** restore  frmUI.INFO *************************
                                    if (DEVI__Q.ATT_Log.hasOwnProperty(tenDB)) {
                                        //
                                        frmUI_INFO([1001,DEVI__Q.ATT_Log[tenDB]]);
                                        //
                                    } else {
                                        //
                                        workerCODE.apply(frmUI_INFO, [null, tenDB + DEVI__Q.VER[0], ['alog'.hexEncode(), 'alog__rte'.hexEncode()], "R", 0,

                                            { noV: 1 }//triet tieu version db trong main.js  -> lo$DB

                                        ]);//R:read database
                                    };
                                    //*************************************************************
                                } else {
                                    //
                                    frmUI();
                                    //
                                };
                            };
                        //
                        LOD_INF();
                        //
                        PAA.trigger('LOAD_XONG_JS_JS_payrollonline', [[th$a, devs]]);
                        //
                        return;
                        //
                    };


                    setTimeout(function () {
                        //
                        th$a.___devs = devs;
                        //
                        th$a.initWOK_JOB(devs);

                    }, 100);

                }
                ,

                initWOK_JOB: function (devs) {
                    //
                    clearInterval(DEVI__Q.isBSY_TO);
                    //
                    if (DEVI__Q.isBSY == '2') {//
                        //
                        if (!DEVI__Q.___initWOK_JOB) DEVI__Q.___initWOK_JOB = this;
                        //
                        PAA.find('.text_conn').addClass('text-danger').text("BUSY ...");
                        //
                        DEVI__Q.isBSY_TO = setTimeout(DEVI__Q.___initWOK_JOB.initWOK_JOB, 1000);
                        //
                        return;
                    };
                    //
                    //
                    //debugger;
                    //
                    DEVI__Q.isBSY = '2';//bat flag buzy
                    //
                    //
                    //reset phat sinh khi download finger template
                    frmUI.VAL = '';
                    frmUI.INFO = [];
                    //
                    //
                    //
                    if (!devs) devs = (DEVI__Q.___initWOK_JOB || this).___devs || [];
                    //
                    delete DEVI__Q.___initWOK_JOB;//clear
                    //
                    //
                    //const rawFN = opts.wokJS+ '(' + workerCODE.toString().replace('_$_ATTLOG_$_', '_$_ATTLOG_$_'.hexEncode()) + ')()';


                    //debugger;
                    //
                    //co tong cong bao nhieu mcc?
                    const dumeRING = [],
                        __bk_res = opts.el.data('__bk_res') || {};
                    //
                    var task_dynjs = '';

                    if (__bk_res.hasOwnProperty('__fn')) {
                        if (!__bk_res['__fn']) {
                            //co property, nhung undefined!
                            delete __bk_res['__fn'];
                        } else {
                            //debugger; 
                            //code upload user template.
                            task_dynjs = __bk_res['__fn'](null,'upload_tmpl_dynjs');
                        };
                    };
                    //         
                    //
                    //
                    const rawFN = opts.wokJS[1] +

                        ';(function(initWOK){const lo$DB=' + lo$DB.toString() +

                        ',workerCODE=' + workerCODE.toString() + task_dynjs +

                        ';' + opts.wokJS[2].replace('_$_ATTLOG_$_', opts.wokJS[0]) +

                    '})'
                    ,

                    upHOLE = [
                        //[2]: 1: not cross domain, 2: CORS                           ,
                        ["0"/*1*/,

                            'zkdev.dnd.vn',

                            2]
                        ,

                        ["0"/*2*/,
                            'zkheavy.vercel.app'
                            , 2
                        ]

                        , ['0'/*3*/, "http://wdms.dnd.vn:16868", 2]

                        ,
                        ["0"/*4*/,

                            'firebase.dnd.vn',

                            2]
                        ,
                        ["0"/*5*/,

                        'botay-thaihoa.koyeb.app',

                        2]
                        ,

                        ["0"/*6 very good !!!*/,

                        'hellohrm.somee.com',

                        2]

                        ,

                        ["7"/*7*/,

                        'hoa138-001-site1.anytempurl.com',//'hieu01-001-site1.jtempurl.com' ,//'hoa137-001-site1.gtempurl.com',//'hoa12345-001-site1.dtempurl.com',//'hoa123-001-site1.etempurl.com',

                        2]

                    ]
                    ,
                    rndIt = function (arr, d) {
                        //
                        //debugger;

                        let lop = [];
                        //
                        while (lop.length < arr.length) {
                            //
                            let ix = Math.floor((Math.random() * arr.length)),
                                it = arr[ix];

                            //kiem tra xem con song k????
                            if (it[0] !== "0") {

                                if (!it.isUSE || d.heavyMOD === "1") {
                                    it.isUSE = 1;
                                } else {
                                    //tim cai chua dung
                                    for (var ss = 0; ss < arr.length; ss++) {
                                        if (arr[ss][0] !== '0' && !arr[ss].isUSE) {
                                            arr[ss].isUSE = 1;
                                            it = arr[ss];
                                            break;
                                        }
                                    }
                                }
                                //
                                return JSON.parse(JSON.stringify(it));
                                //
                            };
                            //
                            //luu giu lai index da duoc random
                            if (lop.indexOf(ix) == -1) {
                                lop.push(ix);
                            };
                            //
                        };
                        //
                    }
                    ,
                    RND_CORS = function (d) {
                        return rndIt(
                            upHOLE.filter(function (it) {
                                return it[2] > (d.heavyMOD === "1" ? 1 : 0);
                            }), d
                        );
                    };
                    
                    //debugger;
                    //
                    //
                    //
                    for (var z = 0; z < devs.length ; z++) {
                        //
                        HEAVY_JOB_HWND[devs[z].id] = function (sFN, m, z, hevyENGINE) {
                            //
                            //debugger;

                           // const wdmo = JSON.parse(m.wdmo),
                            //devcap = wdmo[2].split('-');

                            //_fp = cntchrt(6, 1, 80, rstMAX[0]),//finger
                            //_usr = cntchrt(7, 0, 50, rstMAX[1]),//user
                            //_fa = cntchrt(13, 12, 20, rstMAX[2]);//face
                            //(parseInt(devi[8]) - parseInt(devi[2])) / 1000;

                            //const devcap = JSON.parse(m.wdmo)[2].split('-'),
                            //               p = [
                            //                   devcap[6],//6 'fp_capacity': 56,
                            //                   devcap[7],//7 'usr_capacity': 60,
                            //                   devcap[13],///13 'face_capacity': 88

                            //                   devcap[8], //log_capacity

                            //                   devcap[1], // fp_used
                            //                   devcap[0], // usr_used
                            //                   devcap[12], // face_used

                            //                   devcap[2] // log_used

                            //               ],


                            //clnIOS = RND_CORS.___appIos == 'ios' ? "|" + ["", "", "", "", JSON.stringify(p)]
                            //    .join(String.fromCharCode(4)) : '';
                            //
                            //
                            const clnIOS =  ["", "", "", "", dCAPA(m.wdmo)].join(String.fromCharCode(4));
                            //
                            //
                            const tenDB = c0s$l_na(m.serno, 1),// c0s$l_na trong main.js ('dev_' + m.serno).hexEncode(),

                                //tbNA = (attlog_oneday === true ? 'alog__rte' : 'alog').hexEncode(),//ten tablename log tinh cong # log_rte dung cho realtime ....

                                jobJS = sFN + "('" + btoa(JSON.stringify([tenDB,

                                    ['alog'.hexEncode(), 'alog__rte'.hexEncode()], DEVI__Q.VER[0], attlog_oneday,

                                    //index:4 is rte-log download lastest log condition.
                                    (attlog_oneday === false && DEVI__Q['RTE_Log'][tenDB] ? DEVI__Q['RTE_Log'][tenDB][3] : null)//[].slice.apply(DEVI__Q['RTE_Log'][tenDB], [0,5])/*bo item [5] rte-log*/ 


                                    , __bk_res.sem//sel emps download usr FP template

                                    , clnIOS //mo them vao detect ios, count block download template cho nhanh...

                                ]

                                    )) + "')"

                                ,
                                doREQ = mngusrs === false ?  function () {
                                    //
                                    //debugger;
                                    //delete m.dlog;
                                    //
                                    const wher = [];
                                    //
                                    var m_dlog = attlog_oneday === true ? DEVI__Q[(attlog_oneday === true ? 'RTE' : 'ATT') + '_Log'][tenDB] : null;
                                    //
                                    if (!m_dlog/*m.dlog*/) {
                                        //
                                        m_dlog = st('getItem', tenDB + DEVI__Q.VER[0] + (attlog_oneday === true ? '__rte' : ''));
                                        //
                                        if (m_dlog) {//da download 1 lan roi.
                                            m_dlog = JSON.parse(window[st0('2')](atob(m_dlog)));
                                        };
                                    };
                                    //
                                    //option nay lam tao het ca hon !!!!
                                    //m_dlog = null;//DEBUG TAI LAI TU DAU...
                                    //










                                    /*
                                    if (m_dlog) {//da download 1 lan roi.
                                        wher.push("Verify_Time>'" + m_dlog[3] + "'");
                                    } else {
                                        //
                                        if (attlog_oneday === true && wher.length == 0) {
                                            wher.push("Verify_Time>'" + new Date().toISOString().split('T')[0] + "'");
                                        };
                                    };
                                    */
                               




                                    //debugger;





                                    //
                                    //
                                    //se tinh toan
                                    const _page = "0|" + (attlog_oneday === true ? "1000" : "50") + "|0|$!N;$!N;$!N;$!N;$!N;$!N;$!N;$!N;$!N;|0|" + (wher.length > 0 ? ' Where ' + wher.join(' and ') : '')
                                         //moi them vao coi chung DOG-DEAD-ERROR.
                                    + "|" + clnIOS;// chi dung cho ios de tinh toan so luong download

                                    //***NOTE _page[3] se ko xai trong truong hop ftp host
                                    //
                                    //debugger;
                                    new opts.zkblob(-505, m, z + 1, _page, wo.hevyENGINE);
                                    //
                                } : function () {
                                    //
                                    //
                                    //********************* only one device trigger to node js lay thong tin cloud upload template truoc khi keo ve device ... *********************
                                    //debugger;

                                    $.when(wo.delayZKBLOB).done(function (a) {
                                        //
                                        //debugger;
                                        //
                                        var zero_block = "0",
                                            total_block = "0",
                                            cloud_free_or_paid = "";
                                        //

                           
                                        //devcap[0] = nSL[0];//user
                                        //devcap[1] = nSL[1];//finger
                                        //devcap[12] = nSL[2];//face
                                        //devcap[4] = nSL[5];//admin
                                        //devcap[5] = nSL[4];//pass
                                        //
                                        //debugger;
                                        //
                                        if (a) {
                                            //debugger;
                                            //flag detect  delayZKBLOB result.
                                            //close worker n ., only keep 1st to post template, prevent stack main thread !
                                            wo.postMessage({ cmd: 'fuk_up_heavy_tmpl_close' });
                                            //
                                            total_block = a[1];
                                            //
                                            cloud_free_or_paid = '|' + a[2];
                                            //
                                        } else if (wo.one_put_tmpl_2_cloud) {
                                            //truoc khi get cloud template info thi tranh thu post data qua worker...
                                            //thuc thi lenh goi raw data to worker.
                                            wo.one_put_tmpl_2_cloud(wo, '1st_up_heavy_tmpl_init');
                                            //
                                            //first call get cloud host info.
                                            zero_block = "-1";//ignore ring process at block 0
                                        } else {
                                            //
                                            //moi them vao coi chung DOG-DEAD-ERROR.
                                            cloud_free_or_paid = "|" + clnIOS;// chi dung cho ios de tinh toan so luong download
                                            //
                                        };
                                        //
                                        //debugger;
                                        //*** so 100000 ngan nay tuong chung voi hai, nhung qua nguy hiem, vi day la package clean upload fp
                                        //se tinh toan " + devcap[0] + "
                                        const _page = zero_block + "|100000|" + total_block + "|$!N;$!N;$!N;$!N;$!N;$!N;$!N;$!N;$!N;|0|" + _fpver(__bk_res, z) + cloud_free_or_paid,//limit 100 tram ngan

                                            _only_usr_inf = PAA.closest('.modal-dialog').hasClass('only_usr_inf') ? 0 : -1000000
                                        //
                                        //
                                        //__bk_res: query finger template ...
                                        new opts.zkblob(-505, m, -1 * (z + 1) + _only_usr_inf, _page, wo.hevyENGINE, wo.__bk_res.tok);//z la so minus = download user !!!
                                        //
                                    });
                                    //**********************************************************************************************************************************************
                                }
                                ,
                                onmessage = function () {
                                    //
                                    //debugger;
                                    //
                                    const dat = arguments[0].data;
                                    //
                                    //danh dau browser support indexedDB
                                    workerCODE.indexedDB = dat.cmd == '!indexedDB' ? 2 : 1;
                                    //
                                    if (dat.cmd == '!indexedDB') {//ko support worker db
                                        //
                                        workerCODE.apply(doREQ, [null, dat.msg[0] + DEVI__Q.VER[0], dat.msg[1], "R", attlog_oneday === true ? 1 : 0,

                                            { noV: 1 }//triet tieu version db trong main.js  -> lo$DB

                                        ]);//R:read database

                                    } else if (dat.cmd == 'DB') {//co support nhung chua luu tru
                                        //ben worker goi ve ko co database ...
                                        doREQ();
                                    };
                                    //
                                    dumeRING.push([m.id, 0/*tong so luong*/, 100 / devs.length/*%*/, 0/*so luong ok*/]);
                                    //
                                    //debugger;f
                                    if (dumeRING.length == devs.length) {
                                        //khoi tao cho xoay vong vong mau den....
                                        CARDX_CALC.X = CARDX(dumeRING);
                                    };
                                    //
                                };

                            //
                            var wo;
                            //
                            //debugger;
                            //
                            if (hevyENGINE[2] > 1 || m.heavyMOD === "1" || m.kind == 101) {//ban quyen hoac local
                                //
                                //premium job worker
                                wo = new Worker(w0w.URL.createObjectURL(new Blob([jobJS])));
                                wo.onmessage = onmessage;
                                //
                                //return wo;
                                //
                            } else {
                                //
                                ////test iframe mode
                                const evtWK = document.createElement('iframe'),
                                    seson = Math.random().toString(36).substring(7) + new Date().getTime();

                                wo = {
                                    evtWK: evtWK,
                                    seson: seson,
                                    onmessage: onmessage,
                                    postMessage: function (dat) {
                                        //debugger;
                                        if (dat.cmd !== 'close') evtWK.contentWindow.postMessage(dat, "*");
                                    }
                                }

                                //
                                apisvr.a$.sessions[seson] = {
                                    id: seson,
                                    fn: function (rst, msg) {
                                        //debugger;
                                        if (msg.evtData.cmd == 0) {
                                            evtWK.contentWindow.postMessage({ cmd: 'iniscript', msg: jobJS }, "*");
                                        } else {
                                            wo.onmessage({ data: msg.evtData });
                                        };
                                    }
                                };

                                evtWK.setAttribute("style", "position:absolute;left:-100px;height:1px;width:1px;border:none;opacity:0");
                                evtWK.setAttribute('src', 'https://' + hevyENGINE[1] + '/zk/uphole.html?seson=' + btoa([seson].join('|')));//
                                //
                                //
                                dog_canvas[0].appendChild(evtWK);//append vao step 3 main div
                                //
                                //return wo;
                                //
                            };
                            //
                            //
                            wo.hevyENGINE = encodeURIComponent(JSON.stringify(hevyENGINE));
                            wo.hevyBLOCK = [];//quy uoc index 0 la total
                            wo.__bk_res = __bk_res;
                            //
                            //
                            //debugger;
                            //*************** use for upload user + tempate to device ?? action nay ko biet co ganh noi heavy template ????
                            if (__bk_res.hasOwnProperty('__fn')) {
                                //
                                //debugger;
                                //khi zero worker part template will modify device upload info
                                wo.M = m;
                                //
                                stack_put_tmpl[m.id] = [-1, ""/*BUZY*/];//kiem soat list file template 
                                //
                                //
                                //debugger;
                                if (z > 0) {//delay lai, cho thang 0 lay thong tin host ve xu ly ...
                                    //
                                    wo.delayZKBLOB = $.Deferred();
                                    //
                                } else {
                                    wo.one_put_tmpl_2_cloud = __bk_res.__fn;
                                    wo.toilaMAIN = [0,1,2,3,4,5,6,7,8,9];
                                };
                            };
                            //
                            //
                            return wo;
                            //
                        }(rawFN, devs[z], z, RND_CORS(devs[z]));
                        //
                    };
                    //
                    //
                    srclocked(false);
                }

                ,

                getOPT: function (na) {
                    if (na == 'online_signal') return online_signal;
                    if (na) return opts[na];
                    return opts;
                }

            }

        };
        //step 3: add end to obfucator tool.
        return MyObj;


    })();



</script>

<script type="text/javascript">
    /**

    https://github.com/kirilloid/bzip2-js/blob/master/bzip2.js

     *	this is a port of pyflate
     *	@url http://www.paul.sladen.org/projects/pyflate/
     *	@author kirilloid
     * @license CC-SA 3.0
     * @usage ArchUtils.bz2.decode(str)
     * @example ArchUtils.bz2.decode(
     * 		"BZh91AY&SYN\xEC\xE86\0\0\2Q\x80\0\x10@\0\6D\x90\x80 " +
     * 		"\x001\6LA\1\xA7\xA9\xA5\x80\xBB\x941\xF8\xBB\x92)\xC2\x84\x82wgA\xB0"
     * ) == "hello world\n";
     */


var ArchUtils=function(){"use strict";
/**
         * bwt_reverse code from wikipedia (slightly modified)
         * @url http://en.wikipedia.org/wiki/Burrows%E2%80%93Wheeler_transform
         * @license: CC-SA 3.0
         */function t(t, i) { var r = t.length; if (i >= r) throw RangeError("Out of bound"); if (i < 0) throw RangeError("Out of bound"); var s = t; t = t.join(""), s.sort(); for (var e = {}, o = r - 1; o >= 0; o--) e[s[o]] = o; var a = []; for (o = 0; o < r; o++) a.push(e[t[o]]++); for (var n = s[o = i], h = [], f = 1; f < r; f++) h.push(s[o = a[o]]); return n + h.reverse().join("") } function i(t, i, r) { for (var s = t[i], e = i; e > 0; t[e] = t[--e]); r.push(t[0] = s) } var r = function (t, i) { this.code = t, this.bits = i, this.symbol = void 0 }, s = function () { this.process = function (t) { for (var i = t.length, s = [], e = 0; e < i; e++) s.push([e, t[e]]); s.push([i, -1]); for (var o = [], a = s[0], n = a[0], h = a[1], f = 1; f < s.length; f++) { var b = s[f][0], u = s[f][1]; if (h) for (var d = n; d < b; d++) o.push(new r(d, h)); if (n = b, h = u, -1 == u) break } o.sort(function (t, i) { return t.bits - i.bits || t.code - i.code }), this.table = o; var c = 0, v = -1; this.faht = []; var l = null; for (e = 0; e < this.table.length; e++) { var p = this.table[e]; v += 1, p.bits != c && (v <<= p.bits - c, l = this.faht[c = p.bits] = {}), l[p.symbol = v] = p } this.min_bits = 16, this.max_bits = -1, this.table.forEach(function (t) { t.bits < this.min_bits && (this.min_bits = t.bits), t.bits > this.max_bits && (this.max_bits = t.bits) }, this) } };
         return { bz2: { decode: function (r) {  var e = new function () { this.init = function (t) { this.masks = []; for (var i = 0; i < 31; i++) this.masks[i] = (1 << i) - 1; this.masks[31] = -2147483648, this.f = t, this.bits = 0, this.bitfield = 0, this.count = 0 }, this.readbits2 = function (t) { var i = t >> 1; return this.readbits(i) * (1 << i) + this.readbits(t - i) }, this.readbits = function (t) { for (; this.bits < t;) this.bitfield = (this.bitfield << 8) + this.f.charCodeAt(this.count++), this.bits += 8; var i = this.masks[t], r = this.bitfield >> this.bits - t & i; return this.bits -= t, this.bitfield &= ~(i << this.bits), r } }; if (e.init(r), e.readbits(16), 104 != e.readbits(8)) throw "Unknown (not type 'h'uffman Bzip2) compression method"; var o = e.readbits(8); if (!(49 <= o && o <= 57)) throw "Unknown (not size '1'-'9') Bzip2 blocksize"; function a(t) { for (var i = [], r = t.readbits(16), s = 32768; s > 0; s >>= 1) if (r & s) for (var e = t.readbits(16), o = 32768; o > 0; o >>= 1) i.push(Boolean(e & o)); else for (var a = 0; a < 16; a++) i.push(!1); return i } o -= 48; var n = []; return function () { for (; ;) { var r = e.readbits2(48); if (e.readbits2(32), 54156738319193 != r) { if (25779555029136 == r) { e.readbits(7 & e.bits); break } throw "Illegal Bzip2 blocktype = 0x" + r.toString(16) } if (e.readbits(1)) throw "Bzip2 randomised support not implemented"; var o = e.readbits(24), h = a(e), f = e.readbits(3); if (2 > f || f > 6) throw RangeError("Bzip2: Number of Huffman groups not in range 2..6"); for (var b = [0, 1, 2, 3, 4, 5, 6].slice(0, f), u = [], d = 0, c = e.readbits(15) ; d < c; d++) { for (var v = 0; e.readbits(1) ;) if (v++ >= f) throw RangeError("More than max (" + f + ") groups"); i(b, v, u) } for (var l = [], p = h.reduce(function (t, i) { return t + i }, 0) + 2, m = 0; m < f; m++) { var g = e.readbits(5), w = []; for (d = 0; d < p; d++) { if (g < 0 || g > 20) throw RangeError("Bzip2 Huffman length code outside range 0..20"); for (; e.readbits(1) ;) g -= 2 * e.readbits(1) - 1; w.push(g) } l.push(w) } for (var k = [], z = 0; z < l.length; z++) { var A = new s; A.process(l[z]), k.push(A) } var C = []; for (v = h.length - 1; v >= 0; v--) h[v] && C.push(String.fromCharCode(v)); C.reverse(); for (var B, E, _ = 0, x = 0, R = 0, j = 0, y = []; ;) { for (var U in --x <= 0 && (x = 50, _ <= u.length && (B = k[u[_++]])), B.faht) if (e.bits < U && (e.bitfield = (e.bitfield << 8) + e.f.charCodeAt(e.count++), e.bits += 8), E = B.faht[U][e.bitfield >> e.bits - U]) { e.bitfield &= e.masks[e.bits -= U], E = E.code; break } if (0 <= E && E <= 1) 0 == R && (j = 1), R += j << E, j <<= 1; else { for (var H = C[0]; R > 0; R--) y.push(H); if (E == p - 1) break; i(C, E - 1, y) } } for (var O = t(y, o), S = [], I = (d = 0, O.length) ; d < I;) if (v = O.charCodeAt(d), d < I - 4 && O.charCodeAt(d + 1) == v && O.charCodeAt(d + 2) == v && O.charCodeAt(d + 3) == v) { v = O.charAt(d); for (var M = O.charCodeAt(d + 4) + 4; M > 0; M--) S.push(v); d += 5 } else S.push(O[d++]); n.push(S.join("")) } }(), n.join("") } } }
}();

</script>

<script type="text/javascript">

    //modify iframe
    onmessage = function (e) {
        //
        //handleMessage(event);
        //debugger;
        //
        const cmd=e.data.cmd.toString().toLowerCase();
        switch (cmd) {
            case 'err': {
                //
                RST(e.data.dat, "", 0);//se error va chay xuong end
                //muc dich la send old data ve hien thi tren browser
                //
                return;
                break;
            }
            case 'fuk_up_heavy_tmpl_close': {
                //debugger;
                self.close();
                //device_user.html send heavy template de upload len cloud. 
                return;
                break;
            }
            case 'end_up_heavy_tmpl_clean': {
                up_heavy_tmpl_init.__me[cmd].apply(this, e.data);
                return;
                break;
            }
            case '1st_up_heavy_tmpl_task': {
                //
                //debugger;
                //
                up_heavy_tmpl_init.__me[cmd].apply(this, e.data.dat);
                console.log('2.1 1st_up_heavy_tmpl_task', 'device_step2.html');
                //debugger;
                //UP_TMPL_WORKER.apply(this,e.data.dat);

                //postMessage({ cmd: '1st_up_heavy_tmpl_task' });

                //device_user.html send heavy template de upload len cloud. 
                return;
                break;
            }
            case 'up_heavy_tmpl_local': {
                //debugger;
                up_heavy_tmpl_init.__me[cmd].apply(this, e.data.dat);

                return;
                break;

            }
            case '1st_up_heavy_tmpl_init': {
                //
                //
                //debugger;
                //
                up_heavy_tmpl_init.__me =  up_heavy_tmpl_init();
                up_heavy_tmpl_init.__me[cmd](e.data);
                //
                console.log('1.1 1st_up_heavy_tmpl_init', 'device_step2.html');
                //postMessage({ cmd: 'end_up_heavy_tmpl_init' });

                //debugger;
                return;
                break;
            }
            //case 'rst_cordovanative_host': {
            //    //
            //    //debugger;
            //    up_heavy_tmpl_init.__me.rst_cordovanative_host();
            //    return;
            //    break;
            //};
                
        };
        //
        //
        //
        try {
            //
            //debugger;
            //
            ajz(e.data.dat);
            //
        } catch (err) {
            //
            postMessage({ cmd: 'err'});
            //
        };
        //
    };


    var attLOG = []
    ,

    idxDB

    ,

    ver = 1;


    function usr_tmpl(flagJOB, m, dMap, req, rst, lne, typ) {
        //
        //debugger;
        //
        if (flagJOB == 1) { // sumary user
            //
            //debugger;
            req[0] = req[2] + "|" + req[0] + "|";//**** cache lai de replace line next the last 
            //
            //
            if (ARGs[5][0]) {//user want download custom selection emps
                //
                //debugger;
                //
                const sEM = ARGs[5][0],
                    l0g_NEW = workerCODE(lne, null, null, 'l0g_SUM')([/*usr*/], dMap, req),
                    usr = l0g_NEW[0];
                //
                //remove pad info of last line
                //lne[w] = lne[w].replace(req[2] + "|" + req[0] + "|", "")
                //debugger;
                lne[lne.length - 2] = l0g_NEW[3][1];
                //
                //
                //
                ARGs[5][0] = [];//reset dung lai...
                //
                req[2] = 0;
                //
                for (var dz = 0; dz < sEM.length; dz++) {
                    //
                    const isSEL = usr.indexOf('|' + sEM[dz]);
                    if (isSEL > -1) {
                        //
                        req[2] += parseInt(usr[isSEL + 1]);
                        //
                        ARGs[5][0].push([sEM[dz], usr[isSEL + 1]]);
                        //
                    };
                };
                //ARGs[5][1][0][] default chua id mcc.
                //***** chu y no la ARRAy ***************
                ARGs[5][1][0][0] = 0;//gio chuyen sang index cua ARGs[5][0]
                //
            } else {
                //
                //debugger;
                lne[lne.length - 2] = lne[lne.length - 2].replace(req[0], "");//(****)
                //
                req[2] = dMap[1]; // tong so luong template can download
                //
            };
            //
            req[4] = 0; // da download 0
            //
            dMap[1] = dMap[5] = 0;//reset so luong template download 
            //
            //
            req[0] = -1;
            //
            //
            //STORE HEAD OF FP TEMPLATE 
            attLOG = ['package_tmpl', lne, dMap];
            //
            //
        } else {
            //
            //debugger;
            //
            attLOG = ['package_tmpl', rst, dMap];
            //
            //tong so luong log da duoc downloaded.
            req[4] = dMap[1] + parseInt(req[4]);
            //
        };
        //
        //so luong tra ve == line + voi lan truoc do parseInt(req[4])
        if (flagJOB == 1 || req[4] < parseInt(req[2])) {
            //
            //debugger;
            //
            var solu =m[1][3][0] == 'localconn'?150: 300;//250 10 ngon tay !!!
            //
            //download for valid emps.
            if (ARGs[5][0]) {
                //
                //debugger;
                //
                var validE = ARGs[5][0],
                    curIDX = ARGs[5][1][0][0],//********* chu y no la ARRAY 
                    getE = [[], 0],
                    newSL = 0;
                //
                for (curIDX ; curIDX < validE.length; curIDX++) {
                    //
                    newSL = getE[1] + validE[curIDX][1];
                    //
                    getE[0].push(validE[curIDX][0]);//list valid emp
                    getE[1] = newSL;//store lai ...
                    //
                    if (newSL >= solu) {
                        //
                        solu = newSL;//update lai so luong can download
                        //
                        ARGs[5][1][0][0] = curIDX + 1;//bat dau next block .. ********* chu y no la ARRAY 
                        //
                        break;
                    };
                    //
                };
                //
                //
                if (solu > newSL) solu = newSL;
                //
                //update query WHERE!
                //********* chu y no la ARRAY 
                req[5] = ARGs[5][1][0][1] + ' Where pin in(' + getE[0].join(',') + ')';
                //
                //
            };
            //
            //
            //fixed soluong template download moi lan
            req[1] = solu;//moi lan 100 template !!!
            //
            //
            if (solu > 0) {

                //debugger;

                if (m[1][3][0] != 'localconn') req[3] = m[1][4][3];//ftp host id **** index nay dung de get base64 block android app
                //
                //continue get nex block.
                postMessage({ cmd: 'nxt', msg: [req.join('|'), dMap, attLOG] });//, inf: dMap
                //
                attLOG = [];//RESET
                //
                return true;
            } else {
               // debugger;
                dMap = req;
                lne = [lne.slice(0)];//clone lne at index 0
                attLOG = ['package_tmpl', "", dMap];
            };
            //
        };
        //
        //debugger;

        for (j = 0; j < attLOG.length; j += 3) {
            lne.push(attLOG[j + 1]);
        };
        //
        postMessage({

            cmd: 'end', msg: [[rst, lne], dMap, ARGs,

                //index[3] extract rte_log neu download att_log mode ....
                null

            ]

        });
        //
        //
        self.close();
        //
        //
        return true;
    };

    const RST = function (m, bz2, typ) {
        //
        //debugger;
        //
        var rst,dMap = [],
            req = m[4].split('|')//m[1][3][2].split('|'),
            solg = req[1];

        try {
            //
            //
            //
            if (m[0] == 'OK' && parseInt(m[3]) < 0 //nho hon 0 dung cho user
                &&  m[1][4][4] === '2') {//=2 la package template
                //
                //debugger;
                //
                dMap = m[4].split('|');//lay lai thong tin request lan truoc.
                //
                dMap[1] = parseInt(dMap[1]);//neu ko no bi loi int
                //
                //download template ..
                if (usr_tmpl(parseInt(m[1][4][4]), m, dMap, req, bz2, [], typ)) {
                    return;
                };
            };
            //
            //
            //
            //debugger;
            //
            rst = ArchUtils.bz2.decode(atob(bz2));
            //
            if (!rst || rst.trim() == '') {
                bz2 = "ZERO_VAL";
                throw bz2;
            };
            //
            //lay request header
            var lne = rst.split(/\r|\r\n|\n/),
            usr = [],
            z =lne.length>5?5:lne.length-1;
            //
            //console.log('RST = function (m, bz2,typ): ' + z);
            //
            //debugger;
            //console.log(m[1][3][2]);
            //console.log(m[2].wdms);
            //
            //may gita head openDatabase ...
            for (var i = z; i > -1; i--) {
                if (lne[i].indexOf('isThreadsafe:0,') > -1) {
                    usr = lne.splice(i, 1);
                    if (i>0) {
                        //debugger;
                        //du me cut luon trong rst...
                        rst = rst.split(usr[0] + '\n')[1];
                    };
                };
            };
            //
            //cap nhat lai z
            usr = [];
            z = 0;
            //
            //debugger;
            //
            if (parseInt(m[3]) > 0) {//tai log the cham cong ...

                const l0g_NEW = workerCODE(lne, null, null, 'l0g_SUM')(usr, dMap, req),
                    oriRST = l0g_NEW[3];
                //
                usr = l0g_NEW[0];
                dMap = l0g_NEW[1];
                req = l0g_NEW[2];
                //
                //
                //remove maxID in origin result
                if (oriRST) {
                    rst = rst.replace(oriRST[0], oriRST[1]);
                };
                //
                //
                attLOG = attLOG.concat([m[1][3][2], rst, dMap]);
                //
                //
                //
                //debugger;
                //tong so luong log da duoc downloaded.
                req[4] = dMap[1] + parseInt(req[4]);
                //
                //so luong tra ve == line + voi lan truoc do parseInt(req[4])
                if (req[4] < parseInt(req[2])) {
                    //
                    //debugger;
                    req[1] = parseInt(req[2]) - parseInt(req[4]);
                    if (typ == 101) {
                        //
                        if (req[1] > 20000) req[1] = 20000;
                        //
                        //req[1] = 50;//DEBUG TAI LOG CHAN ALL
                        //
                    } else {
                        if (req[1] > 10000) req[1] = 30000;
                        //if (req[1] > 500) req[1] = 800;
                    };
                    //
                    //debugger;
                    if (m[1][3][0] != 'localconn') req[3] = m[1][4][3];//ftp host id **** index nay dung de get base64 block android app
                    //
                    //continue get nex block.
                    postMessage({ cmd: 'nxt', msg: [req.join('|'), dMap] });//, inf: dMap
                    //
                    return;

                };
            } else {
                //
                //debugger;
                //
                const flagJOB = parseInt(m[1][4][4]);//0: dowload user, 1: dowload sumary template , 9: finger print v9, 10: FP:10
                //
                dMap = [0, 0, null, null, m[1][4][4], 0];
                //
                for (var w = lne.length - 1; w > -1; w--) {
                    //
                    if (lne[w].trim() != '') {
                        //
                        const maxID = lne[w].split('|');
                        //
                        //
                        ////bo idex dau tien vi day la total record
                        req[2] = maxID.splice(0, 1)[0];//next block keep total here
                        ////
                        ////update start next block
                        req[0] = maxID[0];
                        ////
                        dMap[0] = maxID[0];//ID log
                        //
                        dMap[1] = dMap[5] = w + 1;//so luong log
                        //
                        //
                        //
                        if (flagJOB < 9 && usr_tmpl(flagJOB, m, dMap, req, rst, lne, typ)) {
                            return;
                        };
                        //
                        //
                        break;
                    };
                };
                //
                //download user
                if (parseInt(req[1]) == 100000) {//tai user lan dau tien quy uoc 100.000
                    //debugger;
                    if (parseInt(m[3]) < -1000000) {//neu nho hon -1.000.000 = download luon template....

                    };
                };
                //
                //debugger;
                //
                postMessage({

                    cmd: 'OK', msg: [[rst, lne], dMap, ARGs,

                        //index[3] extract rte_log neu download att_log mode ....
                        null

                    ]
                    , 'm[1][4]': m[1][4]//local connect bi thieu result giong nhu nodejs
                });
                //
                self.close();
                //
                return;
            };
            //
            //
            //
        } catch (err) {

            //(***)     loi nodejs pipe ftp, upload ko kip / khac phuc bang cach thay dau '|' '&&'='\x26\x26'
            //debugger;
            //attLOG[m[2].id] = "-1"
            //postMessage({ cmd: 'err', msg: [bz2.length] });
            //return;

            if (parseInt(m[3]) < 0) {//tai user

                dMap = [0, 0, null, null, "", 0];

                postMessage({

                    cmd: m[0] /*OK or ERR */, msg: [[rst, []], dMap, ARGs,

                        //index[3] extract rte_log neu download att_log mode ....
                        null

                    ]
                    , 'm[1][4]': m[1][4]//local connect bi thieu result giong nhu nodejs
                });

                return;

            };

        };
        //
        //
        //debugger;
        //
        RST_END.bkRST = [dMap, req, bz2 == 'ZERO_VAL' ? '-2' : '-1'];
        RST_END();
    }

    ,

    RST_END = function () {
        //
        RST_END._deffer--;

        if (RST_END._deffer > 0) return;


        //chua co db hoac loi
        const oDAT=workerCODE[ARGs[0]];
        if (oDAT) {//old db
            for (var z = 0; z < oDAT.length; z++) {
                attLOG.unshift(oDAT[z][1]);
                attLOG.unshift(oDAT[z][0]);
                attLOG.unshift(z);//chi cho vui
            }
        };


        //debugger;
        const bk_idxDB = idxDB,

            JOI = workerCODE(null, null, null, 'SU').bind(attLOG)(),

            RET = JOI[0],
            rst = JOI[1];
        //
        //
        var dMap = RST_END.bkRST[0],
            req = RST_END.bkRST[1];
        //
        //
        //
        //neu block error >dMap.length==0
        if (dMap.length == 0) {
            //
            //debugger;
            if (oDAT) {
                dMap = JSON.parse(JSON.stringify(RET));
                dMap[4] = parseInt(dMap[4].length / 2);
            } else {
                dMap = [
                    /*0: -1 erro*/RST_END.bkRST[2],//-2:ZERO_VAL
                    /*1: count total error*/ parseInt(req[2]) - RET[0],
                    /*2: tu ngay */RET[2],
                    /*3: den ngay */RET[3],
                    /*4: so luong emps */RET[1],
                    /*5: total all log*/req[2]
                ];
            }
            //
            //debugger;
            //cap nhat lai total result
            //RET[0] = parseInt(req[2]);
            //
            idxDB = null;//flag terminate worker !!! ***
            //
        } else {

            //debugger;

            if (idxDB) {
                //chi save khi that su lay duoc log the
                //debugger;
                workerCODE.apply(function () {

                    //debugger;
                    self.close();

                }, [[rst, RET], ARGs[0], ARGs[1], "W", attlog_oneday_rte === true ? 1 : 0]);

            };
        };
        //
        postMessage({

            cmd: 'end', msg: [[rst, RET], dMap, ARGs,

                //index[3] extract rte_log neu download att_log mode ....
                (attlog_oneday_rte === false && bk_idxDB ? workerCODE(ARGs, null, null, 'logRTE')([rst, RET]) : null)

            ]

        });
        //
        //
        //
        if (!idxDB) {//!!! ***
            //chu y nearly die hear workerCODE
            self.close();
        };
    }

    ,

    ajz = function (m) {

        //debugger;

        const m4 = m[1];
        //
        if (m4[3][0] == 'localconn') {

            
            //
            //debugger;
            //
            const S = m4[0].split(';'),
                usrS = S[0].split(String.fromCharCode(28));
            //
            m[1][4] = ["re_fake_local", "0", usrS[0], "0", usrS[1]];
            //
            postMessage({ cmd: 'ajz', msg: [usrS[0], 101] });
            //
            //debugger;
            //console.log(S[0]);
            RST(m, S[0]=='0'?'ZERO_VAL"': S[1], 101);
            //
            return;

        } else {
            //
            //debugger;

            postMessage({ cmd: 'ajz', msg: [m4[4][2], 0] });
            //
            if (m[1][4][2] == "0") {//so luong =0

                RST(m, "ZERO_VAL", 0);

                return;
            };
            //
            if (!m4[4] || !m4[4][1]) {
                //debugger;
                return;
            };
        };
        //





        //debugger;
        const adr = m4[3][2].split(String.fromCharCode(29));




        //if (ARGs[5] && ARGs[5][1] && ARGs[5][1][0] && ARGs[5][1][0][2] == 'up_usrtmpl') {
        //    //device_user upload usr template to device

        //    UP_TMPL(m, adr);
        //    return;

        //};




        

        const  xhr = new XMLHttpRequest();





        //http://wdms.dnd.vn:16868/zk/fio.php?f=' + adr[1], ''//,


        xhr.open("GET", (adr[0].indexOf('http://')==-1? 'https://':'') + adr[0] + '/zk/' + adr[1].split('_')[0] + '.php?f=' + adr[1]

            + (adr.length > 2 ? '&g=' + encodeURIComponent(adr[3]) + '&h=' + encodeURIComponent(adr[2]) + '&l=' + encodeURIComponent(adr[4]) : '') + '&t=' + new Date().getTime()

            , true);

        //xhr.open("GET", "http://wdms.dnd.vn:2432/zk/furi.php?f=furi_8674625&g=http&h=wdms.dnd.vn:2432&l=%2Fwww.hellohrm.somee.com%2Fzk%2Ff&t=1722398688716", true);

        //xhr.open('POST', (!uri ? "/TabPageData" : uri) + "?XDEBUG_SESSION_START=154A5348", true);
        //
        //
        xhr.responseType = 'blob';
        //
        xhr.onload = function () {
            //
            //debugger;
            if (xhr.status === 200) {
                //debugger;
                // Get the response
                //cb({ 'msgtype': 'newTabPage', 'ajaxsession': ajaxsession, 'kq': 'resolve', 'result': xhr.response });
                var reader = new FileReader;
                reader.onload = function () {
                    //
                    //debugger;
                    RST(m, (reader.result || 'base64,' ).split('base64,')[1],0);
                    //
                };
                reader.readAsDataURL(xhr.response);
                //
            } else {

                //debugger;

                RST(m, '',0);
                //update khi liwayway project registration tra ve status text la code language
                //cb({ 'msgtype': 'newTabPage', 'ajaxsession': ajaxsession, 'kq': 'reject', 'result': JSON.stringify({ status: xhr.status, statusText: xhr.statusText, response: xhr.response }) });// xhr.statusText });// xhr.status + " - " + xhr.statusText + '|' + xhr.response
            }
        };

        xhr.onerror = function (e) {

            //debugger;
            RST(m, '',0);
            //update khi liwayway project registration tra ve status text la code language
            //cb({ 'msgtype': 'newTabPage', 'ajaxsession': ajaxsession, 'kq': 'reject', 'result': JSON.stringify({ status: xhr.status, statusText: xhr.statusText, response: xhr.response }) });// xhr.status + " - " + xhr.statusText + '|' + xhr.response
        };

        xhr.send();

    };

    //debugger;
    //
    const ARGs = JSON.parse(atob(initWOK)),
        attlog_oneday_rte = ARGs[3] && ARGs[3] === true,/*attlog_oneday*/
        //
        dev_CAPA = JSON.parse(ARGs[6].split(String.fromCharCode(4))[4]);//index[8] != -1 = thong so thiet bi de tinh toan package template download.
    //

    ver = ARGs[2];//version database
    //

    //debugger;

   



    //
    //check browser support database
    postMessage({ cmd: indexedDB? 'DB':'!indexedDB', msg: ARGs });
    //
    //debugger;
    //attlog_oneday thi ko can care databse ....
    if (indexedDB) {
        //
        //debugger;
        //
        idxDB = self.indexedDB || self.webkitIndexedDB || self.mozIndexedDB || self.OIndexedDB || self.msIndexedDB;
        //
        RST_END._deffer = 2;
        //
        //day la thoi diem lay luu tru log
        workerCODE.apply(function (kq) {
            //
            //debugger;
            RST_END();
            //
        }, [null, ARGs[0], ARGs[1], "R", attlog_oneday_rte === true ? 1 : 0]);

    };


</script>

