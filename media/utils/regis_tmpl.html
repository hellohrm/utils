<style type="text/css">

.xemdangky .chon_valid_e{
    visibility:hidden;
}

.dx-device-mobile .duma_registration .dx-toolbar-before{
    max-width: calc(100% - 50px);
    overflow: hidden;
    display: flex;
}

.thumbnail-container .dz-progress {
    pointer-events: none;
    position: absolute;
    top: 12px;
    left: 20px;
    right: 15px;
    height: 8px;

    -webkit-transform: scale(1);
    border-radius: 5px;
    overflow: hidden;
    background: rgba(43, 43, 43, .25);
}
.thumbnail-container .dz-progress .dz-upload {
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    width: 0;
    -webkit-transition: width 300ms ease-in-out;
    -moz-transition: width 300ms ease-in-out;
    -ms-transition: width 300ms ease-in-out;
    -o-transition: width 300ms ease-in-out;
    transition: width 300ms ease-in-out;
    background: rgba(48,216,246,1);
    background: -moz-linear-gradient(left, rgba(5,112,213,1) 0%, rgba(48,216,246,1) 100%);
    background: -webkit-gradient(left top, right top, color-stop(0%, rgba(5,112,213,1)), color-stop(100%, rgba(48,216,246,1)));
    background: -webkit-linear-gradient(left, rgba(5,112,213,1) 0%, rgba(48,216,246,1) 100%);
    background: -o-linear-gradient(left, rgba(5,112,213,1) 0%, rgba(48,216,246,1) 100%);
    background: -ms-linear-gradient(left, rgba(5,112,213,1) 0%, rgba(48,216,246,1) 100%);
    background: linear-gradient(to right, rgba(5,112,213,1) 0%, rgba(48,216,246,1) 100%);
    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffea80', endColorstr='#ff7bae', GradientType=1 );
}

.upload-thumbnail.upding .remove-thumbnail{
    visibility:hidden;
}

    .thumbnail-container {
        padding: 0 10px;
    }

    .upload-thumbnail {
        background: #E7F3FF;
        color: #1977F2;
        padding: 1px 3px;
        border-radius: 50px;

        min-width: 70px;
        position: relative !important;
        /*margin-right: 8px;*/
        position: relative;
        margin:5px;
    }

        /*.upload-thumbnail {
        font-size: 10px;
    }*/
        .upload-thumbnail .fa {
            font-size: larger;
        }

        .upload-thumbnail a {
            font-size: 11px;
            text-decoration: none;
        }

        .upload-thumbnail span {
            font-size: 11px;
        }

        .upload-label {
            background: rgba(231, 97, 92, 0);
            color: #fff;
            padding: 2px;
            border: 1px dashed;
            /*font-size: 20px;*/
            cursor:pointer;
        }
            .upload-label .click-txt {
                display:none;
            }

        .upload-label:hover, .btn_attach:hover {
            color: #444;
            /*font-size: 9.4rem;*/
            -webkit-transition: width 2s;
        }
        .upload-thumbnail .image-name{
            max-width: 200px;
            text-overflow: ellipsis;
            overflow: hidden;
        }



    .lstregemp_dume.dx-scrollable-native-android .dx-scrollable-scrollbar{
        margin-top:45px;
    }

    .lstregemp:not(.dx-empty-collection),.lstregemp_dume{/*https://codepen.io/milojennings/pen/nyEZww*/
        overflow: hidden; 
        box-shadow: rgba(191, 191, 191, 0.15) 8px 0px 10px -6px inset;
    }
    .lstregemp .dx-empty-message,  .lstregemp_dume .dx-empty-message{
        border-top:none;
    }

.dumeSELSEAR{
    display: flex;
    align-items: center;
    background-color: rgba(191, 191, 191, 0.15);
    border-radius: 5px;
    padding: 5px;
}
.dumeSELSEAR .dx-list-search{
    margin-bottom:0!important;
}
    .dx-empty-collection .dumeSELSEAR {
        padding-left: 5px;
    }
    .lstregemp.shoter600px{
        height:auto!important;
    }
    .lstregemp .dx-icon-toggle-delete {
        margin-left: 4px;
    }
    .lstregemp .dx-scrollview-scrollbottom {
        display: none !important;
    }

.reg_emps {
  height: 65px;
  display:flex;
  align-items:center;
}
    .reg_emps .myself {
        position: relative;
        padding-top: 10px;
    }
    .myself svg {
        width: 88px;
        height: 90px;
        fill: lightgray;
    }
    .myself img {
        position: absolute;
        left: 18px;
        top: 16px;
        border: none!important;
    }

.reg_emps.latoi svg{
    width: 75px;
    height: 80px;
    position: absolute;
    /* stroke: darkcyan; */
    /* fill: none; */
    /* stroke-width: 20; */
    left: 14px;
    top: 5px;
    fill: lightgreen;
}
.reg_emps.latoi img{
    margin-top: -20px;
    border: none;
}

.reg_emps  img {
    height: 50px;
    width: 50px;
    min-width: 50px;
    margin-right: 10px;
    background-position: center;
    background-repeat: no-repeat;
    background-size: contain;
    border-radius: 25px;
    border: 1px solid lightgray;
    background-color: #fff;
}

.reg_emps > div.info {
  padding-right: 10px;
  overflow:hidden;
  font-size: 15px;

}
.reg_emps > div.info > div{
    white-space:nowrap;
    overflow: hidden;
    text-overflow:ellipsis;
    display:flex;
    align-items: center;
}

.reg_emps > div.accode {
    margin-left:auto;
    font-size: 18px;
    text-align: right;
}
    .reg_emps > div.accode i{
        display:block; /*cho no xuong dong*/
    }
    .reg_emps i{
        color: #6c757d!important;
        font-size:smaller;

        overflow: hidden;
        text-overflow: ellipsis;
        margin-right: 5px;
    }

.lstregemp.only_me .dx-list-select-all,
.lstregemp.only_me div[mnu='reglk_emps'],

.lstregemp.only_read .dx-list-select-all,
.lstregemp.only_read div[mnu='reglk_emps'],

.lstregemp.duyet_rmv .dx-list-select-all,
.lstregemp.duyet_rmv div[mnu='reglk_emps']
{
    display:none;
}



.lstregemp:not(.duyet_rmv) .dx-list-item-before-bag.dx-list-select-checkbox-container{
    display:none!important;
}
.lstregemp:not(.duyet_rmv) .dx-list-item-before-bag.dx-list-toggle-delete-switch-container{
    visibility:hidden;
    width: 20px;
}

.lstregemp.duyet_rmv .dx-list-item-before-bag.dx-list-toggle-delete-switch-container{
    display:none!important;
}

.prevent_point{
    pointer-events: none!important;
}

.lstregemp.duyet_rmv .dx-list-item-selected:not(.prevent_point) .dx-list-item-content,
.lstregemp.only_read .dx-list-item-selected:not(.prevent_point) .dx-list-item-content,

.only_read tr.dx-selection:not(.prevent_point) td {
    color:#dc3545!important;
    text-decoration:line-through!important;
}

.prevent_point td, 
.prevent_point.dx-list-item-selected .dx-list-item-content{
    text-decoration:line-through!important;
    color:#6c757d !important;
}
.hideselectchk .dx-command-select{
   pointer-events: none!important;
}

.dx-device-mobile .lstregemp .dx-icon-toggle-delete{
    margin-left:10px!important;
}

/*.lstregemp .dx-list-select-all{
    display:none;
}*/
.dumeSELSEAR .dx-list-select-all-checkbox{
    margin: -2px 0 -3px 5px!important;
}
.dx-device-mobile .dumeSELSEAR .dx-list-select-all-label{
    display:none!important;
}

.lstregemp .dx-list-item-selected .dx-list-item-before-bag.dx-list-toggle-delete-switch-container{
    visibility:visible;
}

    .reg_action {
        margin:auto
    }

    .reg_action li{
        background-color: transparent;
        display:flex;
        align-items:center;
        flex-wrap: wrap;
        border: none;
        padding: 0;
    }

    .reg_action .viewmode > button{
        margin-right: 5px;
        margin-top:5px;
    }

    .reg_action .viewmode > button:last-child{
        margin-right: 0;
    }


    .dume_overflow > div {
        overflow:visible;
    }

    .dx-state-invisible .dogclose {
        display:none;
    }
    .dogclose{
        position:absolute;
        margin-top:-50px;
        left:50%;
        transform:translateX(-50%);
    }

    



    .fileuploader {
        position: relative;
        width: 60%;
        margin: auto;
        height: 200px;
        border: 2px dashed #ddd;
        background: rgba(0, 0, 0, 0.2);
    }

        .fileuploader.dogswiper {
            border:none!important;
        }



        .fileuploader.active {
            background: #fff;
        }

            .fileuploader.active #upload-label {
                background: #fff;
                color: #e7615c;
            }


        .fileuploader #upload-label span.title {
            font-size: 1em;
            font-weight: bold;
            display: block;
        }

    span.tittle {
        position: relative;
        top: 222px;
        color: #bdbdbd;
    }

    .fileuploader #upload-label i {
        text-align: center;
        display: block;
        color: #e7615c;
        font-size: 9.5rem;
        position: absolute;
        top: -12px;
        left: 0;
        right: 0;
        margin-right: auto;
        margin-left: auto;
    }
    /** Preview of collections of uploaded documents **/
    .preview-container {
        position: relative;
        bottom: 0px;
        width: 35%;
        margin: auto;
        top: 25px;
        visibility: hidden;
    }

        .preview-container #previews {
            max-height: 400px;
            overflow: auto;
        }

            .preview-container #previews .zdrop-info {
                width: 88%;
                margin-right: 2%;
            }

            .preview-container #previews.collection {
                margin: 0;
                box-shadow: none;
            }

                .preview-container #previews.collection .collection-item {
                    background-color: #e0e0e0;
                }

                .preview-container #previews.collection .actions a {
                    width: 1.5em;
                    height: 1.5em;
                    line-height: 1;
                }

                    .preview-container #previews.collection .actions a i {
                        font-size: 1em;
                        line-height: 1.6;
                    }

                .preview-container #previews.collection .dz-error-message {
                    font-size: 0.8em;
                    margin-top: -12px;
                    color: #F44336;
                }



    /*media queries*/

    @media only screen and (max-width: 601px) {
        .fileuploader {
            width: 100%;
        }

        .preview-container {
            width: 100%;
        }
    }


    .swiper-container {
        width: 100%;
        height: 100%;
    }

    .swiper-slide {
        text-align: center;
        font-size: 18px;
        /* Center slide text vertically */
        display: -webkit-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
    }

        .swiper-slide img {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }



    /*.swiper-slide {
                width: 80%;
            }

                .swiper-slide:nth-child(2n) {
                    width: 60%;
                }

                .swiper-slide:nth-child(3n) {
                    width: 40%;
                }*/

    .swiper-container {
        width: 100%;
        height: 100px;
        margin: 20px auto;
        /*overflow: visible;*/
    }

    .append-buttons {
        text-align: center;
        margin-top: 20px;
    }

        .append-buttons button {
            display: inline-block;
            cursor: pointer;
            border: 1px solid #007aff;
            color: #007aff;
            text-decoration: none;
            padding: 4px 10px;
            border-radius: 4px;
            margin: 0 10px;
            font-size: 13px;
        }

    .reg-step-no {
        display:flex;
        align-items:center;
    }
 .reg-step-no .bl-no {
    width: 32px;
    min-width: 32px;
    height: 32px;
    background-color: transparent;
    border-radius: 50%;
    border: 2px solid #007EA7;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 22px;
    font-weight: 700;
}
  .reg-step-no .bl-txt {
    border-radius: 0px 30px 0 0px;
    padding: 0 15px 1px 5px;
    padding-bottom: 1px;
}
 .dog_rdio .dx-widget.dx-collection{
    justify-content: stretch;
}
    .dx-validationsummary-item .bl-no {
         border-color:#d9534f;
    }
    .dog_tong .dx-texteditor {
        margin-top: 0!important;
    }
    .dog_tab .dx-multiview-item:last-of-type .dx-item-content {
        align-items: center!important;
    }
    
    .dog_tab .dx-multiview-wrapper,.dog_tab .dx-multiview-item{
        overflow:initial!important;
    }

</style>
<div>

    <div class="tmpl_attach">

        <div class="append-buttons d-none">
            <button class="prepend-2-slides">Prepend 2 Slides</button>
            <button class="prepend-slide">Prepend Slide</button>
            <button class="append-slide">Append Slide</button>
            <button class="append-2-slides">Append 2 Slides</button>
            <button class="movetoend">move-to-end</button>
        </div>


        <form  action="./"  method="post" class="swiper-container mySwiper2 fileuploader d-flex justify-content-center align-items-center">
            <div class="swiper-wrapper">
                <div class="dropzone-init text-center">
                    <div class="d-inline-block bg-info btn_attach">
                        <i class="ti-clip" style="font-size:30px"></i>
                    </div>
                    <div class="text-secondary font-italic click-txt">
                        Click the Button or Drop Files Here
                    </div>
                </div>
            </div>

        </form>

        <div class="thumbnail-container d-flex justify-content-center align-items-center" style="flex-wrap: wrap">
            <div class="upload-thumbnail">
                <div class="d-flex align-items-center">
                    <i class="fa fa-paperclip" aria-hidden="true"></i>&nbsp;&nbsp;
                    <a href="javascript:" class="image-name"><span data-dz-name></span></a>
                    <a href="javascript:" class="remove-thumbnail text-danger ml-1 fa fa-times-circle" data-dz-remove=""></a>
                </div>
            </div>
            <div class="upload-label d-none"></div>
        </div>


    </div>

    <div class="rpt_invoice">

        <!--Author      : @arboshiki-->


        <div class="toolbar hidden-print">
            <div class="text-right">
                <button id="printInvoice" class="btn btn-info">
                    <i class="fa fa-print"></i> Print
                </button>
                <button class="btn btn-info export_pdf">
                    <i class="fa fa-file-pdf-o"></i> Export as PDF
                </button>
            </div>
        </div>

        <hr />


    </div>
</div>

<script type="text/javascript">


    "use strict";

    function _dog(dogx) {

        var dume_validationSYNC = function (params) {
            //
            const d = $.Deferred(),
                tha = this;
            //
            setTimeout(function () {
                //$.ajax('https://jsonplaceholder.typicode.com/posts?_limit=20').done(function (res) {
                //    // res.message contains validation error message
                //    //res.isValid ? d.resolve() : d.reject(res.message);

                //    // ===== or if "res" is { isValid: Boolean, message: String } =====
                //    d.resolve({ isValid: true, message: 'du me' });
                //    //
                //    console.log('dume ');
                //    //
                //}).fail(function (error) {
                //    console.error("Server-side validation error", error);

                //    d.reject("Cannot contact validation server");
                //})

                d.resolve({ isValid: true, message: 'du me' });
                //
                //console.log('dume ' + new Date().getTime());
                //tha._$element.find('input.dx-texteditor-input').trigger('change');
            }, 1);

            return d.promise();

            //
        }, dume_validationCUS = function (e) {
            //
            if (!e.validator.dume_validationHWND) {
                e.validator.option('validationRules[1]', { 'type': 'async' });
                e.validator.dume_validationHWND = dume_validationSYNC;
                return true;
            } else {
                return e.validator.dume_validationHWND();
            };
        }, tong_SEL = {

            lookup: {
                dataSource: [0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 12, 12.5, 13, 13.5, 14, 14.5, 15],
            }
            , editorOptions: {

                searchEnabled: false,
                //acceptCustomValue: false,
                //openOnFieldClick: true,

                //rtlEnabled: true,
                noDataText: '0',
                placeholder: '',
                //mask: "Hh:Mm",
                //maskRules: {
                //    H: char => char >= 0 && char <= 2,
                //    h: (char, index, fullStr) => {
                //        if (fullStr[0] == '2')
                //            return [0,1,2,3].includes(parseInt(char));
                //        else
                //            return [0,1,2,3,4,5,6,7,8,9].includes(parseInt(char));
                //    },
                //    M: char => char >= 0 && char <= 5,
                //    m: char => char >= 0 && char <= 9
                //},

                dropDownOptions: {
                    onContentReady: function (e) {
                        e.component._$popupContent.addClass('text-right');
                    }
                },
                onContentReady: function (e) {
                    //var btn = e.element.find('.dx-texteditor-buttons-container'),
                    //    txt = btn.prev();
                    //btn.insertBefore(txt);
                }

            }
        }

        , tong_NUM = {

            editorOptions: {

                //showSpinButtons: true,
                onContentReady: function (e) {

                    //var focusedElement,
                    //.on('focus', 'input', function () {
                    //    if (focusedElement == this) return; //already focused, return so user can now place cursor at specific point in input.
                    //    focusedElement = this;
                    //    setTimeout(function () {
                    //        //focusedElement.select();
                    //        inputEl.selectionStart = 0;
                    //        inputEl.selectionEnd = inputEl.value.length;
                    //    }, 100); //select all text in any field on focus for easy re-entry. Delay sightly to allow focus to "stick" before selecting.
                    //});
                    //
                    //
                    e.element.addClass('dx-dropdowneditor');//and vao de khi mouse hover background
                    //
                    var inp = e.element.find('.dx-texteditor-input-container'),
                        dogNUM = e.component,
                        refDIV;
                    //
                    $('<div></div>').insertBefore(inp).dxDropDownButton({

                        items: [0, 0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5, 5.5],
                        //stylingMode: 'contained',
                        //useSelectMode: true,
                        showArrowIcon: false,
                        dropDownOptions: {
                            onShowing: function (e) {
                                //e.component._$wrapper.css('width', inp.parent().width());
                                e.component.option({ 'width': inp.parent().width() });
                                e.component._$popupContent.addClass('text-right');
                                refDIV.parent().addClass('dx-dropdowneditor-active');
                                //
                                var lst = e.component.content().find('.dx-list').dxList('instance');
                                lst.option({ 'selectedItemKeys': [dogNUM.option('value')] });
                                //
                            }
                            ,
                            onHidden: function (e) {
                                refDIV.parent().removeClass('dx-dropdowneditor-active');
                            }
                        },
                        onContentReady: function (e) {
                            refDIV = e.element.find('.dx-button-content').html('<div class="dx-dropdowneditor-icon"></div>');
                            refDIV.parent().removeClass().addClass('dx-button-normal dx-button-mode-contained dx-widget dx-dropdowneditor dx-buttongroup-item');
                        }
                        ,
                        onItemClick: function (e) {
                            dogNUM.option('value', e.itemData);
                        }
                    });

                    setTimeout(function () {
                        //
                        inp.find('input')
                        //detect valid value
                       .on('change', function (e) {
                           //var c = e;
                           //e.currentTarget.value=15;
                           var td = inp.closest('td'),
                               vtor = td.data().dxValidator,
                               rst = vtor._validationInfo.result;

                           if (rst && rst.isValid === true && rst.status === 'valid') {

                               //console.log('du me tao kho cuc qua nhieu')

                               //vtor.option("validationRules[1]", {
                               //    'type': 'async', validationCallback: 
                               //});
                               //
                               //var cusAC = vtor._validationRules[1].validator;
                               //cusAC.validate();

                               //cusAC.isValid = false;
                               //cusAC.message = "console.log('onValueChanged trigger');";
                               //cusAC.validator.validate();
                               ////
                               //$.ajax('https://jsonplaceholder.typicode.com/posts?_limit=2').done(function (res) {
                               //    cusAC.isValid = true;
                               //    cusAC.message = "";
                               //    cusAC.validator.validate();
                               //}).fail(function (error) {
                               //    console.error("Server-side validation error", error);
                               //});


                               var op = td.parent().data().options,
                                   col = op.component._controllers.editing._getEditColumn();
                               //
                               var num = DevExpress.localization.number.parse(e.currentTarget.value, 'decimal');
                               nguye = parseInt(num),
                               le = num - nguye,
                               isMOD = false;
                               if (le > 0.5) {
                                   le = 1;
                                   isMOD = true;
                               } else if (le > 0) {
                                   le = 0.5
                                   isMOD = true;
                               };
                               //
                               if (isMOD) {
                                   op.data.tong = nguye + le;
                                   //console.log(' op.data.tong: ' + op.data.tong);
                               };
                               //console.log(".on('change', function (e) {");
                               //
                           };

                           //console.log(inp.closest('td').data().dxValidator._validationInfo.result.status);
                       })
                       .on('keydown', function (e) {

                           var str = e.key,//String.fromCharCode(event.keyCode),
                                sp = DevExpress.localization.number._getSeparators(),
                                pV = e.currentTarget.value,
                                isOK = true;
                           //
                           if (['.', ','].indexOf(str) > -1) {
                               //
                               if (str === sp.decimalSeparator) {
                                   if (pV.indexOf(str) > -1) {
                                       isOK = false;//co ky tu phan cach so le nam trong chuoi roi!
                                   };
                               } else {
                                   isOK = false;
                               };
                           };
                           //else {//check va lam tron so
                           //    if (/[0-9]/.test(str)) {
                           //        //
                           //        var wV = DevExpress.localization.number.parse(pV + str, 'decimal');
                           //        if (wV < 0.5 || wV > 24) {
                           //            isOK = false;
                           //        };
                           //    };
                           //};
                           //
                           //
                           if (!isOK) {
                               e.preventDefault();
                           } else {

                           };
                           //
                       })
                        //select all text
                        .focus();
                    }, 50);



                    //inp.on('keyup', 'input', function (e) {
                    //    console.log(e.currentTarget.value);
                    //    e.preventDefault();
                    //});

                }

                , onFocusIn: function (e) {
                    var inputEl = e.element.find(".dx-texteditor-input")[0];
                    inputEl.selectionStart = 0;
                    inputEl.selectionEnd = inputEl.value.length;
                }

                //, valueChangeEvent: "keyup"

                , onKeyDown: function (e) {//this function name is not with the right casing "onKeyPress"var event = e.event.jQueryEvent,
                    //    var str = e.event.key,//String.fromCharCode(event.keyCode),
                    //                sp = DevExpress.localization.number.default._getSeparators(),
                    //                nV = e.event.currentTarget.value,
                    //                isOK = true;
                    //    //
                    //    if (/[0-9]/.test(str)) {
                    //        //
                    //        isOK = false;
                    //        //
                    //    } else if (str === sp.decimalSeparator) {
                    //        //
                    //        if (str === sp.decimalSeparator) {
                    //            if (nV.indexOf(str) > -1) {
                    //                isOK = false;//co ky tu phan cach so le nam trong chuoi roi!
                    //            };
                    //        };
                    //    };
                    //    //
                    //    if (isOK) {
                    //        //check va lam tron so
                    //    } else {
                    //        e.event.preventDefault();
                    //        e.event.stopPropagation();
                    //    }
                }

            }
        , "validationRules": [
            {
                type: 'range',
                min: 0.5,
                max: 24,
                message: 'Sorry, we submit only the age from 0.5 to 24.',
            }
            ,
            //{ 
            //    type: "async", 
            //    validationCallback: 

            {
                type: "custom",
                reevaluate: false,
                validationCallback: dume_validationCUS
            }

        ]

        }
        , RZ_HWND = -1;

        function checkEmail(email) {
            //return $.ajax({
            //    // The url returns { errorText: "The Email address you entered already exists.", isValid: false }
            //    url: "https://www.mywebsite.com/api/checkEmail",
            //    dataType: "json",
            //    data: { email: email }
            //});

            const d = $.Deferred(), tha = this;
            //
            $.ajax('https://jsonplaceholder.typicode.com/posts?_limit=20').done(function (res) {
                // res.message contains validation error message
                //res.isValid ? d.resolve() : d.reject(res.message);

                // ===== or if "res" is { isValid: Boolean, message: String } =====
                d.resolve({ isValid: true, message: 'du me' });
                //
                //console.log('dume ');
                //
            }).fail(function (error) {
                console.error("Server-side validation error", error);

                d.reject("Cannot contact validation server");
            })


            return d.promise();
        }

        var __columns = function (lagu) {
            //
            var masOT = JSON.parse(lagu.rawD.ma$ter).filter(function (v) { return v.typ == 4; }),
                chkOverlapOT = function (its, dogV) {
                    //debugger;
                    var nV = dogV.newData, oV = dogV.oldData;
                    //
                    if (oV) {
                        if (!nV.tugio) {
                            nV.tugio = oV.tugio;
                        }
                        if (!nV.dengio) {
                            nV.dengio = oV.dengio;
                        }
                    };
                    //
                    //
                    //gia tri moi, ko bao gom tu gio va den gio
                    if (!nV.tugio || !nV.tugio) return true;
                    //
                    for (var i = its.length - 1; i > -1; i--) {
                        if (its[i].isEditing === false) {
                            var r = its[i].data,
                                otu = new Date(r.tugio).setMilliseconds(0),
                                ode = new Date(r.dengio).setMilliseconds(0),
                                ntu = new Date(nV.tugio).setMilliseconds(0),
                                nde = new Date(nV.dengio).setMilliseconds(0);
                            if (nde <= otu || ode <= ntu) {
                                //ok
                            } else {
                                return false;
                            };
                            //if (otu <= ntu && ntu < ode && (nde < ode || nde >= ode)) {// 
                            //    return false;
                            //} else if (ntu < otu && nde > otu) {
                            //    return false;
                            //};
                        };
                    };
                    return true;
                };
            //
            return {
                editing: {

                    confirmDelete: false,

                    allowUpdating: true,
                    mode: "form",

                    container: '.luoi_head',
                    getEditFormTemplate: function (e) {
                        var c = 3;
                    },
                    form: {
                        //labelMode: 'floating',
                        elementAttr: {
                            class: "text-right"
                        },
                        colCount: 1,
                        //colCountByScreen: {
                        //    xs: 2,
                        //    sm:4
                        //},
                        screenByWidth: function (width) {
                            //clearTimeout(RZ_HWND);
                            var dg = width < 500 ? 'xs' : (width < 650 ? 'sm' : 'md');
                            //
                            //RZ_HWND = setTimeout(function () {
                            //    if (window._fuckingEditing) {
                            //        window._fuckingEditing.trigger('fuckingEditing_COL', [dg,width]);
                            //    };
                            //}, 300);
                            //
                            return dg;
                        },
                        items: [{
                            itemType: 'group',
                            colCount: 4,
                            colCountByScreen: {
                                xs: 1,
                                sm: 2,
                                md: 3
                            },
                            items: [{
                                colSpan: 2,
                                dataField: "id"
                            },
                               {
                                   colSpan: 2,
                                   dataField: "EachDate"
                               }
                               ,
                               {
                                   colSpan: 1,
                                   dataField: "tugio"
                               }

                               ,
                               {
                                   colSpan: 1,
                                   dataField: "tong"
                               }
                               ,
                               {
                                   colSpan: 1,
                                   dataField: "dengio",
                                   readOnly: true
                               }
                            ]
                        }
                            ,
                            {
                                itemType: 'group',
                                items: [{
                                    dataField: "notes",
                                    editorType: "dxTextArea",
                                    editorOptions: {
                                        maxLength: 200
                                    }
                                }]
                            }
                        ],
                        onContentReady: function (e) {
                            //console.log('  onContentReady: function (e) {');
                            //
                            if (!e.component._fuckCLK) {
                                //
                                e.component._fuckCLK = 1;
                                //
                                setTimeout(function () {
                                    var form = e.element, bk = form.parent().find('.dx-button').data().dxButton._clickAction;
                                    form.parent().find('.dx-button').data().dxButton._clickAction = function () {
                                        srclocked(true);
                                        // debugger;
                                        //var dog= e.component.validate();
                                        e.component.validate().brokenRules.forEach(function (it) {
                                            if (it.type == 'custom') {
                                                it.isValid = true;
                                            };
                                        });
                                        //    .every(function (it) {
                                        //    it.validator.validate();
                                        //    var c = 0;
                                        //});

                                        //e.component.itemOption("EachDate", "colSpan", 2);
                                        //e.component.itemOption("Notes", "colSpan", 2);
                                        setTimeout(bk, 10);
                                    };
                                    //let btnSave = form.parentElement.parentElement.querySelector("[aria-label='Save']");
                                    //let btnCancel = form.parentElement.parentElement.querySelector("[aria-label='Cancel']");
                                    //btnCancel.parentNode.insertBefore(btnCancel, btnSave);
                                    //let saveButton = Button.getInstance(btnSave);
                                    //let cancelButton = Button.getInstance(btnCancel);
                                    //saveButton.option("icon", "save");
                                    //saveButton.option("type", "danger");
                                    //cancelButton.option("icon", "undo");



                                }, 0);
                            };
                            srclocked(false);
                        },
                        onInitialized: function (e) {
                            //
                            var dogEdt = e.element.closest('tr'),

                                bk_DAT = JSON.stringify(dogEdt.data().options.data),

                                 dog_edit_frm = dogEdt.closest('.luoi_head'),

                                 fnFRM = function (ex, bc, de) {
                                     //
                                     window._fuckingEditing = null;
                                     dog_edit_frm.css('display', '').prev().empty();
                                     //
                                     //
                                     if (this == 0 && ex.changes.length > 0 && ex.changes[0].type == 'update') {

                                         bk_DAT = JSON.parse(bk_DAT);


                                         grd.getDataSource()._items.some(function (fD) {
                                             //debugger;
                                             if (fD.aid == bk_DAT.aid) { //phuc hoi lai
                                                 //
                                                 for (var f in ex.changes[0].data) {
                                                     // check if the property/key is defined in the object itself, not in parent
                                                     if (ex.changes[0].data.hasOwnProperty(f)) {

                                                         fD[f] = bk_DAT[f];

                                                     };
                                                 };
                                                 //
                                                 return true;//exit some
                                                 //
                                             }
                                         });
                                         //
                                         grd.refresh();
                                         //
                                     };
                                     //off all event
                                     grd._controllers.editing.off('editCanceled');
                                     grd._controllers.editing.off('saved');
                                     grd._controllers.editing.off('rowValidating');
                                     //
                                     e.component.dispose();
                                     //
                                     srclocked(false);
                                     //
                                 };
                            //
                            var grd = dogEdt.data().options.component,
                                dumeFRM = e.component,
                                dumaEDT = {};
                            //
                            grd._controllers.editing
                                .off('editCanceled').on('editCanceled', fnFRM.bind(0))
                                .off('saved').on('saved', fnFRM.bind(1))
                                .off('rowValidating').on('rowValidating', function (v) {
                                    if (v.brokenRules.length == 0) {
                                        v.promise = dume_validationSYNC().done(function (result) {
                                            //
                                            v.isValid = chkOverlapOT(grd._controllers.data._items, v);
                                            //
                                            if (v.isValid === false) {

                                                v.errorText = 'result.errorText';



                                                var dog = e.component.validate();
                                                dog.validators.forEach(function (it) {
                                                    //it._validationRules[0].isValid = false;
                                                    if (it._validationRules[0].type == 'custom') {
                                                        var cusAC = it._validationRules[0];
                                                        cusAC.isValid = false;
                                                        cusAC.message = lagu.js_011_35 || "Overtime overlapping";
                                                        //cusAC.validate();
                                                        cusAC.validator.validate();
                                                        cusAC.validator._getEditor().focus();
                                                    } else {
                                                        return false;
                                                    }
                                                });
                                            };

                                        });
                                    } else {
                                        srclocked(false);
                                    };
                                })
                                .off('editorPrepared').on('editorPrepared', function (v) {
                                    //
                                    if (v.dataField) {//datafield moi listen
                                        var nx = v.editorElement.data();
                                        //
                                        nx[nx.dxComponents[0]].off('valueChanged').on('valueChanged', function (x) {
                                            var fiNa = this.__x.fi;
                                            if (['EachDate', 'tugio', 'tong'].indexOf(fiNa) > -1) {
                                                //
                                                grd._fieldChg(dumaEDT, fiNa, x.value, dogEdt.data().options.data);
                                                //
                                            };
                                            //
                                        }).__x = {
                                            fi: v.dataField
                                        };
                                        if (['tugio', 'dengio'].indexOf(v.dataField) > -1) {
                                            dumaEDT[v.dataField] = nx[nx.dxComponents[0]];
                                        };
                                    };
                                });

                            //grd.off('initNewRow').on('initNewRow', function (e) {
                            //        debugger;
                            //    });


                            //
                            //append nguyen cai td vao tren
                            dog_edit_frm.css('display', 'none').prev().prepend(e.element.parent().css({
                                "display": 'block',
                                'margin': '0 -15px',
                                'box-shadow': 'rgba(0, 0, 0, 0.16) 0px 1px 4px',
                                'padding': '10px 20px',
                                'background-color': 'rgba(191, 191, 191, 0.10)'
                            }));



                        }
                    }
                }

                , onInitNewRow: function (e) {
                    e.data = {
                        id: masOT.length > 0 ? masOT[0].id : null,
                        EachDate: new Date().setHours(0, 0, 0),
                        tugio: new Date().setHours(17, 0, 0),
                        tong: 1,
                        dengio: new Date().setHours(18, 0, 0),
                        notes: ''
                    };
                    //e.data.hireDate = new Date();
                    //e.promise = getDefaultData().done(function (data) {
                    //    e.data.ID = data.ID;
                    //    e.data.position = data.Position;
                    //});
                }
                ,

                columns: [
                            {
                                type: "selection",//https://js.devexpress.com/Documentation/ApiReference/UI_Components/dxDataGrid/Configuration/columns/#type
                                width: 40
                                //minWidth: 30,
                            }
                            ,
                            {
                                caption: lagu.js_011_16 || 'Overtime type',
                                cssClass: 'wrapfuck dog-placeholder',
                                dataField: 'id',
                                minWidth: 150,
                                lookup: {
                                    dataSource: masOT,
                                    displayExpr: 'ten',
                                    valueExpr: 'id',
                                },
                                editorOptions: {

                                    searchEnabled: false,
                                    acceptCustomValue: false,
                                    //openOnFieldClick: true,

                                }
                                , validationRules: [{ type: 'required' }]
                            }

                            ,


                            {
                                widget: 'dxDateBox',
                                caption: lagu.js_011_17 || "Date",
                                dataField: 'EachDate',
                                dataType: 'date',
                                format: function (e) {
                                    return new Intl.DateTimeFormat(apisvr.a$.selected_language, {//
                                        year: 'numeric',
                                        month: '2-digit',
                                        day: '2-digit'
                                    }).format(e);
                                },
                                //cssClass:'small',
                                minWidth: 100,
                                //minWidth: 75,
                                editorOptions: {

                                    acceptCustomValue: false,
                                    openOnFieldClick: true,

                                    pickerType: DevExpress.devices._realDevice.deviceType == 'phone' ? 'rollers' : undefined,
                                    //pickerType:'native',
                                    //adaptivityEnabled: true,
                                    //onFocusIn: function (e) {
                                    //    e.element.find('.dx-texteditor-input').attr('type', 'datetime-local');
                                    //}
                                }
                                , validationRules: [
                                    { type: 'required', message: "My custom message" },
                                ]
                            }
                            ,

                             $.extend({
                                 widget: 'dxNumberBox',
                                 caption: lagu.js_011_18 || "Hour(s)",
                                 dataField: 'tong',
                                 dataType: 'number',
                                 minWidth: 75,
                                 format: "#.#"
                                 , validationRules: [
                                     {
                                         type: "custom",
                                         validationCallback: function (e) {
                                             return true;
                                         },
                                         message: "An even number is expected"
                                     }
                                 ]
                             }, tong_SEL)
                            ,

                            {
                                widget: 'dxDateBox',
                                caption: lagu.js_011_19 || "From time",
                                dataField: 'tugio',
                                dataType: 'datetime',
                                format: "HH:mm",
                                minWidth: 75,
                                editorOptions: {
                                    displayFormat: "HH:mm",
                                    useMaskBehavior: true,
                                    "type": "time",
                                    pickerType: 'list'
                                    ,
                                    dropDownOptions: {//bo chu chon tren ios.
                                        showTitle: false
                                    },

                                    acceptCustomValue: false,
                                    openOnFieldClick: true,


                                    onOpened: function (e) {
                                        //
                                        var list = e.component.content().find('.dx-list').dxList('instance'),
                                            colon = e.component._regExpInfo.patterns[1];
                                        //
                                        list._timeout = -1;
                                        list._sync = function (t0, prt) {
                                            //
                                            clearTimeout(list._timeout);
                                            //
                                            list._timeout = setTimeout(function () {
                                                //
                                                var DXTOR = e.component, pou = DXTOR._popup;
                                                if (pou && pou.option('visible') === true) {
                                                    var atV = prt || (e.element.find('input')[1].value || '00' + colon + '00').split(colon),

                                                    idx = parseInt(atV[0]) * 2 + (parseInt(atV[1]) === 0 ? 0 : 1),
                                                    lit = list._$element.find('.dx-list-item:eq(' + idx + ')');

                                                    if (lit.length > 0) {
                                                        list.selectItem(lit);
                                                        list.scrollToItem(lit);
                                                    };
                                                };
                                                //
                                            }, t0);
                                        };
                                        //
                                        list._sync(0);
                                        e.component._lst = list;
                                        //
                                    }

                                    ,

                                    onInput: function (e) {
                                        var DXTOR = e.component;
                                        if (DXTOR._activePartIndex == 2) {

                                            setTimeout(function () {
                                                var ipt = e.element.find(".dx-texteditor-input"),
                                                    prt = ipt.val().split(DXTOR._regExpInfo.patterns[1]);//colon
                                                //
                                                if (prt.length == 2) {
                                                    //
                                                    var lastK = parseInt(prt[1].slice(-1));
                                                    if (lastK > 0 && lastK < 4) {
                                                        //
                                                        prt[1] = '30';
                                                        lastK = 30;
                                                        //
                                                    } else {
                                                        prt[1] = '00';
                                                        lastK = 0;
                                                    };
                                                    //
                                                    DXTOR._setActivePartValue(lastK);
                                                    DXTOR._selectNextPart(1);
                                                    //
                                                    if (DXTOR._lst) DXTOR._lst._sync(100, prt);
                                                };

                                            }, 10);
                                            //
                                        };

                                    }
                                    //adaptivityEnabled: true,

                                    ,

                                    onContentReady: function (ep) {
                                        ep.component._onMouseWheel = function (e) {
                                            if (this._useMaskBehavior()) {
                                                var ofs = 1;
                                                if (ep.component._activePartIndex == 2) {
                                                    ofs = 30;
                                                };
                                                this._partIncrease(e.delta > 0 ? ofs : -1 * ofs, e);
                                                //
                                                if (this._lst) this._lst._sync(300);
                                                //
                                            }
                                        };

                                        //ep.component.option('value', new Date().setHours(0, 0, 0));
                                        // ep.element.find('input').val("00:00");
                                    }

                                }
                                , validationRules: [{ type: 'required', message: "My custom message" }]
                            }

                            ,

                            {

                                //hidingPriority: 1,

                                widget: 'dxDateBox',
                                caption: "(" + (lagu.js_011_20 || 'To time') + ")",
                                dataField: 'dengio',
                                dataType: 'datetime',
                                format: "HH:mm",
                                minWidth: 75,
                                cssClass: 'text-secondary',
                                editorOptions: {
                                    elementAttr: { "class": 'text-secondary' },
                                    displayFormat: "HH:mm",
                                    useMaskBehavior: true,
                                    "type": "time",
                                    pickerType: 'list'
                                    ,
                                    readOnly: true,
                                    acceptCustomValue: false,
                                    openOnFieldClick: true,
                                    placeholder: '--:--'


                                    //onOpened: function (e) {
                                    //    //
                                    //    var list = e.component.content().find('.dx-list').dxList('instance'),
                                    //        colon = e.component._regExpInfo.patterns[1];
                                    //    //
                                    //    list._timeout = -1;
                                    //    list._sync = function (t0, prt) {
                                    //        //
                                    //        clearTimeout(list._timeout);
                                    //        //
                                    //        list._timeout = setTimeout(function () {
                                    //            //
                                    //            var DXTOR = e.component, pou = DXTOR._popup;
                                    //            if (pou && pou.option('visible') === true) {
                                    //                var atV = prt || (e.element.find('input')[1].value || '00' + colon + '00').split(colon),

                                    //                idx = parseInt(atV[0]) * 2 + (parseInt(atV[1]) === 0 ? 0 : 1),
                                    //                lit = list._$element.find('.dx-list-item:eq(' + idx + ')');

                                    //                if (lit.length > 0) {
                                    //                    list.selectItem(lit);
                                    //                    list.scrollToItem(lit);
                                    //                };
                                    //            };
                                    //            //
                                    //        }, t0);
                                    //    };
                                    //    //
                                    //    list._sync(0);
                                    //    e.component._lst = list;
                                    //    //
                                    //}

                                    //,

                                    //onInput: function (e) {
                                    //    var DXTOR = e.component;
                                    //    if (DXTOR._activePartIndex == 2) {

                                    //        setTimeout(function () {
                                    //            var ipt = e.element.find(".dx-texteditor-input"),
                                    //                prt = ipt.val().split(DXTOR._regExpInfo.patterns[1]);//colon
                                    //            //
                                    //            if (prt.length == 2) {
                                    //                //
                                    //                var lastK = parseInt(prt[1].slice(-1));
                                    //                if (lastK > 0 && lastK < 4) {
                                    //                    //
                                    //                    prt[1] = '30';
                                    //                    lastK = 30;
                                    //                    //
                                    //                } else {
                                    //                    prt[1] = '00';
                                    //                    lastK = 0;
                                    //                };
                                    //                //
                                    //                DXTOR._setActivePartValue(lastK);
                                    //                DXTOR._selectNextPart(1);
                                    //                //
                                    //                if (DXTOR._lst) DXTOR._lst._sync(100, prt);
                                    //            };

                                    //        }, 10);
                                    //        //
                                    //    };

                                    //}
                                    ////adaptivityEnabled: true,

                                    //,

                                    //onContentReady: function (ep) {
                                    //    ep.component._onMouseWheel = function (e) {
                                    //        if (this._useMaskBehavior()) {
                                    //            var ofs = 1;
                                    //            if (ep.component._activePartIndex == 2) {
                                    //                ofs = 30;
                                    //            };
                                    //            this._partIncrease(e.delta > 0 ? ofs : -1 * ofs, e);
                                    //            //
                                    //            if (this._lst) this._lst._sync(300);
                                    //            //
                                    //        }
                                    //    };

                                    //    //ep.component.option('value', new Date().setHours(0, 0, 0));
                                    //    // ep.element.find('input').val("00:00");
                                    //}
                                }
                            }

                            ,

                            {
                                caption: lagu.js_011_21 || 'Notes',
                                //width:500,
                                minWidth: 150,
                                //hidingPriority: 0,
                                dataField: 'notes',
                                //cssClass: 'dog-max-width',
                                //editorType: "dxTextArea",
                            }

                            ,


                            {
                                type: "buttons",
                                visible: false,
                            }

                ]
            }

        }

        ,
        __regisFRM = function (elUI, masLV, LV_NGA, fO, _gLA, isP, isView) {

            var dume = __columns(elUI.lan).columns[3],
                    dumeO = {
                        cssClass: 'dog_tong',
                        dataField: 'tong',
                        editorType: 'dxNumberBox',

                        label: {
                            text: dume.caption + ' (0' + dau_phay() + '5 đến 11' + dau_phay() + '5 ' + (_gLA(34, 5) || 'hour') + ')'
                        }

                        //colSpan: 2,

                        , editorOptions: {
                            value: elUI.minTong,//default value
                            min: elUI.minTong,
                            max: 11.5,
                        }

                    };

            return [{
                dataField: 'id',
                editorType: 'dxSelectBox',

                editorOptions: {
                    items: masLV,
                    valueExpr: 'id',
                    displayExpr: 'ten',
                    searchEnabled: true,
                    value: fO && fO.id || (masLV.length > 0 ? masLV[0].id : null),
                },
                label: {
                    text: elUI.lan.js_011_22 || 'Leaving kind choosing'
                },
                validationRules: [{
                    type: 'required',
                    message: 'Position is required',
                }]
            }
                    ,
                    {
                        dataField: 'EachDate',
                        editorType: 'dxDateBox',

                        editorOptions: {

                            value: new Date(fO && new Date(fO.EachDate) || new Date().setHours(0, 0, 0, 0)),
                            width: '100%',

                            acceptCustomValue: !isP,
                            openOnFieldClick: isP,//chi open khi phone
                            pickerType: isP ? 'rollers' : undefined,

                            onContentReady: function (ez) {
                                LV_NGA[0] = ez.component;
                            }
                            , onValueChanged: function (v) {
                                var od = new Date(LV_NGA[1].option('value'));
                                if (new Date(v.value).getTime() > od.getTime()) {
                                    LV_NGA[1].option('value', v.value);//set den ngay bang tu ngay
                                };
                            }

                        }
                        , label: {
                            text: elUI.lan.js_011_17 || 'Date'//share with OT
                        }
                    }
                    ,
                    {
                        itemType: 'group',
                        colSpan: 2,
                        items: [{
                            itemType: 'tabbed',

                            cssClass: 'dog_tab',

                            tabPanelOptions: {
                                height: 120,
                                deferRendering: false,
                                selectedIndex: fO && fO.selo || 0,// fO.tong  - modify
                                //
                                //
                                disabled: !isView
                                //
                                //onContentReady: function (v, c) {
                                //    debugger;
                                //}
                            },
                            tabs: [{
                                title: elUI.lan.js_011_23 || 'Full-date off',
                                colCount: 2,
                                tabTemplate: function (itemData, itemIndex, itemElement) {
                                    itemElement.addClass('d-flex').append("<span class='fa fa-check-circle tab_sel'></span>" + itemData.title);
                                },
                                items: [
                                    {
                                        dataField: 'todate',
                                        editorType: 'dxDateBox',
                                        editorOptions: {

                                            value: new Date(fO && new Date(fO.todate) || new Date().setHours(0, 0, 0, 0)),
                                            width: '100%',

                                            acceptCustomValue: !isP,
                                            openOnFieldClick: isP,//chi open khi phone
                                            pickerType: DevExpress.devices._realDevice.deviceType == 'phone' ? 'rollers' : undefined,
                                            onContentReady: function (ez) {
                                                LV_NGA[1] = ez.component;
                                            }
                                            , onValueChanged: function (v) {
                                                var od = new Date(LV_NGA[0].option('value'));
                                                if (new Date(v.value).getTime() < od.getTime()) {
                                                    LV_NGA[0].option('value', v.value);//set den ngay bang tu ngay
                                                };
                                            }

                                        }
                                        , label: {
                                            text: elUI.lan.js_011_25 || 'To date'
                                        }
                                    }
                                ],
                            }, {

                                title: elUI.lan.js_011_24 || 'Or apply Late / Early',
                                colCount: 2,


                                colCountByScreen: {
                                    xs: 2
                                },

                                tabTemplate: function (itemData, itemIndex, itemElement) {
                                    itemElement.addClass('d-flex').append("<span class='fa fa-check-circle tab_sel'></span>" + itemData.title);

                                },
                                items: [
                                    //{
                                    //    dataField: 'HireDate',
                                    //    editorType: 'dxDateBox',
                                    //    editorOptions: {
                                    //        value: null,
                                    //        width: '100%'
                                    //    }
                                    //    , label: {
                                    //        text: 'tu gio'
                                    //    }
                                    //}
                                    //,
                                    //{
                                    //    dataField: 'HireDate',
                                    //    editorType: 'dxDateBox',
                                    //    editorOptions: {
                                    //        value: null,
                                    //        width: '100%'
                                    //    }
                                    //    , label: {
                                    //        text: 'den ngio'
                                    //    }
                                    //}
                                    //,
                                    {
                                        cssClass: 'dog_rdio',
                                        dataField: 'tresom',
                                        editorType: 'dxRadioGroup',

                                        //colSpan: 2,
                                        editorOptions: {
                                            layout: "horizontal",
                                            valueExpr: 'id',
                                            displayExpr: 'text',
                                            value: fO && fO.tresom || 1,
                                            items: [
                                                { id: 1, text: _gLA(26) || 'Late' },
                                                { id: 2, text: _gLA(27) || 'Early' }]
                                        }
                                        , label: {
                                            text: '',
                                            visible: false
                                        }

                                        //editorType: 'dxSelectBox',
                                        //colSpan: 2,
                                        //editorOptions: {
                                        //    items: [
                                        //      'Xin vao tre',
                                        //      'Xin ve som'
                                        //    ],
                                        //    searchEnabled: true,
                                        //    value: '',
                                        //    label: {
                                        //        text: 'Chon loai tre som',
                                        //        visible: false
                                        //    },
                                        //},
                                        //label: {
                                        //    text: 'Chon loai tre som',
                                        //    visible:false
                                        //},
                                        //validationRules: [{
                                        //    type: 'required',
                                        //    message: 'Position is required',
                                        //}

                                        //]
                                    }
                                    ,
                                    dumeO
                                ],
                            }]

                        }]
                    }
                    ,
                    {
                        colSpan: 2,
                        dataField: 'notes',
                        label: {
                            text: _gLA(21) || 'Notes'
                        },
                        editorType: 'dxTextArea',
                        editorOptions: {
                            height: 50,
                            maxLength: 200
                        }
                    }
            ]
        }

        ,

        __ERR_BLOCK = ['<div class="col-12 col-sm-6 d-flex flex-column dx-validationsummary-item mb-3">' +
                                                        '<div class="dx-fieldset-header reg-step-no mb-0" style="font-weight: 100;"><span class="bl-no">1</span><span class="bl-txt"></span></div>' +
                                                    '</div>'
                    ,
                    //index[1] la nut luu tam
                    ,
                    '<div class="viewmode mx-auto"></div>',




        ]

        ,

        __CTY = function (elUI, pigIE) {
            return (__ERR_BLOCK[1] = '<span class="font-italic text-right mr-2" style="flex:1">' + (elUI.lan.js_011_7 || 'Draft current registration by clicking Save button') + '</span>' +
                                                '<button mnu="sav_tmp" type="button" class="btn btn-secondary btn-sm ml-auto"><i class="ti-save mr-1"></i>' + aLAN.js_007_29 + '</button>'

                            ,

                        $('<div class="d-none valid_msg  reg_action row">' +


                            //'<div class="col-12 col-sm-6 d-flex flex-column dx-validationsummary-item  mb-3">' +
                            //    '<div class=" dx-fieldset-header reg-step-no mb-0" style="font-weight: 100;"><span class="bl-no">3</span><span class=" bl-txt">Thông Tin Đăng Ký</span></div>' +
                            //    '<div class="mr-auto ml-5 dx-validationsummary-item-content">Email is required</div>' +
                            //'</div>' +

                            '<div class="col-12 mx-auto mt-3 text-center" ' + (pigIE.length > 0 ? 'style=' + pigIE : '') + '>' +

                                    '<span class="font-italic">' + (elUI.lan.js_011_15 || 'Please complete the above errors and try again...') + '</span>' +

                            '</div>' +
                        '</div>' +

                        '<ul class="send_frm list-group reg_action">' +

                            '<li class="list-group-item"  style="max-width:300px;' + pigIE + 'margin:auto">' +

                                (elUI.downline != 2 ?
                                    __ERR_BLOCK[1]//nut luu tam

                                : (__ERR_BLOCK[1] = '', '')) +

                            '</li>' +

                            '<li class="list-group-item' + (elUI.downline != 2 ? ' mt-3' : '') + '">' +

                                '<div class="sendnotes w-100 m-auto" style="box-shadow:rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px;"></div>' +
                            '</li>' +

                            '<li class="list-group-item mx-auto mt-3 flex-nowrap" ' + (pigIE.length > 0 ? 'style=' + pigIE : '') + '>' +

                                    '<span class="font-italic text-right">' + (elUI.lan.js_011_10 || 'Input content then press button') + '</span>' +
                                    '<button mnu="send_reg" type="button" class="ml-2 btn btn-sm btn-"></button>' +

                            '</li>' +

                        '</ul>'

                ));
        }

        ,

        _kdog = 'lstmnu_' + glbK.regVEL()

        , __regEMP_LST = function () {
            return (lstmnu_ctxM.mnuINIT_CLICK).closest('.lstregemp').dxList('instance');
        }

        , lstmnu_ctxM = {
            _k: _kdog,//coi chung no khoi tao 2 lan.
            op: {

                hideOnOutsideClick: true
                ,
                position: {
                    my: "left top",
                    at: "left bottom",
                },
                onShowing: function (e) {
                    //debugger;

                    var mnu = lstmnu_ctxM.el,
                        movSEL = mnu.find('.selectAll'),
                        ck = lstmnu_ctxM.mnuINIT_CLICK.parent().find('.dx-list-select-all'),
                        nutDEL = function (xe) {
                            //
                            if (!xe) {
                                xe = ck.find('.dx-checkbox').data().dxCheckBox;
                            };
                            //nut delete all
                            mnu.find('.delALL').css('display', xe.option('value') === false ? 'none' : '');
                        };
                    //
                    if (ck.length == 0) {

                        ck = __regEMP_LST().element().find('.dx-list-select-all');

                        movSEL.append(ck);

                        ck = ck.find('.dx-checkbox').css('margin-left', '0px').data().dxCheckBox;
                        ck.on('valueChanged', function (e) {
                            nutDEL(e.component);
                        });

                        nutDEL(ck);

                    } else {
                        nutDEL();
                    };

                }
            }
            ,
            el: $('<div class="_k-' + _kdog + ' hedROW_CLK ctx_onlybtn">' +
                    '<div class="selectAll"></div>' +
                    '<div class="delALL">' +
                        '<button mnu="delALL" class="btn btn-sm btn-danger icon dx-icon-trash" style="padding: 2px 3px 2px 1px;" type="button"></button>' +
                        '<span class="pl-1 font-italic text-small text-danger">' + (aLAN.js_001_29 || 'Delete all selection') + '</span>' +
                    '</div>' +
                    //'<div>' +
                    //    '<span class="pl-1 font-italic text-small text-success">muc tieu dem nay.</span>' +
                    //    '<button  class="btn btn-sm btn-success ti-user p-1" type="button"></button>' +
                    //'</div>' +
                    //'<div>' +
                    //    '<button  class="btn btn-sm btn-secondary ti-search p-1" type="button"></button>' +
                    //    '<span class="pl-1 font-italic text-small">Chon lua dai dien cho bac nay.</span>' +
                    //'</div>' +

                    //'<div class="text-center">' +
                    //    '<hr class="hrx  m-2">' +
                    //    '<span class="pl-1 font-italic text-small">Chen dong len tren hoac xuong duoi.</span>' +
                    //    '<div>' +
                    //        '<button  class="btn btn-sm btn-secondary ti-shift-left p-1 rotated" type="button"></button>' +
                    //        '<button  class="btn btn-sm btn-secondary ti-shift-right p-1 rotated" type="button"></button>' +
                    //    '</div>' +
                    //'</div>' +

                    //'<div class="text-center">' +
                    //    '<hr class="hrx m-2">' +
                    //    '<span class="pl-1 font-italic text-small">Doi dong hien tai xuong duoi.</span>' +
                    //    '<div>' +
                    //        '<button  class="btn btn-sm btn-warning ti-arrow-left p-1 rotated" type="button"></button>' +
                    //        '<button  class="btn btn-sm btn-warning ti-arrow-right p-1 rotated" type="button"></button>' +
                    //    '</div>' +
                    //'</div>' +

                '</div>')
        }
        , lstmnu_ctxM_CLK = function (e) {
            //
            //console.log('dele click');
            devDlg.ctx[0].hide();
            //
            var btn = $(e.currentTarget);
            switch (btn.attr('mnu')) {
                case 'delALL': {

                    var regEMP_LST = __regEMP_LST(),

                    dels = regEMP_LST.option('selectedItems').map(function (it) {
                        return it.___;
                    }),

                    olDS = regEMP_LST.option('dataSource').filter(function (it) {
                        return dels.indexOf(it.___) == -1;
                    });
                    //
                    regEMP_LST._hoantat = function (e) {
                        regEMP_LST._hoantat = null;
                        srclocked(false);
                    };
                    //
                    setTimeout(function () {
                        regEMP_LST.option({ 'searchValue': '', 'dataSource': olDS });
                    }, 100);
                    //
                    break;
                }
                default: {
                    srclocked(false); //menu button start click
                    break;
                }
            };
        }
        , ___lstE_mnu = function (elUI, e) {

            devCTXmnu(e.currentTarget, lstmnu_ctxM, function () {
                //
                //luu giu lai de khi dispose thi se huy
                if (!elUI.ctxMNU_K[_kdog]) elUI.ctxMNU_K.push(_kdog);
                //
                //
                lstmnu_ctxM.mnuINIT_CLICK = $(e.currentTarget);
                var mnu = lstmnu_ctxM.el.on('click', '.btn', function (e) {

                    srclocked(true);
                    setTimeout(function () {
                        lstmnu_ctxM_CLK(e);
                    }, 10);

                });
            });

        };



        __columns.otTOOLB = function (luoi) {

            return [
                {
                    location: 'after',
                    widget: 'dxButton',
                    options: {
                        text: aLAN.js_007_25,//Add
                        icon: 'plus',
                        //disabled: true,
                        onClick: function () {
                            srclocked(true);
                            setTimeout(function () {
                                luoi.addRow();
                            }, 10);
                        },
                    }
                }
                ,
                {
                    location: 'after',
                    widget: 'dxButton',
                    options: {
                        text: aLAN.js_007_26,//Edit
                        icon: 'edit',
                        disabled: true,
                        onClick: function (e) {
                            //
                            srclocked(true);
                            setTimeout(function () {
                                var r = luoi.getRowIndexByKey(e.component.option('r'));
                                luoi.editRow(r);
                            }, 10);
                            //
                        },
                    }
                }

                , {
                    location: 'after',
                    widget: 'dxButton',
                    options: {
                        text: aLAN.js_007_27,//Remove
                        stylingMode: 'outlined',
                        icon: 'trash',
                        type: 'danger',
                        disabled: true,

                        onClick: function (e) {
                            //
                            var sel = luoi.getSelectedRowKeys(), dogL;
                            //
                            if (sel.length > 0) {
                                dogL = luoi.option('dataSource')._array;
                                devDlg(1, aLAN.js_001_25).show().done(function (rst) {
                                    if (rst == 1) {
                                        for (var ix = dogL.length - 1; ix > -1; ix--) {

                                            if (sel.indexOf(dogL[ix].aid) > -1) {

                                                dogL.splice(ix, 1);

                                            };
                                        };
                                        //
                                        luoi.refresh();
                                        //
                                    };
                                });
                            };
                        }
                    },
                },
            ]
        };

        __CTY.err_panel = function (pnl, _gLA, syncSEL, wha, byPass_Chk_LV) {
            //
            //wha[0]=req_frm.renWhat;
            //wha[1]=regEMP_LST;
            //wha[2]=luoi || form;
            //wha[3]=DROP_Z.getQueuedFiles().length
            //
            //
            var emptyE = false
                , er_BL
                , no = 0;//OK
            //
            pnl.find('>div:not(:last-child)').remove();
            //
            //
            if (wha[0] == 2) {//renWhat OT check editform show
                //
                er_BL = $(__ERR_BLOCK[0]);//reset
                //
                emptyE = !wha[2]//luoi
                        ._$element.parent().is(':visible');
                //
                if (emptyE === true) {

                    er_BL.find('.bl-txt').text(_gLA(11) || 'Regis Information').prev().text((no++, no));
                    er_BL.append('<div class="mr-auto ml-5 dx-validationsummary-item-content">' + (_gLA(33, 6) || "Registration not completed") + '</div>');

                } else {
                    //
                    emptyE = wha[2]//luoi
                        .option('dataSource')._array.length;
                    //
                    emptyE = emptyE == 0 || (syncSEL.lst_ == 2 && emptyE == wha[2]//luoi
                                                                            .option('selectedRowKeys').length);
                    //
                    if (emptyE === true) {
                        er_BL.find('.bl-txt').text(_gLA(11) || 'Regis Information').prev().text((no++, no));
                        er_BL.append('<div class="mr-auto ml-5 dx-validationsummary-item-content">' + (_gLA(33, 8) || "Empty overtime info") + '</div>');
                    };
                    //
                };
                //
                if (emptyE) er_BL.insertBefore(pnl.find('>div:last-child'));
                //
            } else if (byPass_Chk_LV == 0) {//buoc phai check
                //
                //
                er_BL = $(__ERR_BLOCK[0]);//reset
                //check reg lv rule
                //1. bd in pass
                //tan dung lai variable
                wha[2] = wha[2].option('formData');

                //1. bd in pass
                wha[0] = difDa(new Date(wha[2].todate).setHours(0, 0, 0, 0), new Date().setHours(0, 0, 0, 0));
                //
                if (wha[0] > 3) {//qua 3 ngay ko xin duoc
                    //
                    er_BL.find('.bl-txt').text(_gLA(11) || 'Regis Information').prev().text((no++, no));
                    er_BL.append('<div class="mr-auto ml-5 dx-validationsummary-item-content">' + (_gLA(33, 11) || "Regis date late over 03 days") + '</div>');
                    //
                    er_BL.insertBefore(pnl.find('>div:last-child'));
                    //
                    //
                    emptyE = true;

                } else if (wha[0] > 0 && wha[3] == 0) {//qua 1 ngay thi phai co tap tin dinh kem
                    //
                    er_BL.find('.bl-txt').text(_gLA(11) || 'Regis Information').prev().text((no++, no));
                    er_BL.append('<div class="mr-auto ml-5 dx-validationsummary-item-content">' + (_gLA(33, 9) || "Regis date in past") + '</div>');
                    //
                    er_BL.insertBefore(pnl.find('>div:last-child'));
                    //
                    //
                    //
                    er_BL = $(__ERR_BLOCK[0]);//reset
                    er_BL.find('.bl-txt').text(_gLA(12) || 'Attach Files').prev().text((no++, no));
                    er_BL.append('<div class="mr-auto ml-5 dx-validationsummary-item-content">' + (_gLA(33, 10) || "Attachment require") + '</div>');
                    //
                    er_BL.insertBefore(pnl.find('>div:last-child'));
                    //
                    emptyE = true;
                }
                //
            };
            //
            //
            if (wha[1]//regEMP_LST
                .option('dataSource').length == 0 ||

                    (syncSEL.lst_ == 2 && wha[1]._$element && wha[1].option('dataSource').length == wha[1].option('selectedItemKeys').length)

                ) {
                //
                er_BL = $(__ERR_BLOCK[0]);//reset
                //
                er_BL.insertBefore(pnl.find('>div:last-child'));
                er_BL.find('.bl-txt').text(_gLA(13) || 'Apply To Employees').prev().text((no++, no));
                er_BL.append('<div class="mr-auto ml-5 dx-validationsummary-item-content">' + (_gLA(33, 7) || "Empty valid employee") + '</div>');
                emptyE = true;

            };
            if (emptyE === true) pnl.removeClass('d-none');
            //
            return emptyE;
        };

        return {
            //products: products,
            col: {
                widget: 'dxDateBox',
                caption: "Ngay",
                dataField: 'EachDate',
                dataType: 'date',
                format: function (e) {
                    return new Intl.DateTimeFormat(apisvr.a$.selected_language, {//
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit'
                    }).format(e);
                },
                //cssClass:'small',
                width: 75,
                minWidth: 75,
                editorOptions: {
                    //pickerType:'rollers',// DevExpress.devices._realDevice.deviceType == 'phone'? 'rollers':'calendar',
                    //pickerType:'native',
                    //adaptivityEnabled: true,
                    //onFocusIn: function (e) {
                    //    e.element.find('.dx-texteditor-input').attr('type', 'datetime-local');
                    //}
                }
            }
            , columns: __columns

            , regisFRM: __regisFRM

            , err_block: __ERR_BLOCK

            , cty: __CTY

            , lstE_mnu: ___lstE_mnu

            , myselfSVG: '<svg  version="1.0" xmlns="http://www.w3.org/2000/svg" width="512.000000pt" height="512.000000pt" viewBox="0 0 512.000000 512.000000"><g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"><path  d="M2290 5099 c-247 -37 -394 -81 -596 -179 -500 -243 -845 -671 -954 -1185 -29 -140 -37 -369 -16 -495 31 -191 95 -367 206 -565 113 -201 136 -232 855 -1160 191 -247 399 -516 483 -625 115 -151 246 -320 260 -338 12 -16 15 -15 33 8 11 14 31 38 45 54 13 15 24 32 24 37 0 4 6 12 13 16 7 4 20 20 29 34 9 14 23 32 30 40 8 8 63 79 123 158 61 79 144 187 185 241 41 53 97 126 124 161 27 35 218 282 425 548 427 552 457 593 545 740 253 421 323 765 236 1164 -152 696 -753 1227 -1517 1342 -111 16 -435 19 -533 4z m570 -164 c126 -23 338 -93 456 -151 458 -224 777 -628 870 -1104 23 -117 23 -377 0 -479 -55 -246 -202 -534 -412 -807 -37 -49 -190 -246 -339 -439 -149 -192 -325 -420 -391 -505 -66 -85 -140 -182 -166 -215 -26 -33 -112 -144 -191 -248 l-145 -187 -29 37 c-17 21 -52 67 -79 103 -28 36 -144 187 -259 335 -114 149 -269 349 -343 445 -75 96 -165 213 -202 260 -415 532 -486 633 -589 837 -72 141 -103 224 -137 363 -29 114 -26 420 4 548 33 137 57 204 123 337 139 284 372 520 675 685 185 101 371 163 584 196 119 18 446 12 570 -11z"/><path d="M3218 1053 c-10 -11 -18 -34 -18 -51 0 -45 35 -68 117 -76 187 -19 497 -98 614 -157 117 -59 144 -102 92 -151 -102 -96 -423 -182 -868 -235 -218 -26 -972 -26 -1190 0 -443 52 -766 140 -867 235 -52 49 -26 93 87 150 111 55 365 124 544 147 91 12 125 66 77 121 l-23 28 -114 -17 c-146 -22 -361 -76 -464 -117 -191 -76 -275 -157 -275 -266 0 -201 353 -343 1040 -420 197 -21 764 -30 986 -15 781 55 1234 215 1234 436 0 167 -227 289 -696 375 -58 11 -141 23 -183 26 -67 6 -78 4 -93 -13z"/></g></svg>'

        };
    };


</script>
