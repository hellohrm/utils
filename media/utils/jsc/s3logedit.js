var s3logedit=function(){var t,e=6e4,o=60*e,n=[-2,15,10,10],i=$("body").hasClass("part_fullscreen"),a=null,r=function(t){var e=t%2,o=Math.floor(t/2);return e>0?(t+e)/2:o},s=function(t,e){var n=new Date(t).setHours(0,0,0,0),i=new Date(e).setHours(0,0,0,0);return parseInt((i-n)/(24*o),10)+1};function l(l,d,c,u){"use strict";var g,f,p=-1,h=50,m=[],v=40,_="-20",y=function(t){var n=new Date(t||m[2].getTime()),i=new Date(new Date(n).setHours(0,0,0,0)).getTime(),a=Math.floor((n.getTime()-i)/e),r=m[0].left+m[0].width/2;return[m[1].left+a-r,a,i/o]},w=function(i){function c(){go.Link.call(this),this.isLayoutPositioned=!1,this.isTreeLink=!1,this.routing=go.Link.Orthogonal,this._direction=0,this._extension=30,this._inset=10,this._gap=10}go.Diagram.inherit(c,go.Link),c.prototype.cloneProtected=function(t){go.Link.prototype.cloneProtected.call(this,t),t._direction=this._direction,t._extension=this._extension,t._inset=this._inset,t._gap=this._gap},Object.defineProperty(c.prototype,"direction",{get:function(){return this._direction},set:function(t){if(!isNaN(t)&&0!==t&&90!==t&&180!==t&&270!==t)throw new Error("DimensioningLink: invalid new direction: "+t);this._direction=t}}),Object.defineProperty(c.prototype,"extension",{get:function(){return this._extension},set:function(t){this._extension=t}}),Object.defineProperty(c.prototype,"inset",{get:function(){return this._inset},set:function(t){if(!(t>=0))throw new Error("DimensioningLink: invalid new inset: "+t);this._inset=t}}),Object.defineProperty(c.prototype,"gap",{get:function(){return this._gap},set:function(t){if(!(t>=0))throw new Error("DimensioningLink: invalid new gap: "+t);this._gap=t}}),c.prototype.computePoints=function(){var t=this.fromNode;if(!t)return!1;var e=this.fromPort,o=this.computeSpot(!0),n=this.toNode;if(!n)return!1;var i=this.toPort,a=this.computeSpot(!1),r=this.getLinkPoint(t,e,o,!0,!0,n,i);if(!r.isReal())return!1;var s=this.getLinkPoint(n,i,a,!1,!0,t,e);if(!s.isReal())return!1;this.clearPoints();var l=this.direction;if(isNaN(l)){l=r.directionPoint(s);var d=new go.Point(this.extension,0);d.rotate(l+90);var c=new go.Point(this.extension-this.inset,0);c.rotate(l+90);var u=new go.Point(this.gap,0);u.rotate(l+90),this.addPointAt(r.x+u.x,r.y+u.y),this.addPointAt(r.x+d.x,r.y+d.y),this.addPointAt(r.x+c.x,r.y+c.y),this.addPointAt(s.x+c.x,s.y+c.y),this.addPointAt(s.x+d.x,s.y+d.y),this.addPointAt(s.x+u.x,s.y+u.y)}else{this.extension;var g=0,f=0,p=0,h=0;0===l||180===l?(0===l?(f=(g=Math.min(r.y,s.y)-this.extension)+this.inset,p=r.y-this.gap,h=s.y-this.gap):(f=(g=Math.max(r.y,s.y)+this.extension)-this.inset,p=r.y+this.gap,h=s.y+this.gap),this.addPointAt(r.x,p),this.addPointAt(r.x+.01,g),this.addPointAt(r.x,f),this.addPointAt(s.x,f),this.addPointAt(s.x-.01,g),this.addPointAt(s.x,h)):90!==l&&270!==l||(90===l?(f=(g=Math.max(r.x,s.x)+this.extension)-this.inset,p=r.x+this.gap,h=s.x+this.gap):(f=(g=Math.min(r.x,s.x)-this.extension)+this.inset,p=r.x-this.gap,h=s.x-this.gap),this.addPointAt(p,r.y),this.addPointAt(g,r.y+.01),this.addPointAt(f,r.y),this.addPointAt(f,s.y),this.addPointAt(g,s.y-.01),this.addPointAt(h,s.y))}return this.updateTargetBindings(),!0};var u=go.GraphObject.make,f=(new Date(2016,4,17,0,0,0,0),1440);g=u(go.Diagram,i,{fixedBounds:new go.Rect(m[2]&&y()[0]||0,0-v+100,m[1].width-2,m[1].height-2),"animationManager.isEnabled":!1,"contextMenuTool.defaultTouchContextMenu":null,"toolManager.mouseWheelBehavior":go.ToolManager.WheelNone,padding:0,contentAlignment:go.Spot.TopLeft,initialDocumentSpot:go.Spot.TopLeft,initialViewportSpot:go.Spot.TopLeft,PartResized:function(t){t.subject},SelectionMoved:function(t){},ChangingSelection:function(t){}});var w=function(t,e,o,n){!function(t,e,o,n){t.elements.each((function(i){var a=function(e){if(e.name&&k[e.name]&&k[e.name][o]){var i=k[e.name][o][cS$.c0lor](t.data,n);e.fill&&(e.fill=i),e.stroke&&(e.stroke=i)}};i instanceof go.Panel?i.elements.each((function(n){a(n),e&&"symSEL"==n.name&&(0==t.part.data.sta&&(n.text="sel"==o?"":""),n.font=("sel"==o?"24":"14")+"px FontAwesome")})):a(i)}))}(t,e,o,n)},k={logBODY:{nor:{dark:function(t,e){return 1==t.typ?1==t.sta?"fuchsia":"blue":0==t.sta?"gray":"#000"},light:function(t,e){return 1==t.typ?1==t.sta?"fuchsia":"blue":0==t.sta?"#EC7063":"#4A235A"}},sel:{dark:function(t,e){return 1==t.typ?"clkn"==e&&1==t.typ?1==t.sta?"fuchsia":"blue":"#00ff2b":0==t.sta?"gray":"#000"},light:function(t,e){return 1==t.typ?"clkn"==e&&1==t.typ?1==t.sta?"fuchsia":"blue":"#00ff2b":(t.sta,"red")}},dis:{},hov:{},acti:{}},logHOUR:{nor:{dark:function(t){return t.typ,"#fff"},light:function(t){return t.typ,"#000"}},sel:{dark:function(t){return t.typ,"#00ff2b"},light:function(t){return t.typ,"#00ff2b"}},dis:{},hov:{},acti:{}},symSEL:{nor:{dark:function(t){return t.typ,"cyan"},light:function(t){return t.typ,"cyan"}},sel:{dark:function(t){return t.typ,"#00ff2b"},light:function(t){return t.typ,"#00ff2b"}},dis:{},hov:{},acti:{}}},x=function(t,e){w(e,!0,"sel","me")},b=function(t,e){w(e,!0,T(e),"ml")},T=function(t){return H.contains(t)?"sel":"nor"},S=function(t,n){var i,a=0,r=function(){a=new Date(e*(n.x-f)+t.nga*o),t.lg=a,g.model.setDataProperty(t,"text",DevExpress.localization.date.format(a,"HH : mm")),clearTimeout(p),0!=t.sta&&(p=setTimeout((function(){clearTimeout(p),p=-1,d[0].trigger("DIAG",["3","U",[$.extend(!0,{},t),a]]),console.log("dragMOV_CUS_LOG_HWND")}),300))};if(0!=t.sta){var s,l,c,u=t._nodeP;u&&("string"==typeof u&&(t._nodeP=g.findNodeForKey(u),u=t._nodeP),u&&((s=u.data.pt)[s[2]==t.idx?0:(a=1,1)]=n.x,i=s[1]-s[0],a=i<0?0==a?s[1]:n.x:0==a?n.x:s[0],l=a,(c=u.location.copy()).x=l,u.location=c,u.width=Math.abs(i),u.data._exa[0]=i<0?"-":"",r()))}else r()},D=function(t){return u(go.Node,"Spot",{layerName:1==t?"APPEL":"ORIGL",movable:1==t,copyable:!1,avoidable:!0,minLocation:new go.Point(-1/0,NaN),maxLocation:new go.Point(1/0,NaN),selectionAdorned:!1,locationSpot:go.Spot.Top,dragComputation:function(t,e,o){var n=Math.floor(e.x),i=G[3];return n<i.x?n=i.x:n>i.x+i.width&&(n=i.x+i.width),e.x=n,S(t.data,e),new go.Point(e.x,e.y)},mouseEnter:x,mouseLeave:b},u(go.Shape,{name:"logBODY",alignment:go.Spot.Bottom,cursor:1==t?"w-resize":"default",strokeWidth:.3,portId:"A",fromSpot:new go.Spot(0,1,0,-25),toSpot:new go.Spot(1,1,0,-25),fromEndSegmentLength:50,toEndSegmentLength:50,click:function(t,e){var o=e.part.data;G[1].data.to!=o.key&&d[0].trigger("DIAG",["1",o])}},new go.Binding("geometryString","",(function(t){return 1==t.typ?"F M5 40 L0 50 L0 60 L10 60 L10 50 L5 40 L5 10 L0 15 L5 0 L10 15 L5 10z":"F M5 50 L0 50 L0 60 L10 60 L10 50 L5 50 L5 10 L0 15 L5 0 L10 15 L5 10z"})),new go.Binding("stroke","stroke",(function(t,e){return k.logBODY[T(e.part)][cS$.c0lor](e.part.data,"bi")}))),u(go.TextBlock,{cursor:"pointer",alignment:go.Spot.Top,alignmentFocus:new go.Spot(0,0,0,10),margin:0,stroke:"cyan",font:"10px FontAwesome",editable:!1,isMultiline:!1,text:"",click:function(t,e){alert("here")}}),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("fill","isSelected",(function(t,e){t?(H.each((function(t){w(t,!0,"nor","selr")})),(H=new go.Set).add(e)):H.remove(e),w(e,!0,t?"sel":"nor","sels")})).ofObject(),u(go.Panel,"Table",{name:"timTB",alignment:go.Spot.Bottom,alignmentFocus:go.Spot.Top,defaultSeparatorPadding:0},u(go.TextBlock,{name:"symSEL",desiredSize:new go.Size(20,25),row:0,column:0,alignment:new go.Spot(.5,.5),margin:0,textAlign:"center",verticalAlignment:go.Spot.Center,cursor:"pointer",font:"14px FontAwesome",editable:!1,isMultiline:!1,click:C.click_tickICO,portId:"R00",fromSpot:go.Spot.Bottom,toSpot:new go.Spot(.5,0,0,-10)},new go.Binding("text","sta",(function(t){if(1==t)return""})),new go.Binding("stroke","stroke",(function(t,e){return k.symSEL[T(e.part)][cS$.c0lor](e.part.data,"bi")}))),u(go.TextBlock,{name:"logHOUR",alignment:new go.Spot(.5,0,1,0),row:1,column:0,margin:0,font:'100 9pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif',angle:270},new go.Binding("text"),new go.Binding("stroke","stroke",(function(t,e){return k.logHOUR[T(e.part)][cS$.c0lor](e.part.data,"bi")})))))},C={0:function(t,e,o,n){var i,a=t[0],r=a%2>0?[a,a+1]:[a-1,a],s=a==r[0]?r[1]:r[0];if(g.findNodesByExample({idx:new RegExp(s,"i")}).each((function(t){1==t.data.sta&&(i=t)})),i&&o){var l,d=$.extend(!0,[],o.data.pt),c=0;a==r[0]?(d[0]=t[1],d[1]=i.location.x,d[2]=a,d[3]=s):(d[1]=t[1],d[0]=i.location.x,d[2]=s,d[3]=a),l=(c=d[1]-d[0])<0?0==a?d[0]:d[1]:d[0],o.data._exa[0]=c<0?"-":"",c=Math.abs(c),o.data=$.extend(o.data,{pt:d,width:c}),o.visible=!0,o.width=c;var u=o.location.copy();u.x=l,o.location=u}return!0},1:function(t,e,o,n,i){return o&&(o.visible=!1),!(i||C.clear_clg(e,n))},clear_clg:function(t,e){var o=!1,n=g.findPartsAt(e,!1);return n.count>1&&n.each((function(e,n){1==e.data.typ&&(o=!0,t.removeNodeData(e.data))})),o},click_tickICO:function(n,i,s){var c,u,p,h,m,v=i.part,_=v.data,y=_.sta,k=_.key,x=_.idx,b="P"+r(x)+"|fio"+x+"|noi"+x+"|clg"+x,T=[],S=0,D=G[1].toNode,P=(u=l.step3_utils.editPO.atTD,p=u[0],h=Number(u[1].split("fio")[1]),function(t){srclocked(!0),setTimeout((function(){d[0].trigger("DIAG",t)}),10)});D&&D.data.idx==x||x==h?(0===y&&(S=1),function(){if(n){var t=v.location.x,i=new Date(e*(t-f)+_.nga*o),a=["2",1===S?"U":"R"];if(1===S)if(1==_.typ)a[2]=adapV(i,"1"),a[2].push(i);else{if(_.idx>8)return;a[2]=[i,i]}else 1==_.typ?(a[1]="U",a[2]=[null,null],k=""):(a[2]=adapV(i,"0"),a[2].push(i));P(a)}}(),g.findNodesByExample({key:new RegExp(b,"i")}).each((function(t){"nodehieu"==t.data.category?c=t:t.data.key!=v.data.key&&T.push(t)})),g.model.commit((function(t){T.forEach((function(e,o){t.setDataProperty(e.data,"sta",0),w(e,!0,"nor","ml")})),c||(c=C._addProgresP(t,x,v.location.x,v));var e=!1,o=!1;s&&"function"==typeof s&&(e=!0,o=!0),C[y.toString()]([x,v.location.x],t,c,v.location,e)&&(t.setDataProperty(_,"sta",S),0==S?i.text="":D&&D.data&&1==D.data.typ&&D.key!==v.key&&C.clear_clg(t,D.location),w(v,!0,"sel","clkn")),o?s(t):U([k])}),"click_tickICO")):x<=2*t[1]?(m="fio"+x,srclocked(!0),setTimeout((function(){var t=l.step3_rst_grid,e=t.getCellElement(p,m);a=function(){a=null,srclocked(!1)},t.focus(e)}),10)):function(){C._ddCusLog(_.lg,1);var t=["2","U"];t[2]=adapV(_.lg,"1"),t[2].push(_.lg),P(t)}()},_addProgresP:function(t,e,o,n){var i=[o,o,e,e],a="P"+l.commonFn.lgIdx_2_IOidx(e),r=C._nodeP(a,0,i);return t.addNodeData(r),n._nodeP=g.findNodeForData(r),n._nodeP},_ddCusLog:function(t,e){var o,n,i=[],a=l.step3_utils.editPO.atTD,d=Number(a[1].split("fio")[1]),c="clg"+d,u=new RegExp("P"+r(d)+"|fio"+d+"|noi"+d+"|"+c,"i");g.findNodesByExample({key:u}).each((function(t){"nodehieu"==t.data.category?n=t:t.data.key==c?o=t:i.push(t)})),g.model.commit((function(r){if(i.forEach((function(t,e){r.setDataProperty(t.data,"sta",0),w(t,!0,"nor","ml")})),"1"==e){var l,u=s(a[4].ngay,t),p=y(t),h=u*f+p[1];o?(l=o.data,r.setDataProperty(l,"loc",h+" "+_),r.setDataProperty(l,"text",DevExpress.localization.date.format(t,"HH : mm")),r.setDataProperty(l,"sta",1),g.select(o)):(l=C._calcNOD(d,c,t,h,1,1,p[2]),r.addNodeData(l)),l.lg=t,n||(n=C._addProgresP(r,d,h,l)),C[0]([d,h],r,n),l._nodeP=n,U([c])}}),"CUSTOM_LOG")},_calcNOD:function(t,e,o,n,i,a,r){return{key:e,loc:n+" "+_,color:0==i?"gray":"cyan",text:DevExpress.localization.date.format(o,"HH : mm"),lg:o,sta:a,typ:i,category:0==i?"ORGI_LOG":"",idx:t,nga:r}},_nodeP:function(t,e,o){return{key:t,text:"",color:"gray",loc:o[e>0?0:1]+" 30",width:Math.abs(e),category:"nodehieu",zOrder:0,visible:Math.abs(e)>0,pt:o,_exa:[e>0?"":"-"]}}};g.nodeTemplate=D(1),g.nodeTemplateMap.add("ORGI_LOG",D(0)),g.nodeTemplateMap.add("Center",u(go.Node,"Spot",{zOrder:100,layerName:"DURAT",selectable:!1,movable:!1},new go.Binding("location","loc",go.Point.parse),u(go.Shape,"Circle",{name:"SHAPE",fill:"#00ff2b",strokeWidth:0,portId:"R00",fromSpot:go.Spot.Bottom},new go.Binding("desiredSize","size",go.Size.parse).makeTwoWay(go.Size.stringify)))),g.nodeTemplateMap.add("nodehieu",u(go.Node,"Auto",{zOrder:99,layerName:"DURAT",fromSpot:go.Spot.Bottom,toSpot:new go.Spot(.99999,0,0,0),movable:!1,copyable:!1,avoidable:!0,minLocation:new go.Point(-1/0,NaN),maxLocation:new go.Point(1/0,NaN)},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("width","width").makeTwoWay(),new go.Binding("visible","visible").makeTwoWay(),u(go.Shape,{strokeWidth:0,fill:"lightgray",height:8},new go.Binding("fill","",(function(t,e){return"green"}))),u(go.TextBlock,{margin:0},new go.Binding("text","text")))),g.nodeTemplateMap.add("shiftinfo",u(go.Node,"Auto",new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),u(go.Shape,{fill:"transparent",stroke:"#17a2b8",strokeWidth:.2}),u(go.Panel,"Table",{defaultRowSeparatorStrokeWidth:.2,defaultRowSeparatorStroke:"#17a2b8",defaultColumnSeparatorStroke:"#17a2b8",defaultColumnSeparatorStrokeWidth:.2,defaultAlignment:go.Spot.Right},u(go.TextBlock,"Gia tri",{row:0,column:1,font:"bold 10pt sans-serif",margin:2,stroke:"lime",portId:"PC1",fromSpot:go.Spot.Top,toSpot:go.Spot.Top}),u(go.TextBlock,"DVT",{row:0,column:2,font:"bold 10pt sans-serif",margin:2,stroke:"lime",portId:"PC2",fromSpot:go.Spot.Top,toSpot:go.Spot.Top}),u(go.TextBlock,"(1) Tong thoi gian tinh bang Phut",{row:1,column:0,stroke:"gray",margin:2,font:'100 8pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'}),u(go.TextBlock,"1400",{row:1,column:1,margin:2,stroke:"lime"}),u(go.TextBlock,"(2) Quy doi sang gio Gio ((1)/60)",{row:2,column:0,stroke:"gray",margin:2,font:'100 8pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'}),u(go.TextBlock,"row 2 col 2",{row:2,column:2,margin:2,stroke:"lime",font:'100 8pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'}),u(go.TextBlock,"Doi sang ngay (/8)",{row:3,column:0,stroke:"gray",margin:2,font:'100 8pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'}),u(go.TextBlock,"row 3 col 1",{row:3,column:1,margin:2,stroke:"lime",font:'100 12pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'}),u(go.TextBlock,"row 3 col 2",{row:3,column:2,margin:2,stroke:"lime",font:'100 8pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'}),u(go.TextBlock,"Tong thoi gian duoc tinh sau khi lam tron",{row:4,column:0,stroke:"gray",margin:2,font:'100 8pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'})))),g.linkTemplate=u(go.Link,{routing:go.Link.Normal},u(go.Shape,{stroke:"gray",strokeWidth:2}),u(go.Shape,new go.Binding("fromArrow","fromArrow"),{scale:2,fill:"#D4B52C"}),u(go.Shape,new go.Binding("toArrow","toArrow"),{scale:2,fill:"#D4B52C"}),{click:function(t,e){var o=O(e);if(o){var n=document.getElementById("myArrowheadInfo");n&&(n.textContent=o)}},toolTip:u("ToolTip",u(go.TextBlock,{margin:4},new go.Binding("text","",O).ofObject()))}),g.linkTemplateMap.add("rootLNK",u(go.Link,{zOrder:100,layerName:"DURAT",curve:go.Link.Bezier,toShortLength:7},new go.Binding("fromEndSegmentLength"),new go.Binding("toEndSegmentLength"),new go.Binding("visible","visible").makeTwoWay(),u(go.Shape,{stroke:"#00ff2b",strokeWidth:1}),u(go.Shape,{toArrow:"Standard",stroke:"#00ff2b",strokeWidth:1,fill:"#00ff2b"}))),g.linkTemplateMap.add("detailLNK",u(go.Link,{zOrder:100,layerName:"DURAT",toShortLength:7,corner:10,routing:go.Link.Orthogonal},new go.Binding("fromEndSegmentLength"),new go.Binding("toEndSegmentLength"),u(go.Shape,{stroke:"#00ff2b",strokeWidth:.5,strokeDashArray:[3,5]}),u(go.Shape,{toArrow:"Standard",stroke:"#00ff2b",fill:"#00ff2b",segmentOffset:new go.Point(-5,0)}))),g.linkTemplateMap.add("NEAR_LOG",u(go.Link,{zOrder:101,layerName:"DURAT",curve:go.Link.Bezier,toShortLength:7},u(go.Shape,{strokeWidth:1,stroke:"hotpink",strokeDashArray:[3,5]}),u(go.Shape,{toArrow:"standard",stroke:"hotpink",fill:"hotpink"}),u(go.Panel,"Auto",{segmentOffset:new go.Point(0,-10)},u(go.TextBlock,"transition",{textAlign:"center",font:"8pt helvetica, arial, sans-serif",stroke:"#d43f3a"},new go.Binding("text","text").makeTwoWay())))),g.linkTemplateMap.add("Dimensioning",u(c,{},new go.Binding("layerName","isHighlighted",(function(t){return t?"Foreground":""})).ofObject(),new go.Binding("group","group"),new go.Binding("fromSpot","fromSpot",go.Spot.parse),new go.Binding("toSpot","toSpot",go.Spot.parse),new go.Binding("direction"),new go.Binding("extension"),new go.Binding("inset"),u(go.Shape,{stroke:"gray",strokeWidth:.2},new go.Binding("stroke","color"),new go.Binding("strokeDashArray","strokeDashArray")),u(go.TextBlock,{segmentIndex:2,segmentFraction:.5,segmentOrientation:go.Link.OrientUpright,alignmentFocus:go.Spot.Bottom,stroke:"gray",font:'100 10pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'},new go.Binding("text","text",(function(t,e){return console.log("showDistance(b.part)"),function(t){var e=t.pointsCount;if(e<2)return"";var o=t.getPoint(0),n=t.getPoint(e-1),i=t.direction;if(isNaN(i))return Math.floor(Math.sqrt(o.distanceSquaredPoint(n)))+"";var a=i*Math.PI/180,r=t.fromPort.data._exa[0];return t._arrowDIRECTION=r,r+Math.floor(Math.abs(Math.cos(a)*(o.x-n.x))+Math.abs(Math.sin(a)*(o.y-n.y)))}(e.part)})).makeTwoWay(),new go.Binding("stroke","color")),u(go.Shape,{fromArrow:"BackwardOpenTriangle",segmentIndex:2,stroke:"gray"},new go.Binding("stroke","color",(function(t,e){e.visible="-"==e.part._arrowDIRECTION}))),u(go.Shape,{toArrow:"OpenTriangle",segmentIndex:-3,stroke:"gray"},new go.Binding("stroke","color",(function(t,e){e.visible="-"!=e.part._arrowDIRECTION})))));var P=go.Shape.getArrowheadGeometries().toKeySet().toArray();P.length%2==1&&P.push("");var L=new go.GraphLinksModel;function O(t){var e=t.part;e instanceof go.Adornment&&(e=e.adornedPart);var o="";if(e instanceof go.Link)o="toArrow: "+(n=e).data.toArrow+";\nfromArrow: "+n.data.fromArrow;else if(e instanceof go.Node){var n;o="toArrow: "+(n=e.linksConnected.first()).data.toArrow+";\nfromArrow: "+n.data.fromArrow}return o}L.linkToPortIdProperty="toPort",L.linkFromPortIdProperty="fromPort",L.linkLabelKeysProperty="labs",g.model=L;var A=u(go.Part,"Graduated",{layerName:"Grid",position:new go.Point(0,-30),graduatedTickUnit:60},u(go.Shape,{geometryString:"M0 0 H3600",stroke:"transparent"}),u(go.Shape,{geometryString:"M0 0 V700",interval:24,stroke:"red",strokeWidth:.3}),u(go.TextBlock,{font:"9pt sans-serif",stroke:"red",interval:24,alignmentFocus:new go.Spot(0,0,-2,-4),graduatedFunction:function(t){return"00:00 _LAN.js_gojs_2"}}));function E(t){t="#000";var e="#000";return"dark"==cS$.c0lor&&(t="#4d4d4d",e="#fff"),u(go.Part,"Graduated",{layerName:"Grid",position:new go.Point(0,0),graduatedTickUnit:30},u(go.Shape,{geometryString:"M0 30 H3600",stroke:t}),u(go.Shape,{name:"l1",geometryString:"M0 0 V765",stroke:t,strokeWidth:.2,strokeDashArray:[5,5]}),u(go.Shape,{name:"l2",geometryString:"M0 0 V765",stroke:t,strokeWidth:.2,interval:2}),u(go.TextBlock,{interval:2,font:'100 8pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif',stroke:e,segmentOffset:new go.Point(0,-15),graduatedFunction:function(t){return(t=t/60%24)<0&&(t+=24),0==Math.floor(t)?"":Math.floor(t).toString()+":00"}}))}var B=E("black"),N=u(go.Part,{pickable:!1,layerName:"Grid",visible:!0,position:new go.Point(0,0),isAnimated:!1,locationSpot:go.Spot.Top},u(go.Shape,{geometryString:"M0 5 V20",strokeWidth:2,stroke:"hotpink"})),M=function(){var t=g.viewportBounds;g.fixedBounds.position.x,g.fixedBounds.position.y,g.fixedBounds.position.x,g.fixedBounds.width,g.div.getElementsByTagName("canvas")[0];g.commit((function(e){var o=g.fixedBounds.position.x,n=g.fixedBounds.position.y,i=o+g.fixedBounds.width;g.scale;G[0]&&G[2](t),A.graduatedMin=0,A.graduatedMax=t.width+i,A.elt(0).width=t.width+i,B.graduatedMin=0,B.graduatedMax=t.width+i,B.elt(0).width=t.width+i}),null)};g.addDiagramListener("ViewportBoundsChanged",(function(t){setTimeout((function(t){M()}),200)})),g.add(B),g.add(A),g.add(N),g.toolManager.doMouseMove=function(){go.ToolManager.prototype.doMouseMove.call(this),V()},g.toolManager.linkingTool.doMouseMove=function(){go.LinkingTool.prototype.doMouseMove.call(this),V()},g.toolManager.draggingTool.doMouseMove=function(){go.DraggingTool.prototype.doMouseMove.call(this),V()};var I=null,R=null,H=new go.Set;function V(){var t=g.viewportBounds;t.isReal()&&g.commit((function(e){var o=e.lastInput.documentPoint;N.location=new go.Point(Math.max(o.x,t.x),5),N.scale=1/e.scale}),null)}g.toolManager.dragSelectingTool.delay=500,g.toolManager.dragSelectingTool.doMouseMove=function(t){go.DragSelectingTool.prototype.doMouseMove.call(this),this.diagram.currentCursor="crosshair",function(t,e){var o=t.diagram,n=I,i=R;if(null===o||null===n)return;var a=o.lastInput,r=o.findPartsIn(e,!0,!0,new go.Set),s=function(t,e){t.isRMVSEL=e,w(t,!0,e?"sel":"nor","dra")};a.control||a.meta?a.shift?(i.each((function(t){r.contains(t)||s(t,n.contains(t))})),r.each((function(t){s(t,!1),i.add(t)}))):(i.each((function(t){r.contains(t)||s(t,n.contains(t))})),r.each((function(t){s(t,!n.contains(t)),i.add(t)}))):a.shift?(i.each((function(t){r.contains(t)||s(t,n.contains(t))})),r.each((function(t){s(t,!0),i.add(t)}))):(i.each((function(t){r.contains(t)||s(t,!1)})),n.each((function(t){r.contains(t)||s(t,!1)})),r.each((function(t){s(t,!0),i.add(t)})))}(this,this.computeBoxBounds()),V()},g.toolManager.dragSelectingTool.doActivate=function(){go.DragSelectingTool.prototype.doActivate.call(this),this.diagram.currentCursor="",I=H.copy(),R=new go.Set,this.diagram.raiseDiagramEvent("ChangingSelection")},g.toolManager.dragSelectingTool.doDeactivate=function(){this.diagram.raiseDiagramEvent("ChangedSelection"),I.each((function(t){!1===t.isRMVSEL&&H.remove(t)})),R.each((function(t){H.add(t)})),I=null,R=null,go.DragSelectingTool.prototype.doDeactivate.call(this)},g.toolManager.dragSelectingTool.doCancel=function(){var t=I;null!==t&&(t.each((function(t){t.isSelected=!0})),R.each((function(e){t.contains(e)||(e.isSelected=!1)}))),go.DragSelectingTool.prototype.doCancel.call(this)};var W,F,G=[,,function(t){var e=new go.Point(t.x+(W[1]+50)*(1/g.scale),t.y+1/g.scale*35);return G[0]&&(G[0].location=e),e}],U=function(t){G[1].visible=""!=t[0],g.model.setDataProperty(G[1].data,"to",t[0]),G[2](g.viewportBounds)},z=function(t){g.commit((function(e){U(t)}),"___FOCUSED")},K=function(t){var e=parseFloat(t-n[2]),o=g.commandHandler.zoomFactor;g.scale=1*Math.pow(o,e)},j=g.findLayer("Foreground");return g.addLayerBefore(u(go.Layer,{name:"ORIGL"}),j),g.addLayerBefore(u(go.Layer,{name:"APPEL"}),j),g.addLayerBefore(u(go.Layer,{name:"DURAT"}),j),g.toolManager.standardMouseWheel=function(){this.diagram.lastInput.control||go.ToolManager.prototype.standardMouseWheel.call(this)},g.doFocus=function(){var t=$(i).parent(),e=t.scrollTop();go.Diagram.prototype.doFocus.call(this),t[0].scrollTop=e},K(n[3]),M(),{attLogNode:function(t,n,i){H=new go.Set;var a=l.step3_utils.editPO.atTD,r=a[4],d=[],c=1e5,u=0,p=[],_=Number(a[1].split("fio")[1]),w=[],k=function(){for(var t=[],e=1;e<=8;e++)r.hasOwnProperty("fio"+e)&&r["fio"+e]&&t.push(r["fio"+e].getTime());return t}(),x=[""],b=[],T=function(t,e,n,i,a){var l=function(t){var e=s(r.ngay,t),o=y(t),n=e*f+o[1];return n<c&&(c=n),n>u&&(u=n),[n,o]}(n),g=l[0],p=[g,t,a],h=C._calcNOD(t,e,n,g,i,a,r.ngay.getTime()/o);if(1==i&&p.push(h),w.indexOf(g)>-1){if(0==i)return null}else if(0==i&&w.push(g),-1==e.indexOf("clg")){var m=b[t]||[];m.push({iot:e,cx:g,idx:t,lg:n}),b[t]=m}return d.push(h),p};if(a[0]==F)G[2](g.viewportBounds);else{G[0]=null,G[1]=null,r.freL&&function(){for(var t=0;t<r.freL.length;t++){var e,o,n,i=2==r.freL[t].length?0:2;r.freL[t][i]&&(e=9+t,0==i?(o="fre_"+e,n="noi"+e.toString()):(o="del_"+e,n="del_noi"+e.toString()),T(e,o,r.freL[t][i],0,0),r.freL[t][i+1]&&(r.freL[t][i+1]||[]).forEach((function(t,o){T(e,n+"_"+o.toString(),t,0,0)})))}}(),function(){for(var t=1;t<=8;t++){var o="fio"+t,i=t<=2*n[1]?1:0,a=!1,s=function(e,o){a=!0;var i=-1;return(r["noi"+t]||[]).forEach((function(a,r){var s,l=0;e===a.getTime()&&(i=r,l=t<=2*n[1]?o:0),(s=T(t,"noi"+t.toString()+"_"+r.toString(),a,0,l))&&1==l&&p.push(s)})),i},l=function(){var n=r.cusL&&JSON.parse(r.cusL),a=n&&n[0][t],l=function(n,i){if(n&&"HIE"!==n){var a=new Date(n*e+r.ngay.getTime());-1==k.indexOf(a.getTime())&&T(t,o,a,0,i)}},d=function(e,i){if(n[0][t]!=n[1][t]){var r=s(a[0].getTime(),i);if(r>-1)return e&&l(n[1][t],i),o="noi"+t.toString()+"_"+r.toString(),"log_from_noise"}};if(a){if("HIE"===a)return l(n[1][t],0),o="","origin_log";if(a=new Date(a*e+r.ngay.getTime()),(a=rdapV(a))[1]>4)return l(n[1][t],0),"1"==a[2]?(o="clg"+t,a[0]):"0"==a[2]?d(!0,0)||(i=0,"origin_log"):"origin_log";if(4==a[1]&&n[1][t])return d(!0,1)}}()||r[o];if(l){if(l&&"origin_log"!==l&&"log_from_noise"!==l){var d=o.indexOf("clg")>-1?1:0,c=void 0;(0==d||1==d&&1==i)&&(c=T(t,o,l,d,i)),c&&p.push(c)}a||s(0)}r.hasOwnProperty("fio"+t)&&(x[t]=o)}}();for(var S=0;S<p.length;S++){var D=0,P=l.commonFn.lgIdx_2_IOidx(p[S][1]),O=function(t){t&&(t._nodeP="P"+P)},A=[p[S][0],p[S][0],p[S][1],p[S][1]];O(p[S][3]),S+1<p.length&&P==l.commonFn.lgIdx_2_IOidx(p[S+1][1])&&(O(p[S+1][3]),A[1]=p[S+1][0],A[3]=p[S+1][1],1==p[S][2]&&1==p[S+1][2]&&(D=A[1]-A[0]),S++),d.push(C._nodeP("P"+P,D,A)),P==n[1]&&(S=p.length)}d.push({category:"Center",key:"rootEDT",loc:"0 20",color:"lightblue",size:"8 8"});var E,B=0-v,N=parseFloat(m[1].width-2),I=parseFloat(m[1].height-2);u-c<N&&(E=c-(2*N-(u-c))/2);var R,$,V=r.mmT,U=r.ngay.getTime(),z="shiftparam";E=(V[0]<0?0:f)+y(new Date(U+6e4*V[0]))[1],N=(V[1]<0?0:f)+y(new Date(U+6e4*V[1]))[1],G[3]=new go.Rect(E,B-150,Math.max(1,N),Math.max(1,2*I)),$=!(R=g.fixedBounds.toString()!=G[3].toString())&&i&&!0===i.keepSUM_POS&&($=g.findNodeForKey(z))?go.Point.stringify($.location):E+N/2+" 200",d.push({key:z,category:"shiftinfo",group:"TIMEMAP",SI:"00:00",SO:"00:00",loc:$}),d.push({key:"-41",category:"Center",size:"5 5"}),d.push({key:"-42",category:"Center",size:"5 5"}),L.nodeDataArray=d;var K=[{from:"P1",to:"P1",category:"Dimensioning",labs:["-41"],fromSpot:"TopLeft",toSpot:"TopRight",extension:h,strokeDashArray:[5,5],direction:180,color:"gray",text:"0"},{from:"P2",to:"P2",category:"Dimensioning",labs:["-42"],fromSpot:"TopLeft",toSpot:"TopRight",extension:h,strokeDashArray:[5,5],direction:180,color:"gray",text:"0"}];b.forEach((function(t,e){if(t.length>1){var o=t.sort((function(t,e){return t.cx-e.cx})),n=o[0].iot,i=o[o.length-1].iot,a="Noise logs "+(e%2==0?"OUT":"IN");K.push({from:n,fromPort:"A",to:i,toPort:"A",text:a,category:"NEAR_LOG"})}})),K.push({from:"rootEDT",fromPort:"R00",to:x[_],toPort:"R00",category:"rootLNK",zOrder:1,fromEndSegmentLength:20,toEndSegmentLength:30,visible:!1}),K.push({from:"-41",fromPort:"R00",to:"shiftparam",toPort:"PC1",category:"detailLNK",toEndSegmentLength:10}),K.push({from:"-42",fromPort:"R00",to:"shiftparam",toPort:"PC2",category:"detailLNK",toEndSegmentLength:20}),L.linkDataArray=K,G[0]=g.findNodeForKey("rootEDT"),G[1]=G[0].findLinksConnected().first(),function(t,e,o,n){if(n){g.startTransaction("changeFixedBounds"),g.fixedBounds=G[3],g.commitTransaction("changeFixedBounds");var i=e-(m[1].width-(o-e))/2;g.position=new go.Point(i,t)}else setTimeout(M,200);setTimeout((function(){G[1]&&(G[1].visible=!0)}),200)}(B,c,u,R)}t[3]=a[0],t[2]=a[3],W=t,t[2],F=t[3]},addCusLog:C._ddCusLog,alterTheme:function(){var t="#000",e="#000";"dark"==cS$.c0lor&&(t="#4d4d4d",e="#fff"),B.elements.each((function(o){o instanceof go.TextBlock?o.stroke=e:o.stroke=t})),g.nodes.each((function(t){g.model.raiseDataChanged(t.data,"")})),g.links.each((function(t){g.model.raiseDataChanged(t.data,"")})),M(),srclocked(!1)},gridline:function(t){var e=function(e,o){var n=B.findObject(e);n.geometryString="M0 0 V"+(1==t?"765":"10"),n.strokeWidth=o};e("l1",0==t?1:.2),e("l2",0==t?1.5:.2)},doZoom:K,logFOCUSED:function(t){var e=t[1],o=[""];if(e){var n=s(t[2],e),i=y(e),a=new go.Point(n*f+i[1],Number(_));g.findPartsAt(a,!1).each((function(t){t instanceof go.Node&&t.location.x==a.x&&(o[0]=t.data.key)}))}z(o)},trigCLK_tickICO:function(t){var e=G[1].toNode;if(e){H.remove(e);var o=e.findObject("symSEL"),n=function(t){t.removeNodeData(e.data),z([""])};"U"==t&&(n=null),o&&C.click_tickICO(null,o,n)}},showMagnifier:function(){var t=g.findNodeForKey(0);g.remove(t)},testCommit:function(){g.remove(B),B=E("#4d4d4d"),g.add(B),M()},reset:function(){W=null,-1,F=-1}}};this.editoR=function(o,r){t=JSON.parse(JSON.stringify(o));var s,c,u,p,h,v="desktop"!==DevExpress.devices._currentDevice.deviceType,_=DevExpress.devices._currentOrientation,y={},k=[200,null,-1,-1,300],x='<div class="edit-time-diag-tbar nutlenh-diag" style="right:10px"><div class="btn-group mr-2"><button class="btn btn-secondary btn-sm reload_diag"><i class="ti-reload"></i></button><button class="btn btn-success btn-sm"><i class="ti-save"></i></button></div><div class="btn-group mr-2"><button class="btn btn-danger btn-sm"><i class="fa fa-eraser"></i></button></div><div class="btn-group non-float"><div class="btn-group mr-3 closepanel"><button act="hidediag" class="btn btn-danger btn-sm" style="padding: 0px 3px;"><i class="ti-close"></i></button></div><div class="btn-group floatwindow"><button act="floatdiag" class="btn btn-secondary btn-sm" style="padding: 0px 3px"><i class="ti-new-window"></i></button></div></div></div><div class="edit-time-diag-tbar keypad" style="width:100px;left:10px"><div class="btn-group zoomctrl mr-4" style="display:'+(v?"none":"")+'"><button act="z-" class="btn btn-outline-danger btn-sm"><i class="ti-minus"></i></button><div class="d-flex mr-1 ml-1 position-relative"><input class="levelSlider  align-self-center" type="range" min="'+n[0]+'" max="'+n[1]+'" value="'+n[3]+'"  style="padding: 0px 0px 0px 0px" /><div class="range-value"><span>100%</span></div></div><button act="z+" class="btn btn-outline-success btn-sm"><i class="ti-plus"></i></button></div><div class="navikey" style="display:'+(v?"":"none")+'"><div class="btn-group mr-2"><button class="btn btn-warning btn-sm invisible"><i  class="fa fa-long-arrow-left"></i></button><button act="keyU" class="btn btn-secondary btn-sm upkeypad" style="width:26px"><i class="fa fa-long-arrow-up"></i></button><button class="btn btn-secondary btn-sm invisible"></button></div><div class="btn-group mr-2" role="group" aria-label="Second group"><button act="keyL" class="btn btn-secondary btn-sm"><i  class="fa fa-long-arrow-left"></i></button><button act="keyD" class="btn btn-secondary btn-sm" style="width:26px"><i  class="fa fa-long-arrow-down"></i></button><button act="keyR" class="btn btn-secondary btn-sm"><i class="fa fa-long-arrow-right"></i></button></div></div></div>',b=$('<div><i class="dx-icon ti-direction btnOK okact"></i><i class="ti-help btnOK helpact" style="right:20px;color:#ffc107;font-size:smaller"></i><i class="dx-icon dx-icon-close  btnOK closeact" style="right:0px;color:#dc3545"></i><div class="text-small pl-1 pr-4 text-center font-italic dx-datagrid-headers text-nowrap" style="z-index:-1;border-bottom: none;padding:1px 0;min-height:19px">'+(v?"":"Press ESC to Close")+'</div><div class="edit-time"></div><div class="edit-log-diag" style="height:'+k[4]+'px"><div class="gotime"></div></div></div>'),T=["",""],S=[0,-1],D=-1,C=-1,P=r[0].getBoundingClientRect(),L=-1,O=!0,A=function(){u.trapValueChanged=setTimeout((function(){clearTimeout(u.trapValueChanged);var t=l.step3_rst_grid,e=l.step3_utils.editPO.atTD;B(t,e[0],e[3])}),10)},E=function(t,e,o){if(10!=u._valOK)return 1==u._valOK;var n=t.mmT,i=!0;if(n[0]||n[1]){var a=u._$element.data("dxValidator"),r=a._validationRules[0],s=t.ngay.getTime();n[0]&&(i=new Date(s+6e4*n[0])<=e),i&&n[1]&&(i=e<=new Date(s+6e4*n[1])),!i&&o&&(r.isValid=i,r.message="console.log('onValueChanged trigger');",a.validate())}return u._valOK=i?1:-1,i},B=function(t,e,o){l.step3_utils.ignoreFocusedCellChanging=function(){l.step3_utils.ignoreFocusedCellChanging=null};var n=t.getCellElement(e,o);return t.focus(n),n},N=function(t,e){var o=function(){var t=l.step3_utils.editPO.atTD;return B(l.step3_rst_grid,t[0],t[3])};if(null==t)return o();setTimeout((function(){var t=o();e&&"function"==typeof e&&e(t)}),t)},M=function(){O=!1,p.hide(),N(10)},I=null,R=function(t){console.log("scrollADJUST = function (ofs) {");var e=$("body,html");e.animate({scrollTop:e.scrollTop()+t},200)},H=function(t,e,o){var n=elTAB[0].getBoundingClientRect(),i=V(),a=i[0],r=o&&o.outerHeight()||i[1](t),s=e.top-(n.bottom+r+a);return s<0&&(R(s),!0)},V=function(){var t="0 -5".split(" ");return[10+Number(t[1]),function(t){return t.option("target").outerHeight()}]},W=function(t,e,o){!i&&t._EVTTYPE&&"dxpointerdown"!=t._EVTTYPE[0]&&(H(t,e)||(o=o||$(window).height(),e.top+60>o&&R(e.top+65-o)))},F=function(t,e){if(clearTimeout(D),D=-1,"down"==T[1]){var o=function(t,e){var o=l.step3_utils.editPO,n=o._$popupContent,a=n[0].getBoundingClientRect();if(e){var r,d=$(window).height(),c="",u=a.top+a.height+k[4],g=V(),f=g[0];if(u>d){if(i)r=g[1](o),a.top-r-f>d-(a.top+a.height)&&(c=-(k[4]+r+f)),s[(""==c?"remove":"add")+"Class"]("opposit-flip").css({top:c});else if(!v&&"dxpointerdown"!=o._EVTTYPE[0]&&o._EVTTYPE[1]>0){r=g[1](o);var p=a.top-r-f-elTAB[0].getBoundingClientRect().bottom;R(p>u-d?u-d:p)}}else i?s.removeClass("opposit-flip").css({top:""}):v||W(o,a,d);return[n,a]}return[n,a]}(0,e);if(!o)return;var n=o[0],a=o[1],r=P.width>k[0]&&P.width>800?800:P.width,d=k[1]||r/2-a.width/2,c=P.left+P.width,u=a.left-d,g=!(k[0]==r&&k[5]&&k[5][0]<=a.left&&a.left+a.width<=k[5][0]+r);g?u+r>c?d+=u+r-c:u>P.left?k[1]&&(g=k[0]!=r):d-=P.left-u:(d-=k[5][0]-u,s.css({left:-1*d})),k[0]==r&&k[1]==d||!g||(m[0]=n.find(".dx-texteditor-input")[0].getBoundingClientRect(),s.css({left:-1*d,width:r})),m[1]=s[0].getBoundingClientRect(),k[0]=r,k[1]=d,k[5]=[a.left-d,a.top]}},G=function(t,e){var o=l.step3_utils.editPO._$popupContent.find("div[class^='edit-log-diag']"),n=m[0],i=m[1];if(o.css("height",k[4]),t._$popupContent.append(o),o.removeClass("edit-log-diag").addClass("edit-log-diag-float"),e){var a=i.left-i.width;a<0&&(a=0),a+" "+parseInt(n.top+n.height),l.floatDIAG.option("position.offset",{x:a,y:parseInt(n.top+n.height)})}else;t.show()},U=function(){var t=g.div,e=l.floatDIAG._$content.find(".dx-popup-content");t.style.height=e.height()-2+"px",t.style.width=e.width()-2+"px"},z=function(){S[1]=1,U(),K()},K=function(t){if(0==l.step3_utils.editConfig.focusBack){var e=l.step3_utils.edit_time;if(e.focus(),t&&"dxdrag"==t.type){var o=e._$element.find(".dx-texteditor-input")[0],n=o.selectionStart<3?0:3;o.setSelectionRange(n,2)}}else N()},j=function(){if(l.floatDIAG)G(l.floatDIAG,!1);else{var t=r.parent(),e=m[1],o=$("<div/>").appendTo(t).dxPopup({width:e.width+2,height:e.height+36+2,container:app_container.closest("#app"),showTitle:!0,visible:!1,dragEnabled:!0,resizeEnabled:!0,shading:!1,closeOnOutsideClick:!1,showCloseButton:!0,onContentReady:function(t){var e=t.component._$popupContent;e.css({padding:0,margin:0}),e.prev().css({padding:"0 15px",height:"36px"}).addClass("edit-log-diag-float-header");var o=null,n=t.component._$content;n.hasClass("floatDIAG-hackkeydown")||(n.on("click",(function(t){J(0)})),n.find(".dx-toolbar").on("dxdrag.dxPopup",(function(t){clearTimeout(o),o=setTimeout((function(){K(t)}),200)})),function(t){t.off("scroll").on("scroll",(function(t){if(this.scrollTop>0){var e=l.step3_utils.editPO.fuckMN_Shown;1==e&&(l.step3_utils.editPO.fuckMN.fuckMN_CancelHiding=function(t){t.cancel=!0}),this.scrollTop=0,1==e&&setTimeout((function(){l.step3_utils.editPO.fuckMN.fuckMN_CancelHiding=null}),50)}}))}(n.find(".gotime")),n.find(".dx-closebutton").data("dxButton").option("onClick",(function(t){var e;l.floatDIAG._onHiddenHwnd=function(t){l.floatDIAG._onHiddenHwnd=null,S[1]=0;var o=t.component._$popupContent.find("div[class^='edit-log-diag']");o.removeClass("edit-log-diag-float").addClass("edit-log-diag"),o.css({width:1e3,height:400}),l.step3_utils.editPO._$popupContent.append(o),F(0,!0),e&&"function"==typeof e&&e()},l.floatDIAG.hide()})),n.addClass("floatDIAG-hackkeydown"))},onShowing:function(t){t.component._tmpscrollPos=$(window).scrollTop()},onShown:function(t){$(window).scrollTop(t.component._tmpscrollPos),z()},onHiding:function(t){l.floatDIAG.$puInfo=[this.content().parent().css("transform"),this.option("width"),this.option("height")]},onHidden:function(t){var e=t.component._onHiddenHwnd;e&&"function"==typeof e&&e(t)},onResizeEnd:function(t){J(0),U()},position:{my:"top left",at:"top left",of:document}}).dxPopup("instance");l.floatDIAG=o,G(l.floatDIAG,!0)}},Y=-1,J=function(t){clearTimeout(Y),Y=setTimeout((function(){0==l.step3_utils.editConfig.focusBack?u.focus():N(t)}),void 0!==t?t:100)},q=function(t){if("chevronup"==t.option("icon")?(T=["In","down"],u.close()):T=["Out","up"],g)1===S[1]?(S[1]=2,l.floatDIAG.hide()):2===S[1]?!0!==l.floatDIAG._currentVisible?l.floatDIAG.show():z():s["fade"+T[0]]("fast",(function(){m[1]=this.getBoundingClientRect(),"down"==T[1]&&(F(0,!0),1===y.btnFloatDiag.need_RELOAD&&X())})),srclocked(!1);else{var e=$.Deferred(),o=$.Deferred();s=p._$popupContent.find(".edit-log-diag"),setTimeout((function(){$.when(e,o).then((function(t,e){m[1]=s[0].getBoundingClientRect(),Q(s.find(".gotime")[0]),srclocked(!1)})),s["fade"+T[0]]("fast",(function(){e.resolve()})),_gsC(srcpf$+"/media/vendor/GoJS/release/gojstrial.js","js",(function(){o.resolve()}),"gojs.js")}),20),F(0,!0)}t.option("icon","chevron"+T[1]),J()},Z=function(t,e){if(l.step3_utils.editPO){var o=l.step3_rst_grid,n=l.step3_utils.editPO.atTD;-1==[13,27].indexOf(t)&&setTimeout((function(){var e=o.getCellElement(n[0],n[3]);o.focus(),e.trigger($.Event("keydown",{which:t,code:t}))}),10)}},Q=function(e){(c=w(e)).attLogNode(k,t),i$Desk&&(l.s3editdiag_scroPerf=new PerfectScrollbar($(e).children("div")[0],{})),$(e).parent().append(x);var o=function(t,e){var o=100,i=t.nextSibling;t.value<=n[2]?o-=5*(n[2]-t.value):o+=5*(t.value-n[2]),i.innerHTML="<span>"+o+" %</span>";var a=Number(100*(t.value-t.min)/(t.max-t.min)),r=10-.2*a;i.style.left="calc("+a+"% + "+r+"px)",e&&c.doZoom(t.value)},i=function(t,e){var o=l.step3_rst_grid,n=l.step3_utils.editPO.atTD,i=o.getCellElement(n[0],n[3]);i.offset();o.focus(i),i.trigger($.Event("keydown",{which:e,code:e}))};(f=$(e).parent().find(".levelSlider")).on(11==GetIEVersion()?"change":"input",(function(){var t=this,e=f.closest(".btn-group").find('.btn[act^="z"]');t.value==t.min?($(e[0]).prop("disabled",!0),$(e[1]).removeAttr("disabled")):t.value==t.max?($(e[1]).prop("disabled",!0),$(e[0]).removeAttr("disabled")):($(e[0]).removeAttr("disabled"),$(e[1]).removeAttr("disabled")),o(t,!0)})),o(f[0],!1),$(e).off("click").on("click",(function(t){var e,o,n;(o=1===(e=u).fuckMN_Shown,n=1===e.fuckSZ_Shown,o&&e.fuckMN.hide(),n&&e.fuckMN.fuckSZ.hide(),[o,n])[0]||"dx-texteditor-input"==t.target.className||J(100)})).parent().find(".edit-time-diag-tbar .btn").off("click").on("click",(function(t){var e,n,a=$(t.currentTarget),r=!1;if(a.hasClass(".btn")||(a=a.closest(".btn")),e=a.closest(".btn-group"),a.hasClass("reload_diag"))srclocked(!0),setTimeout((function(){X(),u.focus(),srclocked(!1)}),20);else if(e.hasClass("zoomctrl")){var s=f[0],l=parseInt(f.val());if("z-"==apisvr.a$.trim(a.attr("act"))){if(l<=s.min)return;n="+",r=--l<=s.min}else{if(l>=s.max)return;n="-",r=++l>=s.max}r&&a.prop("disabled",!0),e.find('.btn[act="z'+n+'"]').removeAttr("disabled"),s.value=l,o(s,!0)}else{switch(apisvr.a$.trim(a.attr("act"))){case"floatdiag":j();break;case"hidediag":q(y.btnFloatDiag);break;case"keyL":i(0,37);break;case"keyU":i(0,38);break;case"keyR":i(0,39);break;case"keyD":i(0,40)}}}))},X=function(){c.reset(),c.attLogNode(k,t,{keepSUM_POS:!0}),y.btnFloatDiag.need_RELOAD=0},tt=[{name:"backVAL",location:"before",widget:"dxButton",options:{elementAttr:{class:"logeditundo"},icon:"undo",stylingMode:"text",onClick:function(t){u.close(),nt("U"),h._DEL_VAL=null},onContentReady:function(t){h=t.component}}},{name:"delval",location:"before",widget:"dxButton",options:{elementAttr:{class:"logremove"},icon:"trash",stylingMode:"text",onClick:function(t){srclocked(!0);var e=function(t){if(0!=t.re)if(1==t.sel)ft[1](t);else{var e=p.atTD,o=e[4][e[1]];h._DEL_VAL=[o,o,0],o&&o.getFullYear().toString().length>4?(u.hwChanged=function(t){u.hwChanged=null,nt("R")},h._DEL_VAL[1]=u.option("value"),h._DEL_VAL[2]=1,u.reset()):nt("R"),srclocked(!1)}};setTimeout((function(){gt("del",e),u.close()}),20)},onContentReady:function(t){}}},"dropDown",{name:"dxDropDownButton",widget:"dxButton",location:"after",options:{icon:"chevronup",stylingMode:"text",focusStateEnabled:!1,onClick:function(t){srclocked(!0),setTimeout((function(){u.close(),q(t.component)}),20)},onContentReady:function(t){y.btnFloatDiag=t.component}}}],et=function(){S[0]=0,k[1]=null,k[2]=-1,k[3]=-1,delete k[5]},ot={container:r,width:v?130:180,position:{at:"bottom",my:"top",offset:"0 -5",collision:{x:"fit",y:"none"}},animation:"none",onHiding:function(t){t.component._targetParentsScrollHandler;t.component.cancelHidding&&"function"==typeof t.component.cancelHidding&&t.component.cancelHidding(t),t.cancel||1===S[1]&&1!==t.component._isflash&&(S[1]=2,l.floatDIAG.hide())},onHidden:function(t){et(),console.log(" onHidden: function (e) {"),ct.bind("off"),t.component._EVTTYPE=["HIDDEN",0]},onShown:function(t){1!==p.preventSHOW?(O=!0,S[0]=1,I&&"function"==typeof I&&I(),ct.bind("on"),console.log("            bindSCROLL.bind('on');"),a&&"function"==typeof a&&a()):p.preventSHOW=0},onShowing:function(e){if(console.log("           onShowing: function (e) {"),1!==p.preventSHOW){O=!1,clearTimeout(D),clearTimeout(C),clearTimeout(L);var o=e.component,n=o.atTD,a=n[2],r=rdapV(a);u.close(),u.hwChanged=function(t){u.hwChanged=null,u._$textEditorContainer[(r[1]>4&&"0"==r[2]?"add":"remove")+"Class"]("delval")},u.option("value",r[0]),u.hwChanged=null,m[2]=a;var s=null,d=k[3]!=n[0],g=k[2]!=n[3];"down"==T[1]?((d||g)&&(I=function(){I=null,F(0,d),s&&c&&c.logFOCUSED(s),console.log("  hwndADJUST = function () {")}),g&&(s=[n[1],r[0],n[4].ngay],k[2]=n[3]),d&&(s=null,C=setTimeout((function(){c&&c.attLogNode(k,t)}),100),k[3]=n[0]),2===S[1]&&(!0!==l.floatDIAG._currentVisible?l.floatDIAG.show():z())):i||!d||v||(I=function(){I=null,W(o,o._$popupContent[0].getBoundingClientRect())}),L=setTimeout((function(){L=-1}),200)}},closeOnOutsideClick:!1,onContentReady:function(t){t.component._$wrapper.addClass("edit-log keepshown").find(".btnOK").off("click").on("click",(function(t){$(t.currentTarget).hasClass("okact")?(srclocked(!0),setTimeout((function(){gt("shf",(function(t){1==t.re&&ft[t.sel](t)})),u.close()}),10)):$(t.currentTarget).hasClass("closeact")&&M()}))},hideOnParentScroll:!0},nt=function(t){l.step3_rst_grid,p.atTD;var e=u.option("value"),o=!1,n="0";u._$textEditorContainer[("R"==t?"add":(h._DEL_VAL&&1==h._DEL_VAL[2]&&((h._DEL_VAL[1]&&h._DEL_VAL[1].getTime())!=(e&&e.getTime())&&(u.hwChanged=function(t){u.hwChanged=null}),u.option("value",h._DEL_VAL[1]),n="1",e=h._DEL_VAL[0],o=!0),"remove"))+"Class"]("delval"),at({value:e,previousValue:e},o,"R"==t?adapV(e,n):[e]),!o&&c&&("down"==T[1]?c.trigCLK_tickICO(e&&"R"==t?"U":t):y.btnFloatDiag.need_RELOAD=1)},it=l.saveBadge,at=function(t,e,o){u.bkValIgnore=void 0;var n=l.step3_rst_grid,i=t.value,a=p.atTD,r=a[0],s=a[1],d=a[3],g="1",f=i?o||adapV(i,g):(g="0",function(t,e){if(!t)return[t];var o=new Date(t.setSeconds(0)),n=o.getFullYear().toString();return 4==n.length?[new Date(o.setFullYear(Number(n+e)))]:[null]}(a[4][s],g));it.editLOG(a[4],[s,r],f),n.cellValue(r,s,f[0]),toastMsg("onValueChanged set cellValue!","info",100),console.log("onValueChanged set cellValue! "+r+" cC: "+d+"; val:"+i+"; "+new Date),u.forceCellFocus&&(r=u.forceCellFocus[0],d=u.forceCellFocus[1]),u.forceCellFocus=null,e&&c&&("down"==T[1]?c.addCusLog(i,g):y.btnFloatDiag.need_RELOAD=1)},rt=function(t){if(u._bctivePartIndex==t){if(O=!0,u._fireChangeEvent(),-1==u._valOK)return;A()}},st=function(t,e){var o=e.vals[0],n=adapV(o,"1");E(e.dat,o,!1)&&(it.editLOG(e.dat,e.cell,n),l.step3_rst_grid.cellValue(e.cell[1],e.cell[0],n[0]),"down"==T[1]&&c&&c.addCusLog(o,"1"))},lt=function(){var t=p.atTD,e=new Date((new Date).setSeconds(0));return t&&t[4]?new Date(new Date(t[4].ngay).setHours(e.getHours(),e.getMinutes(),0)):e},dt=-1,ct={DESK:function(t,e,o,n){var i=this;clearTimeout(dt),dt=setTimeout((function(){clearTimeout(dt),dt=-1,l.step3_utils.editPO._$wrapper.removeClass("tmphidden");var t=l.step3_rst_grid,e=l.step3_utils.editPO,o=e.atTD,n=t.getCellElement(o[0],o[3]),a=n[0].getBoundingClientRect(),r=i._$wrapper[0].getBoundingClientRect(),s=r.left+r.width<a.left+30,d=r.top>a.top+20,c=a.top+20>r.top+r.height;s||d||c?(console.log("step3_rst_grid scroll end hide"),e.hide()):(console.log("step3_rst_grid scroll end repaint"),e.repaint(),F(0,!0),t.focus(n))}),e||0)},PHONE:function(t){-1===dt&&(console.log("step3_rst_grid scroll start"),l.step3_utils.editPO._$wrapper.addClass("tmphidden")),ct.DESK.call(this,t,300)},fn:function(t){var e=l.step3_utils.editPO;e._currentVisible&&(e._EVTTYPE&&["keydown","HIDDEN"].indexOf(e._EVTTYPE[0])>-1||ct[v?"PHONE":"DESK"].call(this,t))},srl:function(){return this._srl||(this._srl=l.step3_rst_grid.getScrollable(),this._srl)},bind:function(t){if(this.lastACT!==t){var e=this,o=e._srl||e.srl(),n=e._tabHEAD||(e._tabHEAD=elTAB.find('.chrome-tab[data-tab-id="'+elTAB[0].__actTAB+'"]'),e._tabHEAD);o.off("scroll",e.fn),n.off("WS_START",e.WS_START).off("WS_END",e.WS_END).off("WS_ON",e.WS_END),$(w0w).off("resize",e.WIN_RS),"on"==t&&(o.on("scroll",e.fn),v?n.on("WS_START",e.WS_START).on("WS_END",e.WS_END):$(w0w).on("resize",e.WIN_RS)),Main.needSCRO_EVT("on"==t),e.lastACT=t}},WS_START:function(){l.step3_utils.editPO._$wrapper.addClass("tmphidden")},WS_END:function(t){var e=l.step3_utils.editPO,o=e.option("target"),n=DevExpress.devices._currentOrientation;e._$wrapper.removeClass("tmphidden"),_!=n?(_=n,P=r[0].getBoundingClientRect(),F(0,!0)):o&&l.step3_rst_grid._controllers.editorFactory.focus(o,!0),e.repaint(),console.log("elUI.globHWN.sliderbar: repaint")},WIN_RS_timeout:-1,WIN_RS:function(t){var e=ct;clearTimeout(e.WIN_RS_timeout),e.WIN_RS_timeout=setTimeout((function(){clearTimeout(e.WIN_RS_timeout),e.WIN_RS_timeout=-1,et(),P=r[0].getBoundingClientRect(),F(0,!0),ct.WS_END()}),300)}},ut={_setEDT_VAL:function(t){var e=u.option("value");(e&&e.getTime())!=(t&&t.getTime())&&(u.hwChanged=function(t){u.hwChanged=null},u.option("value",t))},_logchanged_by_Mouse_DragDiagLog:function(t,e){var o=l.step3_rst_grid,n=p.atTD,i=e[0],a=adapV(e[1],"1"),r=1==i.typ?i.key.replace("clg","fio"):i.key,s=n[0],d=r;n[1]==r&&ut._setEDT_VAL(e[1]),it.editLOG(n[4],[d,s],a),o.cellValue(s,d,a[0])},_tickchanged_by_Mouse_Click:function(t,e){u.close(),e&&ut._setEDT_VAL(e[1]),u._$textEditorContainer[("R"==t?"add":"remove")+"Class"]("delval"),at({value:e&&e[1]},!1,e),srclocked(!1)},hidePopupDOG:function(){for(;DevExpress.hideTopOverlay(););},capKeyD:function(t){if(l.frmWizHwnd&&3==l.frmWizHwnd._his.toStep&&!($(t.target).closest(".kiem-the").length>0)){if(t.preventDefault(),t.stopPropagation(),27==t.which)1===S[0]&&l.step3_utils.editPO.hide();else{var e=l.step3_rst_grid,o=l.step3_utils.editPO,n=o.atTD,i=e.getCellElement(n[0],n[3]);t.which?t.which:t.keyCode;H(o,o._$popupContent[0].getBoundingClientRect(),i),e.focus(i)}}},evtTabActived:function(t,e){if(!v){var o=ut;$(document)[1==e.state?"on":"off"]("keydown",o.capKeyD),null!=t&&0==e.state&&o.hidePopupDOG()}},init:function(){var t=ut;ut.evtTabActived(null,{state:1}),d[0].on("onActived",t.evtTabActived).on("onShowStep",(function(e,o,n,i){3==n.fromStep?(t.hidePopupDOG(),t.evtTabActived(null,{state:0})):3==n.toStep&&t.evtTabActived(null,{state:1})})).on("DIAG",(function(e,o,n,i){var a=l.step3_rst_grid,r=p.atTD;switch(o){case"1":a.focus(a.getCellElement(r[0],n.key));break;case"2":t._tickchanged_by_Mouse_Click(n,i);break;case"3":t._logchanged_by_Mouse_DragDiagLog(n,i)}})).on("onRemoving",(function(e,o,n){$(document).off("keydown",t.capKeyD)}))}},gt=function(t,e){var o={del:{0:"(Mac dinh)",1:"Sau khi xoa se doi log the"},shf:{0:"Chen vao log the trong",1:"Doi log the hien tai"}},n=$("<div style='padding:0 10px'/>"),i=t+"_lastOPT";DevExpress.ui.dialog.custom({title:"",showTitle:!0,messageHtml:"",popupOptions:{dragEnabled:!0,_ignoreFunctionValueDeprecation:!0,contentTemplate:function(e){e.append($("<p>"+o[t][1]+'<button type="button" class="btn btn-sm btn-outline-warning" style="float:right;padding: 0px 2px 0px;"><i class="ti-help"></i></button></p>'),n);var a=[{id:0,text:o[t][0]},{id:1,text:"Xoa va doi sang trai"}],r=(gt[i]||(gt[i]=0),gt[i]);"shf"==t&&p.atTD&&p.atTD[4].cusL&&a.push({id:2,text:"Khoi phuc lai ket qua tinh ban dau"}),0==a.filter((function(t,e){return t.id==r})).length&&(r=0),n=n.dxRadioGroup({valueExpr:"id",displayExpr:"text",items:a,value:r}).dxRadioGroup("instance")},onContentReady:function(t){var e=t.component._$wrapper;e.find(".dx-popup-bottom.dx-toolbar").css("padding","10px"),e.find(".dx-popup-content").css("padding","0 0 0 10px"),e.find(".dx-popup-title").addClass("dog_shift_popup")},onHidden:function(t){n.dispose()},onShowing:function(t){srclocked(!1)}},buttons:[{text:"Thuc Hien",onClick:function(e){return srclocked(!0),gt[i]=n.option("value"),{re:1,sel:gt[i],ow:t}}},{text:"Dong",onClick:function(t){return{re:0}}}]}).show().done((function(t){setTimeout((function(){e(t)}),20)}))},ft={ui:function(t,e){a=function(){a=null,srclocked(!1)},t.focus(t.getCellElement(e[0],e[3])),c&&("down"==T[1]?X():y.btnFloatDiag.need_RELOAD=1)},b_se:function(t){var e=l.step3_rst_grid,o=p.atTD,n=o[0],i=o[1],a=o[4],r=e._views.rowsView.getCellOptions(n,i),s=e._controllers.editing,d=Number(i.split("fio")[1]),c={};ft.del2_fre=[],t&&t(c,a,d,[]);for(var u=8;u>=d;u--)c.hasOwnProperty("fio"+u)&&it.editLOG(a,["fio"+u,-1,u],[c["fio"+u]]);s._applyChange(r,{data:c,key:a.id,oldData:a,type:"update"},!0),p.preventSHOW=2,setTimeout((function(){p.preventSHOW=0}),200),e.cellValue(o[0],o[1],c[o[1]]),ft.ui(e,o)},shfOUT:function(t,e,o){var n=$.extend(!0,[],e.freL),i=[e["fio"+t]];e.hasOwnProperty("noi"+t)&&i.push($.extend(!0,[],e["noi"+t])),n.unshift(i),o.freL=n},0:function(t){this.b_se((function(t,e,o,n){for(var i=!1,a=8;a>=o;a--)if(e.hasOwnProperty("fio"+a)){var r=a+1,s=e["fio"+a];t["fio"+a]=null,i||(i=!!s),e.hasOwnProperty("noi"+a)&&(t["noi"+r]=$.extend(!0,[],e["noi"+a]),t["noi"+a]=null),a<8?t["fio"+r]=s:ft.shfOUT(a,e,t)}!i&&t.freL&&delete t.freL}))},getOUT:function(t,e,o){var n=$.extend(!0,[],e.freL),i=!1;if(n.length>0){var a,r=null,s=null;2==(a=n.shift()).length&&(r=a[0],s=a[1]?$.extend(!0,[],a[1]):null,o["fio"+t]=r,o["noi"+t]=s,i=!0)}ft.del2_fre.length>0&&(n.push([,ft.del2_fre[0],ft.del2_fre[1],ft.del2_fre[2]]),i=!0),i&&(o.freL=e.freL.concat(n))},del_and_shf:function(t,o,n){if(t.hasOwnProperty("fio"+n)){var i,a=t["fio"+n];if(t.cusL&&(i=JSON.parse(t.cusL))[1]&&i[1][n]&&"HIE"!=i[1][n]&&(a=new Date(t.ngay.getTime()+i[1][n]*e)),t.hasOwnProperty("noi"+n)){var r=$.extend(!0,[],t["noi"+n]);o["noi"+n]=null}ft.del2_fre.push(n),ft.del2_fre.push(a),o["fio"+n]=null,r&&ft.del2_fre.push(r)}},1:function(t){this.b_se((function(t,e,o,n){ft.del_and_shf(e,t,o);for(var i=o;i<=8;i++){var a=i+1;e.hasOwnProperty("fio"+a)&&(t["fio"+a]=null,e.hasOwnProperty("noi"+a)&&(t["noi"+i]=$.extend(!0,[],e["noi"+a]),t["noi"+a]=null),t["fio"+i]=e["fio"+a]),8==i&&ft.getOUT(i,e,t)}}))},2:function(t){var e=l.step3_rst_grid,o=p.atTD,n=e._controllers.editing;if(n){var i=n.getChanges();i=i.filter((function(t,e){return t.key!=o[4].id})),n._silentOption("editing.changes",i);var a=e._views.rowsView.getCellOptions(o[0],o[1]);n._updateEditRow(a.row,!0,!1);var r=[o[4].acno,o[4].ngay.getTime()].join("|");it[1]("cellValue",r,"remove"),ft.ui(e,o)}},"2_backup":function(t){for(var o=l.step3_rst_grid,n=p.atTD,i=o._controllers.editing,a=n[4],s=[],d=function(t,o){if(a.cusL){var n=a.cusL;if(n[0][o]&&n[1][o])return new Date(n[1][o]*e+a.ngay.getTime())}return t},c=1;c<=8;c++){var u="fio"+c;a.hasOwnProperty(u)&&a[u]&&s.push(d(a[u],c))}r.trigger("giaotiepevt",["RECALC_1ROW",{acno:a.acno,aLogs:s,logs:s.length,ten:"Mr.One"},a.id,function(t){var e=o.getVisibleRows();if(e.length>0){var r=i._dataController._dataSource,s=a.id,l=t,d=r.items();it.resetChanged("row",s);for(var c=0;c<d.length;c++)if(d[c].id==s){l.id=d[c].id,l.mmT=d[c].mmT,d[c]=l;break}e=e[n[0]],i._updateRowImmediately(e,!0,!1);var u=o.getCellElement(n[0],n[3]);u&&o.focus(u)}}])}},pt=function(){c&&c.reset(),c=null,"down"==T[1]&&(T=["Out","up"],y.btnFloatDiag.option("icon","chevron"+T[1]),s.css("display","none")),g&&(g.div=null),g=null,y.btnFloatDiag&&(y.btnFloatDiag.need_RELOAD=0),et()};r.parent().append(b).on("re-calc",(function(t,e,o){alert("s3logedit re-calc"),k[3]=-1})).on("mouse_FocusedCellChanging",st).on("setFIO",(function(t,e,o,n){})).on("listen_2_me",(function(e,o,n){switch(o){case"part_fullscreen":i="add"==n||(s&&s.removeClass("opposit-flip").css({top:""}),!1),setTimeout((function(){P=r[0].getBoundingClientRect()}),1e3);break;case"reset_diag":pt();break;case"changeInOutLogCols":t=JSON.parse(n),pt()}})),v&&tt.splice(2,1),(u=b.find(".edit-time").dxDateBox({type:"datetime",displayFormat:"HH:mm",pickerType:v?"rollers":"calendar",showClearButton:!1,selectionMode:"single",useMaskBehavior:!0,onKeyDown:function(t){t.event.stopPropagation(),13==t.event.keyCode||(27==t.event.keyCode?M():9==t.event.keyCode?(t.event.preventDefault(),function(t){var e,o=l.step3_utils.editPO;if(o._currentVisible){var n=o.atTD[0],i=o.atTD[1],a=o.atTD[3],r=(e=o.atTD[4])&&$.extend(!0,{},e);u.hwChanged=function(t){u.hwChanged=null,setTimeout((function(){st(0,{cell:[i,n,,a],dat:r,vals:[t.value]})}),5)},Z(t.event.which?t.event.which:t.event.keyCode)}}(t)):37==t.event.keyCode?rt(0):39==t.event.keyCode?rt(2):[33,34].indexOf(t.event.keyCode)>-1&&(t.event.preventDefault(),t.event.originalEvent.isDefaultPrevented=function(t){return this.UD_From_EDT_CB=function(){},!1},t.event.keyName=33==t.event.keyCode?"pageUp":"pageDown",l.step3_rst_grid._controllers.keyboardNavigation._keyDownHandler(t.event)))},onValueChanged:function(t){u.hwChanged?u.hwChanged(t):(clearTimeout(t.component.trapValueChanged),O?E(p.atTD[4],t.value,!0)&&(at(t,!0),u._$textEditorContainer.removeClass("delval")):t.component.bkValIgnore=t.value)},buttons:tt,onContentReady:function(t){var e=t.component._$element.find("input");e[0];$(e[1]).off("blur").on("blur",(function(t){u.hwChanged=null,u.forceCellFocus=null}))},onOptionChanged:function(t){t.name},onFocusOut:function(t){u.preventLOSTfocus&&(t.event.isDefaultPrevented=u.preventLOSTfocus)},onClosed:function(t){ut.evtTabActived(null,{state:1})},onOpened:function(t){ut.evtTabActived(null,{state:0}),void 0===u._maskValue&&setTimeout((function(){u._strategy._widget.option("value",lt())}))}}).dxValidator({validationRules:[{type:"custom",validationCallback:function(t){return u._valOK=10,!0}}]}).dxDateBox("instance"))._setNewDateIfEmpty=function(){if(!this._maskValue){var t=lt();this._maskValue=t,this._initialMaskValue=t,this._renderDateParts()}},u._enterHandler=function(t){t.preventDefault(),(O=this._isValueDirty())&&(this._fireChangeEvent(),-1==u._valOK)||(2!=u._bctivePartIndex&&u._maskValue?this._selectNextPart(1):A())},u._supportedKeys=function(t){return this._bctivePartIndex=this._activePartIndex,this.constructor.prototype._supportedKeys.call(this,t)},v||(ot[deV.$2||"hideOnParentScroll"]=function(t){return p.repaint(),!0}),u._valOK=10,l.step3_utils.edit_time=u,(p=b.dxPopover(ot).dxPopover("instance")).backVAL=h,l.step3_utils.editPO=p,it[1]=function(t,e,o){var n,i=this,a=0;"remove"===o?(n=i[2].gI(t))&&(n.rI(e),a=n.L):((n=i[2].g0N(t,{})).sI(e,o),a=n.L),i[0].text(a>0?a:""),it.sBTN.option("visible",a>0)},it.bageChanged_HIS=function(t){var e,o,n=it[2].Is.cellValue;return n&&(e=[t.acno,t.ngay.getTime()].join("|"),o=n.gI(e)),o},it.editLOG=function(t,o,n){var i,a,r=t.ngay.getTime(),s=[0],l=[0],d=function(o,n,i){if(t.hasOwnProperty("fio"+o)){var a=t["fio"+o];n[o]=a?Math.floor((a.getTime()-r)/e):"HIE"}else i&&(n[o]=i)},c=it.bageChanged_HIS(t),u=[t.acno,r].join("|");it[u]&&""!=it[u]?a=it[u]:t.cusL&&""!=t.cusL&&(a=JSON.parse(t.cusL)),a&&(s=a[0],l=a[1]);for(var g=1;g<=8;g++)if("fio"+g==o[0]){var f=n[0],p="HIE";f&&(p=Math.floor((f.getTime()-r)/e)),l[g]||d(g,l,"HIE"),p===l[g]&&(p=l[g],delete l[g]),s[g]=p}else s[g]||d(g,s);i=c?c[3]:t.cusL,it[1]("cellValue",u,[s,l,i]),it[u]=[s,l]},it.resetChanged=function(t,e){var o,n=l.step3_rst_grid._controllers.editing;"all"==t||"row"==t&&(o=(o=n.getChanges()).filter((function(t,o){return t.key!=e})),n._silentOption("editing.changes",o))},l.globHWN.sliderbar=function(t,e){for(;DevExpress.hideTopOverlay(););setTimeout((function(){P=r[0].getBoundingClientRect(),et()}),500)},l.globHWN.theme=function(t,e){g&&c&&c.alterTheme()},app_container.closest("#app").on("sidebar",l.globHWN.sliderbar).on("theme",l.globHWN.theme),ut.init()}}return l.prototype.publicSharedVar="quux",l.prototype.publicSharedMethod=function(t){},l}();