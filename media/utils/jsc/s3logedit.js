var s3logedit=function(){var t=1,e=[0,15,10];function n(n,o,i,a){"use strict";var r,s,c=[],d=40,l=function(t){var e=new Date(t||c[2].getTime()),n=new Date(new Date(e).setHours(0,0,0,0)).getTime(),o=Math.floor((e.getTime()-n)/6e4),i=c[0].left+c[0].width/2;return[c[1].left+o-i,o,e.getTime()]},u=function(o){function i(){go.Link.call(this),this.isLayoutPositioned=!1,this.isTreeLink=!1,this.routing=go.Link.Orthogonal,this._direction=0,this._extension=30,this._inset=10,this._gap=10}go.Diagram.inherit(i,go.Link),i.prototype.cloneProtected=function(t){go.Link.prototype.cloneProtected.call(this,t),t._direction=this._direction,t._extension=this._extension,t._inset=this._inset,t._gap=this._gap},Object.defineProperty(i.prototype,"direction",{get:function(){return this._direction},set:function(t){if(!isNaN(t)&&0!==t&&90!==t&&180!==t&&270!==t)throw new Error("DimensioningLink: invalid new direction: "+t);this._direction=t}}),Object.defineProperty(i.prototype,"extension",{get:function(){return this._extension},set:function(t){this._extension=t}}),Object.defineProperty(i.prototype,"inset",{get:function(){return this._inset},set:function(t){if(!(t>=0))throw new Error("DimensioningLink: invalid new inset: "+t);this._inset=t}}),Object.defineProperty(i.prototype,"gap",{get:function(){return this._gap},set:function(t){if(!(t>=0))throw new Error("DimensioningLink: invalid new gap: "+t);this._gap=t}}),i.prototype.computePoints=function(){var t=this.fromNode;if(!t)return!1;var e=this.fromPort,n=this.computeSpot(!0),o=this.toNode;if(!o)return!1;var i=this.toPort,a=this.computeSpot(!1),r=this.getLinkPoint(t,e,n,!0,!0,o,i);if(!r.isReal())return!1;var s=this.getLinkPoint(o,i,a,!1,!0,t,e);if(!s.isReal())return!1;this.clearPoints();var c=this.direction;if(isNaN(c)){c=r.directionPoint(s);var d=new go.Point(this.extension,0);d.rotate(c+90);var l=new go.Point(this.extension-this.inset,0);l.rotate(c+90);var u=new go.Point(this.gap,0);u.rotate(c+90),this.addPointAt(r.x+u.x,r.y+u.y),this.addPointAt(r.x+d.x,r.y+d.y),this.addPointAt(r.x+l.x,r.y+l.y),this.addPointAt(s.x+l.x,s.y+l.y),this.addPointAt(s.x+d.x,s.y+d.y),this.addPointAt(s.x+u.x,s.y+u.y)}else{this.extension;var g=0,p=0,f=0,h=0;0===c||180===c?(0===c?(p=(g=Math.min(r.y,s.y)-this.extension)+this.inset,f=r.y-this.gap,h=s.y-this.gap):(p=(g=Math.max(r.y,s.y)+this.extension)-this.inset,f=r.y+this.gap,h=s.y+this.gap),this.addPointAt(r.x,f),this.addPointAt(r.x+.01,g),this.addPointAt(r.x,p),this.addPointAt(s.x,p),this.addPointAt(s.x-.01,g),this.addPointAt(s.x,h)):90!==c&&270!==c||(90===c?(p=(g=Math.max(r.x,s.x)+this.extension)-this.inset,f=r.x+this.gap,h=s.x+this.gap):(p=(g=Math.min(r.x,s.x)-this.extension)+this.inset,f=r.x-this.gap,h=s.x-this.gap),this.addPointAt(f,r.y),this.addPointAt(g,r.y+.01),this.addPointAt(p,r.y),this.addPointAt(p,s.y),this.addPointAt(g,s.y-.01),this.addPointAt(h,s.y))}return this.updateTargetBindings(),!0};var a=go.GraphObject.make,s=(new Date(2016,4,17,0,0,0,0),60),u=24,g=s*u;r=a(go.Diagram,o,{fixedBounds:new go.Rect(l()[0],0-d+100,c[1].width-2,c[1].height-2),"animationManager.isEnabled":!1,"contextMenuTool.defaultTouchContextMenu":null,padding:0,contentAlignment:go.Spot.TopLeft,initialDocumentSpot:go.Spot.TopLeft,initialViewportSpot:go.Spot.TopLeft,PartResized:function(t){t.subject},SelectionMoved:function(t){},ChangingSelection:function(t){}});var p=function(t,e,n,o){!function(t,e,n,o){t.elements.each(function(i){var a=function(e){if(e.name&&f[e.name]&&f[e.name][n]){var i=f[e.name][n][cS$.c0lor](t.data,o);e.fill&&(e.fill=i),e.stroke&&(e.stroke=i)}};i instanceof go.Panel?i.elements.each(function(o){a(o),e&&"symSEL"==o.name&&(0==t.part.data.sta&&(o.text="sel"==n?"":""),o.font=("sel"==n?"32":"18")+"px FontAwesome")}):a(i)})}(t,e,n,o)},f={logBODY:{nor:{dark:function(t,e){return 1==t.typ?1==t.sta?"fuchsia":"blue":0==t.sta?"gray":"#000"},light:function(t,e){return 1==t.typ?1==t.sta?"fuchsia":"blue":0==t.sta?"#EC7063":"#4A235A"}},sel:{dark:function(t,e){return 1==t.typ?"clkn"==e&&1==t.typ?1==t.sta?"fuchsia":"blue":"#00ff2b":0==t.sta?"gray":"#000"},light:function(t,e){return 1==t.typ?"clkn"==e&&1==t.typ?1==t.sta?"fuchsia":"blue":"#00ff2b":(t.sta,"red")}},dis:{},hov:{},acti:{}},logHOUR:{nor:{dark:function(t){return t.typ,"#fff"},light:function(t){return t.typ,"#000"}},sel:{dark:function(t){return t.typ,"#00ff2b"},light:function(t){return t.typ,"#00ff2b"}},dis:{},hov:{},acti:{}},symSEL:{nor:{dark:function(t){return t.typ,"cyan"},light:function(t){return t.typ,"cyan"}},sel:{dark:function(t){return t.typ,"#00ff2b"},light:function(t){return t.typ,"#00ff2b"}},dis:{},hov:{},acti:{}}},h=function(t,e){p(e,!0,"sel","me")},m=function(t,e){p(e,!0,v(e),"ml")},v=function(t){return A.contains(t)?"sel":"nor"},w=function(t){return a(go.Node,"Spot",{layerName:"APPEL",movable:1==t,copyable:!1,avoidable:!0,minLocation:new go.Point(-1/0,NaN),maxLocation:new go.Point(1/0,NaN),selectionAdorned:!1,locationSpot:go.Spot.Center,dragComputation:function(t,e,n){return new go.Point(e.x,e.y)},mouseEnter:h,mouseLeave:m},a(go.Shape,{name:"logBODY",alignment:go.Spot.Bottom,cursor:1==t?"w-resize":"default",strokeWidth:.3},new go.Binding("geometryString","",function(t){return 1==t.typ?"F M5 150 L0 160 L0 170 L10 170 L10 160 L5 150 L5 10 L0 15 L5 0 L10 15 L5 10z":"F M5 160 L0 160 L0 170 L10 170 L10 160 L5 160 L5 10 L0 15 L5 0 L10 15 L5 10z"}),new go.Binding("stroke","stroke",function(t,e){return f.logBODY[v(e.part)][cS$.c0lor](e.part.data,"bi")})),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("fill","isSelected",function(t,e){t?(A.each(function(t){p(t,!0,"nor","selr")}),(A=new go.Set).add(e)):A.remove(e),p(e,!0,t?"sel":"nor","sels")}).ofObject(),a(go.Panel,"Table",{name:"timTB",alignment:go.Spot.Bottom,alignmentFocus:go.Spot.Top,defaultSeparatorPadding:0,portId:"A",fromSpot:go.Spot.Bottom,toSpot:new go.Spot(1,1,0,-10),fromEndSegmentLength:50,toEndSegmentLength:50},a(go.TextBlock,{name:"symSEL",desiredSize:new go.Size(30,35),row:0,column:0,alignment:new go.Spot(.5,.5),margin:0,textAlign:"center",verticalAlignment:go.Spot.Center,cursor:"pointer",font:"18px FontAwesome",editable:!1,isMultiline:!1,click:function(t,e){A.remove(e.part);var n=0;0==e.part.data.sta&&(n=1),r.model.setDataProperty(e.part.data,"sta",n),0==n&&(e.text=""),p(e.part,!0,"sel","clkn")}},new go.Binding("text","sta",function(t){if(1==t)return""}),new go.Binding("stroke","stroke",function(t,e){return f.symSEL[v(e.part)][cS$.c0lor](e.part.data,"bi")})),a(go.TextBlock,{name:"logHOUR",alignment:new go.Spot(.5,0,1,0),row:1,column:0,margin:0,font:'100 12pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif',angle:270},new go.Binding("text"),new go.Binding("stroke","stroke",function(t,e){return f.logHOUR[v(e.part)][cS$.c0lor](e.part.data,"bi")}))))};r.nodeTemplate=w(1),r.nodeTemplateMap.add("ORGI_LOG",w(0)),r.nodeTemplateMap.add("Center",a(go.Node,"Spot",{selectable:!1,locationSpot:go.Spot.Center},new go.Binding("location","loc",go.Point.parse))),r.nodeTemplateMap.add("nodehieu",a(go.Node,"Auto",{zOrder:100,layerName:"DURAT",fromSpot:go.Spot.Left,toSpot:go.Spot.Right,movable:!1,copyable:!1,avoidable:!0,minLocation:new go.Point(-1/0,NaN),maxLocation:new go.Point(1/0,NaN)},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("width","width").makeTwoWay(),a(go.Shape,{strokeWidth:0,fill:"lightgray",height:20},new go.Binding("fill","",function(t,e){return{dark:function(){return"gray"},light:function(){return"darkgray"}}[cS$.c0lor]()})),a(go.TextBlock,{margin:0},new go.Binding("text","text")))),r.linkTemplate=a(go.Link,{routing:go.Link.Normal},a(go.Shape,{stroke:"gray",strokeWidth:2}),a(go.Shape,new go.Binding("fromArrow","fromArrow"),{scale:2,fill:"#D4B52C"}),a(go.Shape,new go.Binding("toArrow","toArrow"),{scale:2,fill:"#D4B52C"}),{click:function(t,e){var n=b(e);if(n){var o=document.getElementById("myArrowheadInfo");o&&(o.textContent=n)}},toolTip:a("ToolTip",a(go.TextBlock,{margin:4},new go.Binding("text","",b).ofObject()))}),r.linkTemplateMap.add("NEAR_LOG",a(go.Link,{curve:go.Link.Bezier},new go.Binding("curviness","curviness").makeTwoWay(),a(go.Shape,{strokeWidth:1.5}),a(go.Shape,{toArrow:"standard",stroke:null}),a(go.Panel,"Auto",{},a(go.TextBlock,"transition",{textAlign:"center",font:"10pt helvetica, arial, sans-serif",stroke:"brown"},new go.Binding("text","text").makeTwoWay())))),r.linkTemplateMap.add("Dimensioning",a(i,{},new go.Binding("layerName","isHighlighted",function(t){return t?"Foreground":""}).ofObject(),new go.Binding("group","group"),new go.Binding("fromSpot","fromSpot",go.Spot.parse),new go.Binding("toSpot","toSpot",go.Spot.parse),new go.Binding("direction"),new go.Binding("extension"),new go.Binding("inset"),a(go.Shape,{stroke:"gray",strokeWidth:.2},new go.Binding("stroke","color"),new go.Binding("strokeDashArray","strokeDashArray")),a(go.Shape,{fromArrow:"BackwardOpenTriangle",segmentIndex:2,stroke:"gray"},new go.Binding("stroke","color")),a(go.Shape,{toArrow:"OpenTriangle",segmentIndex:-3,stroke:"gray"},new go.Binding("stroke","color")),a(go.TextBlock,{segmentIndex:2,segmentFraction:.5,segmentOrientation:go.Link.OrientUpright,alignmentFocus:go.Spot.Bottom,stroke:"gray",font:'100 12pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'},new go.Binding("text","text",function(t,e){return function(t){var e=t.pointsCount;if(e<2)return"";var n=t.getPoint(0),o=t.getPoint(e-1),i=t.direction;if(isNaN(i))return Math.floor(Math.sqrt(n.distanceSquaredPoint(o)))+"";var a=i*Math.PI/180;return Math.floor(Math.abs(Math.cos(a)*(n.x-o.x))+Math.abs(Math.sin(a)*(n.y-o.y)))+""}(e.part)}).makeTwoWay(),new go.Binding("stroke","color"))));var y=go.Shape.getArrowheadGeometries().toKeySet().toArray();y.length%2==1&&y.push("");var k=[{from:"P1",to:"P1",category:"Dimensioning",fromSpot:"TopLeft",toSpot:"TopRight",inset:1,extension:40,strokeDashArray:[5,5],direction:0,color:"gray",text:"0"},{from:"P2",to:"P2",category:"Dimensioning",fromSpot:"TopLeft",toSpot:"TopRight",inset:1,extension:40,strokeDashArray:[5,5],direction:0,color:"gray",text:"0"}],x=new go.GraphLinksModel;function b(t){var e=t.part;e instanceof go.Adornment&&(e=e.adornedPart);var n="";if(e instanceof go.Link)n="toArrow: "+(o=e).data.toArrow+";\nfromArrow: "+o.data.fromArrow;else if(e instanceof go.Node){var o;n="toArrow: "+(o=e.linksConnected.first()).data.toArrow+";\nfromArrow: "+o.data.fromArrow}return n}x.linkToPortIdProperty="toPort",x.linkFromPortIdProperty="fromPort",r.model=x;var S=a(go.Part,"Graduated",{layerName:"Grid",position:new go.Point(0,-30),graduatedTickUnit:s},a(go.Shape,{geometryString:"M0 0 H3600",stroke:"transparent"}),a(go.Shape,{geometryString:"M0 0 V700",interval:u,stroke:"red",strokeWidth:.3}),a(go.TextBlock,{font:"9pt sans-serif",stroke:"red",interval:u,alignmentFocus:new go.Spot(0,0,-2,-4),graduatedFunction:function(t){return"00:00 _LAN.js_gojs_2"}}));function _(t){t="#000";var e="#000";return"dark"==cS$.c0lor&&(t="#4d4d4d",e="#fff"),a(go.Part,"Graduated",{layerName:"Grid",position:new go.Point(0,0),graduatedTickUnit:s/2},a(go.Shape,{geometryString:"M0 30 H3600",stroke:t}),a(go.Shape,{name:"l1",geometryString:"M0 0 V765",stroke:t,strokeWidth:.2,strokeDashArray:[5,5]}),a(go.Shape,{name:"l2",geometryString:"M0 0 V765",stroke:t,strokeWidth:.2,interval:2}),a(go.TextBlock,{interval:2,font:'100 10pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif',stroke:e,segmentOffset:new go.Point(0,-15),graduatedFunction:function(t){return(t=t/s%u)<0&&(t+=u),0==Math.floor(t)?"":Math.floor(t).toString()+":00"}}))}var P=_("black"),T=a(go.Part,{pickable:!1,layerName:"Grid",visible:!0,position:new go.Point(0,0),isAnimated:!1,locationSpot:go.Spot.Top},a(go.Shape,{geometryString:"M0 5 V20",strokeWidth:2,stroke:"hotpink"})),M=function(){var t=r.viewportBounds,e=(r.fixedBounds.position.x,r.fixedBounds.position.y,r.fixedBounds.position.x,r.fixedBounds.width,r.div.getElementsByTagName("canvas")[0]);r.commit(function(n){var o=r.fixedBounds.position.x,i=r.fixedBounds.position.y,a=o+r.fixedBounds.width,s=i*r.scale-i;e.style.top=s+"px",S.graduatedMin=0,S.graduatedMax=t.width+a,S.elt(0).width=t.width+a,P.graduatedMin=0,P.graduatedMax=t.width+a,P.elt(0).width=t.width+a},null)};r.addDiagramListener("ViewportBoundsChanged",function(t){setTimeout(function(t){M()},200)}),r.add(P),r.add(S),r.add(T),M(),r.toolManager.doMouseMove=function(){go.ToolManager.prototype.doMouseMove.call(this),D()},r.toolManager.linkingTool.doMouseMove=function(){go.LinkingTool.prototype.doMouseMove.call(this),D()},r.toolManager.draggingTool.doMouseMove=function(){go.DraggingTool.prototype.doMouseMove.call(this),D()};var B=null,C=null,A=new go.Set;function D(){var t=r.viewportBounds;t.isReal()&&r.commit(function(e){var n=e.lastInput.documentPoint;T.location=new go.Point(Math.max(n.x,t.x),5),T.scale=1/e.scale},null)}r.toolManager.dragSelectingTool.doMouseMove=function(t){go.DragSelectingTool.prototype.doMouseMove.call(this),this.diagram.currentCursor="crosshair",function(t,e){var n=t.diagram,o=B,i=C;if(null===n||null===o)return;var a=n.lastInput,r=n.findPartsIn(e,!0,!0,new go.Set),s=function(t,e){t.isRMVSEL=e,p(t,!0,e?"sel":"nor","dra")};a.control||a.meta?a.shift?(i.each(function(t){r.contains(t)||s(t,o.contains(t))}),r.each(function(t){s(t,!1),i.add(t)})):(i.each(function(t){r.contains(t)||s(t,o.contains(t))}),r.each(function(t){s(t,!o.contains(t)),i.add(t)})):a.shift?(i.each(function(t){r.contains(t)||s(t,o.contains(t))}),r.each(function(t){s(t,!0),i.add(t)})):(i.each(function(t){r.contains(t)||s(t,!1)}),o.each(function(t){r.contains(t)||s(t,!1)}),r.each(function(t){s(t,!0),i.add(t)}))}(this,this.computeBoxBounds()),D()},r.toolManager.dragSelectingTool.doActivate=function(){go.DragSelectingTool.prototype.doActivate.call(this),this.diagram.currentCursor="",B=A.copy(),C=new go.Set,this.diagram.raiseDiagramEvent("ChangingSelection")},r.toolManager.dragSelectingTool.doDeactivate=function(){this.diagram.raiseDiagramEvent("ChangedSelection"),B.each(function(t){!1===t.isRMVSEL&&A.remove(t)}),C.each(function(t){A.add(t)}),B=null,C=null,go.DragSelectingTool.prototype.doDeactivate.call(this)},r.toolManager.dragSelectingTool.doCancel=function(){var t=B;null!==t&&(t.each(function(t){t.isSelected=!0}),C.each(function(e){t.contains(e)||(e.isSelected=!1)})),go.DragSelectingTool.prototype.doCancel.call(this)};var L=r.findLayer("Foreground");return r.addLayerBefore(a(go.Layer,{name:"ORIGL"}),L),r.addLayerBefore(a(go.Layer,{name:"APPEL"}),L),r.addLayerBefore(a(go.Layer,{name:"DURAT"}),L),r.toolManager.standardMouseWheel=function(){this.diagram.lastInput.control||go.ToolManager.prototype.standardMouseWheel.call(this)},{attLogNode:function(){A=new go.Set;for(var t=n.step3_utils.editPO.atTD[4],e=[],o=1e5,i=0,a=[],s=1;s<=4;s++){var u="fio"+s,p=l(t[u]),f=g+p[1];f<o&&(o=f),f>i&&(i=f),a.push(f),e.push({key:p[2],loc:f+" 145",color:"gray",text:dayjs(t[u]).format("HH : mm"),sta:1,typ:0,category:"ORGI_LOG"})}e.push({key:"P1",text:"",F:"00:00",T:"00:00",color:"gray",loc:a[0]+" 100",width:a[1]-a[0],category:"nodehieu",zOrder:0}),e.push({key:"P2",text:"",F:"00:00",T:"00:00",color:"gray",loc:a[2]+" 100",width:a[3]-a[2],category:"nodehieu",zOrder:0}),x.nodeDataArray=e,x.linkDataArray=k;var h,m=0-d,v=parseFloat(c[1].width-2),w=parseFloat(c[1].height-2);i-o<v&&(h=o-(v-(i-o))/2),r.startTransaction("changeFixedBounds"),r.fixedBounds=new go.Rect(h,m,Math.max(1,v),Math.max(1,w)),r.commitTransaction("changeFixedBounds")},alterTheme:function(){var t="#000",e="#000";"dark"==cS$.c0lor&&(t="#4d4d4d",e="#fff"),P.elements.each(function(n){n instanceof go.TextBlock?n.stroke=e:n.stroke=t}),r.nodes.each(function(t){r.model.raiseDataChanged(t.data,"")}),r.links.each(function(t){r.model.raiseDataChanged(t.data,"")})},addCusLog:function(t){var e=l(t),n=g+e[1];r.model.addNodeData({key:e[2],loc:n+" 145",color:"cyan",text:dayjs(t).format("HH : mm"),sta:0,typ:1})},gridline:function(t){var e=function(e,n){var o=P.findObject(e);o.geometryString="M0 0 V"+(1==t?"765":"10"),o.strokeWidth=n};e("l1",0==t?1:.2),e("l2",0==t?1.5:.2)},doZoom:function(n){var o=parseFloat(n-e[2]),i=t,a=r.commandHandler.zoomFactor;r.scale=i*Math.pow(a,o)},showMagnifier:function(){var t=r.findNodeForKey(0);r.remove(t)},testCommit:function(){r.remove(P),P=_("#4d4d4d"),r.add(P),M()}}};this.editoR=function(t,i){var a,d,l='<div class="edit-time-diag-tbar nutlenh-diag" style="right:10px"><div class="btn-group zoomctrl mr-4"><button act="z-" class="btn btn-outline-danger btn-sm"><i class="ti-minus"></i></button><div class="d-flex mr-1 ml-1 position-relative"><input class="levelSlider  align-self-center" type="range" min="'+e[0]+'" max="'+e[1]+'" value="'+e[2]+'"  style="padding: 0px 0px 0px 0px" /><div class="range-value"><span>100%</span></div></div><button act="z+" class="btn btn-outline-success btn-sm"><i class="ti-plus"></i></button></div><div class="btn-group mr-2"><button class="btn btn-secondary btn-sm"><i class="fa fa-undo"></i></button><button class="btn btn-success btn-sm"><i class="ti-save"></i></button></div><div class="btn-group mr-2"><button class="btn btn-danger btn-sm"><i class="fa fa-eraser"></i></button></div><div class="btn-group non-float"><div class="btn-group mr-3 closepanel"><button act="hidediag" class="btn btn-danger btn-sm" style="padding: 0px 3px;"><i class="ti-close"></i></button></div><div class="btn-group floatwindow"><button act="floatdiag" class="btn btn-secondary btn-sm" style="padding: 0px 3px"><i class="ti-new-window"></i></button></div></div></div><div class="edit-time-diag-tbar keypad" style="width:100px;left:10px"><div class="btn-group mr-2"><button class="btn btn-warning btn-sm invisible"><i  class="fa fa-long-arrow-left"></i></button><button act="keyU" class="btn btn-secondary btn-sm upkeypad" style="width:26px"><i class="fa fa-long-arrow-up"></i></button><button class="btn btn-secondary btn-sm invisible"></button></div><div class="btn-group mr-2" role="group" aria-label="Second group"><button act="keyL" class="btn btn-secondary btn-sm"><i  class="fa fa-long-arrow-left"></i></button><button act="keyD" class="btn btn-secondary btn-sm" style="width:26px"><i  class="fa fa-long-arrow-down"></i></button><button act="keyR" class="btn btn-secondary btn-sm"><i class="fa fa-long-arrow-right"></i></button></div></div>',g=$('<div class="edit-log"><i class="dx-icon dx-icon-check btnOK okact"></i><i class="ti-help btnOK helpact" style="right:20px;color:#ffc107;font-size:smaller"></i><i class="dx-icon dx-icon-close  btnOK closeact" style="right:0px;color:#dc3545"></i><div class="text-small pl-1 pr-4 pb-1 text-center font-italic dx-datagrid-headers" style="z-index:-1">Press enter to edit</div><div class="edit-time"></div><div class="edit-log-diag"></div></div>'),p={},f=[1e3,null,-1,-1],h=["",""],m=[0,-1],v=-1,w=-1,y=i[0].getBoundingClientRect(),k=-1,x=!0,b=function(){var t=n.step3_utils.edit_time;t.trapValueChanged=setTimeout(function(){var e=n.step3_rst_grid,o=n.step3_utils.editPO.atTD;void 0!==t.bkValIgnore&&e.cellValue(o[0],o[1],t.bkValIgnore),S(e,o[0],o[3])},50)},S=function(t,e,o){n.step3_utils.ignoreFocusedCellChanging=function(){n.step3_utils.ignoreFocusedCellChanging=null};var i=t.getCellElement(e,o);return t.focus(i),i},_=function(t,e){var o=function(){var t=n.step3_utils.editPO.atTD;return S(n.step3_rst_grid,t[0],t[3])};if(null==t)return o();setTimeout(function(){var t=o();e&&"function"==typeof e&&e(t)},t)},P=function(){x=!1,n.step3_utils.editPO.hide(),_(10)},T=function(){if(clearTimeout(v),v=-1,"down"==h[1]){var t=n.step3_utils.editPO._$popupContent,e=t[0].getBoundingClientRect(),o=y.width>f[0]?f[0]:y.width,i=f[1]||o/2-e.width/2,r=y.left+y.width,s=e.left-i,d=!0;s+o>r?i+=s+o-r:s>y.left?f[1]&&(d=f[0]!=o):i-=y.left-s,f[0]==o&&f[1]==i||!d||(c[0]=t.find(".dx-texteditor-input")[0].getBoundingClientRect(),a.css("width",o).animate({left:-1*i},50,function(){c[1]=this.getBoundingClientRect()})),f[0]=o,f[1]=i}},M=function(t,e){var o=n.step3_utils.editPO._$popupContent.find("div[class^='edit-log-diag']"),i=c[0],a=c[1];if(console.log("w:"+o.width()+" ;h:"+o.height()),t._$popupContent.append(o),o.removeClass("edit-log-diag").addClass("edit-log-diag-float"),e){var r=a.left-a.width;r<0&&(r=0),r+" "+parseInt(i.top+i.height),n.floatDIAG.option("position.offset",{x:r,y:parseInt(i.top+i.height)})}else;t.show()},B=function(){var t=r.div,e=n.floatDIAG._$content.find(".dx-popup-content");console.log("wp: "+e.height()+" ; hp:"+e.height()),t.style.height=e.height()-2+"px",t.style.width=e.width()-2+"px",r.redraw()},C=function(){m[1]=1,B(),A()},A=function(t){if(0==n.step3_utils.editConfig.focusBack){var e=n.step3_utils.edit_time;if(e.focus(),t&&"dxdrag"==t.type){var o=e._$element.find(".dx-texteditor-input")[0],i=o.selectionStart<3?0:3;o.setSelectionRange(i,2)}}else _()},D=function(t){t.off("scroll").on("scroll",function(t){if(this.scrollTop>0){var e=n.step3_utils.editPO.fuckMN_Shown;1==e&&(n.step3_utils.editPO.fuckMN.fuckMN_CancelHiding=function(t){t.cancel=!0}),this.scrollTop=0,1==e&&setTimeout(function(){n.step3_utils.editPO.fuckMN.fuckMN_CancelHiding=null},50)}})},L=function(){if(n.floatDIAG)M(n.floatDIAG,!1);else{var t=i.parent(),e=c[1],o=$("<div/>").appendTo(t).dxPopup({width:e.width+2,height:e.height+36+2,container:app_container.closest("#app"),showTitle:!0,visible:!1,dragEnabled:!0,resizeEnabled:!0,shading:!1,closeOnOutsideClick:!1,showCloseButton:!0,onContentReady:function(t){var e=t.component._$popupContent;e.css({padding:0,margin:0}),e.prev().css({padding:"0 15px",height:"36px"}).addClass("edit-log-diag-float-header");var o=null,i=t.component._$content;i.hasClass("floatDIAG-hackkeydown")||(i.on("click",function(t){N(0)}),i.find(".dx-toolbar").on("dxdrag.dxPopup",function(t){clearTimeout(o),o=setTimeout(function(){A(t)},200)}),D(i),i.find(".dx-closebutton").data("dxButton").option("onClick",function(t){var e;n.floatDIAG._onHiddenHwnd=function(t){n.floatDIAG._onHiddenHwnd=null,m[1]=0;var o=t.component._$popupContent.find("div[class^='edit-log-diag']");o.removeClass("edit-log-diag-float").addClass("edit-log-diag"),o.css({width:1e3,height:400}),console.log("w:"+o.width()+" ;h:"+o.height()),n.step3_utils.editPO._$popupContent.append(o),r.redraw(),T(),e&&"function"==typeof e&&e()},n.floatDIAG.hide()}),i.addClass("floatDIAG-hackkeydown"))},onShowing:function(t){t.component._tmpscrollPos=$(window).scrollTop()},onShown:function(t){$(window).scrollTop(t.component._tmpscrollPos),C()},onHiding:function(t){n.floatDIAG.$puInfo=[this.content().parent().css("transform"),this.option("width"),this.option("height")]},onHidden:function(t){var e=t.component._onHiddenHwnd;e&&"function"==typeof e&&e(t)},onResizeEnd:function(t){N(0),B()},position:{my:"top left",at:"top left",of:document}}).dxPopup("instance");n.floatDIAG=o,M(n.floatDIAG,!0)}},O=-1,N=function(t){clearTimeout(O),O=setTimeout(function(){0==n.step3_utils.editConfig.focusBack?n.step3_utils.edit_time.focus():_(t)},void 0!==t?t:100)},I=function(t){"chevronup"==t.option("icon")?(h=["In","down"],n.step3_utils.edit_time.close()):h=["Out","up"],r?1===m[1]?(m[1]=2,n.floatDIAG.hide()):2===m[1]?!0!==n.floatDIAG._currentVisible?n.floatDIAG.show():C():(T(),a["fade"+h[0]]("fast",function(){c[1]=this.getBoundingClientRect()})):(srclocked(!0),setTimeout(function(){_gsC(srcpf$+"/media/vendor/GoJS/release/gojstrial.js","js",function(){a=n.step3_utils.editPO._$popupContent.find(".edit-log-diag"),T(),a["fade"+h[0]]("fast",function(){c[1]=this.getBoundingClientRect(),F(this),srclocked(!1)}),D(a)},"gojs.js")})),t.option("icon","chevron"+h[1]),N()},H=function(t){if(n.step3_utils.editPO){clearTimeout(n.step3_utils.editPO.fuckSZ_timeoutFocus);var e=n.step3_rst_grid,o=n.step3_utils.editPO.atTD,i=S(e,o[0],o[3]);-1==[13,27].indexOf(t)&&setTimeout(function(){i.trigger($.Event("keydown",{which:t,code:t}))},10)}},R=function(t,e){var a=function(){toastMsg("Thay doi xong","success",100)};switch(t.id){case"resetconfig":devDlg(4,"Vui long xac nhan truoc khi khoi phuc cai dat goc").show().done(function(t){1==t||N(0)});break;case"diagsize":var r=n.step3_utils.editPO.fuckMN;r.fuckSZ||(r.fuckSZ=o[4]("exPopUp",{kind:1,el:i.closest(".kiem-the"),showat:e,fn:{onHidden:function(t){},onHiding:function(t){N()},save:o[4]("saveDB")}})),r.fuckSZ.show();break;case"gridline":d.gridline(t.val),a();break;case"keypad":case"zoomctrl":case"closepanel":case"floatwindow":e[(0==t.val?"add":"remove")+"Class"](t.id+"-0"),a()}},E=-1,G=function(t){var e=1===t.fuckMN_Shown,n=1===t.fuckSZ_Shown;return e&&t.fuckMN.hide(),n&&t.fuckMN.fuckSZ.hide(),[e,n]},F=function(t){(d=u(t)).attLogNode(),n.s3editdiag_scroPerf=new PerfectScrollbar($(t).children("div")[0],{}),$(t).append(l);var o=function(t,n){var o=100,i=t.nextSibling;t.value<=e[2]?o-=5*(e[2]-t.value):o+=5*(t.value-e[2]),i.innerHTML="<span>"+o+" %</span>";var a=Number(100*(t.value-t.min)/(t.max-t.min)),r=10-.2*a;i.style.left="calc("+a+"% + "+r+"px)",n&&d.doZoom(t.value)};(s=$(t).find(".levelSlider")).on(11==GetIEVersion()?"change":"input",function(){var t=this,e=s.closest(".btn-group").find('.btn[act^="z"]');t.value==t.min?($(e[0]).prop("disabled",!0),$(e[1]).removeAttr("disabled")):t.value==t.max?($(e[1]).prop("disabled",!0),$(e[0]).removeAttr("disabled")):($(e[0]).removeAttr("disabled"),$(e[1]).removeAttr("disabled")),o(t,!0)}),o(s[0],!1),$(t).off("click").on("click",function(t){G(n.step3_utils.editPO)[0]||"dx-texteditor-input"==t.target.className||N(100)}).find(".edit-time-diag-tbar .btn").off("click").on("click",function(t){var e,n,i=$(t.target),a=!1;if(i.hasClass(".btn")||(i=i.closest(".btn")),(e=i.closest(".btn-group")).hasClass("zoomctrl")){var r=s[0],c=parseInt(s.val());if("z-"==apisvr.a$.trim(i.attr("act"))){if(c<=r.min)return;n="+",a=--c<=r.min}else{if(c>=r.max)return;n="-",a=++c>=r.max}a&&i.prop("disabled",!0),e.find('.btn[act="z'+n+'"]').removeAttr("disabled"),r.value=c,o(r,!0)}else switch(apisvr.a$.trim(i.attr("act"))){case"floatdiag":L();break;case"hidediag":I(p.btnFloatDiag);break;case"keyL":H(37);break;case"keyU":H(38);break;case"keyR":H(39);break;case"keyD":H(40)}}),function(t){var e=function(t,e,n){var o=!t.cate||t.cate&&1===t.val,i=$('<div class="d-flex popcontext-menu"></div>'),a=$('<span class="'+(o&&t.icon||"")+' mr-2"><span>');return i.append(a),t.cate&&(this._$cate=this._$cate||{},this._$cate[t.id]=a),i.append(t.text),t.items&&i.append('<span class="dx-icon-spinright spansub"><span>'),i},o=function(t,n,o){return{cate:"chk",id:t,val:n,text:o,icon:"ti-check",template:e,closeMenuOnClick:!1,selectable:!0}},a=$("<div/>").appendTo(i.closest(".kiem-the")).dxContextMenu({width:200,selectByClick:!0,target:$(t).find("canvas"),closeOnOutsideClick:!0,onShowing:function(t){M0Evt({causeby:"devpop"},1,1),setTimeout(function(){clearTimeout(E),E=-1,clearTimeout(n.step3_utils.editPO.fuckSZ_timeoutFocus)},1)},onShown:function(t){n.step3_utils.editPO.fuckMN_Shown=1;var e=t.component._overlay._$content;e.parent().hasClass("hackkeydown-contextmenu")||(e.on("keydown",function(t){var e=t.which?t.which:t.keyCode,n=function(){t.stopPropagation(),a.hide()};13==e?0==$(t.target).find(".dx-item.dx-state-focused").length?n():t.stopPropagation():39==e?a._getKeyByIndex(a._getActiveItem().data("dxItemIndex")).length||n():[9,27,37].indexOf(e)>-1&&n()}),e.parent().addClass("hackkeydown-contextmenu"))},onHiding:function(t){t.component.fuckMN_CancelHiding&&"function"==typeof t.component.fuckMN_CancelHiding?t.component.fuckMN_CancelHiding(t):n.step3_utils.editPO.fuckMN_Shown=0},onHidden:function(t){t.component.repaint(),E=-9999999999!=E?setTimeout(function(){clearTimeout(E),-1!=E&&N(0),E=-1},100):-1},items:[{text:"Lua chon An / hien",icon:"ti-eye",template:e,items:[o("keypad",1,"Show Arrow Keypad"),o("zoomctrl",1,"Show zoom control"),o("closepanel",1,"Nut dong bieu do"),o("floatwindow",1,"Nut cua so moi"),$.extend({beginGroup:!0},o("gridline",1,"Show grid line"))]},{id:"diagsize",text:"Cai dat kich thuoc khung",icon:"ti-ruler-alt",template:e},{id:"resetconfig",text:"Khoi phuc cai dat goc",icon:"fa fa-wrench",beginGroup:!0,template:e}],onItemClick:function(e){if(e.itemData.items)e.component.focus();else{var n=a._$cate&&a._$cate[e.itemData.id];if(!n)return setTimeout(function(){clearTimeout(E),E=-9999999999},1),void R(e.itemData,$(t));setTimeout(function(){var o=1;1==e.itemData.val&&(o=0),e.itemData.val=o,n[(1==o?"add":"remove")+"Class"](e.itemData.icon),R(e.itemData,$(t)),e.component.focus()},10)}}}).dxContextMenu("instance");n.step3_utils.editPO.fuckMN=a}(t)};i.parent().append(g),n.step3_utils.edit_time=g.find(".edit-time").dxDateBox({type:"datetime",displayFormat:"HH:mm",showClearButton:!0,selectionMode:"single",useMaskBehavior:!0,value:new Date,onKeyDown:function(t){if(t.event.stopPropagation(),13==t.event.keyCode){x=!0;var e=(n=t.event.target,o=0,i=0,"number"==typeof n.selectionStart&&"number"==typeof n.selectionEnd&&(o=n.selectionStart,i=n.selectionEnd),{s:o,e:i});(e.s==e.e||3==e.s&&5==e.e)&&b()}else 27==t.event.keyCode&&P();var n,o,i},onValueChanged:function(t){if(clearTimeout(t.component.trapValueChanged),x){t.component.bkValIgnore=void 0;var e=n.step3_rst_grid,o=t.value,i=n.step3_utils.editPO.atTD;e.cellValue(i[0],i[1],o),setTimeout(function(){S(e,i[0],i[3])},10),"down"==h[1]&&d.addCusLog(o)}else t.component.bkValIgnore=t.value},buttons:[{name:"clear",location:"before",widget:"dxButton",options:{icon:"clear",stylingMode:"text",onClick:function(t){}}},"dropDown",{name:"dxDropDownButton",widget:"dxButton",location:"after",options:{icon:"chevronup",stylingMode:"text",onClick:function(t){I(t.component),M0Evt({causeby:"devclick"},1,1)},onContentReady:function(t){p.btnFloatDiag=t.component}}}],onContentReady:function(t){var e=t.component;e._clearValueHandler=function(t){x=!1,e.option("value",null),x=!0}}}).dxDateBox("instance"),n.step3_utils.editPO=g.dxPopover({container:i,showEvent:"dxclick",width:180,onHiding:function(t){t.component.cancelHidding&&"function"==typeof t.component.cancelHidding&&t.component.cancelHidding(t),t.cancel||1===m[1]&&1!==t.component._isflash&&(m[1]=2,n.floatDIAG.hide())},onHidden:function(t){m[0]=0},onShown:function(t){x=!0,m[0]=1},onShowing:function(t){x=!1,clearTimeout(v),clearTimeout(w),clearTimeout(k);var e=n.step3_utils.editPO.atTD;n.step3_utils.edit_time.option("value",e[2]),c[2]=e[2],"down"==h[1]&&(f[2]!=e[3]&&(v=setTimeout(T,500),f[2]=e[3]),f[3]!=e[0]&&(w=setTimeout(d.attLogNode,500),f[3]=e[0]),2===m[1]&&(!0!==n.floatDIAG._currentVisible?n.floatDIAG.show():C())),k=setTimeout(function(){k=-1},200)},closeOnOutsideClick:!1,closeOnTargetScroll:function(){return n.step3_utils.editPO.repaint(),!0},onContentReady:function(t){t.component._$popupContent.find(".btnOK").off("click").on("click",function(t){$(t.target).hasClass("okact")?b():$(t.target).hasClass("closeact")&&P()})}}).dxPopover("instance"),n.step3_rst_grid.getScrollable().option("onScroll",function(t,e){-1===k&&(k=-2,n.step3_utils.editPO.hide())}),n.globHWN.sliderbar=function(t,e){W(),f[2]=-1,y=i[0].getBoundingClientRect()},n.globHWN.theme=function(t,e){r&&d.alterTheme()},app_container.closest("#app").on("sidebar",n.globHWN.sliderbar).on("theme",n.globHWN.theme),$(window).on("resize",n.globHWN.sliderbar);var z=function(t){1===m[0]?(t.preventDefault(),t.stopPropagation(),27==t.which?n.step3_utils.editPO.hide():[13,37,38,39,40].indexOf(t.which)>=0?H(t.which?t.which:t.keyCode):n.step3_utils.edit_time.focus()):[13,37,38,39,40].indexOf(t.which)>=0&&(t.preventDefault(),t.stopPropagation(),n.step3_rst_grid.focus(),H(t.which?t.which:t.keyCode))},V=function(t,e){$(document)[1==e.state?"on":"off"]("keydown",z),null!=t&&0==e.state&&W()},W=function(){G(n.step3_utils.editPO),1===m[0]&&n.step3_utils.editPO.hide()};V(null,{state:1}),o[0].on("onActived",V).on("onShowStep",function(t,e,n,o){3==n.fromStep?(W(),V(null,{state:0})):3==n.toStep&&V(null,{state:1})}),i.find(".grid-stt").on("click",".dx-datagrid-rowsview table td:first-child",function(t){var e,n,o,i,a,r;if((e=t,n=this.getBoundingClientRect(),o=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,i=document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft,a=n.left+i,r=n.top+o,{x:e.pageX-a,y:e.pageY-r}).x<22);})}}return n.prototype.publicSharedVar="quux",n.prototype.publicSharedMethod=function(t){},n}();