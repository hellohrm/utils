var s3logedit=function(){var t,e=1,o=6e4,n=60*o,i=[-2,15,10,10],a=$("body").hasClass("part_fullscreen"),r=null,s=8,l=9,d=function(t){var e=t%2,o=Math.floor(t/2);return e>0?(t+e)/2:o},c=function(t,e){var o=new Date(t).setHours(0,0,0,0),i=new Date(e).setHours(0,0,0,0);return parseInt((i-o)/(24*n),10)+1};function u(u,g,f,p){"use strict";var h,m,v=-1,_=50,y=[],w=40,k="-20",x=function(t){var e=new Date(t||y[2].getTime()),i=new Date(new Date(e).setHours(0,0,0,0)).getTime(),a=Math.floor((e.getTime()-i)/o),r=y[0].left+y[0].width/2;return[y[1].left+a-r,a,i/n]},b=function(a){function f(){go.Link.call(this),this.isLayoutPositioned=!1,this.isTreeLink=!1,this.routing=go.Link.Orthogonal,this._direction=0,this._extension=30,this._inset=10,this._gap=10}go.Diagram.inherit(f,go.Link),f.prototype.cloneProtected=function(t){go.Link.prototype.cloneProtected.call(this,t),t._direction=this._direction,t._extension=this._extension,t._inset=this._inset,t._gap=this._gap},Object.defineProperty(f.prototype,"direction",{get:function(){return this._direction},set:function(t){if(!isNaN(t)&&0!==t&&90!==t&&180!==t&&270!==t)throw new Error("DimensioningLink: invalid new direction: "+t);this._direction=t}}),Object.defineProperty(f.prototype,"extension",{get:function(){return this._extension},set:function(t){this._extension=t}}),Object.defineProperty(f.prototype,"inset",{get:function(){return this._inset},set:function(t){if(!(t>=0))throw new Error("DimensioningLink: invalid new inset: "+t);this._inset=t}}),Object.defineProperty(f.prototype,"gap",{get:function(){return this._gap},set:function(t){if(!(t>=0))throw new Error("DimensioningLink: invalid new gap: "+t);this._gap=t}}),f.prototype.computePoints=function(){var t=this.fromNode;if(!t)return!1;var e=this.fromPort,o=this.computeSpot(!0),n=this.toNode;if(!n)return!1;var i=this.toPort,a=this.computeSpot(!1),r=this.getLinkPoint(t,e,o,!0,!0,n,i);if(!r.isReal())return!1;var s=this.getLinkPoint(n,i,a,!1,!0,t,e);if(!s.isReal())return!1;this.clearPoints();var l=this.direction;if(isNaN(l)){l=r.directionPoint(s);var d=new go.Point(this.extension,0);d.rotate(l+90);var c=new go.Point(this.extension-this.inset,0);c.rotate(l+90);var u=new go.Point(this.gap,0);u.rotate(l+90),this.addPointAt(r.x+u.x,r.y+u.y),this.addPointAt(r.x+d.x,r.y+d.y),this.addPointAt(r.x+c.x,r.y+c.y),this.addPointAt(s.x+c.x,s.y+c.y),this.addPointAt(s.x+d.x,s.y+d.y),this.addPointAt(s.x+u.x,s.y+u.y)}else{this.extension;var g=0,f=0,p=0,h=0;0===l||180===l?(0===l?(f=(g=Math.min(r.y,s.y)-this.extension)+this.inset,p=r.y-this.gap,h=s.y-this.gap):(f=(g=Math.max(r.y,s.y)+this.extension)-this.inset,p=r.y+this.gap,h=s.y+this.gap),this.addPointAt(r.x,p),this.addPointAt(r.x+.01,g),this.addPointAt(r.x,f),this.addPointAt(s.x,f),this.addPointAt(s.x-.01,g),this.addPointAt(s.x,h)):90!==l&&270!==l||(90===l?(f=(g=Math.max(r.x,s.x)+this.extension)-this.inset,p=r.x+this.gap,h=s.x+this.gap):(f=(g=Math.min(r.x,s.x)-this.extension)+this.inset,p=r.x-this.gap,h=s.x-this.gap),this.addPointAt(p,r.y),this.addPointAt(g,r.y+.01),this.addPointAt(f,r.y),this.addPointAt(f,s.y),this.addPointAt(g,s.y-.01),this.addPointAt(h,s.y))}return this.updateTargetBindings(),!0};var p=go.GraphObject.make,m=(new Date(2016,4,17,0,0,0,0),60),b=24,T=m*b;h=p(go.Diagram,a,{fixedBounds:new go.Rect(y[2]&&x()[0]||0,0-w+100,y[1].width-2,y[1].height-2),"animationManager.isEnabled":!1,"contextMenuTool.defaultTouchContextMenu":null,"toolManager.mouseWheelBehavior":go.ToolManager.WheelNone,padding:0,contentAlignment:go.Spot.TopLeft,initialDocumentSpot:go.Spot.TopLeft,initialViewportSpot:go.Spot.TopLeft,PartResized:function(t){t.subject},SelectionMoved:function(t){},ChangingSelection:function(t){}});var S=function(t,e,o,n){!function(t,e,o,n){t.elements.each(function(i){var a=function(e){if(e.name&&D[e.name]&&D[e.name][o]){var i=D[e.name][o][cS$.c0lor](t.data,n);e.fill&&(e.fill=i),e.stroke&&(e.stroke=i)}};i instanceof go.Panel?i.elements.each(function(n){a(n),e&&"symSEL"==n.name&&(0==t.part.data.sta&&(n.text="sel"==o?"":""),n.font=("sel"==o?"24":"14")+"px FontAwesome")}):a(i)})}(t,e,o,n)},D={logBODY:{nor:{dark:function(t,e){return 1==t.typ?1==t.sta?"fuchsia":"blue":0==t.sta?"gray":"#000"},light:function(t,e){return 1==t.typ?1==t.sta?"fuchsia":"blue":0==t.sta?"#EC7063":"#4A235A"}},sel:{dark:function(t,e){return 1==t.typ?"clkn"==e&&1==t.typ?1==t.sta?"fuchsia":"blue":"#00ff2b":0==t.sta?"gray":"#000"},light:function(t,e){return 1==t.typ?"clkn"==e&&1==t.typ?1==t.sta?"fuchsia":"blue":"#00ff2b":(t.sta,"red")}},dis:{},hov:{},acti:{}},logHOUR:{nor:{dark:function(t){return t.typ,"#fff"},light:function(t){return t.typ,"#000"}},sel:{dark:function(t){return t.typ,"#00ff2b"},light:function(t){return t.typ,"#00ff2b"}},dis:{},hov:{},acti:{}},symSEL:{nor:{dark:function(t){return t.typ,"cyan"},light:function(t){return t.typ,"cyan"}},sel:{dark:function(t){return t.typ,"#00ff2b"},light:function(t){return t.typ,"#00ff2b"}},dis:{},hov:{},acti:{}}},C=function(t,e){S(e,!0,"sel","me")},P=function(t,e){S(e,!0,L(e),"ml")},L=function(t){return U.contains(t)?"sel":"nor"},O=function(t,e){var i,a=0,r=function(){a=new Date(o*(e.x-T)+t.nga*n),t.lg=a,h.model.setDataProperty(t,"text",DevExpress.localization.date.format(a,"HH : mm")),clearTimeout(v),0!=t.sta&&(v=setTimeout(function(){clearTimeout(v),v=-1,g[0].trigger("DIAG",["3","U",[$.extend(!0,{},t),a]]),console.log("dragMOV_CUS_LOG_HWND")},300))};if(0!=t.sta){var s,l,d,c=t._nodeP;c&&("string"==typeof c&&(t._nodeP=h.findNodeForKey(c),c=t._nodeP),c&&((s=c.data.pt)[s[2]==t.idx?0:(a=1,1)]=e.x,i=s[1]-s[0],a=i<0?0==a?s[1]:e.x:0==a?e.x:s[0],l=a,(d=c.location.copy()).x=l,c.location=d,c.width=Math.abs(i),c.data._exa[0]=i<0?"-":"",r()))}else r()},A=function(t){return p(go.Node,"Spot",{layerName:1==t?"APPEL":"ORIGL",movable:1==t,copyable:!1,avoidable:!0,minLocation:new go.Point(-1/0,NaN),maxLocation:new go.Point(1/0,NaN),selectionAdorned:!1,locationSpot:go.Spot.Top,dragComputation:function(t,e,o){var n=Math.floor(e.x),i=Y[3];return n<i.x?n=i.x:n>i.x+i.width&&(n=i.x+i.width),e.x=n,O(t.data,e),new go.Point(e.x,e.y)},mouseEnter:C,mouseLeave:P},p(go.Shape,{name:"logBODY",alignment:go.Spot.Bottom,cursor:1==t?"w-resize":"default",strokeWidth:.3,portId:"A",fromSpot:new go.Spot(0,1,0,-25),toSpot:new go.Spot(1,1,0,-25),fromEndSegmentLength:50,toEndSegmentLength:50,click:function(t,e){var o=e.part.data;Y[1].data.to!=o.key&&g[0].trigger("DIAG",["1",o])}},new go.Binding("geometryString","",function(t){return 1==t.typ?"F M5 40 L0 50 L0 60 L10 60 L10 50 L5 40 L5 10 L0 15 L5 0 L10 15 L5 10z":"F M5 50 L0 50 L0 60 L10 60 L10 50 L5 50 L5 10 L0 15 L5 0 L10 15 L5 10z"}),new go.Binding("stroke","stroke",function(t,e){return D.logBODY[L(e.part)][cS$.c0lor](e.part.data,"bi")})),p(go.TextBlock,{cursor:"pointer",alignment:go.Spot.Top,alignmentFocus:new go.Spot(0,0,0,10),margin:0,stroke:"cyan",font:"10px FontAwesome",editable:!1,isMultiline:!1,text:"",click:function(t,e){alert("here")}}),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("fill","isSelected",function(t,e){t?(U.each(function(t){S(t,!0,"nor","selr")}),(U=new go.Set).add(e)):U.remove(e),S(e,!0,t?"sel":"nor","sels")}).ofObject(),p(go.Panel,"Table",{name:"timTB",alignment:go.Spot.Bottom,alignmentFocus:go.Spot.Top,defaultSeparatorPadding:0},p(go.TextBlock,{name:"symSEL",desiredSize:new go.Size(20,25),row:0,column:0,alignment:new go.Spot(.5,.5),margin:0,textAlign:"center",verticalAlignment:go.Spot.Center,cursor:"pointer",font:"14px FontAwesome",editable:!1,isMultiline:!1,click:E.click_tickICO,portId:"R00",fromSpot:go.Spot.Bottom,toSpot:new go.Spot(.5,0,0,-10)},new go.Binding("text","sta",function(t){if(1==t)return""}),new go.Binding("stroke","stroke",function(t,e){return D.symSEL[L(e.part)][cS$.c0lor](e.part.data,"bi")})),p(go.TextBlock,{name:"logHOUR",alignment:new go.Spot(.5,0,1,0),row:1,column:0,margin:0,font:'100 9pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif',angle:270},new go.Binding("text"),new go.Binding("stroke","stroke",function(t,e){return D.logHOUR[L(e.part)][cS$.c0lor](e.part.data,"bi")}))))},E={0:function(t,e,o,n){var i,a=t[0],r=a%2>0?[a,a+1]:[a-1,a],s=a==r[0]?r[1]:r[0];if(h.findNodesByExample({idx:new RegExp(s,"i")}).each(function(t){1==t.data.sta&&(i=t)}),i&&o){var l,d=$.extend(!0,[],o.data.pt),c=0;a==r[0]?(d[0]=t[1],d[1]=i.location.x,d[2]=a,d[3]=s):(d[1]=t[1],d[0]=i.location.x,d[2]=s,d[3]=a),l=(c=d[1]-d[0])<0?0==a?d[0]:d[1]:d[0],o.data._exa[0]=c<0?"-":"",c=Math.abs(c),o.data=$.extend(o.data,{pt:d,width:c}),o.visible=!0,o.width=c;var u=o.location.copy();u.x=l,o.location=u}return!0},1:function(t,e,o,n,i){return o&&(o.visible=!1),!(i||E.clear_clg(e,n))},clear_clg:function(t,e){var o=!1,n=h.findPartsAt(e,!1);return n.count>1&&n.each(function(e,n){1==e.data.typ&&(o=!0,t.removeNodeData(e.data))}),o},click_tickICO:function(e,i,a){var l,c,f,p,m,v=i.part,_=v.data,y=_.sta,w=_.key,k=_.idx,x="P"+d(k)+"|fio"+k+"|noi"+k+"|clg"+k,b=[],D=0,C=Y[1].toNode,P=(c=u.step3_utils.editPO.atTD,f=c[0],p=Number(c[1].split("fio")[1]),function(t){srclocked(!0),setTimeout(function(){g[0].trigger("DIAG",t)},10)});C&&C.data.idx==k||k==p?function(){0===y&&(D=1);!function(){if(e){var t=v.location.x,i=new Date(o*(t-T)+_.nga*n),a=["2",1===D?"U":"R"];if(1===D)if(1==_.typ)a[2]=adapV(i,"1"),a[2].push(i);else{if(_.idx>s)return;a[2]=[i,i]}else 1==_.typ?(a[1]="U",a[2]=[null,null],w=""):(a[2]=adapV(i,"0"),a[2].push(i));P(a)}}();h.findNodesByExample({key:new RegExp(x,"i")}).each(function(t){"nodehieu"==t.data.category?l=t:t.data.key!=v.data.key&&b.push(t)}),h.model.commit(function(t){b.forEach(function(e,o){t.setDataProperty(e.data,"sta",0),S(e,!0,"nor","ml")}),l||(l=E._addProgresP(t,k,v.location.x,v));var e=!1,o=!1;a&&"function"==typeof a&&(e=!0,o=!0),E[y.toString()]([k,v.location.x],t,l,v.location,e)&&(t.setDataProperty(_,"sta",D),0==D?i.text="":C&&C.data&&1==C.data.typ&&C.key!==v.key&&E.clear_clg(t,C.location),S(v,!0,"sel","clkn")),o?a(t):J([w])},"click_tickICO")}():k<=2*t[1]?(m="fio"+k,srclocked(!0),setTimeout(function(){var t=u.step3_rst_grid,e=t.getCellElement(f,m);r=function(){r=null,srclocked(!1)},t.focus(e)},10)):function(){E._ddCusLog(_.lg,1);var t=["2","U"];t[2]=adapV(_.lg,"1"),t[2].push(_.lg),P(t)}()},_addProgresP:function(t,e,o,n){var i=[o,o,e,e],a="P"+u.commonFn.lgIdx_2_IOidx(e),r=E._nodeP(a,0,i);return t.addNodeData(r),n._nodeP=h.findNodeForData(r),n._nodeP},_ddCusLog:function(t,e){var o,n,i=[],a=u.step3_utils.editPO.atTD,r=Number(a[1].split("fio")[1]),s="clg"+r,l=new RegExp("P"+d(r)+"|fio"+r+"|noi"+r+"|"+s,"i");h.findNodesByExample({key:l}).each(function(t){"nodehieu"==t.data.category?n=t:t.data.key==s?o=t:i.push(t)}),h.model.commit(function(l){if(i.forEach(function(t,e){l.setDataProperty(t.data,"sta",0),S(t,!0,"nor","ml")}),"1"==e){var d,u=c(a[4].ngay,t),g=x(t),f=u*T+g[1];o?(d=o.data,l.setDataProperty(d,"loc",f+" "+k),l.setDataProperty(d,"text",DevExpress.localization.date.format(t,"HH : mm")),l.setDataProperty(d,"sta",1),h.select(o)):(d=E._calcNOD(r,s,t,f,1,1,g[2]),l.addNodeData(d)),d.lg=t,n||(n=E._addProgresP(l,r,f,d)),E[0]([r,f],l,n),d._nodeP=n,J([s])}},"CUSTOM_LOG")},_calcNOD:function(t,e,o,n,i,a,r){return{key:e,loc:n+" "+k,color:0==i?"gray":"cyan",text:DevExpress.localization.date.format(o,"HH : mm"),lg:o,sta:a,typ:i,category:0==i?"ORGI_LOG":"",idx:t,nga:r}},_nodeP:function(t,e,o){return{key:t,text:"",color:"gray",loc:o[e>0?0:1]+" 30",width:Math.abs(e),category:"nodehieu",zOrder:0,visible:Math.abs(e)>0,pt:o,_exa:[e>0?"":"-"]}}};h.nodeTemplate=A(1),h.nodeTemplateMap.add("ORGI_LOG",A(0)),h.nodeTemplateMap.add("Center",p(go.Node,"Spot",{zOrder:100,layerName:"DURAT",selectable:!1,movable:!1},new go.Binding("location","loc",go.Point.parse),p(go.Shape,"Circle",{name:"SHAPE",fill:"#00ff2b",strokeWidth:0,portId:"R00",fromSpot:go.Spot.Bottom},new go.Binding("desiredSize","size",go.Size.parse).makeTwoWay(go.Size.stringify)))),h.nodeTemplateMap.add("nodehieu",p(go.Node,"Auto",{zOrder:99,layerName:"DURAT",fromSpot:go.Spot.Bottom,toSpot:new go.Spot(.99999,0,0,0),movable:!1,copyable:!1,avoidable:!0,minLocation:new go.Point(-1/0,NaN),maxLocation:new go.Point(1/0,NaN)},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("width","width").makeTwoWay(),new go.Binding("visible","visible").makeTwoWay(),p(go.Shape,{strokeWidth:0,fill:"lightgray",height:8},new go.Binding("fill","",function(t,e){return"green"})),p(go.TextBlock,{margin:0},new go.Binding("text","text")))),h.nodeTemplateMap.add("shiftinfo",p(go.Node,"Auto",new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),p(go.Shape,{fill:"transparent",stroke:"#17a2b8",strokeWidth:.2}),p(go.Panel,"Table",{defaultRowSeparatorStrokeWidth:.2,defaultRowSeparatorStroke:"#17a2b8",defaultColumnSeparatorStroke:"#17a2b8",defaultColumnSeparatorStrokeWidth:.2,defaultAlignment:go.Spot.Right},p(go.TextBlock,"Gia tri",{row:0,column:1,font:"bold 10pt sans-serif",margin:2,stroke:"lime",portId:"PC1",fromSpot:go.Spot.Top,toSpot:go.Spot.Top}),p(go.TextBlock,"DVT",{row:0,column:2,font:"bold 10pt sans-serif",margin:2,stroke:"lime",portId:"PC2",fromSpot:go.Spot.Top,toSpot:go.Spot.Top}),p(go.TextBlock,"(1) Tong thoi gian tinh bang Phut",{row:1,column:0,stroke:"gray",margin:2,font:'100 8pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'}),p(go.TextBlock,"1400",{row:1,column:1,margin:2,stroke:"lime"}),p(go.TextBlock,"(2) Quy doi sang gio Gio ((1)/60)",{row:2,column:0,stroke:"gray",margin:2,font:'100 8pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'}),p(go.TextBlock,"row 2 col 2",{row:2,column:2,margin:2,stroke:"lime",font:'100 8pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'}),p(go.TextBlock,"Doi sang ngay (/8)",{row:3,column:0,stroke:"gray",margin:2,font:'100 8pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'}),p(go.TextBlock,"row 3 col 1",{row:3,column:1,margin:2,stroke:"lime",font:'100 12pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'}),p(go.TextBlock,"row 3 col 2",{row:3,column:2,margin:2,stroke:"lime",font:'100 8pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'}),p(go.TextBlock,"Tong thoi gian duoc tinh sau khi lam tron",{row:4,column:0,stroke:"gray",margin:2,font:'100 8pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'})))),h.linkTemplate=p(go.Link,{routing:go.Link.Normal},p(go.Shape,{stroke:"gray",strokeWidth:2}),p(go.Shape,new go.Binding("fromArrow","fromArrow"),{scale:2,fill:"#D4B52C"}),p(go.Shape,new go.Binding("toArrow","toArrow"),{scale:2,fill:"#D4B52C"}),{click:function(t,e){var o=M(e);if(o){var n=document.getElementById("myArrowheadInfo");n&&(n.textContent=o)}},toolTip:p("ToolTip",p(go.TextBlock,{margin:4},new go.Binding("text","",M).ofObject()))}),h.linkTemplateMap.add("rootLNK",p(go.Link,{zOrder:100,layerName:"DURAT",curve:go.Link.Bezier,toShortLength:7},new go.Binding("fromEndSegmentLength"),new go.Binding("toEndSegmentLength"),new go.Binding("visible","visible").makeTwoWay(),p(go.Shape,{stroke:"#00ff2b",strokeWidth:1}),p(go.Shape,{toArrow:"Standard",stroke:"#00ff2b",strokeWidth:1,fill:"#00ff2b"}))),h.linkTemplateMap.add("detailLNK",p(go.Link,{zOrder:100,layerName:"DURAT",toShortLength:7,corner:10,routing:go.Link.Orthogonal},new go.Binding("fromEndSegmentLength"),new go.Binding("toEndSegmentLength"),p(go.Shape,{stroke:"#00ff2b",strokeWidth:.5,strokeDashArray:[3,5]}),p(go.Shape,{toArrow:"Standard",stroke:"#00ff2b",fill:"#00ff2b",segmentOffset:new go.Point(-5,0)}))),h.linkTemplateMap.add("NEAR_LOG",p(go.Link,{zOrder:101,layerName:"DURAT",curve:go.Link.Bezier,toShortLength:7},p(go.Shape,{strokeWidth:1,stroke:"hotpink",strokeDashArray:[3,5]}),p(go.Shape,{toArrow:"standard",stroke:"hotpink",fill:"hotpink"}),p(go.Panel,"Auto",{segmentOffset:new go.Point(0,-10)},p(go.TextBlock,"transition",{textAlign:"center",font:"8pt helvetica, arial, sans-serif",stroke:"#d43f3a"},new go.Binding("text","text").makeTwoWay())))),h.linkTemplateMap.add("Dimensioning",p(f,{},new go.Binding("layerName","isHighlighted",function(t){return t?"Foreground":""}).ofObject(),new go.Binding("group","group"),new go.Binding("fromSpot","fromSpot",go.Spot.parse),new go.Binding("toSpot","toSpot",go.Spot.parse),new go.Binding("direction"),new go.Binding("extension"),new go.Binding("inset"),p(go.Shape,{stroke:"gray",strokeWidth:.2},new go.Binding("stroke","color"),new go.Binding("strokeDashArray","strokeDashArray")),p(go.TextBlock,{segmentIndex:2,segmentFraction:.5,segmentOrientation:go.Link.OrientUpright,alignmentFocus:go.Spot.Bottom,stroke:"gray",font:'100 10pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif'},new go.Binding("text","text",function(t,e){return console.log("showDistance(b.part)"),function(t){var e=t.pointsCount;if(e<2)return"";var o=t.getPoint(0),n=t.getPoint(e-1),i=t.direction;if(isNaN(i))return Math.floor(Math.sqrt(o.distanceSquaredPoint(n)))+"";var a=i*Math.PI/180,r=t.fromPort.data._exa[0];return t._arrowDIRECTION=r,r+Math.floor(Math.abs(Math.cos(a)*(o.x-n.x))+Math.abs(Math.sin(a)*(o.y-n.y)))}(e.part)}).makeTwoWay(),new go.Binding("stroke","color")),p(go.Shape,{fromArrow:"BackwardOpenTriangle",segmentIndex:2,stroke:"gray"},new go.Binding("stroke","color",function(t,e){e.visible="-"==e.part._arrowDIRECTION})),p(go.Shape,{toArrow:"OpenTriangle",segmentIndex:-3,stroke:"gray"},new go.Binding("stroke","color",function(t,e){e.visible="-"!=e.part._arrowDIRECTION}))));var B=go.Shape.getArrowheadGeometries().toKeySet().toArray();B.length%2==1&&B.push("");var N=new go.GraphLinksModel;function M(t){var e=t.part;e instanceof go.Adornment&&(e=e.adornedPart);var o="";if(e instanceof go.Link)o="toArrow: "+(n=e).data.toArrow+";\nfromArrow: "+n.data.fromArrow;else if(e instanceof go.Node){var n;o="toArrow: "+(n=e.linksConnected.first()).data.toArrow+";\nfromArrow: "+n.data.fromArrow}return o}N.linkToPortIdProperty="toPort",N.linkFromPortIdProperty="fromPort",N.linkLabelKeysProperty="labs",h.model=N;var I=p(go.Part,"Graduated",{layerName:"Grid",position:new go.Point(0,-30),graduatedTickUnit:m},p(go.Shape,{geometryString:"M0 0 H3600",stroke:"transparent"}),p(go.Shape,{geometryString:"M0 0 V700",interval:b,stroke:"red",strokeWidth:.3}),p(go.TextBlock,{font:"9pt sans-serif",stroke:"red",interval:b,alignmentFocus:new go.Spot(0,0,-2,-4),graduatedFunction:function(t){return"00:00 _LAN.js_gojs_2"}}));function R(t){t="#000";var e="#000";return"dark"==cS$.c0lor&&(t="#4d4d4d",e="#fff"),p(go.Part,"Graduated",{layerName:"Grid",position:new go.Point(0,0),graduatedTickUnit:m/2},p(go.Shape,{geometryString:"M0 30 H3600",stroke:t}),p(go.Shape,{name:"l1",geometryString:"M0 0 V765",stroke:t,strokeWidth:.2,strokeDashArray:[5,5]}),p(go.Shape,{name:"l2",geometryString:"M0 0 V765",stroke:t,strokeWidth:.2,interval:2}),p(go.TextBlock,{interval:2,font:'100 8pt "Helvetica Neue","Segoe UI",helvetica,verdana,sans-serif',stroke:e,segmentOffset:new go.Point(0,-15),graduatedFunction:function(t){return(t=t/m%b)<0&&(t+=b),0==Math.floor(t)?"":Math.floor(t).toString()+":00"}}))}var H=R("black"),V=p(go.Part,{pickable:!1,layerName:"Grid",visible:!0,position:new go.Point(0,0),isAnimated:!1,locationSpot:go.Spot.Top},p(go.Shape,{geometryString:"M0 5 V20",strokeWidth:2,stroke:"hotpink"})),W=function(){var t=h.viewportBounds;h.fixedBounds.position.x,h.fixedBounds.position.y,h.fixedBounds.position.x,h.fixedBounds.width,h.div.getElementsByTagName("canvas")[0];h.commit(function(e){var o=h.fixedBounds.position.x,n=h.fixedBounds.position.y,i=o+h.fixedBounds.width;h.scale;Y[0]&&Y[2](t),I.graduatedMin=0,I.graduatedMax=t.width+i,I.elt(0).width=t.width+i,H.graduatedMin=0,H.graduatedMax=t.width+i,H.elt(0).width=t.width+i},null)};h.addDiagramListener("ViewportBoundsChanged",function(t){setTimeout(function(t){W()},200)}),h.add(H),h.add(I),h.add(V),h.toolManager.doMouseMove=function(){go.ToolManager.prototype.doMouseMove.call(this),z()},h.toolManager.linkingTool.doMouseMove=function(){go.LinkingTool.prototype.doMouseMove.call(this),z()},h.toolManager.draggingTool.doMouseMove=function(){go.DraggingTool.prototype.doMouseMove.call(this),z()};var F=null,G=null,U=new go.Set;function z(){var t=h.viewportBounds;t.isReal()&&h.commit(function(e){var o=e.lastInput.documentPoint;V.location=new go.Point(Math.max(o.x,t.x),5),V.scale=1/e.scale},null)}h.toolManager.dragSelectingTool.delay=500,h.toolManager.dragSelectingTool.doMouseMove=function(t){go.DragSelectingTool.prototype.doMouseMove.call(this),this.diagram.currentCursor="crosshair",function(t,e){var o=t.diagram,n=F,i=G;if(null===o||null===n)return;var a=o.lastInput,r=o.findPartsIn(e,!0,!0,new go.Set),s=function(t,e){t.isRMVSEL=e,S(t,!0,e?"sel":"nor","dra")};a.control||a.meta?a.shift?(i.each(function(t){r.contains(t)||s(t,n.contains(t))}),r.each(function(t){s(t,!1),i.add(t)})):(i.each(function(t){r.contains(t)||s(t,n.contains(t))}),r.each(function(t){s(t,!n.contains(t)),i.add(t)})):a.shift?(i.each(function(t){r.contains(t)||s(t,n.contains(t))}),r.each(function(t){s(t,!0),i.add(t)})):(i.each(function(t){r.contains(t)||s(t,!1)}),n.each(function(t){r.contains(t)||s(t,!1)}),r.each(function(t){s(t,!0),i.add(t)}))}(this,this.computeBoxBounds()),z()},h.toolManager.dragSelectingTool.doActivate=function(){go.DragSelectingTool.prototype.doActivate.call(this),this.diagram.currentCursor="",F=U.copy(),G=new go.Set,this.diagram.raiseDiagramEvent("ChangingSelection")},h.toolManager.dragSelectingTool.doDeactivate=function(){this.diagram.raiseDiagramEvent("ChangedSelection"),F.each(function(t){!1===t.isRMVSEL&&U.remove(t)}),G.each(function(t){U.add(t)}),F=null,G=null,go.DragSelectingTool.prototype.doDeactivate.call(this)},h.toolManager.dragSelectingTool.doCancel=function(){var t=F;null!==t&&(t.each(function(t){t.isSelected=!0}),G.each(function(e){t.contains(e)||(e.isSelected=!1)})),go.DragSelectingTool.prototype.doCancel.call(this)};var K,j,Y=[,,function(t){var e=new go.Point(t.x+(K[1]+50)*(1/h.scale),t.y+1/h.scale*35);return Y[0]&&(Y[0].location=e),e}],J=function(t){Y[1].visible=""!=t[0],h.model.setDataProperty(Y[1].data,"to",t[0]),Y[2](h.viewportBounds)},q=function(t){h.commit(function(e){J(t)},"___FOCUSED")},Z=function(t){var o=parseFloat(t-i[2]),n=e,a=h.commandHandler.zoomFactor;h.scale=n*Math.pow(a,o)},Q=h.findLayer("Foreground");return h.addLayerBefore(p(go.Layer,{name:"ORIGL"}),Q),h.addLayerBefore(p(go.Layer,{name:"APPEL"}),Q),h.addLayerBefore(p(go.Layer,{name:"DURAT"}),Q),h.toolManager.standardMouseWheel=function(){this.diagram.lastInput.control||go.ToolManager.prototype.standardMouseWheel.call(this)},h.doFocus=function(){var t=$(a).parent(),e=t.scrollTop();go.Diagram.prototype.doFocus.call(this),t[0].scrollTop=e},Z(i[3]),W(),{attLogNode:function(t,e,i){U=new go.Set;var a=u.step3_utils.editPO.atTD,r=a[4],d=[],g=1e5,f=0,p=[],m=Number(a[1].split("fio")[1]),v=[],k=function(){for(var t=[],e=1;e<=s;e++)r.hasOwnProperty("fio"+e)&&r["fio"+e]&&t.push(r["fio"+e].getTime());return t}(),b=[""],S=[],D=function(t,e,o,i,a){var s=function(t){var e=c(r.ngay,t),o=x(t),n=e*T+o[1];return n<g&&(g=n),n>f&&(f=n),[n,o]}(o)[0],l=[s,t,a],u=E._calcNOD(t,e,o,s,i,a,r.ngay.getTime()/n);if(1==i&&l.push(u),v.indexOf(s)>-1){if(0==i)return null}else if(0==i&&v.push(s),-1==e.indexOf("clg")){var p=S[t]||[];p.push({iot:e,cx:s,idx:t,lg:o}),S[t]=p}return d.push(u),l};if(a[0]==j)Y[2](h.viewportBounds);else{Y[0]=null,Y[1]=null,r.freL&&function(){for(var t=0;t<r.freL.length;t++){var e,o,n,i=2==r.freL[t].length?0:2;r.freL[t][i]&&(e=l+t,0==i?(o="fre_"+e,n="noi"+e.toString()):(o="del_"+e,n="del_noi"+e.toString()),D(e,o,r.freL[t][i],0,0),r.freL[t][i+1]&&(r.freL[t][i+1]||[]).forEach(function(t,o){D(e,n+"_"+o.toString(),t,0,0)}))}}(),function(){for(var t=1;t<=s;t++){var n="fio"+t,i=t<=2*e[1]?1:0,a=!1,l=function(o,n){a=!0;var i=-1;return(r["noi"+t]||[]).forEach(function(a,r){var s,l=0;o===a.getTime()&&(i=r,l=t<=2*e[1]?n:0),(s=D(t,"noi"+t.toString()+"_"+r.toString(),a,0,l))&&1==l&&p.push(s)}),i},d=function(){var e=r.cusL&&JSON.parse(r.cusL),a=e&&e[0][t],s=function(e,i){if(e&&"HIE"!==e){var a=new Date(e*o+r.ngay.getTime());-1==k.indexOf(a.getTime())&&D(t,n,a,0,i)}},d=function(o,i){if(e[0][t]!=e[1][t]){var r=l(a[0].getTime(),i);if(r>-1)return o&&s(e[1][t],i),n="noi"+t.toString()+"_"+r.toString(),"log_from_noise"}};if(a){if("HIE"===a)return s(e[1][t],0),n="","origin_log";if(a=new Date(a*o+r.ngay.getTime()),(a=rdapV(a))[1]>4)return s(e[1][t],0),"1"==a[2]?(n="clg"+t,a[0]):"0"==a[2]?d(!0,0)||(i=0,"origin_log"):"origin_log";if(4==a[1]&&e[1][t])return d(!0,1)}}()||r[n];if(d){if(d&&"origin_log"!==d&&"log_from_noise"!==d){var c=n.indexOf("clg")>-1?1:0,u=void 0;(0==c||1==c&&1==i)&&(u=D(t,n,d,c,i)),u&&p.push(u)}a||l(0)}r.hasOwnProperty("fio"+t)&&(b[t]=n)}}();for(var C=0;C<p.length;C++){var P=0,L=u.commonFn.lgIdx_2_IOidx(p[C][1]),O=function(t){t&&(t._nodeP="P"+L)},A=[p[C][0],p[C][0],p[C][1],p[C][1]];O(p[C][3]),C+1<p.length&&L==u.commonFn.lgIdx_2_IOidx(p[C+1][1])&&(O(p[C+1][3]),A[1]=p[C+1][0],A[3]=p[C+1][1],1==p[C][2]&&1==p[C+1][2]&&(P=A[1]-A[0]),C++),d.push(E._nodeP("P"+L,P,A)),L==e[1]&&(C=p.length)}d.push({category:"Center",key:"rootEDT",loc:"0 20",color:"lightblue",size:"8 8"});var B,M=0-w,I=parseFloat(y[1].width-2),R=parseFloat(y[1].height-2);f-g<I&&(B=g-(2*I-(f-g))/2);var H,V,$=r.mmT,F=r.ngay.getTime();B=($[0]<0?0:T)+x(new Date(F+6e4*$[0]))[1],I=($[1]<0?0:T)+x(new Date(F+6e4*$[1]))[1],Y[3]=new go.Rect(B,M-150,Math.max(1,I),Math.max(1,2*R)),V=!(H=h.fixedBounds.toString()!=Y[3].toString())&&i&&!0===i.keepSUM_POS&&(V=h.findNodeForKey("shiftparam"))?go.Point.stringify(V.location):B+I/2+" 200",d.push({key:"shiftparam",category:"shiftinfo",group:"TIMEMAP",SI:"00:00",SO:"00:00",loc:V}),d.push({key:"-41",category:"Center",size:"5 5"}),d.push({key:"-42",category:"Center",size:"5 5"}),N.nodeDataArray=d;var G=[{from:"P1",to:"P1",category:"Dimensioning",labs:["-41"],fromSpot:"TopLeft",toSpot:"TopRight",extension:_,strokeDashArray:[5,5],direction:180,color:"gray",text:"0"},{from:"P2",to:"P2",category:"Dimensioning",labs:["-42"],fromSpot:"TopLeft",toSpot:"TopRight",extension:_,strokeDashArray:[5,5],direction:180,color:"gray",text:"0"}];S.forEach(function(t,e){if(t.length>1){var o=t.sort(function(t,e){return t.cx-e.cx}),n=o[0].iot,i=o[o.length-1].iot,a="Noise logs "+(e%2==0?"OUT":"IN");G.push({from:n,fromPort:"A",to:i,toPort:"A",text:a,category:"NEAR_LOG"})}}),G.push({from:"rootEDT",fromPort:"R00",to:b[m],toPort:"R00",category:"rootLNK",zOrder:1,fromEndSegmentLength:20,toEndSegmentLength:30,visible:!1}),G.push({from:"-41",fromPort:"R00",to:"shiftparam",toPort:"PC1",category:"detailLNK",toEndSegmentLength:10}),G.push({from:"-42",fromPort:"R00",to:"shiftparam",toPort:"PC2",category:"detailLNK",toEndSegmentLength:20}),N.linkDataArray=G,Y[0]=h.findNodeForKey("rootEDT"),Y[1]=Y[0].findLinksConnected().first(),function(t,e,o,n){if(n){h.startTransaction("changeFixedBounds"),h.fixedBounds=Y[3],h.commitTransaction("changeFixedBounds");var i=e-(y[1].width-(o-e))/2;h.position=new go.Point(i,t)}else setTimeout(W,200);setTimeout(function(){Y[1]&&(Y[1].visible=!0)},200)}(M,g,f,H)}t[3]=a[0],t[2]=a[3],K=t,t[2],j=t[3]},addCusLog:E._ddCusLog,alterTheme:function(){var t="#000",e="#000";"dark"==cS$.c0lor&&(t="#4d4d4d",e="#fff"),H.elements.each(function(o){o instanceof go.TextBlock?o.stroke=e:o.stroke=t}),h.nodes.each(function(t){h.model.raiseDataChanged(t.data,"")}),h.links.each(function(t){h.model.raiseDataChanged(t.data,"")}),W(),srclocked(!1)},gridline:function(t){var e=function(e,o){var n=H.findObject(e);n.geometryString="M0 0 V"+(1==t?"765":"10"),n.strokeWidth=o};e("l1",0==t?1:.2),e("l2",0==t?1.5:.2)},doZoom:Z,logFOCUSED:function(t){var e=t[1],o=[""];if(e){var n=c(t[2],e),i=x(e),a=new go.Point(n*T+i[1],Number(k));h.findPartsAt(a,!1).each(function(t){t instanceof go.Node&&t.location.x==a.x&&(o[0]=t.data.key)})}q(o)},trigCLK_tickICO:function(t){var e=Y[1].toNode;if(e){U.remove(e);var o=e.findObject("symSEL"),n=function(t){t.removeNodeData(e.data),q([""])};"U"==t&&(n=null),o&&E.click_tickICO(null,o,n)}},showMagnifier:function(){var t=h.findNodeForKey(0);h.remove(t)},testCommit:function(){h.remove(H),H=R("#4d4d4d"),h.add(H),W()},reset:function(){K=null,-1,j=-1}}};this.editoR=function(e,n){t=JSON.parse(JSON.stringify(e));var s,l,d,c,f,p="desktop"!==DevExpress.devices._currentDevice.deviceType,v=DevExpress.devices._currentOrientation,_={},w=[200,null,-1,-1,300],k='<div class="edit-time-diag-tbar nutlenh-diag" style="right:10px"><div class="btn-group mr-2"><button class="btn btn-secondary btn-sm reload_diag"><i class="ti-reload"></i></button><button class="btn btn-success btn-sm"><i class="ti-save"></i></button></div><div class="btn-group mr-2"><button class="btn btn-danger btn-sm"><i class="fa fa-eraser"></i></button></div><div class="btn-group non-float"><div class="btn-group mr-3 closepanel"><button act="hidediag" class="btn btn-danger btn-sm" style="padding: 0px 3px;"><i class="ti-close"></i></button></div><div class="btn-group floatwindow"><button act="floatdiag" class="btn btn-secondary btn-sm" style="padding: 0px 3px"><i class="ti-new-window"></i></button></div></div></div><div class="edit-time-diag-tbar keypad" style="width:100px;left:10px"><div class="btn-group zoomctrl mr-4" style="display:'+(p?"none":"")+'"><button act="z-" class="btn btn-outline-danger btn-sm"><i class="ti-minus"></i></button><div class="d-flex mr-1 ml-1 position-relative"><input class="levelSlider  align-self-center" type="range" min="'+i[0]+'" max="'+i[1]+'" value="'+i[3]+'"  style="padding: 0px 0px 0px 0px" /><div class="range-value"><span>100%</span></div></div><button act="z+" class="btn btn-outline-success btn-sm"><i class="ti-plus"></i></button></div><div class="navikey" style="display:'+(p?"":"none")+'"><div class="btn-group mr-2"><button class="btn btn-warning btn-sm invisible"><i  class="fa fa-long-arrow-left"></i></button><button act="keyU" class="btn btn-secondary btn-sm upkeypad" style="width:26px"><i class="fa fa-long-arrow-up"></i></button><button class="btn btn-secondary btn-sm invisible"></button></div><div class="btn-group mr-2" role="group" aria-label="Second group"><button act="keyL" class="btn btn-secondary btn-sm"><i  class="fa fa-long-arrow-left"></i></button><button act="keyD" class="btn btn-secondary btn-sm" style="width:26px"><i  class="fa fa-long-arrow-down"></i></button><button act="keyR" class="btn btn-secondary btn-sm"><i class="fa fa-long-arrow-right"></i></button></div></div></div>',x=$('<div><i class="dx-icon ti-direction btnOK okact"></i><i class="ti-help btnOK helpact" style="right:20px;color:#ffc107;font-size:smaller"></i><i class="dx-icon dx-icon-close  btnOK closeact" style="right:0px;color:#dc3545"></i><div class="text-small pl-1 pr-4 text-center font-italic dx-datagrid-headers text-nowrap" style="z-index:-1;border-bottom: none;padding:1px 0;min-height:19px">'+(p?"":"Press ESC to Close")+'</div><div class="edit-time"></div><div class="edit-log-diag" style="height:'+w[4]+'px"><div class="gotime"></div></div></div>'),T=["",""],S=[0,-1],D=-1,C=-1,P=n[0].getBoundingClientRect(),L=-1,O=!0,A=function(){d.trapValueChanged=setTimeout(function(){clearTimeout(d.trapValueChanged);var t=u.step3_rst_grid,e=u.step3_utils.editPO.atTD;B(t,e[0],e[3])},10)},E=function(t,e,o){if(10!=d._valOK)return 1==d._valOK;var n=t.mmT,i=!0;if(n[0]||n[1]){var a=d._$element.data("dxValidator"),r=a._validationRules[0],s=t.ngay.getTime();n[0]&&(i=new Date(s+6e4*n[0])<=e),i&&n[1]&&(i=e<=new Date(s+6e4*n[1])),!i&&o&&(r.isValid=i,r.message="console.log('onValueChanged trigger');",a.validate())}return d._valOK=i?1:-1,i},B=function(t,e,o){u.step3_utils.ignoreFocusedCellChanging=function(){u.step3_utils.ignoreFocusedCellChanging=null};var n=t.getCellElement(e,o);return t.focus(n),n},N=function(t,e){var o=function(){var t=u.step3_utils.editPO.atTD;return B(u.step3_rst_grid,t[0],t[3])};if(null==t)return o();setTimeout(function(){var t=o();e&&"function"==typeof e&&e(t)},t)},M=function(){O=!1,c.hide(),N(10)},I=null,R=function(t){console.log("scrollADJUST = function (ofs) {");var e=$("body,html");e.animate({scrollTop:e.scrollTop()+t},200)},H=function(t,e,o){var n=elTAB[0].getBoundingClientRect(),i=V(),a=i[0],r=o&&o.outerHeight()||i[1](t),s=e.top-(n.bottom+r+a);return s<0&&(R(s),!0)},V=function(){var t="0 -5".split(" ");return[10+Number(t[1]),function(t){return t.option("target").outerHeight()}]},W=function(t,e,o){!a&&t._EVTTYPE&&"dxpointerdown"!=t._EVTTYPE[0]&&(H(t,e)||(o=o||$(window).height(),e.top+60>o&&R(e.top+65-o)))},F=function(t,e){if(clearTimeout(D),D=-1,"down"==T[1]){var o=function(t,e){var o=u.step3_utils.editPO,n=o._$popupContent,i=n[0].getBoundingClientRect();if(e){var r,l=$(window).height(),d="",c=i.top+i.height+w[4],g=V(),f=g[0];if(c>l){if(a)r=g[1](o),i.top-r-f>l-(i.top+i.height)&&(d=-(w[4]+r+f)),s[(""==d?"remove":"add")+"Class"]("opposit-flip").css({top:d});else if(!p&&"dxpointerdown"!=o._EVTTYPE[0]&&o._EVTTYPE[1]>0){r=g[1](o);var h=i.top-r-f-elTAB[0].getBoundingClientRect().bottom;R(h>c-l?c-l:h)}}else a?s.removeClass("opposit-flip").css({top:""}):p||W(o,i,l);return[n,i]}return[n,i]}(0,e);if(!o)return;var n=o[0],i=o[1],r=P.width>w[0]&&P.width>800?800:P.width,l=w[1]||r/2-i.width/2,d=P.left+P.width,c=i.left-l,g=!(w[0]==r&&w[5]&&w[5][0]<=i.left&&i.left+i.width<=w[5][0]+r);g?c+r>d?l+=c+r-d:c>P.left?w[1]&&(g=w[0]!=r):l-=P.left-c:(l-=w[5][0]-c,s.css({left:-1*l})),w[0]==r&&w[1]==l||!g||(y[0]=n.find(".dx-texteditor-input")[0].getBoundingClientRect(),s.css({left:-1*l,width:r})),y[1]=s[0].getBoundingClientRect(),w[0]=r,w[1]=l,w[5]=[i.left-l,i.top]}},G=function(t,e){var o=u.step3_utils.editPO._$popupContent.find("div[class^='edit-log-diag']"),n=y[0],i=y[1];if(o.css("height",w[4]),t._$popupContent.append(o),o.removeClass("edit-log-diag").addClass("edit-log-diag-float"),e){var a=i.left-i.width;a<0&&(a=0),a+" "+parseInt(n.top+n.height),u.floatDIAG.option("position.offset",{x:a,y:parseInt(n.top+n.height)})}else;t.show()},U=function(){var t=h.div,e=u.floatDIAG._$content.find(".dx-popup-content");t.style.height=e.height()-2+"px",t.style.width=e.width()-2+"px"},z=function(){S[1]=1,U(),K()},K=function(t){if(0==u.step3_utils.editConfig.focusBack){var e=u.step3_utils.edit_time;if(e.focus(),t&&"dxdrag"==t.type){var o=e._$element.find(".dx-texteditor-input")[0],n=o.selectionStart<3?0:3;o.setSelectionRange(n,2)}}else N()},j=function(){if(u.floatDIAG)G(u.floatDIAG,!1);else{var t=n.parent(),e=y[1],o=$("<div/>").appendTo(t).dxPopup({width:e.width+2,height:e.height+36+2,container:app_container.closest("#app"),showTitle:!0,visible:!1,dragEnabled:!0,resizeEnabled:!0,shading:!1,closeOnOutsideClick:!1,showCloseButton:!0,onContentReady:function(t){var e=t.component._$popupContent;e.css({padding:0,margin:0}),e.prev().css({padding:"0 15px",height:"36px"}).addClass("edit-log-diag-float-header");var o=null,n=t.component._$content;n.hasClass("floatDIAG-hackkeydown")||(n.on("click",function(t){J(0)}),n.find(".dx-toolbar").on("dxdrag.dxPopup",function(t){clearTimeout(o),o=setTimeout(function(){K(t)},200)}),function(t){t.off("scroll").on("scroll",function(t){if(this.scrollTop>0){var e=u.step3_utils.editPO.fuckMN_Shown;1==e&&(u.step3_utils.editPO.fuckMN.fuckMN_CancelHiding=function(t){t.cancel=!0}),this.scrollTop=0,1==e&&setTimeout(function(){u.step3_utils.editPO.fuckMN.fuckMN_CancelHiding=null},50)}})}(n.find(".gotime")),n.find(".dx-closebutton").data("dxButton").option("onClick",function(t){var e;u.floatDIAG._onHiddenHwnd=function(t){u.floatDIAG._onHiddenHwnd=null,S[1]=0;var o=t.component._$popupContent.find("div[class^='edit-log-diag']");o.removeClass("edit-log-diag-float").addClass("edit-log-diag"),o.css({width:1e3,height:400}),u.step3_utils.editPO._$popupContent.append(o),F(0,!0),e&&"function"==typeof e&&e()},u.floatDIAG.hide()}),n.addClass("floatDIAG-hackkeydown"))},onShowing:function(t){t.component._tmpscrollPos=$(window).scrollTop()},onShown:function(t){$(window).scrollTop(t.component._tmpscrollPos),z()},onHiding:function(t){u.floatDIAG.$puInfo=[this.content().parent().css("transform"),this.option("width"),this.option("height")]},onHidden:function(t){var e=t.component._onHiddenHwnd;e&&"function"==typeof e&&e(t)},onResizeEnd:function(t){J(0),U()},position:{my:"top left",at:"top left",of:document}}).dxPopup("instance");u.floatDIAG=o,G(u.floatDIAG,!0)}},Y=-1,J=function(t){clearTimeout(Y),Y=setTimeout(function(){0==u.step3_utils.editConfig.focusBack?d.focus():N(t)},void 0!==t?t:100)},q=function(t){if("chevronup"==t.option("icon")?(T=["In","down"],d.close()):T=["Out","up"],h)1===S[1]?(S[1]=2,u.floatDIAG.hide()):2===S[1]?!0!==u.floatDIAG._currentVisible?u.floatDIAG.show():z():s["fade"+T[0]]("fast",function(){y[1]=this.getBoundingClientRect(),"down"==T[1]&&(F(0,!0),1===_.btnFloatDiag.need_RELOAD&&X())}),srclocked(!1);else{var e=$.Deferred(),o=$.Deferred();s=c._$popupContent.find(".edit-log-diag"),setTimeout(function(){$.when(e,o).then(function(t,e){y[1]=s[0].getBoundingClientRect(),Q(s.find(".gotime")[0]),srclocked(!1)}),s["fade"+T[0]]("fast",function(){e.resolve()}),_gsC(srcpf$+"/media/vendor/GoJS/release/gojstrial.js","js",function(){o.resolve()},"gojs.js")},20),F(0,!0)}t.option("icon","chevron"+T[1]),J()},Z=function(t,e){if(u.step3_utils.editPO){var o=u.step3_rst_grid,n=u.step3_utils.editPO.atTD;-1==[13,27].indexOf(t)&&setTimeout(function(){var e=o.getCellElement(n[0],n[3]);o.focus(),e.trigger($.Event("keydown",{which:t,code:t}))},10)}},Q=function(e){(l=b(e)).attLogNode(w,t),i$Desk&&(u.s3editdiag_scroPerf=new PerfectScrollbar($(e).children("div")[0],{})),$(e).parent().append(k);var o=function(t,e){var o=100,n=t.nextSibling;t.value<=i[2]?o-=5*(i[2]-t.value):o+=5*(t.value-i[2]),n.innerHTML="<span>"+o+" %</span>";var a=Number(100*(t.value-t.min)/(t.max-t.min)),r=10-.2*a;n.style.left="calc("+a+"% + "+r+"px)",e&&l.doZoom(t.value)},n=function(t,e){var o=u.step3_rst_grid,n=u.step3_utils.editPO.atTD,i=o.getCellElement(n[0],n[3]);i.offset();o.focus(i),i.trigger($.Event("keydown",{which:e,code:e}))};(m=$(e).parent().find(".levelSlider")).on(11==GetIEVersion()?"change":"input",function(){var t=this,e=m.closest(".btn-group").find('.btn[act^="z"]');t.value==t.min?($(e[0]).prop("disabled",!0),$(e[1]).removeAttr("disabled")):t.value==t.max?($(e[1]).prop("disabled",!0),$(e[0]).removeAttr("disabled")):($(e[0]).removeAttr("disabled"),$(e[1]).removeAttr("disabled")),o(t,!0)}),o(m[0],!1),$(e).off("click").on("click",function(t){var e,o,n;(o=1===(e=d).fuckMN_Shown,n=1===e.fuckSZ_Shown,o&&e.fuckMN.hide(),n&&e.fuckMN.fuckSZ.hide(),[o,n])[0]||"dx-texteditor-input"==t.target.className||J(100)}).parent().find(".edit-time-diag-tbar .btn").off("click").on("click",function(t){var e,i,a=$(t.currentTarget),r=!1;if(a.hasClass(".btn")||(a=a.closest(".btn")),e=a.closest(".btn-group"),a.hasClass("reload_diag"))srclocked(!0),setTimeout(function(){X(),d.focus(),srclocked(!1)},20);else if(e.hasClass("zoomctrl")){var s=m[0],l=parseInt(m.val());if("z-"==apisvr.a$.trim(a.attr("act"))){if(l<=s.min)return;i="+",r=--l<=s.min}else{if(l>=s.max)return;i="-",r=++l>=s.max}r&&a.prop("disabled",!0),e.find('.btn[act="z'+i+'"]').removeAttr("disabled"),s.value=l,o(s,!0)}else{switch(apisvr.a$.trim(a.attr("act"))){case"floatdiag":j();break;case"hidediag":q(_.btnFloatDiag);break;case"keyL":n(0,37);break;case"keyU":n(0,38);break;case"keyR":n(0,39);break;case"keyD":n(0,40)}}})},X=function(){l.reset(),l.attLogNode(w,t,{keepSUM_POS:!0}),_.btnFloatDiag.need_RELOAD=0},tt=[{name:"backVAL",location:"before",widget:"dxButton",options:{elementAttr:{class:"logeditundo"},icon:"undo",stylingMode:"text",onClick:function(t){d.close(),nt("U"),f._DEL_VAL=null},onContentReady:function(t){f=t.component}}},{name:"delval",location:"before",widget:"dxButton",options:{elementAttr:{class:"logremove"},icon:"trash",stylingMode:"text",onClick:function(t){srclocked(!0);var e=function(t){if(0!=t.re)if(1==t.sel)ft[1](t);else{var e=c.atTD,o=e[4][e[1]];f._DEL_VAL=[o,o,0],o&&o.getFullYear().toString().length>4?(d.hwChanged=function(t){d.hwChanged=null,nt("R")},f._DEL_VAL[1]=d.option("value"),f._DEL_VAL[2]=1,d.reset()):nt("R"),srclocked(!1)}};setTimeout(function(){gt("del",e),d.close()},20)},onContentReady:function(t){}}},"dropDown",{name:"dxDropDownButton",widget:"dxButton",location:"after",options:{icon:"chevronup",stylingMode:"text",focusStateEnabled:!1,onClick:function(t){srclocked(!0),setTimeout(function(){d.close(),q(t.component)},20)},onContentReady:function(t){_.btnFloatDiag=t.component}}}],et=function(){S[0]=0,w[1]=null,w[2]=-1,w[3]=-1,delete w[5]},ot={container:n,width:p?130:180,position:{at:"bottom",my:"top",offset:"0 -5",collision:{x:"fit",y:"none"}},animation:"none",onHiding:function(t){t.component._targetParentsScrollHandler;t.component.cancelHidding&&"function"==typeof t.component.cancelHidding&&t.component.cancelHidding(t),t.cancel||1===S[1]&&1!==t.component._isflash&&(S[1]=2,u.floatDIAG.hide())},onHidden:function(t){et(),console.log(" onHidden: function (e) {"),ct.bind("off"),t.component._EVTTYPE=["HIDDEN",0]},onShown:function(t){1!==c.preventSHOW?(O=!0,S[0]=1,I&&"function"==typeof I&&I(),ct.bind("on"),console.log("            bindSCROLL.bind('on');"),r&&"function"==typeof r&&r()):c.preventSHOW=0},onShowing:function(e){if(console.log("           onShowing: function (e) {"),1!==c.preventSHOW){O=!1,clearTimeout(D),clearTimeout(C),clearTimeout(L);var o=e.component,n=o.atTD,i=n[2],r=rdapV(i);d.close(),d.hwChanged=function(t){d.hwChanged=null,d._$textEditorContainer[(r[1]>4&&"0"==r[2]?"add":"remove")+"Class"]("delval")},d.option("value",r[0]),d.hwChanged=null,y[2]=i;var s=null,g=w[3]!=n[0],f=w[2]!=n[3];"down"==T[1]?((g||f)&&(I=function(){I=null,F(0,g),s&&l&&l.logFOCUSED(s),console.log("  hwndADJUST = function () {")}),f&&(s=[n[1],r[0],n[4].ngay],w[2]=n[3]),g&&(s=null,C=setTimeout(function(){l&&l.attLogNode(w,t)},100),w[3]=n[0]),2===S[1]&&(!0!==u.floatDIAG._currentVisible?u.floatDIAG.show():z())):a||!g||p||(I=function(){I=null,W(o,o._$popupContent[0].getBoundingClientRect())}),L=setTimeout(function(){L=-1},200)}},closeOnOutsideClick:!1,onContentReady:function(t){t.component._$wrapper.addClass("edit-log keepshown").find(".btnOK").off("click").on("click",function(t){$(t.currentTarget).hasClass("okact")?(srclocked(!0),setTimeout(function(){gt("shf",function(t){1==t.re&&ft[t.sel](t)}),d.close()},10)):$(t.currentTarget).hasClass("closeact")&&M()})},hideOnParentScroll:!0},nt=function(t){u.step3_rst_grid,c.atTD;var e=d.option("value"),o=!1,n="0";d._$textEditorContainer[("R"==t?"add":(f._DEL_VAL&&1==f._DEL_VAL[2]&&((f._DEL_VAL[1]&&f._DEL_VAL[1].getTime())!=(e&&e.getTime())&&(d.hwChanged=function(t){d.hwChanged=null}),d.option("value",f._DEL_VAL[1]),n="1",e=f._DEL_VAL[0],o=!0),"remove"))+"Class"]("delval"),at({value:e,previousValue:e},o,"R"==t?adapV(e,n):[e]),!o&&l&&("down"==T[1]?l.trigCLK_tickICO(e&&"R"==t?"U":t):_.btnFloatDiag.need_RELOAD=1)},it=u.saveBadge,at=function(t,e,o){d.bkValIgnore=void 0;var n=u.step3_rst_grid,i=t.value,a=c.atTD,r=a[0],s=a[1],g=a[3],f="1",p=i?o||adapV(i,f):(f="0",function(t,e){if(!t)return[t];var o=new Date(t.setSeconds(0)),n=o.getFullYear().toString();return 4==n.length?[new Date(o.setFullYear(Number(n+e)))]:[null]}(a[4][s],f));it.editLOG(a[4],[s,r],p),n.cellValue(r,s,p[0]),toastMsg("onValueChanged set cellValue!","info",100),console.log("onValueChanged set cellValue! "+r+" cC: "+g+"; val:"+i+"; "+new Date),d.forceCellFocus&&(r=d.forceCellFocus[0],g=d.forceCellFocus[1]),d.forceCellFocus=null,e&&l&&("down"==T[1]?l.addCusLog(i,f):_.btnFloatDiag.need_RELOAD=1)},rt=function(t){if(d._bctivePartIndex==t){if(O=!0,d._fireChangeEvent(),-1==d._valOK)return;A()}},st=function(t,e){var o=e.vals[0],n=adapV(o,"1");E(e.dat,o,!1)&&(it.editLOG(e.dat,e.cell,n),u.step3_rst_grid.cellValue(e.cell[1],e.cell[0],n[0]),"down"==T[1]&&l&&l.addCusLog(o,"1"))},lt=function(){var t=c.atTD,e=new Date((new Date).setSeconds(0));return t&&t[4]?new Date(new Date(t[4].ngay).setHours(e.getHours(),e.getMinutes(),0)):e},dt=-1,ct={DESK:function(t,e,o,n){var i=this;clearTimeout(dt),dt=setTimeout(function(){clearTimeout(dt),dt=-1,u.step3_utils.editPO._$wrapper.removeClass("tmphidden");var t=u.step3_rst_grid,e=u.step3_utils.editPO,o=e.atTD,n=t.getCellElement(o[0],o[3]),a=n[0].getBoundingClientRect(),r=i._$wrapper[0].getBoundingClientRect(),s=r.left+r.width<a.left+30,l=r.top>a.top+20,d=a.top+20>r.top+r.height;s||l||d?(console.log("step3_rst_grid scroll end hide"),e.hide()):(console.log("step3_rst_grid scroll end repaint"),e.repaint(),F(0,!0),t.focus(n))},e||0)},PHONE:function(t){-1===dt&&(console.log("step3_rst_grid scroll start"),u.step3_utils.editPO._$wrapper.addClass("tmphidden")),ct.DESK.call(this,t,300)},fn:function(t){var e=u.step3_utils.editPO;e._currentVisible&&(e._EVTTYPE&&["keydown","HIDDEN"].indexOf(e._EVTTYPE[0])>-1||ct[p?"PHONE":"DESK"].call(this,t))},srl:function(){return this._srl||(this._srl=u.step3_rst_grid.getScrollable(),this._srl)},bind:function(t){if(this.lastACT!==t){var e=this,o=e._srl||e.srl(),n=e._tabHEAD||(e._tabHEAD=elTAB.find('.chrome-tab[data-tab-id="'+elTAB[0].__actTAB+'"]'),e._tabHEAD);o.off("scroll",e.fn),n.off("WS_START",e.WS_START).off("WS_END",e.WS_END).off("WS_ON",e.WS_END),$(w0w).off("resize",e.WIN_RS),"on"==t&&(o.on("scroll",e.fn),p?n.on("WS_START",e.WS_START).on("WS_END",e.WS_END):$(w0w).on("resize",e.WIN_RS)),Main.needSCRO_EVT("on"==t),e.lastACT=t}},WS_START:function(){u.step3_utils.editPO._$wrapper.addClass("tmphidden")},WS_END:function(t){var e=u.step3_utils.editPO,o=e.option("target"),i=DevExpress.devices._currentOrientation;e._$wrapper.removeClass("tmphidden"),v!=i?(v=i,P=n[0].getBoundingClientRect(),F(0,!0)):o&&u.step3_rst_grid._controllers.editorFactory.focus(o,!0),e.repaint(),console.log("elUI.globHWN.sliderbar: repaint")},WIN_RS_timeout:-1,WIN_RS:function(t){var e=ct;clearTimeout(e.WIN_RS_timeout),e.WIN_RS_timeout=setTimeout(function(){clearTimeout(e.WIN_RS_timeout),e.WIN_RS_timeout=-1,et(),P=n[0].getBoundingClientRect(),F(0,!0),ct.WS_END()},300)}},ut={_setEDT_VAL:function(t){var e=d.option("value");(e&&e.getTime())!=(t&&t.getTime())&&(d.hwChanged=function(t){d.hwChanged=null},d.option("value",t))},_logchanged_by_Mouse_DragDiagLog:function(t,e){var o=u.step3_rst_grid,n=c.atTD,i=e[0],a=adapV(e[1],"1"),r=1==i.typ?i.key.replace("clg","fio"):i.key,s=n[0],l=r;n[1]==r&&ut._setEDT_VAL(e[1]),it.editLOG(n[4],[l,s],a),o.cellValue(s,l,a[0])},_tickchanged_by_Mouse_Click:function(t,e){d.close(),e&&ut._setEDT_VAL(e[1]),d._$textEditorContainer[("R"==t?"add":"remove")+"Class"]("delval"),at({value:e&&e[1]},!1,e),srclocked(!1)},hidePopupDOG:function(){for(;DevExpress.hideTopOverlay(););},capKeyD:function(t){if(!(3!=frmWizHwnd._his.toStep||$(t.target).closest(".kiem-the").length>0)){if(t.preventDefault(),t.stopPropagation(),27==t.which)1===S[0]&&u.step3_utils.editPO.hide();else{var e=u.step3_rst_grid,o=u.step3_utils.editPO,n=o.atTD,i=e.getCellElement(n[0],n[3]);t.which?t.which:t.keyCode;H(o,o._$popupContent[0].getBoundingClientRect(),i),e.focus(i)}}},evtTabActived:function(t,e){if(!p){var o=ut;$(document)[1==e.state?"on":"off"]("keydown",o.capKeyD),null!=t&&0==e.state&&o.hidePopupDOG()}},init:function(){var t=ut;ut.evtTabActived(null,{state:1}),g[0].on("onActived",t.evtTabActived).on("onShowStep",function(e,o,n,i){3==n.fromStep?(t.hidePopupDOG(),t.evtTabActived(null,{state:0})):3==n.toStep&&t.evtTabActived(null,{state:1})}).on("DIAG",function(e,o,n,i){var a=u.step3_rst_grid,r=c.atTD;switch(o){case"1":a.focus(a.getCellElement(r[0],n.key));break;case"2":t._tickchanged_by_Mouse_Click(n,i);break;case"3":t._logchanged_by_Mouse_DragDiagLog(n,i)}})}},gt=function(t,e){var o={del:{0:"(Mac dinh)",1:"Sau khi xoa se doi log the"},shf:{0:"Chen vao log the trong",1:"Doi log the hien tai"}},n=$("<div style='padding:0 10px'/>"),i=t+"_lastOPT";DevExpress.ui.dialog.custom({title:"",showTitle:!0,messageHtml:"",popupOptions:{dragEnabled:!0,_ignoreFunctionValueDeprecation:!0,contentTemplate:function(e){e.append($("<p>"+o[t][1]+'<button type="button" class="btn btn-sm btn-outline-warning" style="float:right;padding: 0px 2px 0px;"><i class="ti-help"></i></button></p>'),n);var a=[{id:0,text:o[t][0]},{id:1,text:"Xoa va doi sang trai"}],r=(gt[i]||(gt[i]=0),gt[i]);"shf"==t&&c.atTD&&c.atTD[4].cusL&&a.push({id:2,text:"Khoi phuc lai ket qua tinh ban dau"}),0==a.filter(function(t,e){return t.id==r}).length&&(r=0),n=n.dxRadioGroup({valueExpr:"id",displayExpr:"text",items:a,value:r}).dxRadioGroup("instance")},onContentReady:function(t){var e=t.component._$wrapper;e.find(".dx-popup-bottom.dx-toolbar").css("padding","10px"),e.find(".dx-popup-content").css("padding","0 0 0 10px"),e.find(".dx-popup-title").addClass("dog_shift_popup")},onHidden:function(t){n.dispose()},onShowing:function(t){srclocked(!1)}},buttons:[{text:"Thuc Hien",onClick:function(e){return srclocked(!0),gt[i]=n.option("value"),{re:1,sel:gt[i],ow:t}}},{text:"Dong",onClick:function(t){return{re:0}}}]}).show().done(function(t){setTimeout(function(){e(t)},20)})},ft={ui:function(t,e){r=function(){r=null,srclocked(!1)},t.focus(t.getCellElement(e[0],e[3])),l&&("down"==T[1]?X():_.btnFloatDiag.need_RELOAD=1)},b_se:function(t){var e=u.step3_rst_grid,o=c.atTD,n=o[0],i=o[1],a=o[4],r=e._views.rowsView.getCellOptions(n,i),s=e._controllers.editing,l=Number(i.split("fio")[1]),d={};ft.del2_fre=[],t&&t(d,a,l,[]);for(var g=8;g>=l;g--)d.hasOwnProperty("fio"+g)&&it.editLOG(a,["fio"+g,-1,g],[d["fio"+g]]);s._applyChange(r,{data:d,key:a.id,oldData:a,type:"update"},!0),c.preventSHOW=2,setTimeout(function(){c.preventSHOW=0},200),e.cellValue(o[0],o[1],d[o[1]]),ft.ui(e,o)},shfOUT:function(t,e,o){var n=$.extend(!0,[],e.freL),i=[e["fio"+t]];e.hasOwnProperty("noi"+t)&&i.push($.extend(!0,[],e["noi"+t])),n.unshift(i),o.freL=n},0:function(t){this.b_se(function(t,e,o,n){for(var i=!1,a=8;a>=o;a--)if(e.hasOwnProperty("fio"+a)){var r=a+1,s=e["fio"+a];t["fio"+a]=null,i||(i=!!s),e.hasOwnProperty("noi"+a)&&(t["noi"+r]=$.extend(!0,[],e["noi"+a]),t["noi"+a]=null),a<8?t["fio"+r]=s:ft.shfOUT(a,e,t)}!i&&t.freL&&delete t.freL})},getOUT:function(t,e,o){var n=$.extend(!0,[],e.freL),i=!1;if(n.length>0){var a,r=null,s=null;2==(a=n.shift()).length&&(r=a[0],s=a[1]?$.extend(!0,[],a[1]):null,o["fio"+t]=r,o["noi"+t]=s,i=!0)}ft.del2_fre.length>0&&(n.push([,ft.del2_fre[0],ft.del2_fre[1],ft.del2_fre[2]]),i=!0),i&&(o.freL=e.freL.concat(n))},del_and_shf:function(t,e,n){if(t.hasOwnProperty("fio"+n)){var i,a=t["fio"+n];if(t.cusL&&(i=JSON.parse(t.cusL))[1]&&i[1][n]&&"HIE"!=i[1][n]&&(a=new Date(t.ngay.getTime()+i[1][n]*o)),t.hasOwnProperty("noi"+n)){var r=$.extend(!0,[],t["noi"+n]);e["noi"+n]=null}ft.del2_fre.push(n),ft.del2_fre.push(a),e["fio"+n]=null,r&&ft.del2_fre.push(r)}},1:function(t){this.b_se(function(t,e,o,n){ft.del_and_shf(e,t,o);for(var i=o;i<=8;i++){var a=i+1;e.hasOwnProperty("fio"+a)&&(t["fio"+a]=null,e.hasOwnProperty("noi"+a)&&(t["noi"+i]=$.extend(!0,[],e["noi"+a]),t["noi"+a]=null),t["fio"+i]=e["fio"+a]),8==i&&ft.getOUT(i,e,t)}})},2:function(t){var e=u.step3_rst_grid,o=c.atTD,n=e._controllers.editing;if(n){var i=n.getChanges();i=i.filter(function(t,e){return t.key!=o[4].id}),n._silentOption("editing.changes",i);var a=e._views.rowsView.getCellOptions(o[0],o[1]);n._updateEditRow(a.row,!0,!1);var r=[o[4].acno,o[4].ngay.getTime()].join("|");it[1]("cellValue",r,"remove"),ft.ui(e,o)}},"2_backup":function(t){for(var e=u.step3_rst_grid,i=c.atTD,a=e._controllers.editing,r=i[4],s=[],l=function(t,e){if(r.cusL){var n=r.cusL;if(n[0][e]&&n[1][e])return new Date(n[1][e]*o+r.ngay.getTime())}return t},d=1;d<=8;d++){var g="fio"+d;r.hasOwnProperty(g)&&r[g]&&s.push(l(r[g],d))}n.trigger("giaotiepevt",["RECALC_1ROW",{acno:r.acno,aLogs:s,logs:s.length,ten:"Mr.One"},r.id,function(t){var o=e.getVisibleRows();if(o.length>0){var n=a._dataController._dataSource,s=r.id,l=t,d=n.items();it.resetChanged("row",s);for(var c=0;c<d.length;c++)if(d[c].id==s){l.id=d[c].id,l.mmT=d[c].mmT,d[c]=l;break}o=o[i[0]],a._updateRowImmediately(o,!0,!1);var u=e.getCellElement(i[0],i[3]);u&&e.focus(u)}}])}},pt=function(){l&&l.reset(),l=null,"down"==T[1]&&(T=["Out","up"],_.btnFloatDiag.option("icon","chevron"+T[1]),s.css("display","none")),h&&(h.div=null),h=null,_.btnFloatDiag&&(_.btnFloatDiag.need_RELOAD=0),et()};n.parent().append(x).on("re-calc",function(t,e,o){alert("s3logedit re-calc"),w[3]=-1}).on("mouse_FocusedCellChanging",st).on("setFIO",function(t,e,o,n){}).on("listen_2_me",function(e,o,i){switch(o){case"part_fullscreen":a="add"==i||(s&&s.removeClass("opposit-flip").css({top:""}),!1),setTimeout(function(){P=n[0].getBoundingClientRect()},1e3);break;case"reset_diag":pt();break;case"changeInOutLogCols":t=JSON.parse(i),pt()}}),p&&tt.splice(2,1),(d=x.find(".edit-time").dxDateBox({type:"datetime",displayFormat:"HH:mm",pickerType:p?"rollers":"calendar",showClearButton:!1,selectionMode:"single",useMaskBehavior:!0,onKeyDown:function(t){t.event.stopPropagation(),13==t.event.keyCode||(27==t.event.keyCode?M():9==t.event.keyCode?(t.event.preventDefault(),function(t){var e,o=u.step3_utils.editPO;if(o._currentVisible){var n=o.atTD[0],i=o.atTD[1],a=o.atTD[3],r=(e=o.atTD[4])&&$.extend(!0,{},e);d.hwChanged=function(t){d.hwChanged=null,setTimeout(function(){st(0,{cell:[i,n,,a],dat:r,vals:[t.value]})},5)},Z(t.event.which?t.event.which:t.event.keyCode)}}(t)):37==t.event.keyCode?rt(0):39==t.event.keyCode?rt(2):[33,34].indexOf(t.event.keyCode)>-1&&(t.event.preventDefault(),t.event.originalEvent.isDefaultPrevented=function(t){return this.UD_From_EDT_CB=function(){},!1},t.event.keyName=33==t.event.keyCode?"pageUp":"pageDown",u.step3_rst_grid._controllers.keyboardNavigation._keyDownHandler(t.event)))},onValueChanged:function(t){d.hwChanged?d.hwChanged(t):(clearTimeout(t.component.trapValueChanged),O?E(c.atTD[4],t.value,!0)&&(at(t,!0),d._$textEditorContainer.removeClass("delval")):t.component.bkValIgnore=t.value)},buttons:tt,onContentReady:function(t){var e=t.component._$element.find("input");e[0];$(e[1]).off("blur").on("blur",function(t){d.hwChanged=null,d.forceCellFocus=null})},onOptionChanged:function(t){t.name},onFocusOut:function(t){d.preventLOSTfocus&&(t.event.isDefaultPrevented=d.preventLOSTfocus)},onClosed:function(t){ut.evtTabActived(null,{state:1})},onOpened:function(t){ut.evtTabActived(null,{state:0}),void 0===d._maskValue&&setTimeout(function(){d._strategy._widget.option("value",lt())})}}).dxValidator({validationRules:[{type:"custom",validationCallback:function(t){return d._valOK=10,!0}}]}).dxDateBox("instance"))._setNewDateIfEmpty=function(){if(!this._maskValue){var t=lt();this._maskValue=t,this._initialMaskValue=t,this._renderDateParts()}},d._enterHandler=function(t){t.preventDefault(),(O=this._isValueDirty())&&(this._fireChangeEvent(),-1==d._valOK)||(2!=d._bctivePartIndex&&d._maskValue?this._selectNextPart(1):A())},d._supportedKeys=function(t){return this._bctivePartIndex=this._activePartIndex,this.constructor.prototype._supportedKeys.call(this,t)},p||(ot[deV.$2||"hideOnParentScroll"]=function(t){return c.repaint(),!0}),d._valOK=10,u.step3_utils.edit_time=d,(c=x.dxPopover(ot).dxPopover("instance")).backVAL=f,u.step3_utils.editPO=c,it[1]=function(t,e,o){var n,i=0;"remove"===o?(n=this[2].gI(t))&&(n.rI(e),i=n.L):((n=this[2].g0N(t,{})).sI(e,o),i=n.L),this[0].text(i>0?i:""),it.sBTN.option("visible",i>0)},it.bageChanged_HIS=function(t){var e,o,n=it[2].Is.cellValue;return n&&(e=[t.acno,t.ngay.getTime()].join("|"),o=n.gI(e)),o},it.editLOG=function(t,e,n){var i,a,r=t.ngay.getTime(),s=[0],l=[0],d=function(e,n,i){if(t.hasOwnProperty("fio"+e)){var a=t["fio"+e];n[e]=a?Math.floor((a.getTime()-r)/o):"HIE"}else i&&(n[e]=i)},c=it.bageChanged_HIS(t),u=[t.acno,r].join("|");it[u]&&""!=it[u]?a=it[u]:t.cusL&&""!=t.cusL&&(a=JSON.parse(t.cusL)),a&&(s=a[0],l=a[1]);for(var g=1;g<=8;g++)if("fio"+g==e[0]){var f=n[0],p="HIE";f&&(p=Math.floor((f.getTime()-r)/o)),l[g]||d(g,l,"HIE"),p===l[g]&&(p=l[g],delete l[g]),s[g]=p}else s[g]||d(g,s);i=c?c[3]:t.cusL,it[1]("cellValue",u,[s,l,i]),it[u]=[s,l]},it.resetChanged=function(t,e){var o,n=u.step3_rst_grid._controllers.editing;"all"==t||"row"==t&&(o=(o=n.getChanges()).filter(function(t,o){return t.key!=e}),n._silentOption("editing.changes",o))},u.globHWN.sliderbar=function(t,e){for(;DevExpress.hideTopOverlay(););setTimeout(function(){P=n[0].getBoundingClientRect(),et()},500)},u.globHWN.theme=function(t,e){h&&l&&l.alterTheme()},app_container.closest("#app").on("sidebar",u.globHWN.sliderbar).on("theme",u.globHWN.theme),ut.init()}}return u.prototype.publicSharedVar="quux",u.prototype.publicSharedMethod=function(t){},u}();