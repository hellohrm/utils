<!DOCTYPE html>
<html>
<head>
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">

    <title>Hello World</title>

    <!--<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css'>-->
    <!--debug IE chay duoc lap (1) combine use (***)---> <link rel='stylesheet' href='https://hrm.dnd.vn/media/css/vendors.bundle.bootstrap.css'>-->
   
</head>
<body translate="no">

    <div class="bubble_chat_msg_body d-none">


        <div class="home-page__content messages-page">

            <div class="container-fluid h-100">
                <div class="row px-0 h-100">
                    <!-- start message list section  -->
                    <div class="col-12 col-md-4 col-lg-5 col-xl-3 px-0 messages-page__list-scroll">

                        <div class="messages-page__header mb-0 px-4 pt-3 pb-3">
                            <span class="messages-page__title">Events</span>
                            <div class="messages-page__dark-mode-toogler">
                                <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon svg-icon--dark-mode" viewBox="0 0 49.7 49.7">
                                    <path d="M25.4,49.7A25.6,25.6,0,0,1,1.3,32.3,25.6,25.6,0,0,1,17.3.1a2,2,0,0,1,2.1.5,2.2,2.2,0,0,1,.5,2.1,19.9,19.9,0,0,0-1.2,6.8A21,21,0,0,0,25,24.7,21,21,0,0,0,40.2,31h0a20.9,20.9,0,0,0,6.9-1.2,2,2,0,0,1,2.5,2.5,25.8,25.8,0,0,1-16,16.1A28.7,28.7,0,0,1,25.4,49.7ZM15,5.5A21.4,21.4,0,0,0,5.1,31.1,21.5,21.5,0,0,0,15.9,43.4a21.2,21.2,0,0,0,28.3-8.8,17.5,17.5,0,0,1-4,.4h0a24.9,24.9,0,0,1-18-7.5,24.9,24.9,0,0,1-7.5-18A26.9,26.9,0,0,1,15,5.5Z" fill="#f68b3c" />
                                </svg>
                            </div>
                        </div>
                        <div class="messages-page__search mb-0 px-3 pb-3">
                            <div class="custom-form__search-wrapper">
                                <input type="text" class="form-control custom-form"  placeholder="Search …" autocomplete="off">
                                <button type="submit" class="custom-form__search-submit">
                                    <i class="ti-search"></i>
                                    <i class="fa fa-times-circle text-danger" style="display:none;font-size: larger;"></i>
                                </button>
                            </div>
                        </div>

                        <ul class="messages-page__list pb-5 px-1 px-md-3">

                            <li class="messaging-member messaging-member--new messaging-member--online">

                                <div class="messaging-member__wrapper">
                                    <div class="messaging-member__avatar">
                                        <img/>
                                        <div class="hieu-badge partition-red badge_regis_cnt"></div>
                                    </div>

                                    <span class="messaging-member__name">Bessie Cooper</span>
                                    <span class="messaging-member__message">Yes, I need your help with the project, it need it done by tomorrow 😫</span>
                                </div>
                            </li>

                            <!--<li class="messaging-member messaging-member--online messaging-member--active">
                                <div class="messaging-member__wrapper">
                                    <div class="messaging-member__avatar">
                                        <img src="https://randomuser.me/api/portraits/thumb/women/56.jpg" alt="Jenny Smith" loading="lazy">
                                        <div class="user-status"></div>
                                    </div>

                                    <span class="messaging-member__name">Jenny Smith</span>
                                    <span class="messaging-member__message">Perfect, thanks !</span>
                                </div>
                            </li>-->

                        </ul>
                    </div>
                    <!-- end message list section  -->
                    <!-- start content section  -->
                    <div class="chat_khuvuc col-12 col-md-8 col-lg-7 col-xl-6 px-0 pl-md-1">
                        <div class="chat__container">
                            <div class="chat__wrapper pt-2">

                                <div class="d-none chat__messaging messaging-member--online pb-2 pb-md-2 pl-2 pl-md-4 pr-2">
                                    <div class="chat__previous d-none d-md-none">
                                        <i class="ti-arrow-left mr-2"></i>
                                    </div>
                                    <div class="chat__notification d-none d-md-none chat__notification--new">
                                        <span>1</span>
                                    </div>
                                    <div class="chat__infos pl-2 pl-md-0">
                                        <div class="chat-member__wrapper" data-online="true">
                                            <i class="btn ti-reload chat_reload d-none"></i>
                                            <div class="chat-member__avatar d-none">
                                                <img/>
                                                <div class="user-status user-status--large d-none"></div>
                                            </div>
                                            <div class="chat-member__details">
                                                <span class="chat-member__name">Jenny Smith</span>
                                                <span class="chat-member__status">Online</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chat__actions mr-2 ">
                                        <ul class="m-0">
                                            <li class="chat__details d-flex d-xl-none">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon" viewBox="0 0 42.2 11.1">
                                                    <g>
                                                        <circle cx="5.6" cy="5.6" r="5.6" fill="#d87232" />
                                                        <circle cx="21.1" cy="5.6" r="5.6" fill="#d87232" />
                                                        <circle cx="36.6" cy="5.6" r="5.6" fill="#d87232" />
                                                    </g>
                                                </svg>
                                            </li>
                                        </ul>

                                    </div>
                                </div>
                                
                                <div class="chat__content pt-3 px-lg-3">
                             
                                </div>

                            </div>
                        </div>
                    </div>
                    <!-- end content section  -->
                    <!-- start infos section  -->
                    <div class="col-12 col-md-5 col-lg-4 col-xl-3 px-4 px-sm-5 px-lg-4 user-profile">
                        <div class="user-profile__close d-flex d-xl-none">
                            <i class="ti-close"></i>
                        </div>
                        <div class="user-profile__wrapper">
                            <div class="user-profile__avatar">
                                <img  loading="lazy">
                            </div>
                            <div class="user-profile__details mt-1">
                                <span class="user-profile__name">Jenny Smith</span>
                                <span class="user-profile__phone">(025) 015-234-567</span>
                                <span class="user-profile__location d-none">New York, United States</span>
                            </div>
                            <div class="user-profile__description d-none">
                                <p>Fly me to the moon 🌙 If you feel like your life is a routine, step back and take a deep breath.</p>
                            </div>
                            <div class="user-profile__learning mt-4 d-none">
                                <span class="user-profile__label">Social Medias</span>
                                <ul class="user-profile__tags user-profile__tags--primary mt-2">
                                    <li><a href="https://www.instagram.com/tiantsoa_sh/" target="_blank">Instagram</a></li>
                                    <li><a href="https://www.linkedin.com/in/tiantsoa-rabemananjara-254655152/" target="_blank">Linkedin</a></li>
                                    <li><a href="https://codepen.io/tiantsoa" target="_blank">Codepen</a></li>
                                </ul>
                            </div>
                            <div class="user-profile__hobbies d-none">
                                <span class="user-profile__label">Activities</span>
                                <ul class="user-profile__tags user-profile__tags--secondary mt-2">
                                    <li>Biking</li>
                                    <li>Cooking</li>
                                    <li>Traveling</li>
                                    <li>Grahic design</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- end infos section  -->
                </div>
            </div>

        </div>



    </div>


    <script type="text/javascript">
        function myJavaScriptFunc(act, jString) {
            console.log(act, new Date().getTime(), jString);
            //document.getElementById('helloguy').style.backgroundColor = 'blue';
        }
    </script>


    <!--debug IE chay duoc lap (2) combine use (***) --->  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js'></script>-->

    <script  type="text/javascript">

        /* ===================================

            https://codepen.io/tiantsoa/pen/RwpwoWY
            Screen resize handler
        ====================================== */
        (function () {

            "use strict";
            //debugger;

            const chat__content = $('.chat__content'),

                    chat__infos = chat__content.prev().find('.chat__infos'),

                    $chat = chat__infos.closest(".chat_khuvuc"),

                    bubble_chat_msg_body = $chat.closest('.bubble_chat_msg_body'),

                    $profile = $chat.next(),// $(".user-profile"),

                    smallDevice = window.matchMedia("(max-width: 767px)"),

                    largeScreen = window.matchMedia("(max-width: 1199px)"),
                    evt = smallDevice.addEventListener ? 'addEventListener' : 'addListener',

                    guylst = $chat.prev().find('.messages-page__list'),

                    rawUI = [guylst.find('li:first')[0].outerHTML],

                    iniUI = function () {
                        //
                        //loai nay la cua tung nhan vien, nen ko can hien thi guylist

                        if (qryU['ki'] == "2") {
                            //
                            $chat.addClass('chat--show');
                            //
                            chat__infos.find('.chat-member__avatar').addClass('d-none');// hide hinh tren title bar vi Main GUY da show hinh
                            //
                            chat__infos.prev().removeClass('d-flex').addClass('d-none')//badge count
                                .prev().removeClass('d-flex').addClass('d-none');//nut previous

                            //
                        } else {//loai nay la cua group guy ...
                            //
                            $chat.remove('chat--show');
                            //tam thoi chua hien thi badge number 
                            chat__infos.prev()/*.removeClass('d-none').addClass('d-flex')*/.prev().removeClass('d-none').addClass('d-flex');
                            //
                        };
                    }
            , searchIPT = $chat.prev().find('.messages-page__search input').on('keyup', function () {
                // debugger;
                const searchString = this.value;

                guylst.find('li').each(function (index, value) {

                    const li=$(value),exsearch=  li.data('exsearch'), currentName = li.text() +  (exsearch ?exsearch:'');

                    if (currentName.toUpperCase().indexOf(searchString.toUpperCase()) > -1) {

                        li.show();

                    } else {

                        li.hide();

                    }

                });
            });

            searchIPT.next().on('click', '.fa', function (e) {
                searchIPT.val('').trigger('keyup');
            });

            //
            guylst.empty();//clear het
            //
            //
            iniUI();
            //
            //
            smallDevice[evt]("change", handleDeviceChange);
            largeScreen[evt]("change", handleLargeScreenChange);

            handleDeviceChange(smallDevice);
            handleLargeScreenChange(largeScreen);

            function handleDeviceChange(e) {
                if (e.matches) chatMobile(); else
                    chatDesktop();
            }

            function handleLargeScreenChange(e) {
                if (e.matches) profileToogleOnLarge(); else
                    profileExtraLarge();
            }

            function chatMobile() {
                $chat.addClass("chat--mobile");
            }

            function chatDesktop() {
                $chat.removeClass("chat--mobile");
            }

            function profileToogleOnLarge() {
                $profile.addClass("user-profile--large");
            }

            function profileExtraLarge() {
                $profile.removeClass("user-profile--large");
            }

            /* ===================================
                Events
            ====================================== */
            function notiCOUNT(cnt, offs) {
                //
                const btn = chat__infos.prev(),
                    isBubble = window['_cordovaNative'] && qryU.hasOwnProperty('timegold_regisview');
                //
                if (offs > 0) {
                    cnt = parseInt(btn.text()) + offs + 1;
                }
                //
                return btn[(cnt > 2 && (qryU['ki'] == "1" || (!isBubble && notiCOUNT._REG_COF_newui == 1)) ? 'remove' : 'add') + 'Class']('d-none').html('<span>' + (cnt - 1) + '</span>');
                //
            };

            function view_REGIS(li) {
                //debugger;

                if (!li) {
                    delete chat__details.__guyINF;
                    //debugger;
                    return;
                };
                //
                //
                //dung de view detail
                chat__details.__guyINF = [li.data('guyinf')];
                //
                //
                const da = li.data('regIDs'),
                    no_ = 'reg_no_',
                   uiMOI= li.data('uiMOI');
                //
                var cnt = 1;
                //
                //
                if (uiMOI == '-1') {
                    //
                    srclocked(true);
                    //
                };
                //
                //
                setTimeout(function () {
                    //
                    //
                    if (uiMOI == '-1') {
                        //
                        //gio di load vao mobile UI
                        //diable load lai 
                        li.data('uiMOI', '1');
                        //
                        //
                        chat__content.trigger('listenCMD', ['newUI_LOD', da]);
                        //
                    };
                    //
                    //
                    //debugger;
                    //
                    chat__content.find(".act_cmm_tmpl").each(function (w, reg) {
                        //

                        console.log('chat__content.find(".act_cmm_tmpl").each(function (w, reg) ', w);

                        const re_no = $(reg).find("div[id^=" + no_ + "]");

                        if (da.indexOf(re_no[0].id.split(no_)[1]) > -1) {

                            if (cnt == 1) {
                                var ava = chat__infos.find('.chat-member__avatar').removeClass('d-none'),
                                    inf = li.find('img');

                                ava.find('img').attr('src', inf.attr('src'));

                                ava = chat__infos.find('.chat-member__name'); inf = inf.parent().next();
                                ava.html(inf.text());
                                ava = ava.next(); inf = inf.next();
                                ava.html(inf.text());
                            };
                            //
                            //
                            re_no.prev().find('.reco-no').html(cnt);
                            //
                            cnt++;
                            //
                            $(reg).removeClass('d-none');
                            //
                        } else {
                            $(reg).addClass('d-none');
                        }
                    });
                    //
                    //
                    $chat.fadeIn('slow', function () {
                        //send focusGUY key to native
                        snd_native_msg(['GUY_FOCUSED'].concat(li.data('guyinf')));// )  'GUY_FOCUSED', li.data('guyinf'));
                        //
                        li.removeClass('messaging-member--new');
                        //
                        srclocked(false);
                        //
                    });
                    //
                    $chat.addClass("chat--show");
                    //
                    notiCOUNT(cnt, 0).prev().removeClass('d-none');
                    //
                }, 50);
            };


            guylst.on('click', ".messaging-member", function (e) {
                //
                //debugger;
                //
                const li = $(e.currentTarget),
                    guyinf = li.data('guyinf');

                //
                mod_uri._focusGUY = guyinf[0];
                //
                //console.log(' mod_uri._focusGUY: ', mod_uri._focusGUY, 'guyinf', guyinf);
                //
                if (guyinf[guyinf.length - 1] == "2") {//2 nghia la tam thoi ... phai load lai

                    reload_regis();

                } else {
                    view_REGIS(li);
                }
                //
            });




            $(".chat__previous").click(function (e) {

                //debugger;

                if (reload_regis._msg2Native) {

                    fn_103100100(reload_regis._msg2Native);

                    delete reload_regis._msg2Native;

                };

                //
                $chat.removeClass("chat--show");
                //
                //
                //if ($(e.currentTarget).hasClass('rebuild_guylst')) {

                //    srclocked(true);

                //    setTimeout(function () {

                //        reload_regis();

                //    }, 100);

                //    $(e.currentTarget).removeClass('rebuild_guylst')
                //};
                //
                //
                //khi quay ve main guy lis thi coi nhu ko ai focus.
                snd_native_msg(['GUY_FOCUSED', "-1"]);
                //
                chat__infos.find('.chat_reload').addClass('d-none');
                //
            });

            
            const chat__details = function () {


                var LOD = $profile.data("LOD"),
                    atEm=chat__details.__guyINF[0];

                if (!LOD || LOD[0] != atEm[0]) {
                    //
                    $profile.data("LOD", atEm);
                    //
                    chat__content.trigger('listenCMD', ['emppic', [

                            [

                                $profile.find('img')[0],

                                btoa(atEm[0]),//usrid bubble chat key.

                                (window._cordovaNative ? window._cordovaNative.__._e$UI['bosI'] : '')

                            ]

                    ]

                    ]);
                };
                //

                //debugger;
                //$('#init_chathome_bg').trigger('theme');

                const inf = $profile.find('.user-profile__details span');
                inf[0].innerHTML= atEm[3];//emp name
                inf[1].innerHTML = atEm[0] + ' / ' + atEm[1] + ' / ' + atEm[2];//emp name
                //
                $profile.fadeIn();
                $profile.addClass("user-profile--show");


            };



            $(".chat__details").click(chat__details);
            $(".user-profile__close").click(function () {
                $profile.removeClass("user-profile--show");
            });

            $(".messages-page__dark-mode-toogler").click(function (e,arg) {
                //
                e.preventDefault();
                e.stopPropagation();
                //debugger;
                //
                if (window['cS$']) {
                    //
                    //run in hellohrm ...
                    var them = 'dark-mode';

                    if (bubble_chat_msg_body.hasClass(them)) {
                        them = '-1';
                    } else {
                        them = '-2';
                    }
                    //
                    //doi class them ve container chat
                    $('input[name=setting-theme][value=theme' + them + ']').trigger("change");
                    //
                };
                //
                bubble_chat_msg_body.toggleClass("dark-mode");
                //
            });

            function giaotiepevt(e) {
                //
                console.log('giaotiepevt');


                if (qryU['timegold_regisview'] == undefined) {

                    //new UI

                    if (cS$.c0lor == 'dark') {
                        bubble_chat_msg_body.addClass("dark-mode");
                    } else {
                        bubble_chat_msg_body.removeClass("dark-mode");
                    }

                } else {
                    if (e) {
                        //do user click, 
                        if (w0w['_cordovaNative']) {
                            //
                            //console.log('giaotiep call native', new Date().getTime());
                            //
                            //code nay duoc viet trong file https://hellohrm.github.io/utils/pagelands/js/liway_android_index.js
                            //hieu_comjs nay se hieu luc o file WebViewJavaScriptInterface

                            w0w._cordovaNative.__.hieu_comjs('THEME', cS$.c0lor == 'dark' ? "#1a1a1a" : "#ffffff");

                        };
                    }
                    //
                    const them = cS$.c0lor + 'color';
                    //
                    chat__content.removeClass('darkcolor lightcolor').addClass(them);
                    //
                    //default trong main.js no set cho body.
                    $(document.body).removeClass('darkcolor lightcolor');
                    //
                }
                //
            };
            //
            //
            //load lan dau tien ko goi tin hieu them, vi reg_lv dang load server, arrow se bi khac color.
            //se update trong chat_home o liway_android_index.js
            giaotiepevt(/*ko co tham so, de phan biet voi user click action*/);
            //
            //#init_bg o trong file buble_msg.html trong android native
            $('#init_chathome_bg').removeClass('ekko-lightbox-loader').removeAttr('style').addClass('postion-absolute giaotiepevt')
                .on('theme', giaotiepevt); //khi view tren app android, thi co 1 khung background voi round border top-left top-right
            //
            //



            const mod_uri = function (args, ki) {
                //
                //
                //
                if (ki != qryU['ki']) {
                    //ko duoc dung chung voi ai, vi no la object ....
                    GRP_GUY_TYP.___regLST = [].slice.apply(args, [0]);
                };
                //
                //
                // are the new history methods available ?
                if (window.history != undefined && window.history.pushState != undefined) {
                    //
                    //remove url query string 
                    qryU['timegold_regisview'] = args[1];
                    if (ki) qryU['ki'] = ki;
                    //
                    var newREG = $.map(qryU, function (v, k) {
                        return k + '=' + qryU[k];
                    }).join('&');
                    //
                    //
                    window.history.pushState({}, document.title, window.location.pathname + '?' + newREG);
                    //
                    //vao ben JS_relv.js se encode lai.
                    //******** muc dich la se dung LOD_REG_DAT trong JS_relv.js
                    console.log('before ', apisvr.review_regis);
                    apisvr.review_regis = decodeURIComponent(args[1]);
                    console.log('after ', apisvr.review_regis);
                    //
                };
                //
                //
                //focusGUY ben native goi qua
                mod_uri._focusGUY = args[4];
                //
                //
                const msg = [].slice.apply(args, [0]);
                //
                if (mod_uri._focusGUY == "-1") {
                    //ko co focus guy thi hide registration
                    $chat.removeClass("chat--show");
                } else {
                    //
                    //luu giu lai tham so de call tro lai navitive java khi reload xong
                    msg[0] = 'CLEAR_RELOAD';
                    reload_regis._msg2Native = msg;

                    console.log('reload_regis._msg2Native: ', msg);
                }
                //
            }
            //,

            //focusGUY_INF = function (emI) {
            //    //if (qryU.hasOwnProperty("senderinf")) {
            //    //    const gUy = JSON.parse(decodeURIComponent(qryU["senderinf"]));
            //    //    return [gUy[10] /*emI.usrid.toString()*/, gUy[11]/*emI.EmpCode*/, _La$N('js_001_21|' + gUy[8], ), gUy[12] /*emI.EmpName*/];
            //    //} else {aLAN
            //        return [emI.usrid.toString(), emI.EmpCode, emI.ff_gt, emI.EmpName];
            //    //}
            //}
            ,
            reload_regis = function () {

                var piltab = $('#tabBODY_JS_reglv a.nav-link[mnu="1"]');
                piltab.removeClass('active').trigger('click');

                //window.location.replace(location.href.split('#')[0]);

            }
            ,

            each_GUY = function (gUy, guyTPY,uiMOI) {

                var li = $(rawUI[0]),

                    na = li.find('.messaging-member__name'),

                    emI = gUy[0],

                    dlzy = btoa(emI.usrid),

                    im = na.prev().find('img').attr('data-lazy', dlzy),

                    guyinf = [emI.usrid.toString(), emI.EmpCode, emI.ff_gt, emI.EmpName],

                    EmpName = guyinf.splice(-1, 1)[0];

                //
                na.html(EmpName);

                na.next().html(guyinf.join(' / '));
                //
                //
                guylst.append(li);
                //
                var exsearch = [];
                //
                //luu giu lai cac regid tung GUY...
                li.data('regIDs', $.map(gUy, function (v, k) {
                    //
                    const srch = (v.ff_usrid ? v.ff_usrid : '') + (v.ff_EmpCode ? v.ff_EmpCode : '') + (v.ff_EmpName ? v.ff_EmpName : '');
                    if (srch.trim() != '') {
                        exsearch.push(srch);
                    };

                    return v.regid.toString();
                    //
                }));
                //
                //danh dau la UI moi
                li.data('uiMOI', uiMOI);
                //
                //them empname vao
                li.data('exsearch', exsearch.join(''))//note no se modify luon source ...
                //
                //
                //guyinf = guyinf.concat([emI.EmpName]);
                //console.log(guyinf);
                const regis_cnt = gUy.length;

                li.data('guyinf', guyinf.concat([EmpName, regis_cnt.toString(), guyTPY.toString()]));



                console.log('each_GUY = function (gUy, guyTPY)', li.data('guyinf'));



                //
                im.next().text(regis_cnt > 1 ? regis_cnt : '');
                //
                ///
                // se bat focus nhan vien 
                if (mod_uri._focusGUY == guyinf[0]) {
                    //
                    reload_regis.__view_REGIS = li;
                    //
                };
                //
                //
                return [
                          im[0],
                          dlzy
                ];
            }

            ,

            snd_native_msg = function (msg) {
                if (w0w._cordovaNative && w0w._cordovaNative.__) w0w._cordovaNative.__.hieu_comjs.apply(null, msg);// )  'GUY_FOCUSED', li.data('guyinf'));
            }

            ,

            arrayDiff = function (firstArr, secondArr) {

                var i, o = [], fLen = firstArr.length, sLen = secondArr.length, len;


                if (fLen > sLen) {
                    len = sLen;
                } else if (fLen < sLen) {
                    len = fLen;
                } else {
                    len = sLen;
                }
                for (i = 0; i < len; i++) {
                    if (firstArr[i] !== secondArr[i]) {
                        o.push({ idx: i, elem1: firstArr[i], elem2: secondArr[i] });  //idx: array index
                    }
                }

                if (fLen > sLen) {  // first > second
                    for (i = sLen; i < fLen; i++) {
                        o.push({ idx: i, 0: firstArr[i], 1: undefined });
                    }
                } else if (fLen < sLen) {
                    for (i = fLen; i < sLen; i++) {
                        o.push({ idx: i, 0: undefined, 1: secondArr[i] });
                    }
                }

                return o;
            }

            ,

            fn_101100100 = function (args) {
                //


                //debugger;



                fn_103100100(args);







                //chathead chuyen trang thai tu Main Guy -> Guy List, 
                //
                //mod_uri(args, 1);
                //



                // are the new history methods available ?
                var tha = window._cordovaNative.__
                    , ava = chat__infos.find('.chat-member__avatar').removeClass('d-none');
                //
                if (mod_uri._focusGUY == "-1") {


                } else {
                    //
                    chat__content.trigger('listenCMD', ['emppic', [

                        [

                            ava.find('img')[0],

                            btoa(mod_uri._focusGUY),//usrid bubble chat key.

                            tha._e$UI['bosI']
                        ]

                    ]

                    ]);
                };
                //
                ////////1. get list of guy
                //////const rawLST = args[args.length - 1].split(String.fromCharCode(30));
                //////for (var w = 0; w < rawLST.length ; w++) {
                //////    //
                //////    var gUy = JSON.parse(rawLST[w]),
                //////        usrid = gUy[10],

                //////        it = {
                //////            regid: gUy[1],
                //////            usrid: usrid,
                //////            EmpCode: gUy[11],
                //////            EmpName: gUy[12],
                //////            ff_gt: 'NAM'
                //////        }
                //////        ,

                //////        eV = guyLST[it.usrid] || (guyLST[it.usrid] = []);

                //////    //
                //////    eV.push(it);
                //////    //
                //////};
                ////////
                ////////
                //////for (var i in guyLST) {

                //////    if (guyLST.hasOwnProperty(i)) {
                //////        //
                //////        //
                //////        //if (guyLST[i].usrid == mod_uri._focusGUY) {
                //////        //    focusGUY = guyLST[i].usrid;
                //////        //};
                //////        //
                //////        //
                //////        var lazyIMG = each_GUY(guyLST[i], "2");
                //////        //
                //////        chat__content.trigger('listenCMD', ['emppic', [
                //////                lazyIMG.concat([
                //////                    tha._e$UI['empI'] // ve ben kia mac dinh se lay hinh avatar employees
                //////                ])
                //////        ]
                //////        ]);
                //////    }
                //////};
                //
                //hien arrow back
                chat__infos.prev().prev().removeClass('d-none').addClass('d-flex');
                //va add flag click se reload lai GUY LIST
                //.addClass('rebuild_guylst');
                //
            }
            ,

            fn_103100100 = function (args) {//103,100,100 : logo head focus + open , new guy income, -> update list guy

                //debugger;

                

                //change uri 
                mod_uri(args, 1);
                //
                //
                var RE='',guyLST = {}, eLST = [];
                //
                //
                //1. get list of guy
                const tha = window._cordovaNative.__,
                    rawLST = args[args.length - 1].split(String.fromCharCode(30));

                for (var w = 0; w < rawLST.length ; w++) {
                    //
                    var gUy = JSON.parse(rawLST[w]),

                        usrid = gUy[10],

                        it = {
                            regsta: gUy[0],
                            regid: gUy[1],
                            usrid: usrid,
                            EmpCode: gUy[11],
                            EmpName: gUy[12],
                            ff_gt: 'NAM'
                        }

                        ,

                        eV = guyLST[it.usrid] || (guyLST[it.usrid] = []);

                    //
                    if (eLST.indexOf(usrid.toString()) == -1) eLST.push(usrid.toString());
                    //
                    eV.push(it);
                    //
                };
                //
                //
                //
                //2. remove guy in list ko co trong guyLST
                guylst.find('li').each(function (z, it) {

                    var li = $(it), guyinf = li.data('guyinf');

                    var idx = eLST.indexOf(guyinf[0]);
                    if (idx > -1) {
                        //
                        //update thong tin guy nay.
                        const regIDs = $.map(guyLST[eLST[idx]], function (v, k) {
                            return v.regid.toString();
                        })
                        ,
                        diff = arrayDiff(li.data('regIDs'), regIDs);
                        //
                        //luu giu lai cac regid tung GUY...
                        if (diff.length > 0) {
                            //
                            var guyinf = li.data('guyinf');
                            const regis_cnt = guyLST[eLST[idx]].length, inf = guyinf.length;
                            //
                            //guyinf.concat([emI.EmpName, regis_cnt.toString(), guyTPY.toString()])
                            guyinf[inf - 2] = regis_cnt.toString();//cap nhat so luong
                            guyinf[inf - 1] = "2";//danh dau thay doi




                            //console.log("guylst.find('li').each(function (z, it)", li.data('guyinf'));



                            //add nguoc lai
                            li.data('guyinf', guyinf);
                            //

                            //
                            li.find('img').next().text(regis_cnt > 1 ? regis_cnt : '');
                            //
                        };
                        //
                        eLST.splice(idx, 1);

                    } else {
                        //
                        //loai bo guy li ra khoi guy list
                        li.remove();
                        //
                    };
                });
                //
                //
                //fill new GUY to list
                for (var i in guyLST) {

                    if (guyLST.hasOwnProperty(i)) {
                        //
                        var usrid = guyLST[i][0].usrid.toString(),
                              kindLI = "2";
                        //
                        //
                        if (eLST.indexOf(usrid) > -1) {
                            //
                            //
                            //
                            //co focus guy
                            if (mod_uri._focusGUY == usrid && guyLST[i].length == 1) {
                                //neu co tim regno
                                const __regis = chat__content.find(".act_cmm_tmpl #reg_no_" + guyLST[i][0].regid);
                                //
                                //ko can thay doi loai Li nay, vi no duoc load len roi
                                if (__regis.length > 0) {
                                    kindLI = "1";
                                } else {
                                    //debugger;
                                    if (qryU['ki'] == '1') {
                                        //loai logo,
                                        $chat.removeClass("chat--show");
                                        //
                                        snd_native_msg(['GUY_FOCUSED', "-1"]);
                                        //
                                    }
                                }
                            };
                            //
                            //
                            //
                            var lazyIMG = each_GUY(guyLST[i], kindLI, '1');
                            //
                            chat__content.trigger('listenCMD', ['emppic', [
                                    lazyIMG.concat([
                                        tha._e$UI['empI'] // ve ben kia mac dinh se lay hinh avatar employees
                                    ])
                            ]
                            ]);
                        }
                        //
                    };
                };
                //
            }

            ,
            eachREG_INF = function (rawLST, regDAT) {

                var guyLST = {}, eLST = []

                    ,

                    realREG = $.map(regDAT, function (v, k) {
                        return v.regid.toString();
                    });



                console.log('rawLST', rawLST);
                console.log('realREG', realREG);

                for (var w = 0; w < rawLST.length ; w++) {
                    //
                    var gUy = JSON.parse(rawLST[w]),

                        usrid = gUy[10],

                        it = {
                            regsta: gUy[0],
                            regid: gUy[1],
                            usrid: usrid,
                            EmpCode: gUy[11],
                            EmpName: gUy[12],
                            ff_gt: 'NAM'
                        }

                        ,

                        eV;



                    if (realREG.indexOf(it.regid.toString()) > -1) {

                        eV = guyLST[it.usrid] || (guyLST[it.usrid] = []);

                        //
                        if (eLST.indexOf(usrid.toString()) == -1) eLST.push(usrid.toString());
                        //
                        eV.push(it);
                    };
                    //
                };
                //
                return [guyLST, eLST];
                //
            }

            ,

            GRP_GUY_TYP = function (regDAT) {
                //
                var gUy;
                //
                if (GRP_GUY_TYP.___regLST) {

                    const args = GRP_GUY_TYP.___regLST
                        , rawLST = args[args.length - 1].split(String.fromCharCode(30));


                    gUy = eachREG_INF(rawLST, regDAT);


                    console.log(gUy);

                    //lan dau khi open window chat head ->  send reglist to GRP_GUY_TYP.___regLST
                    //chi su dung 1 lan.
                    //if (qryU['ki'] == "1") {
                    //    delete GRP_GUY_TYP.___regLST;
                    //};

                } else {
                    //
                    //group theo user dang ky
                    //
                    var eLST = []
                        ,

                        guyLST = regDAT.reduce(function (rs, it) {
                            //
                            //console.log(mod_uri._focusGUY + ' / ' + it.usrid);
                            //if (it.usrid == mod_uri._focusGUY) {
                            //    focusGUY = it.usrid;
                            //};
                            //
                            var usrid = it.usrid,
                                eV = rs[it.usrid] || (rs[it.usrid] = []);
                            //
                            eV.push(it);
                            //
                            //
                            if (eLST.indexOf(usrid.toString()) == -1) eLST.push(usrid.toString());
                            //
                            return rs;

                        }, {});



                    gUy = [guyLST, eLST];
                }
                //
                return gUy;
                //
            }
            ,
            NEW_UI_LST = function (elUI ) {
                //
                var regDAT=elUI.regDAT.R
                    ,

                    SND = elUI.regDAT.GOI
                    ,
                    eLST = []

                    ,

                    cacheE = {}
                    ,

                    guyLST = regDAT.reduce(function (rs, it) {
                        //
                        var usrid = it.usrid, VAL, eV;
                        //
                        //
                        //
                        if (it.regsta > 101 && SND && SND[it.regid]) {
                            //
                            //
                            //group theo nguoi handler
                            const E = SND[it.regid][0];

                            //

                            //
                            //
                            usrid = E.usrid;
                            //
                            //
                            VAL = {
                                regsta: it.regsta,
                                regid: it.regid,
                                usrid: usrid,
                                EmpCode: "BOSS",
                                EmpName: E.EmpName,
                                ff_gt: "<i class='ti-pencil'></i>"
                            };

                            if (!VAL.EmpName) {
                                //
                                if (cacheE.hasOwnProperty(usrid)) {
                                    //debugger;
                                    VAL.EmpName = cacheE[usrid];
                                } else {
                                    chat__content.trigger('listenCMD', ['getE', VAL, it.flowMark]);
                                    cacheE[usrid] = VAL.EmpName;//backup lai
                                };
                                //
                            }



                        };

                        eV = rs[usrid] || (rs[usrid] = []);
                        //
                        eV.push(VAL || it);

                        if (eLST.indexOf(usrid.toString()) == -1) eLST.push(usrid.toString());

         
                        //
                        return rs;

                    }, {});



                return [guyLST, eLST];
                //
            };

            Mr_WEB.chat_ui= function (elUI, flowIMG, regis_dat) {
                //
                //debugger;
                //
                if (elUI.flagRESET == 1) {
                    mod_uri._focusGUY = -1;
                }
                delete elUI.flagRESET;
                //
                //
                //1. group nhan vien dang ky ------------------------
                var tha = window._cordovaNative ? window._cordovaNative.__:null;

                //
                //const gUy = elUI.regDAT.R.reduce(function (rs, it) {
                //    //
                //    //console.log(mod_uri._focusGUY + ' / ' + it.usrid);

                //    if (it.usrid == mod_uri._focusGUY) {
                //        focusGUY = it.usrid;
                //    };
                //    //
                //    var eV = rs[it.usrid] || (rs[it.usrid] = []);
                //    //
                //    eV.push(it);
                //    //
                //    cnt++;
                //    //
                //    return rs;
                //}, {})


                notiCOUNT._REG_COF_newui = elUI.REG_COF.newui;


                const isBubble = window['_cordovaNative'] && qryU.hasOwnProperty('timegold_regisview'),


                    gUyNEW = notiCOUNT._REG_COF_newui == 1 ? NEW_UI_LST(elUI) : GRP_GUY_TYP(elUI.regDAT.R),



                gUy = gUyNEW[0],


                cnt = gUyNEW[1].length,



                //2. chat content title bar display 
                baR = chat__content.prev()[(cnt > 0 ? 'remove' : 'add') + 'Class']('d-none'),

                uiMOI = !isBubble && notiCOUNT._REG_COF_newui == 1;
                //
                //console.log('chat_ui here: ',new Date().getTime());
                //
                //
                if (qryU['ki'] == "1" || uiMOI) {// list guy
                    //
                    //chat-member__name
                    //
                    //
                    //3. render left guy list
                    var eLST = [],

                        batbuoc = function (key,isRMV) {
                            //
                            if (gUy.hasOwnProperty(key )) {

                                var lazyIMG = each_GUY(gUy[key], "1", uiMOI?'-1':'1');

                                flowIMG.bind(lazyIMG.concat(
                                    [
                                            elUI.empI // ve ben kia mac dinh se lay hinh avatar employees
                                    ]
                                ))();
                                //
                                //remove ra
                                if (isRMV == 1) delete gUy[key];
                            };
   
                        };
                    //
                    guylst.find('li').each(function (z, it) {
                        const guyinf = $(it).data('guyinf');
                        eLST.push(guyinf[0]);
                    });
                    //
                    //
                    guylst.empty();//clear het
                    //
                    //
                    //
                    if (mod_uri._focusGUY == -1 || !gUy[mod_uri._focusGUY] || gUy[mod_uri._focusGUY].length == 0) {
                        //ko co focus guy thi hide registration
                        $chat.removeClass("chat--show");
                        //
                        delete reload_regis.__view_REGIS;
                        //
                    } else if (regis_dat && regis_dat[2] == 30) {

                        //khi goi GUY the last one thi tro ve man hinh list GUY.
                        if (gUy[mod_uri._focusGUY]) {

                            //ham nay duoc goi trong MainActivity.java , dung de remove regis.
                            if (tha) tha.bubble_sync_main('test', encodeURIComponent(JSON.stringify([2, regis_dat[1], 2])));

                            var atF = gUy[mod_uri._focusGUY];
                            for (var F = atF.length - 1; F > -1; F--) {
                                if (atF[F].regid == regis_dat[1].regid) {
                                    atF.splice(F, 1);
                                }
                            };
                            //
                            if (atF.length == 0) {
                                delete gUy[mod_uri._focusGUY];
                                const atE = eLST.indexOf(mod_uri._focusGUY);
                                if (atE > -1) eLST.splice(atE, 1);

                                $chat.removeClass("chat--show");
                                //
                                delete reload_regis.__view_REGIS;
                            };
                        }

                    };




                    //
                    //
                    //load theo thu tu cu, va remove 
                    for (var w = 0; w < eLST.length; w++) {
                        batbuoc(eLST[w], 1);
                    };
                    //

                    //
                    //
                    //load nhung guy con lai
                    for (var i in gUy) {

                        batbuoc(i);

                        //http://192.168.1.91:10996/media/utils/pagelands/com/firewall_login.html?timegold_regisview=FKl393FP5cig0aQ1H4/HxltrQO9gyUwpTob/i+bqogI+4c4abWoOBbvk10WfjOTjjbgop6iDbcgR/tGfQZ5ao7iZfX777oXHMz1UBWzVv/U~&XDEBUG_SESSION_START=154A5348
                    }



                    if (reload_regis.__view_REGIS) {
                        //
                        setTimeout(function () {

                            view_REGIS(reload_regis.__view_REGIS);

                            delete reload_regis.__view_REGIS;
                            //
                        }, 100);
                    }
                    //
                    //
                    if (searchIPT.val().trim().length > 0) {
                        searchIPT.trigger('keyup');
                    };
                    //
                    //
                } else {
                    if (cnt > 0) {
                        for (var i in gUy) {

                            if (gUy.hasOwnProperty(i)) {
                                //
                                const emI = gUy[i][0],

                                    guyinf = [emI.usrid.toString(), emI.EmpCode, emI.ff_gt, emI.EmpName],

                                    EmpName = emI.EmpName;// guyinf.splice(-1, 1)[0];

                                chat__details.__guyINF = [[].concat(guyinf)];

                                guyinf.splice(-1, 1);

                                baR.find('.chat-member__name').html(EmpName).next().html(guyinf.join(' / '));
                                //
                            }
                        }
                    };
                    //
                    //
                };
                //
                //hide nut refresh ...
                chat__infos.find('.chat_reload').addClass('d-none');
                //
                if (reload_regis._msg2Native) {
                    //
                    //remove index cuoi cung, vi no la rawLST
                    reload_regis._msg2Native.splice(-1, 1);
                    //
                    snd_native_msg(reload_regis._msg2Native);// )  'GUY_FOCUSED', li.data('guyinf'));
                    //
                    delete reload_regis._msg2Native; //xong viec roi thi remove luon flag.
  
                };
                //
            };

            //extend them cac method chat_home
            if (window._cordovaNative) $.extend(window._cordovaNative.__, {

                '_e$UI': {},

                'chat_home': function (elUI, flowIMG) {
                    //
                    const them = cS$.c0lor + 'color',
                        tha = window._cordovaNative.__;
                    //
                    tha._e$UI['bosI'] = elUI.bosI;
                    tha._e$UI['empI'] = elUI.empI;
                    //
                    //
                    //
                    //
                    if (cS$.c0lor == 'dark') bubble_chat_msg_body.addClass(cS$.c0lor + '-mode');
                    //

                    bubble_chat_msg_body.attr('id', 'bubble_chat_msg_body').removeClass('d-none')
                    //"visibility": "hidden" se duoc ignore khi css load xong, vi trong do co #bubble_chat_msg_body {visibility:visible!important;}
                        .css({ "visibility": "hidden" });
                    //
                    //
                    chat__content.addClass(them).empty();
                    //
                    //mobi_raw['mobi_cmm'].closest('.container').appendTo(chat__content);
                    //
                    //doi class them ve container chat
                    $(document.body).removeClass(them);
                    //
                    //
                    //debugger;

                    GRP_GUY_TYP.___regLST = w0w._cordovaNative.__.hieu_comjs('THEME_and_REGLIST', cS$.c0lor == 'dark' ? "#1a1a1a" : "#ffffff")
                    //
                    //toi day moi goi tin hieu qua phone set arrow chat head 
                    if (!GRP_GUY_TYP.___regLST && w0w._cordovaNative.GRP_GUY_TYP_ios_regLST) {
                        GRP_GUY_TYP.___regLST = w0w._cordovaNative.GRP_GUY_TYP_ios_regLST;
                    };
                    //
                    //if (w0w.liway_android_index_hieu_comjs) {
                    //    w0w.liway_android_index_hieu_comjs('THEME_and_REGLIST', cS$.c0lor == 'dark' ? "#1a1a1a" : "#ffffff").then(dog_IOS);
                    //} else {
                    //    dog_IOS(w0w._cordovaNative.__.hieu_comjs('THEME_and_REGLIST', cS$.c0lor == 'dark' ? "#1a1a1a" : "#ffffff"));
                    //};
                    //




                    //setTimeout(function () {
                        //
                        if (GRP_GUY_TYP.___regLST) {
                            //
                            GRP_GUY_TYP.___regLST = GRP_GUY_TYP.___regLST.split(String.fromCharCode(29));
                            //
                            //focusGUY ben native goi qua
                            mod_uri._focusGUY = GRP_GUY_TYP.___regLST[4];
                        }
                        //
                        //
                        //debugger;
                        Mr_WEB.chat_ui(elUI, flowIMG);
                    //}, 1);
                    //
                    //debugger;
                    //console.log(_La$N('js_011_33|3', elUI.lan));
                        $('.messages-page__title').text(_La$N('js_011_33|3', elUI.lan) || 'Events').click(function (e) {

                            //var piltab = $('#tabBODY_JS_reglv a.nav-link[mnu="1"]');
                            //piltab.removeClass('active').trigger('click');
                        });
                    //
                    //
                    return chat__content;
                }
                
                ,
                listen_Native: function () {

                    //debugger;

                    console.log('listen_Native: ', new Date().getTime(), arguments);

                    const tha = window._cordovaNative.__;

                    switch (arguments[0]) {

                        case '100100100': {//GUY mode hien thi nut refresh
                            //
                            mod_uri(arguments);
                            //
                            //
                            chat__infos.find('.chat_reload').removeClass('d-none');
                            //
                            //
                            notiCOUNT(0, 1);
                            //
                            break;
                        }

                        case '101100100': {//LOGO mode
                            //
                            //debugger;

                            fn_101100100(arguments);
                            //
                            break;
                        }
                        case "102100100": {//reload immedately
                            //
                            mod_uri(arguments, arguments[3]);
                            //
                            iniUI();
                            //
                            //reload imedate ly nen ko can send back native clear flag reload
                            delete reload_regis._msg2Native;
                            //
                            reload_regis();
                            //
                            break;
                        }

                        case "103100100": {//103,100,100 : logo head focus + open , new guy income, -> update list guy
                            //
                            //debugger;

                            fn_103100100(arguments);
                            //
                            GRP_GUY_TYP.___regLST = [].slice.apply(arguments, [0]);
                            //
                            delete reload_regis._msg2Native; //xong viec roi thi remove luon flag.
                            //
                            break;
                        }

                        case '_backbtn': {
                            //
                            if ($profile.hasClass("user-profile--show")) {
                                $profile.removeClass("user-profile--show");
                            } else if ($chat.hasClass('chat--show')) {
                                $chat.removeClass('chat--show');
                            };
                            //
                            return "1";
                            break;
                        }

                    }



                }
            });

  






            chat__infos.on('click', '.chat_reload', function () {
                //
                //reload_regis.__view_REGIS = mod_uri._focusGUY;
                //
                //reset ???
                delete reload_regis.__view_REGIS;
                //
                reload_regis();
                //
            });


        })();

    </script>

</body>
</html>

